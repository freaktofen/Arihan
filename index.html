<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ø£Ø±ÙŠÙ‡Ø§Ù†</title>
<meta name="description" content="Ø£Ø±ÙŠÙ‡Ø§Ù† â€” Ù„Ø¹Ø¨Ø© Ù‚Ø±Ø§Ø±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ©. Ø£Ù†Øª Ø§Ù„Ù…Ù„ÙƒØŒ ÙˆÙƒÙ„ Ù‚Ø±Ø§Ø± ÙŠØºÙŠØ± Ù…ØµÙŠØ± Ø§Ù„Ù…Ù…Ù„ÙƒØ©.">
<meta name="theme-color" content="#080604">
<meta property="og:title" content="Ø£Ø±ÙŠÙ‡Ø§Ù† â€” Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…ØµÙŠØ±">
<meta property="og:description" content="Ù„Ø¹Ø¨Ø© Ù‚Ø±Ø§Ø±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ©. Ø£Ù†Øª Ø§Ù„Ù…Ù„ÙƒØŒ ÙˆÙƒÙ„ Ù‚Ø±Ø§Ø± ÙŠØºÙŠØ± Ù…ØµÙŠØ± Ø§Ù„Ù…Ù…Ù„ÙƒØ©.">
<meta property="og:type" content="website">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #d4a843;
  --gold2: #f0c96a;
  --gold3: #8b6914;
  --dark: #080604;
  --dark2: #110e07;
  --dark3: #1c170a;
  --parchment: #e8d5a3;
  --blood: #7a1515;
  --ink: #1a1408;
  --text: #ddc99a;
  --text2: #a08860;
  --accent-blue: #2a4a6a;
  --accent-green: #1a3a2a;
  --accent-red: #3a1010;
}

/* â”€â”€ SPLASH SCREEN â”€â”€ */
#splash {
  position: fixed;
  inset: 0;
  z-index: 999;
  background: var(--dark);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 28px;
  transition: opacity 0.7s ease, transform 0.7s ease;
}

#splash.hidden {
  opacity: 0;
  transform: scale(1.04);
  pointer-events: none;
}

.splash-logo {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
  animation: splashReveal 1s ease both;
}

@keyframes splashReveal {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* SVG-style CSS logo mark */
.logo-mark {
  position: relative;
  width: 90px;
  height: 90px;
  margin-bottom: 16px;
}

.logo-mark-ring {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  border: 2px solid rgba(212,168,67,0.25);
  animation: ringPulse 3s ease-in-out infinite;
}

.logo-mark-ring:nth-child(2) {
  inset: 8px;
  border-color: rgba(212,168,67,0.45);
  animation-delay: 0.4s;
}

.logo-mark-ring:nth-child(3) {
  inset: 18px;
  border-color: rgba(212,168,67,0.7);
  animation-delay: 0.8s;
}

@keyframes ringPulse {
  0%,100% { transform: scale(1); opacity: 1; }
  50%      { transform: scale(1.05); opacity: 0.6; }
}

.logo-mark-crown {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 38px;
  filter: drop-shadow(0 0 16px rgba(212,168,67,0.8));
}

/* Wordmark */
.logo-wordmark {
  text-align: center;
}

.logo-title-ar {
  font-family: 'Amiri', serif;
  font-size: 52px;
  font-weight: 700;
  letter-spacing: 6px;
  background: linear-gradient(180deg, var(--gold2) 0%, var(--gold) 50%, var(--gold3) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1;
  text-shadow: none;
  position: relative;
}

/* Decorative line under title */
.logo-wordmark::after {
  content: '';
  display: block;
  width: 100%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
  margin-top: 6px;
}

.logo-tagline {
  font-family: 'Scheherazade New', serif;
  font-size: 12px;
  letter-spacing: 5px;
  color: var(--text2);
  margin-top: 8px;
  opacity: 0.7;
}

/* Loading bar */
.splash-loader {
  width: 140px;
  height: 2px;
  background: rgba(212,168,67,0.1);
  border-radius: 2px;
  overflow: hidden;
  animation: splashReveal 1s ease 0.3s both;
}

.splash-loader-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--gold3), var(--gold2));
  border-radius: 2px;
  animation: loadFill 1.8s cubic-bezier(0.4,0,0.2,1) 0.2s both;
}

@keyframes loadFill {
  from { width: 0%; }
  to   { width: 100%; }
}

.splash-hint {
  font-family: 'Scheherazade New', serif;
  font-size: 12px;
  color: var(--text2);
  opacity: 0;
  letter-spacing: 2px;
  animation: splashReveal 0.6s ease 1.6s both;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; user-select:none; }

html, body { height: 100%; overflow: hidden; }

body {
  font-family: 'Scheherazade New', serif;
  background: var(--dark);
  color: var(--text);
  height: 100vh;
  overflow: hidden;
  position: relative;
}

/* â”€â”€ CANVAS PARTICLES â”€â”€ */
#bgCanvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* â”€â”€ APP SHELL â”€â”€ */
#app {
  position: relative;
  z-index: 1;
  height: 100vh;
  display: flex;
  flex-direction: column;
  max-width: 480px;
  margin: 0 auto;
}

/* â”€â”€ SCREENS â”€â”€ */
.screen {
  display: none;
  flex-direction: column;
  height: 100%;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
.screen.active { display: flex; }

/* =====================
   INTRO SCREEN
   ===================== */
#intro {
  justify-content: flex-start;
  align-items: center;
  padding: 0;
  background: transparent;
  overflow: hidden;
}

.intro-header {
  width: 100%;
  height: 42vh;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  overflow: hidden;
}

.intro-header::before {
  content: '';
  position: absolute;
  inset: 0;
  background:
    radial-gradient(ellipse 80% 60% at 50% 100%, rgba(212,168,67,0.15) 0%, transparent 70%),
    linear-gradient(180deg, #0a0805 0%, transparent 50%);
  z-index: 1;
}

.castle-art {
  font-size: 90px;
  position: relative;
  z-index: 2;
  filter: drop-shadow(0 0 40px rgba(212,168,67,0.5));
  animation: throneGlow 4s ease-in-out infinite;
}

@keyframes throneGlow {
  0%,100% { filter: drop-shadow(0 0 30px rgba(212,168,67,0.4)); transform: scale(1); }
  50% { filter: drop-shadow(0 0 60px rgba(212,168,67,0.7)); transform: scale(1.03); }
}

.intro-body {
  flex: 1;
  width: 100%;
  padding: 0 24px 30px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 18px;
  overflow-y: auto;
}

.game-logo {
  text-align: center;
}

.game-logo-ar {
  font-family: 'Amiri', serif;
  font-size: 44px;
  font-weight: 700;
  letter-spacing: 6px;
  background: linear-gradient(180deg, var(--gold2) 0%, var(--gold) 50%, var(--gold3) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1;
}

.game-logo-sub {
  font-size: 13px;
  color: var(--text2);
  letter-spacing: 4px;
  margin-top: 4px;
  opacity: 0.7;
}

.gold-ornament {
  width: 100%;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--gold3), var(--gold), var(--gold3), transparent);
  position: relative;
}
.gold-ornament::before {
  content: 'âœ¦';
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  color: var(--gold);
  font-size: 12px;
  background: var(--dark);
  padding: 0 8px;
}

.intro-lore {
  font-family: 'Amiri', serif;
  font-size: 16px;
  line-height: 2.1;
  color: var(--text2);
  text-align: center;
  font-style: italic;
}

.intro-lore em {
  color: var(--gold2);
  font-style: normal;
}

/* Faction preview */
.factions-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  width: 100%;
}

.faction-card {
  background: rgba(212,168,67,0.05);
  border: 1px solid rgba(212,168,67,0.15);
  border-radius: 12px;
  padding: 10px 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.faction-icon { font-size: 20px; }
.faction-info { flex: 1; }
.faction-name { font-size: 12px; color: var(--gold2); font-weight: 700; }
.faction-desc { font-size: 10px; color: var(--text2); margin-top: 1px; }

/* Name section */
.name-section {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.name-label {
  font-family: 'Amiri', serif;
  font-size: 15px;
  color: var(--gold);
  text-align: center;
}

.name-input {
  width: 100%;
  background: rgba(212,168,67,0.06);
  border: 1px solid rgba(212,168,67,0.35);
  border-radius: 12px;
  padding: 14px 18px;
  color: var(--gold2);
  font-family: 'Scheherazade New', serif;
  font-size: 18px;
  text-align: center;
  outline: none;
  transition: border-color 0.3s;
}
.name-input:focus { border-color: var(--gold); box-shadow: 0 0 20px rgba(212,168,67,0.1); }
.name-input::placeholder { color: rgba(212,168,67,0.3); }

.start-btn {
  width: 100%;
  background: linear-gradient(135deg, #c9a843, #8b6914);
  border: none;
  border-radius: 14px;
  padding: 17px;
  color: var(--dark);
  font-family: 'Amiri', serif;
  font-size: 20px;
  font-weight: 700;
  cursor: pointer;
  letter-spacing: 1px;
  box-shadow: 0 4px 30px rgba(212,168,67,0.25), inset 0 1px 0 rgba(255,255,255,0.15);
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.start-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.1));
}
.start-btn:active { transform: scale(0.98); box-shadow: 0 2px 15px rgba(212,168,67,0.2); }

/* =====================
   GAME SCREEN
   ===================== */
#game { background: transparent; }

/* Stats bar */
.stats-bar {
  flex-shrink: 0;
  background: rgba(8,6,4,0.9);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(212,168,67,0.15);
  padding: 8px 14px;
  position: relative;
  z-index: 10;
}

.stats-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.king-title {
  font-family: 'Amiri', serif;
  color: var(--gold);
  font-size: 13px;
}

.chapter-indicator {
  font-size: 10px;
  color: var(--text2);
  background: rgba(212,168,67,0.08);
  border: 1px solid rgba(212,168,67,0.15);
  border-radius: 20px;
  padding: 3px 10px;
}

.factions-bar {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  gap: 6px;
}

.faction-stat {
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.faction-stat-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.faction-stat-name {
  font-size: 9px;
  color: var(--text2);
}

.faction-stat-num {
  font-size: 9px;
  font-weight: 700;
}

.faction-bar-bg {
  height: 4px;
  background: rgba(255,255,255,0.06);
  border-radius: 2px;
  overflow: hidden;
}

.faction-bar-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 0.6s cubic-bezier(0.4,0,0.2,1);
}

.f-people .faction-bar-fill { background: linear-gradient(90deg, #2a7a5a, #4caf8c); }
.f-nobles .faction-bar-fill { background: linear-gradient(90deg, #5a3a7a, #8c6caf); }
.f-army .faction-bar-fill { background: linear-gradient(90deg, #7a1515, #c94c4c); }
.f-church .faction-bar-fill { background: linear-gradient(90deg, #3a3a5a, #6c6caf); }

.f-people .faction-stat-num { color: #4caf8c; }
.f-nobles .faction-stat-num { color: #8c6caf; }
.f-army .faction-stat-num { color: #c94c4c; }
.f-church .faction-stat-num { color: #8c8ccf; }

/* Scene */
.scene-container {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  display: flex;
  flex-direction: column;
}

.scene-visual {
  width: 100%;
  height: 180px;
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.scene-emoji {
  font-size: 72px;
  position: relative;
  z-index: 2;
  animation: sceneFloat 5s ease-in-out infinite;
  filter: drop-shadow(0 0 30px var(--scene-color, rgba(212,168,67,0.4)));
}

@keyframes sceneFloat {
  0%,100% { transform: translateY(0) scale(1); }
  50% { transform: translateY(-8px) scale(1.02); }
}

.scene-visual::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 100px;
  background: linear-gradient(transparent, var(--dark2));
  z-index: 3;
}

/* Scene mood overlay */
.mood-overlay {
  position: absolute;
  inset: 0;
  z-index: 1;
  transition: background 0.8s ease;
}

.scene-text-area {
  padding: 16px 20px 0;
  flex: 1;
}

/* Memory tag */
.memory-tag {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(212,168,67,0.08);
  border: 1px solid rgba(212,168,67,0.2);
  border-radius: 8px;
  padding: 4px 10px;
  font-size: 11px;
  color: var(--gold2);
  margin-bottom: 10px;
  animation: memoryPop 0.4s ease;
}
@keyframes memoryPop {
  from { opacity:0; transform: scale(0.9); }
  to { opacity:1; transform: scale(1); }
}

.chapter-tag {
  font-size: 10px;
  letter-spacing: 3px;
  color: var(--gold3);
  text-transform: uppercase;
  margin-bottom: 6px;
}

.scene-title {
  font-family: 'Amiri', serif;
  font-size: 28px;
  font-weight: 700;
  color: var(--gold2);
  line-height: 1.25;
  margin-bottom: 14px;
  text-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

.scene-body {
  font-family: 'Amiri', serif;
  font-size: 17px;
  line-height: 2.1;
  color: var(--text);
}

.scene-body .char-name {
  color: var(--gold2);
  font-weight: 700;
}

.scene-body .dramatic {
  color: #e88888;
  font-weight: 700;
}

.scene-body .good-word {
  color: #88e8a8;
}

.scene-body .whisper {
  color: var(--text2);
  font-style: italic;
  font-size: 15px;
}

/* Choices */
.choices-section {
  padding: 14px 16px 24px;
  display: flex;
  flex-direction: column;
  gap: 9px;
  flex-shrink: 0;
}

.choices-header {
  font-size: 11px;
  letter-spacing: 2px;
  color: var(--text2);
  margin-bottom: 2px;
  text-align: center;
}

.choice-btn {
  background: rgba(212,168,67,0.06);
  border: 1px solid rgba(212,168,67,0.2);
  border-radius: 14px;
  padding: 13px 16px;
  width: 100%;
  text-align: right;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  position: relative;
  overflow: hidden;
}

.choice-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(212,168,67,0.08), transparent);
  opacity: 0;
  transition: opacity 0.2s;
}

.choice-btn:active {
  transform: scale(0.975);
  border-color: var(--gold);
  background: rgba(212,168,67,0.12);
}
.choice-btn:active::before { opacity: 1; }

.choice-emoji {
  font-size: 24px;
  flex-shrink: 0;
  margin-top: 1px;
}

.choice-content { flex: 1; }

.choice-text {
  font-family: 'Scheherazade New', serif;
  font-size: 15px;
  color: var(--parchment);
  line-height: 1.6;
}

.choice-effects {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 6px;
}

.effect-pill {
  font-size: 10px;
  padding: 2px 7px;
  border-radius: 20px;
  font-weight: 700;
}

.effect-up { background: rgba(76,175,140,0.15); color: #4caf8c; border: 1px solid rgba(76,175,140,0.3); }
.effect-down { background: rgba(201,76,76,0.15); color: #e88888; border: 1px solid rgba(201,76,76,0.3); }
.effect-neutral { background: rgba(212,168,67,0.1); color: var(--gold2); border: 1px solid rgba(212,168,67,0.2); }

/* Stat flash animation */
@keyframes statUp {
  0% { transform: scale(1); }
  40% { transform: scale(1.3); color: #88e8a8; }
  100% { transform: scale(1); }
}
@keyframes statDown {
  0% { transform: scale(1); }
  40% { transform: scale(1.3); color: #e88888; }
  100% { transform: scale(1); }
}
.flash-up { animation: statUp 0.5s ease; }
.flash-down { animation: statDown 0.5s ease; }

/* Reaction toast */
.reaction-toast {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: rgba(8,6,4,0.97);
  border: 1px solid rgba(212,168,67,0.3);
  border-radius: 12px;
  padding: 10px 18px;
  font-family: 'Amiri', serif;
  font-size: 14px;
  color: var(--gold2);
  z-index: 60;
  opacity: 0;
  transition: all 0.3s ease;
  pointer-events: none;
  white-space: nowrap;
  max-width: 90vw;
  text-align: center;
}
.reaction-toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* Mobile fix: wrap pills better */
@media (max-width: 360px) {
  .choice-text { font-size: 13px; }
  .effect-pill { font-size: 9px; padding: 2px 5px; }
  .choice-btn { padding: 10px 12px; gap: 8px; }
  .choice-emoji { font-size: 20px; }
}

/* =====================
   TRANSITION OVERLAY
   ===================== */
.transition-overlay {
  position: fixed;
  inset: 0;
  background: var(--dark);
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.35s ease;
}

.transition-overlay.show { opacity: 1; pointer-events: all; }

.transition-content {
  text-align: center;
  font-family: 'Amiri', serif;
  font-size: 22px;
  color: var(--gold);
  opacity: 0;
  transform: scale(0.9);
  transition: all 0.3s ease 0.1s;
}
.transition-overlay.show .transition-content {
  opacity: 1;
  transform: scale(1);
}

/* =====================
   CONSEQUENCE BANNER
   ===================== */
.consequence-banner {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 440px;
  background: rgba(8,6,4,0.97);
  border: 1px solid rgba(212,168,67,0.4);
  border-top: none;
  border-radius: 0 0 16px 16px;
  padding: 12px 20px;
  z-index: 50;
  text-align: center;
  font-family: 'Amiri', serif;
  font-size: 15px;
  color: var(--gold2);
  line-height: 1.6;
  transform: translateX(-50%) translateY(-100%);
  transition: transform 0.4s cubic-bezier(0.4,0,0.2,1);
}
.consequence-banner.visible { transform: translateX(-50%) translateY(0); }
.consequence-banner .con-icon { font-size: 22px; display: block; margin-bottom: 4px; }

/* =====================
   ENDING SCREEN
   ===================== */
#ending {
  align-items: center;
  padding: 0;
  overflow-y: auto;
}

.ending-header {
  width: 100%;
  min-height: 280px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  padding: 40px 24px 30px;
}

.ending-bg-glow {
  position: absolute;
  inset: 0;
  opacity: 0.3;
  background: radial-gradient(ellipse 80% 70% at 50% 100%, var(--ending-color, #c9a843) 0%, transparent 70%);
}

.ending-seal {
  font-size: 90px;
  position: relative;
  z-index: 2;
  animation: throneGlow 4s ease-in-out infinite;
}

.ending-title {
  font-family: 'Amiri', serif;
  font-size: 34px;
  font-weight: 700;
  text-align: center;
  position: relative;
  z-index: 2;
  margin-top: 12px;
  line-height: 1.2;
}

.ending-rank {
  font-size: 12px;
  letter-spacing: 3px;
  color: var(--text2);
  position: relative;
  z-index: 2;
  margin-top: 6px;
}

.ending-body {
  padding: 0 22px 40px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: 100%;
}

.ending-story {
  font-family: 'Amiri', serif;
  font-size: 17px;
  line-height: 2.2;
  color: var(--text2);
  text-align: center;
  font-style: italic;
}

.ending-story strong {
  color: var(--gold2);
  font-style: normal;
}

/* Faction final standings */
.faction-standings {
  background: rgba(212,168,67,0.05);
  border: 1px solid rgba(212,168,67,0.15);
  border-radius: 16px;
  padding: 18px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.standings-title {
  font-family: 'Amiri', serif;
  font-size: 16px;
  color: var(--gold);
  text-align: center;
  margin-bottom: 2px;
}

.standing-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.standing-icon { font-size: 20px; flex-shrink: 0; }

.standing-info { flex: 1; }
.standing-name { font-size: 12px; color: var(--text2); }

.standing-bar-wrap {
  height: 6px;
  background: rgba(255,255,255,0.05);
  border-radius: 3px;
  margin-top: 4px;
  overflow: hidden;
}

.standing-bar-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 1s ease 0.3s;
}

.standing-val {
  font-size: 13px;
  font-weight: 700;
  min-width: 32px;
  text-align: left;
}

/* Chronicle */
.chronicle-box {
  background: rgba(0,0,0,0.3);
  border: 1px solid rgba(212,168,67,0.1);
  border-radius: 16px;
  padding: 18px;
}

.chronicle-title {
  font-family: 'Amiri', serif;
  font-size: 15px;
  color: var(--gold);
  margin-bottom: 12px;
  text-align: center;
}

.chronicle-entry {
  display: flex;
  gap: 10px;
  padding: 7px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  font-size: 13px;
  color: var(--text2);
}
.chronicle-entry:last-child { border-bottom: none; }
.chronicle-icon { font-size: 14px; flex-shrink: 0; }

.replay-section {
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: center;
}

.btn-gold {
  width: 100%;
  background: linear-gradient(135deg, #c9a843, #8b6914);
  border: none;
  border-radius: 14px;
  padding: 16px;
  color: var(--dark);
  font-family: 'Amiri', serif;
  font-size: 19px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 4px 20px rgba(212,168,67,0.2);
}
.btn-gold:active { transform: scale(0.97); }

.btn-outline {
  width: 100%;
  background: transparent;
  border: 1px solid rgba(212,168,67,0.3);
  border-radius: 14px;
  padding: 13px;
  color: var(--gold2);
  font-family: 'Amiri', serif;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-outline:active { background: rgba(212,168,67,0.08); }

/* Scrollbar */
::-webkit-scrollbar { width: 3px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(212,168,67,0.2); border-radius: 3px; }

/* Pulse anim for critical low stats */
@keyframes criticalPulse {
  0%,100% { box-shadow: 0 0 0 0 rgba(201,76,76,0); }
  50% { box-shadow: 0 0 0 6px rgba(201,76,76,0.2); }
}
.critical-warning { animation: criticalPulse 1.5s ease infinite; }

@keyframes fadeIn {
  from { opacity:0; }
  to { opacity:1; }
}
</style>
</head>
<body>

<!-- Background canvas -->
<canvas id="bgCanvas"></canvas>

<!-- Transition overlay -->
<div class="transition-overlay" id="transOverlay">
  <div class="transition-content" id="transContent"></div>
</div>

<!-- Consequence banner -->
<div class="consequence-banner" id="conBanner">
  <span class="con-icon" id="conIcon"></span>
  <span id="conText"></span>
</div>

<!-- Reaction toast -->
<div class="reaction-toast" id="reactionToast"></div>

<!-- â•â• SPLASH SCREEN â•â• -->
<div id="splash">
  <div class="splash-logo">
    <div class="logo-mark">
      <div class="logo-mark-ring"></div>
      <div class="logo-mark-ring"></div>
      <div class="logo-mark-ring"></div>
      <div class="logo-mark-crown">ğŸ‘‘</div>
    </div>
    <div class="logo-wordmark">
      <div class="logo-title-ar">Ø£Ø±ÙŠÙ‡Ø§Ù†</div>
      <div class="logo-tagline">Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…ØµÙŠØ±</div>
    </div>
  </div>
  <div class="splash-loader">
    <div class="splash-loader-fill"></div>
  </div>
  <div class="splash-hint">Ø§Ù„Ù…Ù…Ù„ÙƒØ© ØªÙ†ØªØ¸Ø±Ùƒ...</div>
</div>

<div id="app">

  <!-- â•â• INTRO â•â• -->
  <div class="screen active" id="intro">
    <div class="intro-header">
      <div class="castle-art">ğŸ°</div>
    </div>
    <div class="intro-body">
      <div class="game-logo">
        <div class="game-logo-ar">Ø£Ø±ÙŠÙ‡Ø§Ù†</div>
        <div class="game-logo-sub">Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…ØµÙŠØ±</div>
      </div>

      <div class="gold-ornament"></div>

      <p class="intro-lore">
        Ù…Ù…Ù„ÙƒØ© <em>Ø£Ø±ÙŠÙ‡Ø§Ù†</em> ØªÙ†Ø²Ù Ù…Ù† Ø§Ù„Ø¯Ø§Ø®Ù„.
        Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø±Ø§Ø­Ù„ ØªØ±Ùƒ ÙˆØ±Ø§Ø¡Ù‡ Ø¯ÙŠÙˆÙ†Ø§Ù‹ØŒ ÙØµØ§Ø¦Ù„ Ù…ØªÙ†Ø§Ø­Ø±Ø©ØŒ ÙˆØ¹Ø±Ø´Ø§Ù‹ Ø«Ù‚ÙŠÙ„Ø§Ù‹.
        Ø£Ù†Øª Ø§Ù„ÙˆØ±ÙŠØ« Ø§Ù„ÙˆØ­ÙŠØ¯.
        <br><br>
        ÙƒÙ„ Ù‚Ø±Ø§Ø± ØªØªØ®Ø°Ù‡ Ø³ÙŠÙØ­ÙƒÙ‰ ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®
        â€” Ø£Ùˆ ÙŠÙØ·Ù…Ø³ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¨Ø¯.
      </p>

      <div class="gold-ornament"></div>

      <div class="factions-grid">
        <div class="faction-card">
          <span class="faction-icon">ğŸ˜ï¸</span>
          <div class="faction-info">
            <div class="faction-name">Ø§Ù„Ø´Ø¹Ø¨</div>
            <div class="faction-desc">Ù‚ÙˆØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</div>
          </div>
        </div>
        <div class="faction-card">
          <span class="faction-icon">ğŸ—¡ï¸</span>
          <div class="faction-info">
            <div class="faction-name">Ø§Ù„Ø¬ÙŠØ´</div>
            <div class="faction-desc">Ø­Ø±Ø§Ø³ Ø§Ù„Ø¹Ø±Ø´</div>
          </div>
        </div>
        <div class="faction-card">
          <span class="faction-icon">ğŸ’</span>
          <div class="faction-info">
            <div class="faction-name">Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡</div>
            <div class="faction-desc">Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø«Ø±ÙˆØ©</div>
          </div>
        </div>
        <div class="faction-card">
          <span class="faction-icon">â›ª</span>
          <div class="faction-info">
            <div class="faction-name">Ø§Ù„ÙƒÙ†ÙŠØ³Ø©</div>
            <div class="faction-desc">Ø´Ø±Ø¹ÙŠØ© Ø§Ù„Ø­ÙƒÙ…</div>
          </div>
        </div>
      </div>

      <div class="name-section">
        <div class="name-label">âœ¦ Ù…Ø§ Ø§Ø³Ù…Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØŸ âœ¦</div>
        <input class="name-input" id="kingInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." maxlength="18" autocomplete="off">
      </div>

      <button class="start-btn" onclick="startGame()">âš”ï¸ ØªØ³Ù„Ù‘Ù… Ø§Ù„Ø¹Ø±Ø´ âš”ï¸</button>
    </div>
  </div>

  <!-- â•â• GAME â•â• -->
  <div class="screen" id="game">
    <div class="stats-bar">
      <div class="stats-top">
        <div class="king-title" id="kingTitleBar">Ø§Ù„Ù…Ù„Ùƒ</div>
        <div class="chapter-indicator" id="chapterIndicator">Ø§Ù„ÙØµÙ„ Ù¡</div>
      </div>
      <div class="factions-bar">
        <div class="faction-stat f-people">
          <div class="faction-stat-header">
            <span class="faction-stat-name">ğŸ˜ï¸ Ø§Ù„Ø´Ø¹Ø¨</span>
            <span class="faction-stat-num" id="num-people">60</span>
          </div>
          <div class="faction-bar-bg"><div class="faction-bar-fill" id="bar-people"></div></div>
        </div>
        <div class="faction-stat f-army">
          <div class="faction-stat-header">
            <span class="faction-stat-name">ğŸ—¡ï¸ Ø§Ù„Ø¬ÙŠØ´</span>
            <span class="faction-stat-num" id="num-army">60</span>
          </div>
          <div class="faction-bar-bg"><div class="faction-bar-fill" id="bar-army"></div></div>
        </div>
        <div class="faction-stat f-nobles">
          <div class="faction-stat-header">
            <span class="faction-stat-name">ğŸ’ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡</span>
            <span class="faction-stat-num" id="num-nobles">60</span>
          </div>
          <div class="faction-bar-bg"><div class="faction-bar-fill" id="bar-nobles"></div></div>
        </div>
        <div class="faction-stat f-church">
          <div class="faction-stat-header">
            <span class="faction-stat-name">â›ª Ø§Ù„ÙƒÙ†ÙŠØ³Ø©</span>
            <span class="faction-stat-num" id="num-church">60</span>
          </div>
          <div class="faction-bar-bg"><div class="faction-bar-fill" id="bar-church"></div></div>
        </div>
      </div>
    </div>

    <div class="scene-container" id="sceneContainer">
      <div class="scene-visual" id="sceneVisual">
        <div class="mood-overlay" id="moodOverlay"></div>
        <div class="scene-emoji" id="sceneEmoji"></div>
      </div>
      <div class="scene-text-area">
        <div class="memory-tag" id="memoryTag" style="display:none">ğŸ“œ <span id="memoryText"></span></div>
        <div class="chapter-tag" id="chapterTag"></div>
        <div class="scene-title" id="sceneTitle"></div>
        <div class="scene-body" id="sceneBody"></div>
      </div>
      <div class="choices-section">
        <div class="choices-header">â€” Ø§Ø®ØªØ± Ù‚Ø±Ø§Ø±Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„Ùƒ â€”</div>
        <div id="choicesList"></div>
      </div>
    </div>
  </div>

  <!-- â•â• ENDING â•â• -->
  <div class="screen" id="ending">
    <div class="ending-header">
      <div class="ending-bg-glow" id="endingGlow"></div>
      <div class="ending-seal" id="endingSeal"></div>
      <div class="ending-title" id="endingTitle"></div>
      <div class="ending-rank" id="endingRank"></div>
    </div>
    <div class="ending-body">
      <div class="gold-ornament"></div>
      <p class="ending-story" id="endingStory"></p>
      <div class="faction-standings" id="factionStandings"></div>
      <div class="chronicle-box">
        <div class="chronicle-title">ğŸ“œ Ø³Ø¬Ù„ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„Ùƒ</div>
        <div id="chronicle"></div>
      </div>
      <div class="replay-section">
        <button class="btn-gold" onclick="restartGame()">ğŸ”„ Ø§Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¨Ù…Ø³Ø§Ø± Ù…Ø®ØªÙ„Ù</button>
        <button class="btn-outline" onclick="shareResult()">ğŸ“œ Ø´Ø§Ø±Ùƒ Ù†Ù‡Ø§ÙŠØªÙƒ</button>
      </div>
    </div>
  </div>

</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
let particles = [];

function initCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  particles = [];
  for(let i = 0; i < 80; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 1.2 + 0.3,
      alpha: Math.random() * 0.6 + 0.1,
      speed: Math.random() * 0.15 + 0.05,
      twinkle: Math.random() * Math.PI * 2,
      twinkleSpeed: Math.random() * 0.02 + 0.005,
    });
  }
}

function drawParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#080604';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  particles.forEach(p => {
    p.twinkle += p.twinkleSpeed;
    p.y -= p.speed;
    if(p.y < -2) p.y = canvas.height + 2;
    const a = p.alpha * (0.6 + 0.4 * Math.sin(p.twinkle));
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(212,180,120,${a})`;
    ctx.fill();
  });

  requestAnimationFrame(drawParticles);
}

initCanvas();
drawParticles();
window.addEventListener('resize', initCanvas);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let G = {
  name: '',
  people: 60, army: 60, nobles: 60, church: 60,
  choices: [],
  tags: new Set(),
  seenEvents: new Set(),
  turn: 0,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCENARIOS DATABASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SCENES = {

  // â”€â”€ SCENE 1: The Debt â”€â”€
  debt: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„ â€” ÙˆØ±Ø§Ø«Ø© Ø§Ù„Ø£Ø¹Ø¨Ø§Ø¡',
    title: 'Ø¯ÙŠÙˆÙ† Ø§Ù„Ø£Ø¨',
    emoji: 'ğŸ›ï¸',
    mood: 'radial-gradient(ellipse at 50% 120%, rgba(140,100,20,0.4) 0%, transparent 60%)',
    text: () => `
      ÙŠÙÙ†Ø§Ø¯ÙŠÙƒ <span class="char-name">ÙˆØ²ÙŠØ±Ùƒ Ø§Ù„Ø£ÙƒØ¨Ø±ØŒ Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø­ÙƒÙŠÙ…</span>ØŒ ÙÙˆØ± Ø¬Ù„ÙˆØ³Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø´.
      ÙˆØ¬Ù‡Ù‡ Ø´Ø§Ø­Ø¨ ÙƒØ£Ù†Ù‡ ÙŠØ­Ù…Ù„ Ø®Ø¨Ø±Ø§Ù‹ ÙŠÙƒØ³Ø± Ø§Ù„Ø¸Ù‡Ø±.
      <br><br>
      <span class="whisper">"Ø¬Ù„Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ùƒ... Ø®Ø²ÙŠÙ†Ù†Ø§ Ù…Ø«Ù‚Ù„ Ø¨Ø¯ÙŠÙˆÙ† Ø£Ø¨ÙŠÙƒ Ø±Ø­Ù…Ù‡ Ø§Ù„Ù„Ù‡. Ø¥Ù† Ù„Ù… Ù†Ø¯ÙØ¹ Ù„Ù„Ù…ØµØ§Ø±Ù Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ© Ø®Ù„Ø§Ù„ Ø£Ø±Ø¨Ø¹ÙŠÙ† ÙŠÙˆÙ…Ø§Ù‹ØŒ Ø³ÙŠÙØ±Ø³Ù„ÙˆÙ† Ù…Ø­ØµÙ‘Ù„ÙŠÙ† Ù…Ø³Ù„Ø­ÙŠÙ†."</span>
      <br><br>
      Ø«Ù„Ø§Ø«Ø© ÙˆØ¬ÙˆÙ‡ ØªØªØ·Ù„Ø¹ Ø¥Ù„ÙŠÙƒ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø©: ØªØ§Ø¬Ø± Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ <span class="char-name">ÙŠÙˆØ³Ù Ø§Ù„Ø«Ø±ÙŠ</span>ØŒ Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ <span class="char-name">Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø®Ø§Ù„Ø¯</span>ØŒ ÙˆØ§Ù„Ø£Ø³Ù‚Ù <span class="char-name">ÙŠÙˆØ­Ù†Ø§ Ø§Ù„ÙˆÙ‚ÙˆØ±</span>.
      ÙƒÙ„ÙŒÙ‘ Ù…Ù†Ù‡Ù… Ù„Ø¯ÙŠÙ‡ Ø­Ù„ â€” ÙˆÙƒÙ„ÙŒÙ‘ Ù…Ù†Ù‡Ù… ÙŠØ±ÙŠØ¯ Ø«Ù…Ù†Ø§Ù‹.
    `,
    memory: null,
    choices: [
      {
        emoji: 'ğŸ’', text: 'Ø£ÙØ±Ø¶ Ø¶Ø±ÙŠØ¨Ø© Ø·Ø§Ø±Ø¦Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙˆÙƒØ¨Ø§Ø± Ø§Ù„ØªØ¬Ø§Ø±',
        sub: [
          { label: '+Ø®Ø²ÙŠÙ†Ø©', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’15', type: 'down' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +5', type: 'up' }
        ],
        fn: () => {
          apply({nobles:-15, people:5});
          G.tags.add('taxed_nobles');
          chronicle('ğŸ’', 'ÙØ±Ø¶ Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡');
          transition('âš–ï¸', 'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØªØ°Ù…Ø±ÙˆÙ†... Ù„ÙƒÙ† Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ØªÙ†ÙØ³', () => go('drought'));
        }
      },
      {
        emoji: 'âš”ï¸', text: 'Ø£Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø¬ÙŠØ´ Ø§Ù„ØªÙ†Ø§Ø²Ù„ Ø¹Ù† Ù…ÙƒØ§ÙØ¢ØªÙ‡Ù… Ù…Ø¤Ù‚ØªØ§Ù‹ Ù…Ù‚Ø§Ø¨Ù„ ÙˆØ¹Ø¯ Ø¨Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ©',
        sub: [
          { label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’20', type: 'down' }, { label: '+Ø´Ø±Ù Ø§Ù„Ù…Ù„Ùƒ', type: 'up' }, { label: 'Ø®Ø·Ø±: Ø§Ù„Ø¬ÙŠØ´ ØºØ§Ø¶Ø¨', type: 'neutral' }
        ],
        fn: () => {
          apply({army:-20, church:5});
          G.tags.add('army_debt');
          chronicle('âš”ï¸', 'Ø·Ù„Ø¨ ØªØ¶Ø­ÙŠØ© Ù…Ù† Ø§Ù„Ø¬ÙŠØ´ Ø¨ÙˆØ¹Ø¯ Ø¨Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ©');
          transition('ğŸ—¡ï¸', 'Ø§Ù„Ø¬Ù†Ø¯ ÙŠØªØ°Ù…Ø±ÙˆÙ† Ø®Ù„Ù Ø¸Ù‡Ø±Ùƒ...', () => go('drought'));
        }
      },
      {
        emoji: 'â›ª', text: 'Ø£Ø·Ù„Ø¨ Ù‚Ø±Ø¶Ø§Ù‹ Ù…Ù† Ø®Ø²ÙŠÙ†Ø© Ø§Ù„ÙƒÙ†ÙŠØ³Ø© Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù…ØªÙŠØ§Ø²Ø§Øª Ø¯ÙŠÙ†ÙŠØ©',
        sub: [
          { label: '+Ø®Ø²ÙŠÙ†Ø©', type: 'up' }, { label: 'âˆ’Ø³ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ù„Ùƒ', type: 'down' }, { label: '+Ø§Ù„ÙƒÙ†ÙŠØ³Ø© +15', type: 'up' }
        ],
        fn: () => {
          apply({church:15, nobles:-5});
          G.tags.add('church_debt');
          chronicle('â›ª', 'Ø§Ø³ØªØ¹Ø§Ø± Ù…Ù† Ø§Ù„ÙƒÙ†ÙŠØ³Ø© Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù…ØªÙŠØ§Ø²Ø§Øª');
          transition('âœï¸', 'Ø§Ù„Ø£Ø³Ù‚Ù ÙŠØ¨ØªØ³Ù…... Ù„Ù„ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø¢Ù† Ø«Ù…Ù†', () => go('drought'));
        }
      },
    ]
  },

  // â”€â”€ SCENE 2: Drought â”€â”€
  drought: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ â€” Ø§Ù„Ø£Ø±Ø¶ Ø§Ù„Ø¸Ø§Ù…Ø¦Ø©',
    title: 'ØµÙŠÙ Ø§Ù„Ø¬Ø­ÙŠÙ…',
    emoji: 'ğŸŒ¾',
    mood: 'radial-gradient(ellipse at 50% 120%, rgba(120,60,10,0.5) 0%, transparent 60%)',
    text: () => {
      const base = `
        Ø«Ù„Ø§Ø«Ø© Ø£Ø´Ù‡Ø± Ø¨Ù„Ø§ Ù…Ø·Ø±. Ù…Ø­Ø§ØµÙŠÙ„ Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ© ØªÙ…ÙˆØª ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ØŒ ÙˆØ§Ù„ÙÙ„Ø§Ø­ÙˆÙ† ÙŠØ³ÙŠØ±ÙˆÙ† Ù†Ø­Ùˆ Ø§Ù„Ø¹Ø§ØµÙ…Ø© Ø¨ÙˆØ¬ÙˆÙ‡ ÙŠØ§Ø¨Ø³Ø© ÙƒØ§Ù„Ø·ÙŠÙ† Ø§Ù„Ù…ØªØ´Ù‚Ù‚.
        <br><br>
        <span class="char-name">Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø­ÙƒÙŠÙ…</span> ÙŠØ¶Ø¹ Ø£Ù…Ø§Ù…Ùƒ ØªÙ‚Ø±ÙŠØ±Ø§Ù‹: <span class="whisper">"Ø¥Ù† Ù„Ù… Ù†ØªØ¯Ø®Ù„ Ø®Ù„Ø§Ù„ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†ØŒ Ø³ØªØ¨Ø¯Ø£ ÙˆÙÙŠØ§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„."</span>
        <br><br>
      `;
      if (G.tags.has('taxed_nobles')) return base + `Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ù„Ø°ÙŠÙ† ÙØ±Ø¶Øª Ø¹Ù„ÙŠÙ‡Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© <span class="dramatic">ÙŠÙØ­Ø¬Ù…ÙˆÙ† Ø¹Ù† Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</span> Ø§Ø­ØªØ¬Ø§Ø¬Ø§Ù‹. Ø§Ù„ÙˆØ¶Ø¹ Ø£ØµØ¹Ø¨ Ù…Ù…Ø§ ÙƒØ§Ù† ÙŠØ¬Ø¨.`;
      if (G.tags.has('army_debt')) return base + `Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„ØºØ§Ø¶Ø¨ÙˆÙ† <span class="dramatic">ÙŠØ¨Ø·Ø¦ÙˆÙ†</span> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø±Ù‰. Ø§Ù„ÙˆØ¶Ø¹ ÙŠØªØ£Ø²Ù….`;
      if (G.tags.has('church_debt')) return base + `<span class="good-word">Ø§Ù„ÙƒÙ†ÙŠØ³Ø© ØªÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨Ù‡Ø§</span> Ù„Ù„Ø¬Ø§Ø¦Ø¹ÙŠÙ† Ø¨Ø¯ÙˆÙ† Ø£Ù† ØªØ³ØªØ£Ø°Ù† â€” ÙˆØªÙØ­Ø³Ø¨ Ù„Ù‡Ø§ Ù„Ø§ Ù„Ùƒ.`;
      return base + `Ø§Ù„Ù…Ø¬Ø§Ø¹Ø© ØªÙ‚ØªØ±Ø¨ Ø¨Ø®Ø·Ù‰ Ø«Ø§Ø¨ØªØ©.`;
    },
    memory: () => G.tags.has('taxed_nobles') ? 'ğŸ“Œ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ù„Ø§ ÙŠØ²Ø§Ù„ÙˆÙ† ØºØ§Ø¶Ø¨ÙŠÙ† Ù…Ù† Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©' :
                  G.tags.has('army_debt') ? 'ğŸ“Œ Ø§Ù„Ø¬ÙŠØ´ Ù„Ù… ÙŠÙ†Ø³Ù Ù…Ø§ Ø·Ù„Ø¨Øª Ù…Ù†Ù‡ ÙÙŠ Ø§Ù„Ø£Ø²Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰' :
                  G.tags.has('church_debt') ? 'ğŸ“Œ Ø§Ù„ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø¢Ù† Ù„Ø§Ø¹Ø¨ Ù‚ÙˆÙŠ ÙÙŠ Ø§Ù„Ù…Ø´Ù‡Ø¯' : null,
    choices: [
      {
        emoji: 'ğŸ ', text: 'Ø§ÙØªØ­ Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø­Ø¨ÙˆØ¨ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù„Ù„Ø´Ø¹Ø¨',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +25', type: 'up' }, { label: 'âˆ’Ù…Ø®Ø²ÙˆÙ† âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’10', type: 'down' }],
        fn: () => {
          apply({people:25, army:-10});
          G.tags.add('opened_stores');
          chronicle('ğŸ ', 'ÙØªØ­ Ø§Ù„Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù„Ù„Ø´Ø¹Ø¨ Ù…Ø¬Ø§Ù†Ø§Ù‹');
          transition('â¤ï¸', 'Ø§Ù„Ø´Ø¹Ø¨ ÙŠÙ‡ØªÙ Ø¨Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ø´ÙˆØ§Ø±Ø¹!', () => go('rebellion'));
        }
      },
      {
        emoji: 'â›ï¸', text: 'Ø£Ø±Ø³Ù„ Ø§Ù„Ø¬ÙŠØ´ Ù„Ø­ÙØ± Ù‚Ù†ÙˆØ§Øª Ø±ÙŠ Ù…Ù† Ø§Ù„Ù†Ù‡Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +15', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +5', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’15 Ù…Ø¤Ù‚ØªØ§Ù‹', type: 'down' }],
        fn: () => {
          apply({people:15, nobles:5, army:-15});
          G.tags.add('dug_canals');
          chronicle('â›ï¸', 'Ø£Ù…Ø± Ø§Ù„Ø¬ÙŠØ´ Ø¨Ø­ÙØ± Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙŠ');
          transition('ğŸ’§', 'Ø§Ù„Ù…Ø§Ø¡ ÙŠØªØ¯ÙÙ‚... ÙˆØ§Ù„Ø£Ø±Ø¶ ØªØªÙ†ÙØ³', () => go('rebellion'));
        }
      },
      {
        emoji: 'ğŸ’°', text: 'Ø§Ø´ØªØ±Ù Ø§Ù„Ø­Ø¨ÙˆØ¨ Ù…Ù† Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠÙŠÙ† Ø¨Ø³Ø¹Ø± Ù…Ø±ØªÙØ¹',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +10', type: 'up' }, { label: 'âˆ’Ø®Ø²ÙŠÙ†Ø© ÙƒØ¨ÙŠØ±', type: 'down' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +10', type: 'up' }],
        fn: () => {
          apply({people:10, nobles:10, church:-5});
          G.tags.add('bought_grain');
          chronicle('ğŸ’°', 'Ø´Ø±Ø§Ø¡ Ø§Ù„Ø­Ø¨ÙˆØ¨ Ø¨Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø®Ø²ÙŠÙ†Ø©');
          transition('ğŸŒ¾', 'Ø§Ù„Ø­Ø¨ÙˆØ¨ ÙˆØµÙ„Øª... Ù„ÙƒÙ† Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ù†Ø²Øª', () => go('rebellion'));
        }
      },
    ]
  },

  // â”€â”€ SCENE 3: Rebellion â”€â”€
  rebellion: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø« â€” Ø§Ù„ÙØªÙ†Ø© ØªØ´Ø¨Ù‘',
    title: 'Ø£Ù…ÙŠØ± Ø§Ù„Ø´Ø±Ù‚ ÙŠÙ‚Ø·Ø¹ Ø¨ÙŠØ¹ØªÙ‡',
    emoji: 'âš¡',
    mood: 'radial-gradient(ellipse at 50% 120%, rgba(120,20,20,0.5) 0%, transparent 60%)',
    text: () => {
      const amirName = '<span class="char-name">Ø§Ù„Ø£Ù…ÙŠØ± ÙƒÙ…Ø§Ù„ Ø¨Ù† Ø¹Ø±ÙØ§Ù†</span>';
      const base = `
        Ø±Ø³Ø§Ù„Ø© Ù…ÙØ³Ø±ÙÙ‘Ø¨Ø© Ù…Ù† Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø´Ø±Ù‚ÙŠ: ${amirName} ÙŠÙØµØ±Ù‘Ø­ Ø£Ù† Ø§Ù„Ø¹Ø±Ø´ ÙŠØ³ØªØ­Ù‚ Ù…ÙÙ† Ù‡Ùˆ Ø£Ø¬Ø¯Ø±.
        ÙˆÙ‚Ø¯ Ø£ÙˆÙ‚Ù Ø¯ÙØ¹ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ØŒ ÙˆØ³Ø­Ø¨ Ø¬Ù†ÙˆØ¯Ù‡ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©.
        <br><br>
        <span class="char-name">Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø®Ø§Ù„Ø¯</span> ÙŠØ¶Ø±Ø¨ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø¨Ù‚Ø¨Ø¶ØªÙ‡: <span class="whisper">"Ø¯Ø¹Ù†ÙŠ Ø£Ø³ÙŠØ± Ø¥Ù„ÙŠÙ‡ Ø§Ù„Ø¢Ù†ØŒ Ø¬Ù„Ø§Ù„ØªÙƒ. Ù‡Ø°Ø§ Ø§Ù„Ù…ØªÙ…Ø±Ø¯ Ù„Ø§ ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ø­ÙˆØ§Ø±."</span>
        <br><br>
      `;
      if (G.tags.has('opened_stores')) return base + `<span class="good-word">Ø´Ø¹Ø¨Ùƒ ÙŠÙ‚Ù Ø®Ù„ÙÙƒ</span> Ø¨Ù‚ÙˆØ© â€” Ù„ÙƒÙ† Ø§Ù„Ø¬ÙŠØ´ Ù„Ø§ ÙŠØ²Ø§Ù„ Ù…ØªØ°Ø¨Ø°Ø¨Ø§Ù‹.`;
      if (G.tags.has('army_debt')) return base + `<span class="dramatic">Ø§Ù„Ø¬Ù†ÙˆØ¯ ÙŠØªØ±Ø¯Ø¯ÙˆÙ†</span> ÙÙŠ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ø£ÙˆØ§Ù…Ø± â€” Ø°ÙƒØ±Ù‰ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù„Ø§ ØªØ²Ø§Ù„ Ø·Ø§Ø²Ø¬Ø© ÙÙŠ Ø£Ø°Ù‡Ø§Ù†Ù‡Ù….`;
      return base + `Ø§Ù„Ù…ÙˆÙ‚Ù Ø­Ø±Ø¬ØŒ ÙˆÙƒÙ„ Ø®Ø·ÙˆØ© Ù„Ù‡Ø§ Ø«Ù…Ù†.`;
    },
    memory: () => G.tags.has('army_debt') ? 'âš ï¸ Ø§Ù„Ø¬ÙŠØ´ Ù„Ù… ÙŠÙ†Ø³Ù Ù…Ø§ Ø·Ù„Ø¨ØªÙ‡ Ù…Ù†Ù‡ Ø³Ø§Ø¨Ù‚Ø§Ù‹' :
                  G.tags.has('opened_stores') ? 'ğŸ’š Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ¤ÙŠØ¯Ùƒ â€” Ø§Ø³ØªØ«Ù…Ø± Ù‡Ø°Ø§' : null,
    choices: [
      {
        emoji: 'âš”ï¸', text: 'Ø£Ø±Ø³Ù„ Ø¬ÙŠØ´Ø§Ù‹ Ù„Ø¥Ø®Ù…Ø§Ø¯ Ø§Ù„ØªÙ…Ø±Ø¯ ÙÙˆØ±Ø§Ù‹ ÙˆØ¨Ø§Ù„Ù‚ÙˆØ©',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’20', type: 'down' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +5', type: 'up' }],
        fn: () => {
          const penalty = G.tags.has('army_debt') ? -15 : 0;
          apply({army: 10 + penalty, people:-20, nobles:5});
          G.tags.add('crushed_rebel');
          chronicle('âš”ï¸', 'Ø£Ø®Ù…Ø¯ ØªÙ…Ø±Ø¯ Ø§Ù„Ø£Ù…ÙŠØ± ÙƒÙ…Ø§Ù„ Ø¨Ø§Ù„Ù‚ÙˆØ©');
          transition('ğŸ—¡ï¸', 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø³Ù‚Ø·Øª... Ù„ÙƒÙ† Ø§Ù„Ø¯Ù… ÙŠØ³ØªÙˆØ¬Ø¨ Ø§Ù„Ø¯Ù…', () => go('invasion'));
        }
      },
      {
        emoji: 'ğŸ¤', text: 'Ø£Ø¯Ø¹Ùˆ Ø§Ù„Ø£Ù…ÙŠØ± Ù„Ù…Ø£Ø¯Ø¨Ø© ÙˆØ£Ø¹Ø±Ø¶ Ø¹Ù„ÙŠÙ‡ Ù…Ù†ØµØ¨ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø£ÙˆÙ„',
        sub: [{ label: '+Ø§Ù„ÙƒÙ†ÙŠØ³Ø© +10', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’10', type: 'down' }],
        fn: () => {
          apply({church:10, people:10, nobles:-10});
          G.tags.add('diplomacy_rebel');
          chronicle('ğŸ¤', 'ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø§Ù„Ø£Ù…ÙŠØ± ÙˆØ£Ø¹Ø·Ø§Ù‡ Ù…Ù†ØµØ¨Ø§Ù‹');
          transition('ğŸ•Šï¸', 'Ø§Ù„Ø£Ù…ÙŠØ± Ù‚Ø¨Ù„... Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙˆÙ† ÙŠØªØ³Ø§Ø¡Ù„ÙˆÙ†: Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ù†Ø­Ù† Ø£ÙŠØ¶Ø§Ù‹ØŸ', () => go('invasion'));
        }
      },
      {
        emoji: 'ğŸ“œ', text: 'Ø§ØªÙ‡Ù…Ù‡ Ø¹Ù„Ù†Ø§Ù‹ Ø¨Ø§Ù„Ø®ÙŠØ§Ù†Ø© ÙˆØ§Ù†ØªØ¸Ø± Ø¯Ø¹Ù… Ø§Ù„ÙØµØ§Ø¦Ù„',
        sub: [{ label: '+Ø§Ù„ÙƒÙ†ÙŠØ³Ø© +15', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’5', type: 'down' }, { label: 'Ù†ØªÙŠØ¬Ø© ØºÙŠØ± Ù…Ø¶Ù…ÙˆÙ†Ø©', type: 'neutral' }],
        fn: () => {
          const churchBonus = G.tags.has('church_debt') ? 20 : 15;
          apply({church: churchBonus, army:-5, people: 5});
          G.tags.add('public_accusation');
          chronicle('ğŸ“œ', 'Ø§ØªÙ‡Ù… Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ù„Ù†Ø§Ù‹ ÙˆØ§Ù†ØªØ¸Ø± Ø§Ù„Ø¯Ø¹Ù…');
          transition('âš–ï¸', 'Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ­ÙƒÙ…... ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ±Ø§Ù‚Ø¨', () => go('invasion'));
        }
      },
    ]
  },

  // â”€â”€ SCENE 4: Invasion â”€â”€
  invasion: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø±Ø§Ø¨Ø¹ â€” Ø§Ù„ØºØ²Ùˆ',
    title: 'Ø£Ø³ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ ØªØ²Ø­Ù',
    emoji: 'ğŸº',
    mood: 'radial-gradient(ellipse at 50% 120%, rgba(80,20,80,0.5) 0%, transparent 60%)',
    text: () => {
      const base = `
        Ø«Ù„Ø§Ø«ÙˆÙ† Ø£Ù„Ù Ø¬Ù†Ø¯ÙŠ Ù…Ù† Ù…Ù…Ù„ÙƒØ© <span class="char-name">Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©</span> ÙŠØ¹Ø¨Ø±ÙˆÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯.
        Ù‚Ø§Ø¦Ø¯Ù‡Ù… <span class="char-name">Ø§Ù„Ø¬Ù†Ø±Ø§Ù„ ÙÙˆÙ„ÙƒÙˆ</span> ÙŠÙØ±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ­ÙŠØ¯Ø©: <span class="dramatic">"Ø§Ø³ØªØ³Ù„Ù…ÙˆØ§ Ø£Ùˆ Ù†Ø­Ø±Ù‚ Ø§Ù„Ù‚Ø±Ù‰ ÙˆØ§Ø­Ø¯Ø© ØªÙ„Ùˆ Ø§Ù„Ø£Ø®Ø±Ù‰."</span>
        <br><br>
        Ù…Ø¬Ù„Ø³ Ø§Ù„Ø­Ø±Ø¨ ÙŠÙ†Ø¹Ù‚Ø¯ ÙÙŠ ØºØ±ÙØ© Ø¯Ø®Ø§Ù†Ù‡Ø§ ÙŠØ®Ù†Ù‚ Ø§Ù„Ø£Ù†ÙØ§Ø³.
        <br><br>
      `;
      if (G.tags.has('crushed_rebel') && G.tags.has('dug_canals')) return base + `Ø¬ÙŠØ´Ùƒ <span class="good-word">Ù…ÙˆØ­Ù‘Ø¯ ÙˆÙ…ÙˆØ±Ø§Ù„ÙŠ Ù…Ø±ØªÙØ¹</span>ØŒ ÙˆÙ‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙŠ ØªØ¬Ø¹Ù„ Ø§Ù„Ù…Ø¯Ù† Ø£Ù‚Ù„ Ø­Ø§Ø¬Ø© Ù„Ù„Ù…Ø¤Ù†.`;
      if (G.tags.has('diplomacy_rebel')) return base + `<span class="char-name">Ø§Ù„Ø£Ù…ÙŠØ± ÙƒÙ…Ø§Ù„</span> ÙŠÙØ¹Ø±Ø¶ Ø¹Ù„ÙŠÙƒ Ø¬Ù†ÙˆØ¯Ù‡ Ù…Ù† Ø§Ù„Ø´Ø±Ù‚ â€” Ø±Ø¨Ù…Ø§ Ù‚Ø±Ø§Ø±Ù‡ Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠ Ø«Ù…Ù‘Ø±!`;
      if (G.tags.has('army_debt')) return base + `<span class="dramatic">Ø¨Ø¹Ø¶ Ù‚Ø§Ø¯Ø© Ø§Ù„Ø¬ÙŠØ´ ÙŠØªØ°Ù…Ø±ÙˆÙ† Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù</span> â€” ÙˆØ¹Ø¯Ù‡Ù… Ø¨Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ© Ù„Ù… ÙŠØªØ­Ù‚Ù‚ Ø¨Ø¹Ø¯.`;
      return base + `Ø§Ù„Ù…Ø¹Ø±ÙƒØ© ØªÙ„ÙˆØ­ ÙÙŠ Ø§Ù„Ø£ÙÙ‚ØŒ ÙˆØ§Ù„ÙˆÙ‚Øª ÙŠÙ†ÙØ¯.`;
    },
    memory: () => {
      if (G.tags.has('diplomacy_rebel')) return 'ğŸ¤ Ø§Ù„Ø£Ù…ÙŠØ± ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¢Ù† Ø­Ù„ÙŠÙÙƒ';
      if (G.tags.has('crushed_rebel')) return 'âš”ï¸ Ø¬ÙŠØ´Ùƒ Ù…Ø­Ø§Ø±Ø¨ ÙˆÙ…Ù†ØªØµØ±';
      if (G.tags.has('army_debt')) return 'âš ï¸ Ø§Ù„Ø¬ÙŠØ´ Ù„Ù… ÙŠÙÙƒØ§ÙÙØ£ Ø¨Ø¹Ø¯ ÙƒÙ…Ø§ ÙˆØ¹Ø¯Øª';
      return null;
    },
    choices: [
      {
        emoji: 'ğŸ—¡ï¸', text: 'Ø§Ø®Ø±Ø¬ Ø¨Ù†ÙØ³Ùƒ Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ø¬ÙŠØ´ ÙˆÙ‚Ø§ØªÙ„ Ø¯ÙØ§Ø¹Ø§Ù‹ Ø¹Ù† Ø§Ù„ÙˆØ·Ù†',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +20', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +15', type: 'up' }, { label: 'Ø®Ø·Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ùƒ', type: 'neutral' }],
        fn: () => {
          const bonus = G.tags.has('diplomacy_rebel') ? 10 : 0;
          apply({army:20+bonus, people:15, nobles:5});
          G.tags.add('led_battle');
          chronicle('ğŸ—¡ï¸', 'Ù‚Ø§Ø¯ Ø§Ù„Ø¬ÙŠØ´ Ø´Ø®ØµÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©');
          transition('âš”ï¸', 'Ø§Ù„Ù…Ù„Ùƒ ÙŠÙ‚Ø§ØªÙ„! Ø§Ù„Ù…ÙˆØ±Ø§Ù„ ÙŠØ±ØªÙØ¹ Ù„Ù„Ø³Ù…Ø§Ø¡!', () => go('plague'));
        }
      },
      {
        emoji: 'ğŸ³ï¸', text: 'Ø§Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ÙˆØ¶ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„ØªÙ†Ø§Ø²Ù„ Ø¹Ù† Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„Ø­Ø¯ÙˆØ¯ÙŠØ©',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’15', type: 'down' }, { label: 'âˆ’Ø´Ø±Ù Ø§Ù„Ù…Ù„Ùƒ', type: 'down' }],
        fn: () => {
          apply({people:10, nobles:-15, church:-5});
          G.tags.add('surrendered_land');
          chronicle('ğŸ³ï¸', 'ØªÙ†Ø§Ø²Ù„ Ø¹Ù† Ø£Ø±Ø§Ø¶ÙŠ Ø­Ø¯ÙˆØ¯ÙŠØ© Ù„ÙˆÙ‚Ù Ø§Ù„Ø­Ø±Ø¨');
          transition('ğŸ“œ', 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¬Ø§Ø¡... Ù„ÙƒÙ† Ø¨Ø«Ù…Ù† ÙŠØ¬Ø±Ø­ Ø§Ù„ÙƒØ¨Ø±ÙŠØ§Ø¡', () => go('plague'));
        }
      },
      {
        emoji: 'ğŸ”¥', text: 'Ø§Ø³ØªØ®Ø¯Ù… ØªÙƒØªÙŠÙƒ Ø§Ù„Ø£Ø±Ø¶ Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø© ÙˆØ£Ø®Ù„Ù Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙƒÙ…ØµÙŠØ¯Ø©',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +15', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’10', type: 'down' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +5', type: 'up' }],
        fn: () => {
          apply({army:15, people:-10, nobles:5});
          G.tags.add('scorched_earth');
          chronicle('ğŸ”¥', 'Ø­Ø±Ù‚ Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙƒÙ…ØµÙŠØ¯Ø© Ù„Ù„ØºØ²Ø§Ø©');
          transition('ğŸŒ‘', 'Ø§Ù„ØºØ²Ø§Ø© ØªØ±Ø§Ø¬Ø¹ÙˆØ§... Ù„ÙƒÙ† Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ÙŠØ© Ø¯ÙÙ…Ù‘Ø±Øª', () => go('plague'));
        }
      },
    ]
  },

  // â”€â”€ SCENE 5: Plague â”€â”€
  plague: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø®Ø§Ù…Ø³ â€” Ø§Ù„Ø·Ø§Ø¹ÙˆÙ† Ø§Ù„Ø£Ø³ÙˆØ¯',
    title: 'Ø§Ù„Ù…ÙˆØª ÙŠØ·Ø±Ù‚ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨',
    emoji: 'ğŸ’€',
    mood: 'radial-gradient(ellipse at 50% 120%, rgba(30,50,80,0.6) 0%, transparent 60%)',
    text: () => {
      const base = `
        Ø¬Ù†ÙˆØ¯ Ø¹Ø§Ø¦Ø¯ÙˆÙ† Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø£Ø­Ø¶Ø±ÙˆØ§ Ù…Ø¹Ù‡Ù… Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù†ØµØ± â€” Ø£Ø­Ø¶Ø±ÙˆØ§ ÙˆØ¨Ø§Ø¡Ù‹ Ù„Ø§ ÙŠÙØ±Ù‰.
        <br><br>
        ÙÙŠ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†ØŒ Ø£ÙØºÙ„Ù‚Øª Ø«Ù„Ø« Ø­ÙˆØ§Ù†ÙŠØª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©. Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ ÙŠØ­Ø±Ù‚ÙˆÙ† Ø§Ù„Ø¬Ø«Ø« Ù„ÙŠÙ„Ø§Ù‹ ÙˆØ§Ù„Ø¯Ø®Ø§Ù† ÙŠÙ…Ù„Ø£ Ø§Ù„Ø£ÙÙ‚.
        <span class="char-name">Ø§Ù„Ø£Ø³Ù‚Ù ÙŠÙˆØ­Ù†Ø§</span> ÙŠØ¯Ø¹Ùˆ Ù„ØµÙ„Ø§Ø© Ø¹Ø§Ù…Ø©ØŒ Ø£Ù…Ø§ <span class="char-name">Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù…Ù„ÙƒÙŠ ÙƒØ§Ø±Ø§Ø²</span> ÙÙŠÙ‚ÙˆÙ„: <span class="whisper">"Ø§Ù„Ø¹Ø²Ù„ Ø§Ù„ØµØ§Ø±Ù… Ù‡Ùˆ Ø§Ù„Ø­Ù„ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø¹Ù„Ù…ÙŠØ§Ù‹."</span>
        <br><br>
      `;
      if (G.tags.has('led_battle')) return base + `<span class="good-word">Ø´Ø¹Ø¨Ùƒ ÙŠØ«Ù‚ Ø¨Ùƒ ØªÙ…Ø§Ù…Ø§Ù‹</span> Ø¨Ø¹Ø¯ Ø£Ù† Ø±Ø£ÙˆÙƒ ØªÙ‚Ø§ØªÙ„ Ù…Ø¹Ù‡Ù… â€” Ù‚Ø±Ø§Ø±Ø§ØªÙƒ Ø³ØªÙØ·Ø§Ø¹ Ø¨Ù„Ø§ ØªØ±Ø¯Ø¯.`;
      if (G.tags.has('scorched_earth')) return base + `<span class="dramatic">Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ÙŠØ© Ø§Ù„Ù…Ø¯Ù…Ø±Ø©</span> ØªÙØ´ÙƒÙ‘Ù„ Ù…Ù„Ø§Ø¬Ø¦ Ø¨Ø§Ø¦Ø³Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø²Ù„Ù‡Ø§ Ø¨Ø³Ù‡ÙˆÙ„Ø© â€” Ø§Ù„ÙˆØ¶Ø¹ Ø£Ø¹Ù‚Ø¯.`;
      if (G.tags.has('church_debt')) return base + `<span class="char-name">Ø§Ù„Ø£Ø³Ù‚Ù ÙŠÙˆØ­Ù†Ø§</span> ÙŠÙØ°ÙƒÙ‘Ø±Ùƒ Ø¨Ø§Ù„Ø¯ÙÙ‘ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚: <span class="whisper">"Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ù†Ø³Ø§Ø¹Ø¯... ÙƒÙ…Ø§ Ø³Ø§Ø¹Ø¯Ù†Ø§ Ù…Ù† Ù‚Ø¨Ù„."</span>`;
      return base + `Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ØªÙ†ØªØ¸Ø± Ù‚Ø±Ø§Ø±Ùƒ.`;
    },
    memory: () => {
      if (G.tags.has('church_debt')) return 'â›ª Ø§Ù„ÙƒÙ†ÙŠØ³Ø© ØªÙ†ØªØ¸Ø± Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙ‡Ø§';
      if (G.tags.has('led_battle')) return 'ğŸ’š Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ«Ù‚ Ø¨Ù‚ÙŠØ§Ø¯ØªÙƒ';
      if (G.tags.has('scorched_earth')) return 'âš ï¸ Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ÙŠØ© Ø§Ù„Ù…Ø¯Ù…Ø±Ø© ØªØ²ÙŠØ¯ Ø§Ù„Ø£Ù…Ø± ØµØ¹ÙˆØ¨Ø©';
      return null;
    },
    choices: [
      {
        emoji: 'ğŸš§', text: 'Ø£Ø¹Ø²Ù„ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØµØ§Ø¨Ø© Ø¹Ø²Ù„Ø§Ù‹ ØªØ§Ù…Ø§Ù‹ Ø­ØªÙ‰ Ù„Ùˆ Ø£Ø¶Ø±Ù‘ Ø°Ù„Ùƒ Ø¨Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯',
        sub: [{ label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’20', type: 'down' }, { label: '+Ø§Ù„Ø¬ÙŠØ´ +5', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +10', type: 'up' }],
        fn: () => {
          apply({people:-20, army:5, nobles:10});
          G.tags.add('isolated');
          chronicle('ğŸš§', 'Ø¹Ø²Ù„ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØµØ§Ø¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„');
          transition('ğŸŒ‘', 'Ø§Ù„ÙˆØ¨Ø§Ø¡ ÙŠØªØ±Ø§Ø¬Ø¹... Ù„ÙƒÙ† Ø±ÙˆØ­ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ØªÙ†ÙƒØ³Ø±', () => triggerRandomEvent(() => go('betrayal')));
        }
      },
      {
        emoji: 'â¤ï¸', text: 'Ø£ÙØªØ­ Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ø¯ÙˆÙ„Ø© ÙƒÙ„Ù‡Ø§ Ù„Ù„Ø¹Ù„Ø§Ø¬ â€” Ù„Ø§ Ø£Ø­Ø¯ ÙŠÙØªØ±Ùƒ',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +25', type: 'up' }, { label: 'âˆ’Ø®Ø²ÙŠÙ†Ø© âˆ’30', type: 'down' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’10', type: 'down' }],
        fn: () => {
          apply({people:25, nobles:-10, church:10});
          G.tags.add('healed_all');
          chronicle('â¤ï¸', 'Ø£Ù†ÙÙ‚ Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù…Ø±Ø¶Ù‰');
          transition('â¤ï¸', 'Ù„Ø§ Ø£Ø­Ø¯ Ù…Ø§Øª ÙˆØ­ÙŠØ¯Ø§Ù‹... ÙˆØ§Ù„Ù†Ø§Ø³ Ù„Ù† ÙŠÙ†Ø³ÙˆØ§', () => triggerRandomEvent(() => go('betrayal')));
        }
      },
      {
        emoji: 'â›ª', text: 'Ø£Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„ÙƒÙ†ÙŠØ³Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø²Ù…Ø© Ù…Ù‚Ø§Ø¨Ù„ Ù…Ù†Ø­ Ø£ÙˆØ³Ø¹ Ù„Ù„Ù…Ø¹Ø§Ø¨Ø¯',
        sub: [{ label: '+Ø§Ù„ÙƒÙ†ÙŠØ³Ø© +20', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +10', type: 'up' }, { label: 'âˆ’Ø³Ù„Ø·Ø© Ø§Ù„Ù…Ù„Ùƒ', type: 'down' }],
        fn: () => {
          const churchMod = G.tags.has('church_debt') ? 25 : 20;
          apply({church: churchMod, people:10, nobles:-5});
          G.tags.add('church_led');
          chronicle('â›ª', 'Ø£ÙˆÙƒÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ¨Ø§Ø¡ Ù„Ù„ÙƒÙ†ÙŠØ³Ø© Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù…ØªÙŠØ§Ø²Ø§Øª');
          transition('âœï¸', 'Ø§Ù„ÙƒÙ†ÙŠØ³Ø© ØªÙØ¯ÙŠØ±... ÙˆØ§Ù„Ù…Ù„Ùƒ ÙŠØ±Ø§Ù‚Ø¨', () => triggerRandomEvent(() => go('betrayal')));
        }
      },
    ]
  },

  // â”€â”€ SCENE 6: Betrayal â”€â”€
  betrayal: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø³Ø§Ø¯Ø³ â€” Ø§Ù„Ø®Ù†Ø¬Ø± Ù…Ù† Ø§Ù„Ø¸Ù‡Ø±',
    title: 'Ø®ÙŠØ§Ù†Ø© Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø­ÙƒÙŠÙ…',
    emoji: 'ğŸ—¡ï¸',
    mood: 'radial-gradient(ellipse at 50% 120%, rgba(80,10,10,0.7) 0%, transparent 60%)',
    text: () => {
      const base = `
        ÙÙŠ Ù„ÙŠÙ„Ø© Ø¨Ø§Ø±Ø¯Ø©ØŒ ØªØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© Ù…Ø¬Ù‡ÙˆÙ„Ø© ØªØ­Øª ÙˆØ³Ø§Ø¯ØªÙƒ.<br><br>
        ÙÙŠÙ‡Ø§ Ø£Ø¯Ù„Ø© Ù…ÙÙØµÙ‘Ù„Ø©: <span class="char-name">Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø­ÙƒÙŠÙ…</span>ØŒ ÙˆØ²ÙŠØ±Ùƒ Ø§Ù„Ø£ÙƒØ¨Ø± Ø§Ù„Ø°ÙŠ Ø±Ø§ÙÙ‚Ùƒ Ù…Ù†Ø° Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ â€”
        Ù‡Ùˆ Ù…Ù† Ø£ÙˆØµÙ‰ Ø£Ø¨Ø§Ùƒ Ø¨Ø§Ù„Ù‚Ø±ÙˆØ¶ Ø§Ù„Ù…Ø´Ø¤ÙˆÙ…Ø© Ø§Ù„ØªÙŠ Ø£Ø«Ù‚Ù„Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø©.
        ÙˆÙ‡Ùˆ Ù…Ù† ÙƒØ§Ù† ÙŠÙØ³Ø±Ù‘Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø«Ù†Ø¯Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„ØºØ²Ùˆ.
        <br><br>
        <span class="whisper">Ù„ÙŠÙ„Ù‰ ØªÙ‡Ù…Ø³: "Ø¬Ù„Ø§Ù„ØªÙƒ... Ø³Ù„ÙŠÙ…Ø§Ù† Ù„ÙŠØ³ ÙˆØ­Ø¯Ù‡. Ù„ÙƒÙ† Ø¥Ù† ØªØµØ±ÙØª Ø¨Ø§Ù†Ø¯ÙØ§Ø¹ØŒ Ø³ØªÙØ­ÙˆÙ‘Ù„ Ù†ØµÙ Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø¶Ø¯Ùƒ."</span>
        <br><br>
      `;
      if (G.tags.has('diplomacy_rebel')) return base + `<span class="char-name">Ø§Ù„Ø£Ù…ÙŠØ± ÙƒÙ…Ø§Ù„</span> Ø­Ù„ÙŠÙÙƒ ÙŠÙØ¤ÙƒØ¯ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª: <span class="good-word">"Ø±Ø£ÙŠØª Ø³Ù„ÙŠÙ…Ø§Ù† ÙŠÙ„ØªÙ‚ÙŠ Ø¨Ø¬ÙˆØ§Ø³ÙŠØ³ Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø¨Ù†ÙØ³ÙŠ."</span>`;
      if (G.tags.has('taxed_nobles')) return base + `<span class="dramatic">Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ù„ØºØ§Ø¶Ø¨ÙˆÙ†</span> ÙŠØ¯Ø¹Ù…ÙˆÙ† Ø³Ù„ÙŠÙ…Ø§Ù† Ø®Ù„Ù Ø§Ù„ÙƒÙˆØ§Ù„ÙŠØ³ â€” ÙŠØ±ÙˆÙ† ÙÙŠÙ‡ Ø­Ù„ÙŠÙØ§Ù‹ Ø¶Ø¯Ùƒ.`;
      return base + `Ø§Ù„Ù‚ØµØ± ÙŠØ­Ø¨Ø³ Ø£Ù†ÙØ§Ø³Ù‡. Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙŠØ±Ø§Ù‚Ø¨.`;
    },
    memory: () => {
      if (G.tags.has('diplomacy_rebel')) return 'ğŸ¤ Ø§Ù„Ø£Ù…ÙŠØ± ÙƒÙ…Ø§Ù„ Ø­Ù„ÙŠÙÙƒ â€” Ø´Ù‡Ø§Ø¯ØªÙ‡ Ù‚ÙˆÙŠØ©';
      if (G.tags.has('taxed_nobles')) return 'âš ï¸ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø¶Ø¯Ùƒ â€” Ø§Ø­Ø°Ø± Ù…Ù† Ø§Ù„ØªØµØ¹ÙŠØ¯';
      return 'ğŸ—¡ï¸ Ø³Ù„ÙŠÙ…Ø§Ù† ÙƒØ§Ù† Ø£Ù‚Ø±Ø¨ Ø§Ù„Ù†Ø§Ø³ Ø¥Ù„ÙŠÙƒ';
    },
    choices: [
      {
        emoji: 'âš–ï¸', text: 'Ø£Ø¹Ù‚Ø¯ Ù…Ø­Ø§ÙƒÙ…Ø© Ø¹Ù„Ù†ÙŠØ© ÙˆØ£Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯Ù„Ø© Ø£Ù…Ø§Ù… Ø§Ù„ÙØµØ§Ø¦Ù„ ÙƒÙ„Ù‡Ø§',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +15', type: 'up' }, { label: '+Ø§Ù„ÙƒÙ†ÙŠØ³Ø© +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’15', type: 'down' }],
        fn: () => {
          apply({people:15, church:10, nobles:-15});
          G.tags.add('public_trial');
          chronicle('âš–ï¸', 'Ø­Ø§ÙƒÙ… Ø³Ù„ÙŠÙ…Ø§Ù† Ø¹Ù„Ù†Ø§Ù‹ Ø£Ù…Ø§Ù… Ø§Ù„Ø´Ø¹Ø¨');
          transition('âš–ï¸', 'Ø§Ù„Ù…Ø­Ø§ÙƒÙ…Ø© ØªÙ‡Ø²Ù‘ Ø£Ø±ÙŠÙ‡Ø§Ù†... Ù„Ø§ Ø´ÙŠØ¡ Ø¨Ø¹Ø¯Ù‡Ø§ ÙƒÙ…Ø§ ÙƒØ§Ù†', () => go('pretender'));
        }
      },
      {
        emoji: 'ğŸŒ‘', text: 'Ø£Ø¹Ø²Ù„Ù‡ Ø¨Ù‡Ø¯ÙˆØ¡ ÙˆØ£ÙØ¨Ø¹Ø¯Ù‡ Ø¹Ù† Ø§Ù„Ù‚ØµØ± Ø¨Ù„Ø§ Ø¶Ø¬Ø© â€” Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ù„Ø§ ØªØªØ­Ù…Ù„ ÙØ¶ÙŠØ­Ø©',
        sub: [{ label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’5', type: 'down' }, { label: '+Ø§Ø³ØªÙ‚Ø±Ø§Ø±', type: 'neutral' }],
        fn: () => {
          apply({nobles:10, people:-5, army:5});
          G.tags.add('silent_exile');
          chronicle('ğŸŒ‘', 'Ø£Ø¨Ø¹Ø¯ Ø³Ù„ÙŠÙ…Ø§Ù† Ø¨ØµÙ…Øª Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡');
          transition('ğŸŒ™', 'Ø³Ù„ÙŠÙ…Ø§Ù† ØºØ§Ø¯Ø±... Ù„ÙƒÙ† Ø£Ø³Ø±Ø§Ø±Ù‡ Ø¨Ù‚ÙŠØª', () => go('pretender'));
        }
      },
      {
        emoji: 'ğŸ¤', text: 'Ø£Ø³ØªØ¯Ø¹ÙŠÙ‡ ÙˆØ­Ø¯Ù‡ ÙˆØ£Ù…Ù†Ø­Ù‡ ÙØ±ØµØ© Ù„Ù„Ø§Ø¹ØªØ±Ø§Ù Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø±Ø­Ù…Ø©',
        sub: [{ label: '+Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†Ø§Ø¯Ø±Ø©', type: 'neutral' }, { label: '+Ø§Ù„ÙƒÙ†ÙŠØ³Ø© +5', type: 'up' }, { label: 'Ø®Ø·Ø±: Ù‚Ø¯ ÙŠÙƒØ°Ø¨', type: 'neutral' }],
        fn: () => {
          const bonus = G.tags.has('church_debt') ? 10 : 5;
          apply({church: bonus, people:5, nobles:5});
          G.tags.add('forgave_solomon');
          G.tags.add('solomon_secret'); // Ø³Ù„ÙŠÙ…Ø§Ù† ÙŠÙƒØ´Ù Ø³Ø±Ø§Ù‹ Ù…Ù‡Ù…Ø§Ù‹
          chronicle('ğŸ¤', 'Ù…Ù†Ø­ Ø³Ù„ÙŠÙ…Ø§Ù† ÙØ±ØµØ© Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù ÙˆØ§Ù„Ø±Ø­Ù…Ø©');
          transition('ğŸ•¯ï¸', 'Ø³Ù„ÙŠÙ…Ø§Ù† Ø¨ÙƒÙ‰... ÙˆØ§Ø¹ØªØ±Ù Ø¨Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ØªÙˆÙ‚Ø¹Øª', () => go('pretender'));
        }
      },
    ]
  },

  // â”€â”€ SCENE 7: The Pretender â”€â”€
  pretender: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø³Ø§Ø¨Ø¹ â€” Ø¯Ù… Ø§Ù„Ù…Ù„ÙˆÙƒ',
    title: 'Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø´',
    emoji: 'ğŸ‘‘',
    mood: 'radial-gradient(ellipse at 50% 120%, rgba(60,40,10,0.7) 0%, transparent 60%)',
    text: () => {
      const base = `
        Ù…Ù† Ø¨Ù„Ø§Ø¯ Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø© ÙŠØµÙ„ Ø´Ø§Ø¨ ÙŠØ¯Ù‘Ø¹ÙŠ Ø£Ù†Ù‡ <span class="dramatic">Ø§Ø¨Ù† Ø£Ø¨ÙŠÙƒ Ù…Ù† Ø²ÙˆØ§Ø¬ Ø³Ø±ÙŠ</span>.
        Ù…Ø¹Ù‡ ÙˆØ«Ø§Ø¦Ù‚ ØªØ¨Ø¯Ùˆ Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ ÙˆØ®Ø§ØªÙ… Ù…Ù„ÙƒÙŠ Ù‚Ø¯ÙŠÙ….
        Ø§Ù„Ø´Ø¹Ø¨ ÙŠØªØ³Ø§Ø¡Ù„. Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØªØ¢Ù…Ø±ÙˆÙ†. ÙˆØ§Ù„Ø¬ÙŠØ´ ÙŠÙ†ØªØ¸Ø±.
        <br><br>
        <span class="char-name">Ù„ÙŠÙ„Ù‰</span> ØªØ¬Ù„Ø³ Ø£Ù…Ø§Ù…Ùƒ ÙˆØ¹ÙŠÙ†Ø§Ù‡Ø§ Ù‚Ù„Ù‚ØªØ§Ù†:
        <span class="whisper">"Ø¬Ù„Ø§Ù„ØªÙƒØŒ Ø¥Ù† ÙƒØ§Ù† Ø­Ù‚ÙŠÙ‚ÙŠØ§Ù‹ â€” ÙÙ†ØµÙ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø³ØªØªØ¨Ø¹Ù‡. ÙˆØ¥Ù† ÙƒØ§Ù† ÙƒØ§Ø°Ø¨Ø§Ù‹ â€” ÙÙ…Ù† Ø£Ø±Ø³Ù„Ù‡ØŸ"</span>
        <br><br>
      `;
      if (G.tags.has('solomon_secret')) return base + `<span class="good-word">Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ø¹ØªØ±Ù:</span> Ù‡Ø°Ø§ Ø§Ù„Ø´Ø§Ø¨ Ø­Ù‚ÙŠÙ‚ÙŠ â€” Ø£Ø¨ÙˆÙƒ Ø£Ø®Ø¨Ø±Ù‡ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø³Ø± Ù‚Ø¨Ù„ Ù…ÙˆØªÙ‡. <span class="dramatic">Ø£Ø®ÙˆÙƒ ØºÙŠØ± Ø§Ù„Ø´Ø±Ø¹ÙŠ Ø­ÙŠÙ‘.</span>`;
      if (G.tags.has('public_trial')) return base + `Ø¨Ø¹Ø¯ Ù…Ø­Ø§ÙƒÙ…Ø© Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø¹Ù„Ù†ÙŠØ©ØŒ <span class="dramatic">Ø§Ù„Ù†Ø§Ø³ ÙŠØµØ¯Ù‘Ù‚ÙˆÙ† Ø£ÙŠ Ø§Ø¯Ø¹Ø§Ø¡</span> ÙŠØ²Ø¹Ø²Ø¹ Ø§Ù„Ø¹Ø±Ø´ Ø§Ù„Ø­Ø§Ù„ÙŠ.`;
      if (G.tags.has('crushed_rebel')) return base + `Ø¬ÙŠØ´Ùƒ Ø§Ù„Ù‚ÙˆÙŠ ÙŠÙ‚Ù Ø®Ù„ÙÙƒ â€” Ù„ÙƒÙ† <span class="whisper">Ø§Ù„Ù‚ÙˆØ© ÙˆØ­Ø¯Ù‡Ø§ Ù„Ø§ ØªÙØ³ÙƒØª Ø§Ù„Ø´Ùƒ.</span>`;
      return base + `Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ù…Ø¯ÙÙˆÙ†Ø©... ÙˆØ¹Ù„ÙŠÙƒ Ø£Ù† ØªÙ‚Ø±Ø± ÙƒÙŠÙ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù„ØºØ².`;
    },
    memory: () => {
      if (G.tags.has('solomon_secret')) return 'ğŸ’€ Ø³Ù„ÙŠÙ…Ø§Ù† ÙƒØ´Ù: Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø£Ø®ÙˆÙƒ ÙØ¹Ù„Ø§Ù‹';
      if (G.tags.has('public_trial')) return 'âš–ï¸ Ù…Ø­Ø§ÙƒÙ…Ø© Ø³Ù„ÙŠÙ…Ø§Ù† Ø²Ø±Ø¹Øª Ø§Ù„Ø´Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù„ÙˆØ¨';
      return 'ğŸ‘‘ Ù…Ù† Ø£Ø±Ø³Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø´Ø§Ø¨... ÙˆÙ„Ù…Ø§Ø°Ø§ Ø§Ù„Ø¢Ù†ØŸ';
    },
    choices: [
      {
        emoji: 'ğŸ§¬', text: 'Ø£Ø¬Ø±Ù‘Ø¨ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ù… Ø£Ù…Ø§Ù… Ø§Ù„Ø£Ø³Ù‚Ù ÙˆÙƒØ¨Ø§Ø± Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ â€” Ø§Ù„Ø­Ù‚ ÙŠØ¹Ù„Ùˆ',
        sub: [{ label: '+Ø§Ù„ÙƒÙ†ÙŠØ³Ø© +15', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +10', type: 'up' }, { label: 'Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø³ØªÙÙƒØ´Ù', type: 'neutral' }],
        fn: () => {
          const isReal = G.tags.has('solomon_secret');
          if (isReal) {
            apply({people:10, church:15, nobles:-10});
            G.tags.add('brother_revealed');
            chronicle('ğŸ§¬', 'ÙƒØ´Ù Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ù…: Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø£Ø® Ø­Ù‚ÙŠÙ‚ÙŠ');
            transition('ğŸ˜±', 'Ø§Ù„ØµØ¯Ù…Ø© ØªØ³Ø±ÙŠ ÙÙŠ Ø§Ù„Ù‚ØµØ±... Ø£Ø®ÙˆÙƒ Ø­ÙŠÙ‘!', () => go('legacy'));
          } else {
            apply({people:10, church:15, nobles:10});
            G.tags.add('pretender_exposed');
            chronicle('ğŸ§¬', 'ÙØ¶Ø­ Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø§Ù„ÙƒØ§Ø°Ø¨ Ø£Ù…Ø§Ù… Ø§Ù„Ø¬Ù…ÙŠØ¹');
            transition('ğŸ¯', 'Ø§Ù„Ù…Ø­ØªØ§Ù„ Ø§Ù†ÙƒØ´Ù! Ø§Ù„Ø¹Ø±Ø´ Ù„Ùƒ ÙˆØ­Ø¯Ùƒ!', () => go('legacy'));
          }
        }
      },
      {
        emoji: 'âš”ï¸', text: 'Ø£Ø¹ØªÙ‚Ù„Ù‡ ÙÙˆØ±Ø§Ù‹ â€” Ù…Ù† ÙŠØ´ÙƒÙ‘Ùƒ ÙÙŠ Ø´Ø±Ø¹ÙŠØ© Ø§Ù„Ù…Ù„Ùƒ ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ø²Ù†Ø²Ø§Ù†Ø©',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’20', type: 'down' }, { label: 'âˆ’Ø§Ù„ÙƒÙ†ÙŠØ³Ø© âˆ’10', type: 'down' }],
        fn: () => {
          apply({army:10, people:-20, church:-10});
          G.tags.add('imprisoned_pretender');
          chronicle('âš”ï¸', 'Ø³Ø¬Ù† Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø¯ÙˆÙ† Ù…Ø­Ø§ÙƒÙ…Ø©');
          transition('ğŸ”’', 'Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† ØªØ¨ØªÙ„Ø¹Ù‡... Ù„ÙƒÙ† Ø§Ù„Ø´Ø§Ø¦Ø¹Ø§Øª ØªØ¨Ù‚Ù‰', () => go('legacy'));
        }
      },
      {
        emoji: 'ğŸ•Šï¸', text: 'Ø£Ø¹ØªØ±Ù Ø¨Ù‡ Ø£Ø®Ø§Ù‹ ÙˆØ£Ù…Ù†Ø­Ù‡ Ù„Ù‚Ø¨Ø§Ù‹ Ø´Ø±ÙÙŠØ§Ù‹ Ø¨Ù„Ø§ ØµÙ„Ø§Ø­ÙŠØ§Øª â€” Ø£Ù‚Ø±Ø¨ Ø§Ù„Ø¹Ø¯Ùˆ',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +20', type: 'up' }, { label: '+Ø§Ù„ÙƒÙ†ÙŠØ³Ø© +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’5', type: 'down' }],
        fn: () => {
          apply({people:20, church:10, nobles:-5, army:5});
          G.tags.add('adopted_brother');
          chronicle('ğŸ•Šï¸', 'Ø§Ø¹ØªØ±Ù Ø¨Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø£Ø®Ø§Ù‹ ÙˆØ£Ø¹Ø·Ø§Ù‡ Ù„Ù‚Ø¨Ø§Ù‹ Ø´Ø±ÙÙŠØ§Ù‹');
          transition('ğŸ‘‘', 'Ø§Ù„Ø´Ø¹Ø¨ ÙŠÙØ­Ø¨ Ø§Ù„Ø±Ø­Ù…Ø©... ÙˆØ§Ù„Ø£Ø® ÙŠØ¨ØªØ³Ù… Ø¨Ø¹ÙŠÙˆÙ† Ø¨Ø§Ø±Ø¯Ø©', () => go('legacy'));
        }
      },
    ]
  },

  // â”€â”€ SCENE 8: Legacy â”€â”€
  legacy: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù…Ù† â€” Ø¥Ø±Ø« Ø£Ø±ÙŠÙ‡Ø§Ù†',
    title: 'Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø£Ø®ÙŠØ±',
    emoji: 'ğŸŒ…',
    mood: 'radial-gradient(ellipse at 50% 120%, rgba(100,70,20,0.6) 0%, transparent 60%)',
    text: () => {
      const base = `
        Ø¹Ø´Ø± Ø³Ù†ÙˆØ§Øª Ù…Ø±Ù‘Øª Ø¹Ù„Ù‰ Ø¬Ù„ÙˆØ³Ùƒ Ø¹Ù„Ù‰ Ø¹Ø±Ø´ Ø£Ø±ÙŠÙ‡Ø§Ù†.
        Ø§Ù„Ù…Ù…Ù„ÙƒØ© ØªØºÙŠÙ‘Ø±Øª. Ø£Ù†Øª ØªØºÙŠÙ‘Ø±Øª. ÙˆØ§Ù„Ø¢Ù† Ø£Ù…Ø§Ù…Ùƒ Ù‚Ø±Ø§Ø± ÙˆØ§Ø­Ø¯ Ø£Ø®ÙŠØ± â€” Ø³ÙŠÙØ­Ø¯Ø¯ ÙƒÙŠÙ ØªÙØ°ÙƒØ±.
        <br><br>
        <span class="char-name">Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©</span> ØªÙ‚Ù Ø¨Ø¬Ø§Ù†Ø¨Ùƒ Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©:
        <span class="whisper">"Ø¬Ù„Ø§Ù„ØªÙƒØŒ ÙƒÙ„ Ù…Ù„Ùƒ ÙŠØªØ±Ùƒ Ø´ÙŠØ¦Ø§Ù‹. Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØªØ±Ùƒ Ø£Ø±ÙŠÙ‡Ø§Ù†ØŸ"</span>
        <br><br>
      `;
      if (G.tags.has('brother_revealed') || G.tags.has('adopted_brother'))
        return base + `<span class="char-name">Ø£Ø®ÙˆÙƒ</span> ÙŠÙ‚Ù ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© ÙŠØ±Ø§Ù‚Ø¨. Ø¹ÙŠÙ†Ø§Ù‡ Ù„Ø§ ØªÙƒØ´ÙØ§Ù† Ø¹Ù† Ù†ÙˆØ§ÙŠØ§Ù‡.`;
      if (G.tags.has('healed_all'))
        return base + `Ø§Ù„Ø´Ø¹Ø¨ Ø§Ù„Ø°ÙŠ Ø¹Ø§Ù„Ø¬Øª Ø¬Ø±Ø§Ø­Ù‡ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠÙ‡ØªÙ Ø¨Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚.`;
      if (G.tags.has('led_battle'))
        return base + `Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„Ø°ÙŠÙ† Ù‚Ø§ØªÙ„Øª Ù…Ø¹Ù‡Ù… ØµØ§Ø±ÙˆØ§ Ø¢Ø¨Ø§Ø¡ ÙˆØ£Ù…Ù‡Ø§Øª â€” ÙˆÙŠÙØ­ÙƒÙˆÙ† Ù„Ø£Ø·ÙØ§Ù„Ù‡Ù… Ø¹Ù† Ù…Ù„ÙƒÙ‡Ù….`;
      return base + `Ø£Ø±ÙŠÙ‡Ø§Ù† ØªÙ†ØªØ¸Ø±. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠÙØ¹Ø¯Ù‘ Ù‚Ù„Ù…Ù‡.`;
    },
    memory: () => {
      if (G.tags.has('adopted_brother') || G.tags.has('brother_revealed')) return 'ğŸ‘‘ Ø£Ø®ÙˆÙƒ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙÙŠ Ø§Ù„Ù‚ØµØ±... ÙŠØ±Ø§Ù‚Ø¨';
      if (G.tags.has('forgave_solomon')) return 'ğŸ•¯ï¸ Ø±Ø­Ù…ØªÙƒ Ø¨Ø³Ù„ÙŠÙ…Ø§Ù† Ø¹Ù„Ù‘Ù…Øª Ø§Ù„Ù†Ø§Ø³ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¹Ø¯Ù„';
      return 'ğŸ“œ Ø¹Ø´Ø± Ø³Ù†ÙˆØ§Øª Ù…Ù† Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ØªÙ‚ÙˆØ¯Ùƒ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø­Ø¸Ø©';
    },
    choices: [
      {
        emoji: 'ğŸ“œ', text: 'Ø£ÙØµØ¯Ø± Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø­Ù‚ÙˆÙ‚ â€” Ø£ÙˆÙ„ Ù‚Ø§Ù†ÙˆÙ† ÙŠØ­Ù…ÙŠ Ø¹Ø§Ù…Ø© Ø§Ù„Ø´Ø¹Ø¨ Ù…Ù† Ø¸Ù„Ù… Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +30', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’25', type: 'down' }, { label: '+Ø¥Ø±Ø« ØªØ§Ø±ÙŠØ®ÙŠ', type: 'neutral' }],
        fn: () => {
          apply({people:30, nobles:-25, church:10});
          G.tags.add('charter_issued');
          chronicle('ğŸ“œ', 'Ø£ØµØ¯Ø± Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨');
          transition('ğŸ“œ', 'Ø§Ù„Ù…ÙŠØ«Ø§Ù‚ ÙŠÙÙ‚Ø±Ø£ ÙÙŠ ÙƒÙ„ Ù‚Ø±ÙŠØ©... Ø§Ø³Ù…Ùƒ ÙŠÙÙ†Ù‚Ø´ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®', calcEnding);
        }
      },
      {
        emoji: 'ğŸ°', text: 'Ø£Ø¨Ù†ÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ ÙˆØ£ÙØ¯Ø®Ù„ Ø§Ù„Ø¹Ù„Ù… ÙˆØ§Ù„Ø·Ø¨ Ù„ÙƒÙ„ Ø£Ø¨Ù†Ø§Ø¡ Ø£Ø±ÙŠÙ‡Ø§Ù†',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +20', type: 'up' }, { label: '+Ø§Ù„ÙƒÙ†ÙŠØ³Ø© +10', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +10', type: 'up' }],
        fn: () => {
          apply({people:20, church:10, nobles:10, army:5});
          G.tags.add('university_built');
          chronicle('ğŸ°', 'Ø£Ø³Ù‘Ø³ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ Ù„Ø£Ø¨Ù†Ø§Ø¡ Ø£Ø±ÙŠÙ‡Ø§Ù†');
          transition('ğŸ“', 'Ø§Ù„Ù†ÙˆØ± ÙŠÙØ¶Ø§Ø¡... ÙˆØ§Ù„Ø¬Ù‡Ù„ ÙŠØªØ±Ø§Ø¬Ø¹', calcEnding);
        }
      },
      {
        emoji: 'âš”ï¸', text: 'Ø£ÙØ¹Ù„Ù† Ø£Ø±ÙŠÙ‡Ø§Ù† Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ÙˆØ£Ø¨Ø¯Ø£ ØªÙˆØ³Ø¹Ø§Ù‹ Ù†Ø­Ùˆ Ø§Ù„Ø´Ù…Ø§Ù„ â€” Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø³ØªØ¯ÙØ¹',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +30', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +15', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’20', type: 'down' }],
        fn: () => {
          apply({army:30, nobles:15, people:-20, church:-5});
          G.tags.add('empire_declared');
          chronicle('âš”ï¸', 'Ø£Ø¹Ù„Ù† Ø£Ø±ÙŠÙ‡Ø§Ù† Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ÙˆØ¨Ø¯Ø£ Ø§Ù„ØªÙˆØ³Ø¹');
          transition('ğŸ”¥', 'Ø§Ù„Ø±Ø§ÙŠØ© ØªØ±ØªÙØ¹... ÙˆØ§Ù„Ø­Ø±Ø¨ ØªØ¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯', calcEnding);
        }
      },
    ]
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANDOM EVENTS SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const RANDOM_EVENTS = [
  {
    id: 'spy_caught',
    weight: 3,
    emoji: 'ğŸ•µï¸',
    title: 'Ø¬Ø§Ø³ÙˆØ³ ÙÙŠ Ø§Ù„Ù‚ØµØ±',
    text: 'Ø­Ø±Ù‘Ø§Ø³Ùƒ ÙŠÙÙ…Ø³ÙƒÙˆÙ† Ø¨Ø¬Ø§Ø³ÙˆØ³ ÙŠÙØµÙˆÙ‘Ø± Ø®Ø±Ø§Ø¦Ø· Ø§Ù„Ù‚ØµØ±. Ø¹Ù†Ø¯ Ø§Ø³ØªØ¬ÙˆØ§Ø¨Ù‡ØŒ ÙŠÙƒØ´Ù Ø£Ù†Ù‡ ÙŠØ¹Ù…Ù„ Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠÙŠÙ†.',
    choices: [
      { text: 'Ø§Ø¹Ø¯Ù…Ù‡ ÙÙˆØ±Ø§Ù‹ Ø±Ø³Ø§Ù„Ø©Ù‹ Ù„Ù„Ø¢Ø®Ø±ÙŠÙ†', emoji: 'âš”ï¸', apply: {army:5, people:-5}, tag: null },
      { text: 'Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ø¹Ù…ÙŠÙ„Ø§Ù‹ Ù…Ø²Ø¯ÙˆØ¬Ø§Ù‹', emoji: 'ğŸ­', apply: {nobles:5, church:5}, tag: 'double_agent' },
    ]
  },
  {
    id: 'harvest_miracle',
    weight: 2,
    emoji: 'ğŸŒ¾',
    title: 'Ù…ÙˆØ³Ù… ÙˆÙÙŠØ±',
    text: 'Ø®Ù„Ø§ÙØ§Ù‹ Ù„Ù„ØªÙˆÙ‚Ø¹Ø§ØªØŒ Ø¬Ø§Ø¡ Ø§Ù„Ø­ØµØ§Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù… ÙˆÙÙŠØ±Ø§Ù‹. Ø§Ù„ÙÙ„Ø§Ø­ÙˆÙ† ÙŠÙ‚ÙˆÙ„ÙˆÙ† Ø¥Ù†Ù‡ Ø¨Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ù„Ù‡ Ø¹Ù„Ù‰ Ø­ÙƒÙ…Ùƒ.',
    choices: [
      { text: 'ÙˆØ²Ù‘Ø¹ Ø§Ù„ÙØ§Ø¦Ø¶ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ‚Ø±Ø§Ø¡', emoji: 'ğŸ˜ï¸', apply: {people:15, nobles:-5}, tag: 'distributed_harvest' },
      { text: 'Ø§Ø¯Ù‘Ø®Ø±Ù‡ ÙÙŠ Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ù„Ù„Ø·ÙˆØ§Ø±Ø¦', emoji: 'ğŸ’°', apply: {nobles:10, army:5}, tag: null },
    ]
  },
  {
    id: 'leyla_arrives',
    weight: 4,
    emoji: 'ğŸŒ™',
    title: 'Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„ØºØ±ÙŠØ¨Ø©',
    text: 'Ø§Ù…Ø±Ø£Ø© ØªØ¯Ø¹Ù‰ <strong>Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©</strong> ØªØ·Ù„Ø¨ Ù…Ù‚Ø§Ø¨Ù„ØªÙƒ. ÙŠÙÙ‚Ø§Ù„ Ø¥Ù†Ù‡Ø§ Ø¯Ø±Ø³Øª ÙÙŠ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ§Øª Ø§Ù„Ø´Ø±Ù‚ ÙˆØªÙØ­Ø³Ù† Ø³Ø¨Ø¹ Ù„ØºØ§Øª. Ø¹ÙŠÙ†Ø§Ù‡Ø§ ØªÙ‚Ø±Ø¢Ù† Ø§Ù„ØºØ±Ù Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø§Ø³.',
    choices: [
      { text: 'Ø§Ù‚Ø¨Ù„Ù‡Ø§ Ù…Ø³ØªØ´Ø§Ø±Ø©Ù‹ Ø¨Ù„Ø§ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø±Ø³Ù…ÙŠØ©', emoji: 'ğŸŒ™', apply: {church:-5, people:5}, tag: 'leyla_trusted' },
      { text: 'Ø§Ø±ÙØ¶ â€” Ø§Ù„Ù‚ØµØ± Ù„ÙŠØ³ Ù…ÙƒØ§Ù†Ø§Ù‹ Ù„Ù„ØºØ±Ø¨Ø§Ø¡', emoji: 'ğŸšª', apply: {army:5}, tag: null },
    ]
  },
  {
    id: 'merchants_petition',
    weight: 3,
    emoji: 'ğŸ’¼',
    title: 'ÙˆÙØ¯ Ø§Ù„ØªØ¬Ø§Ø±',
    text: 'Ø¹Ø´Ø±ÙˆÙ† ØªØ§Ø¬Ø±Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø¯Ù† Ø§Ù„ÙƒØ¨Ø±Ù‰ ÙŠØ·Ø§Ù„Ø¨ÙˆÙ† Ø¨Ø¥Ù„ØºØ§Ø¡ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø·Ø±Ù‚. ÙŠÙ‚ÙˆÙ„ÙˆÙ† Ø¥Ù†Ù‡Ø§ ØªÙÙÙ‚Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯. Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØ¹Ø§Ø±Ø¶ÙˆÙ† â€” Ù‡Ø°Ù‡ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ØªÙ…Ù„Ø£ Ø¬ÙŠÙˆØ¨Ù‡Ù….',
    choices: [
      { text: 'Ø£Ù„ØºÙ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© â€” Ø§Ù„ØªØ¬Ø§Ø±Ø© ØªÙØºÙ†ÙŠ Ø§Ù„Ø¬Ù…ÙŠØ¹', emoji: 'ğŸ›’', apply: {people:10, nobles:-15}, tag: 'trade_freed' },
      { text: 'Ø®ÙÙ‘Ø¶Ù‡Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ù†ØµÙ â€” Ø­Ù„Ù‘ ÙˆØ³Ø·', emoji: 'âš–ï¸', apply: {people:5, nobles:-5}, tag: null },
    ]
  },
  {
    id: 'army_promotion',
    weight: 2,
    emoji: 'ğŸ–ï¸',
    title: 'Ø¨Ø·Ù„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©',
    text: 'Ø¶Ø§Ø¨Ø· Ø´Ø§Ø¨ Ù…Ù† Ø¹Ø§Ø¦Ù„Ø© ÙÙ‚ÙŠØ±Ø© Ø£Ù†Ù‚Ø° ÙƒØªÙŠØ¨Ø© ÙƒØ§Ù…Ù„Ø© Ø®Ù„Ø§Ù„ Ø§Ù„ØºØ²Ùˆ. Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø®Ø§Ù„Ø¯ ÙŠÙ‚ØªØ±Ø­ ØªØ±Ù‚ÙŠØªÙ‡ Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø­Ø±Ø³ Ø§Ù„Ù…Ù„ÙƒÙŠ. Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØ±ÙØ¶ÙˆÙ† â€” Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ù„ÙŠØ³Øª Ù†Ø¨ÙŠÙ„Ø©.',
    choices: [
      { text: 'Ø±Ù‚Ù‘Ù‡ â€” Ø§Ù„ÙƒÙØ§Ø¡Ø© ÙÙˆÙ‚ Ø§Ù„Ù†Ø³Ø¨', emoji: 'â­', apply: {army:20, nobles:-10}, tag: 'merit_promotion' },
      { text: 'Ø§Ù…Ù†Ø­Ù‡ Ù…ÙŠØ¯Ø§Ù„ÙŠØ© ÙÙ‚Ø· â€” Ø§Ù„ØªÙ‚Ø§Ù„ÙŠØ¯ Ù…Ù‡Ù…Ø©', emoji: 'ğŸ…', apply: {army:5, nobles:5}, tag: null },
    ]
  },
  {
    id: 'drought_echo',
    weight: 2,
    emoji: 'ğŸ’§',
    title: 'Ù†Ø¨Ø¹ Ø¬Ø¯ÙŠØ¯',
    text: 'Ù…Ù‡Ù†Ø¯Ø³ÙˆÙ† ÙŠÙƒØªØ´ÙÙˆÙ† Ù†Ø¨Ø¹Ø§Ù‹ Ø¶Ø®Ù…Ø§Ù‹ ØªØ­Øª Ø§Ù„ØµØ­Ø±Ø§Ø¡ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©. Ø§Ù„Ø­ÙØ± Ù…ÙÙƒÙ„Ù Ù„ÙƒÙ† Ø¥Ù† Ù†Ø¬Ø­ØŒ Ù„Ù† ØªØ¹Ø§Ù†ÙŠ Ø£Ø±ÙŠÙ‡Ø§Ù† Ù…Ù† Ø§Ù„Ø¹Ø·Ø´ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.',
    choices: [
      { text: 'Ø£Ù…ÙˆÙ‘Ù„ Ø§Ù„Ø­ÙØ± Ù…Ù† Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ø¯ÙˆÙ„Ø©', emoji: 'â›ï¸', apply: {people:15, nobles:5}, tag: 'spring_funded' },
      { text: 'Ø§ØªØ±ÙƒÙ‡ Ù„Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ', emoji: 'ğŸ’', apply: {nobles:15, people:-5}, tag: null },
    ]
  },
];

// Show a random event as a modal-style overlay
function triggerRandomEvent(callback) {
  // Pick a weighted random event not yet seen
  const unseen = RANDOM_EVENTS.filter(e => !G.seenEvents.has(e.id));
  if (unseen.length === 0) { callback(); return; }

  const totalWeight = unseen.reduce((s,e) => s + e.weight, 0);
  let rand = Math.random() * totalWeight;
  let chosen = unseen[0];
  for (const e of unseen) {
    rand -= e.weight;
    if (rand <= 0) { chosen = e; break; }
  }
  G.seenEvents.add(chosen.id);

  showRandomEventModal(chosen, callback);
}

function showRandomEventModal(ev, callback) {
  // Create modal
  const modal = document.createElement('div');
  modal.style.cssText = `
    position:fixed;inset:0;z-index:200;background:rgba(8,6,4,0.97);
    display:flex;align-items:center;justify-content:center;padding:24px;
    animation:fadeIn 0.3s ease;
  `;
  modal.innerHTML = `
    <div style="max-width:420px;width:100%;text-align:center;">
      <div style="font-size:56px;margin-bottom:12px;filter:drop-shadow(0 0 20px rgba(212,168,67,0.5))">${ev.emoji}</div>
      <div style="font-size:10px;letter-spacing:4px;color:#8b6914;margin-bottom:8px">â€” Ø­Ø¯Ø« Ø·Ø§Ø±Ø¦ â€”</div>
      <div style="font-family:'Amiri',serif;font-size:24px;font-weight:700;color:#f0c96a;margin-bottom:16px">${ev.title}</div>
      <div style="font-family:'Amiri',serif;font-size:16px;line-height:2;color:#ddc99a;margin-bottom:24px">${ev.text}</div>
      <div style="display:flex;flex-direction:column;gap:10px" id="eventChoices"></div>
    </div>
  `;
  document.body.appendChild(modal);

  const choicesEl = modal.querySelector('#eventChoices');
  ev.choices.forEach(c => {
    const btn = document.createElement('button');
    btn.style.cssText = `
      background:rgba(212,168,67,0.07);border:1px solid rgba(212,168,67,0.25);
      border-radius:12px;padding:13px 16px;width:100%;cursor:pointer;
      color:#e8d5a3;font-family:'Scheherazade New',serif;font-size:15px;
      display:flex;align-items:center;gap:10px;text-align:right;
      transition:all 0.2s;
    `;
    btn.innerHTML = `<span style="font-size:22px">${c.emoji}</span><span>${c.text}</span>`;
    btn.onclick = () => {
      apply(c.apply);
      if (c.tag) G.tags.add(c.tag);
      modal.style.opacity = '0';
      modal.style.transition = 'opacity 0.3s';
      setTimeout(() => { modal.remove(); callback(); }, 300);
    };
    choicesEl.appendChild(btn);
  });
}


const REACTIONS = {
  people: {
    up: ['Ø§Ù„Ø´Ø¹Ø¨ ÙŠÙ‡ØªÙ Ø¨Ø§Ø³Ù…Ùƒ!', 'Ø§Ù„Ù‚Ù„ÙˆØ¨ Ù…Ø¹Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„Ùƒ!', 'Ø±Ø¶Ø§ Ø§Ù„Ø´Ø¹Ø¨ ÙŠÙ‚ÙˆÙ‘ÙŠ Ø§Ù„Ø¹Ø±Ø´'],
    down: ['Ø§Ù„Ø´Ø¹Ø¨ ÙŠØªØ°Ù…Ø± ÙÙŠ Ø§Ù„Ø£Ø²Ù‚Ø©...', 'Ø§Ù„ØºØ¶Ø¨ ÙŠØªØµØ§Ø¹Ø¯ ÙÙŠ Ø§Ù„Ø´ÙˆØ§Ø±Ø¹', 'Ø§Ù„Ø´Ø¹Ø¨ ÙŠÙÙ‚Ø¯ Ø«Ù‚ØªÙ‡...']
  },
  army: {
    up: ['Ø§Ù„Ø¬Ù†ÙˆØ¯ ÙŠØ±ÙØ¹ÙˆÙ† Ø³ÙŠÙˆÙÙ‡Ù…!', 'Ø§Ù„Ø¬ÙŠØ´ Ø£ÙƒØ«Ø± ÙˆÙ„Ø§Ø¡Ù‹!', 'Ø§Ù„Ù…ÙˆØ±Ø§Ù„ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ ÙŠØ±ØªÙØ¹!'],
    down: ['Ø§Ù„Ø¬Ù†ÙˆØ¯ ÙŠØªØ°Ù…Ø±ÙˆÙ†...', 'Ø§Ù„Ø¬ÙŠØ´ ÙŠÙÙ‚Ø¯ Ø­Ù…Ø§Ø³Ù‡', 'Ø§Ù„ØªØ°Ù…Ø± ÙŠÙ†ØªØ´Ø± ÙÙŠ Ø§Ù„Ø«ÙƒÙ†Ø§Øª...']
  },
  nobles: {
    up: ['Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø±Ø§Ø¶ÙˆÙ† Ø¹Ù†Ùƒ', 'Ø§Ù„Ø«Ø±ÙˆØ© ØªØªØ¯ÙÙ‚ Ù„ØµØ§Ù„Ø­Ùƒ', 'Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ù†ÙÙˆØ° Ù…Ø¹Ùƒ'],
    down: ['Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØªØ¢Ù…Ø±ÙˆÙ† Ø®Ù„Ù Ø§Ù„Ø³ØªØ§Ø±...', 'Ø§Ù„Ø«Ø±ÙˆØ© ØªÙ†Ø£Ù‰ Ø¹Ù†Ùƒ', 'ØºØ¶Ø¨ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø®Ø·ÙŠØ±...']
  },
  church: {
    up: ['Ø§Ù„ÙƒÙ†ÙŠØ³Ø© ØªØ¨Ø§Ø±ÙƒÙƒ!', 'Ø§Ù„Ø´Ø±Ø¹ÙŠØ© Ø§Ù„Ø¯ÙŠÙ†ÙŠØ© ØªØªØ¹Ø²Ø²', 'Ø§Ù„Ø£Ø³Ù‚Ù ÙŠØ±Ø¶Ù‰ Ø¹Ù†Ùƒ'],
    down: ['Ø§Ù„ÙƒÙ†ÙŠØ³Ø© ØªÙ†Ø£Ù‰ Ø¹Ù†Ùƒ...', 'Ø§Ù„Ø´Ø±Ø¹ÙŠØ© Ø§Ù„Ø¯ÙŠÙ†ÙŠØ© ØªØªØ²Ø¹Ø²Ø¹', 'Ø±Ø¬Ø§Ù„ Ø§Ù„Ø¯ÙŠÙ† ÙŠØªØ³Ø§Ø¡Ù„ÙˆÙ†...']
  }
};

let toastTimer = null;

function showReaction(msg) {
  const toast = document.getElementById('reactionToast');
  toast.textContent = msg;
  toast.classList.add('show');
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toast.classList.remove('show'), 2000);
}

function apply(delta) {
  const reactions = [];
  ['people','army','nobles','church'].forEach(f => {
    if(delta[f] !== undefined && delta[f] !== 0) {
      const prev = G[f];
      G[f] = clamp(G[f] + delta[f]);
      const numEl = document.getElementById('num-'+f);
      numEl.classList.remove('flash-up','flash-down');
      void numEl.offsetWidth; // force reflow
      if(delta[f] > 0) {
        numEl.classList.add('flash-up');
        const msgs = REACTIONS[f]?.up;
        if(msgs) reactions.push(msgs[Math.floor(Math.random()*msgs.length)]);
      } else {
        numEl.classList.add('flash-down');
        const msgs = REACTIONS[f]?.down;
        if(msgs) reactions.push(msgs[Math.floor(Math.random()*msgs.length)]);
      }
    }
  });
  updateBars();
  // Show the most impactful reaction
  if(reactions.length > 0) {
    setTimeout(() => showReaction(reactions[0]), 400);
  }
}

function clamp(v) { return Math.max(0, Math.min(100, v)); }

function updateBars() {
  ['people','army','nobles','church'].forEach(f => {
    const v = G[f];
    const barEl = document.getElementById('bar-'+f);
    const numEl = document.getElementById('num-'+f);
    barEl.style.width = v + '%';
    numEl.textContent = v;
    numEl.style.color = v <= 20 ? '#e88888' : v >= 75 ? '#88e8a8' : '';
    // Critical glow on bar background
    const bgEl = barEl.parentElement;
    if(v <= 25) {
      bgEl.style.boxShadow = '0 0 6px rgba(201,76,76,0.4)';
      bgEl.style.borderRadius = '2px';
    } else {
      bgEl.style.boxShadow = '';
    }
  });
}

function go(sceneId) {
  G.turn++;
  showScene(SCENES[sceneId]);
}

function chronicle(icon, text) {
  G.choices.push({ icon, text });
}

function showScene(sc) {
  // Scroll to top
  document.getElementById('sceneContainer').scrollTo({top:0,behavior:'smooth'});

  // Visual
  document.getElementById('sceneEmoji').textContent = sc.emoji;
  document.getElementById('moodOverlay').style.background = sc.mood;

  // Chapter / title
  document.getElementById('chapterTag').textContent = sc.chapter;
  document.getElementById('sceneTitle').textContent = sc.title;
  document.getElementById('chapterIndicator').textContent = 'Ø§Ù„ÙØµÙ„ ' + arabNum(G.turn);

  // Body text
  const bodyText = typeof sc.text === 'function' ? sc.text() : sc.text;
  document.getElementById('sceneBody').innerHTML = bodyText;

  // Memory
  const memFn = sc.memory;
  let memVal = null;
  if (typeof memFn === 'function') memVal = memFn();
  else if (memFn) memVal = memFn;
  const memTag = document.getElementById('memoryTag');
  if(memVal) {
    memTag.style.display = 'inline-flex';
    document.getElementById('memoryText').textContent = memVal;
    // Re-trigger animation
    memTag.classList.remove('pop-anim');
    void memTag.offsetWidth;
    memTag.classList.add('pop-anim');
  } else {
    memTag.style.display = 'none';
  }

  // Choices
  const list = document.getElementById('choicesList');
  list.innerHTML = '';
  sc.choices.forEach(c => {
    const btn = document.createElement('button');
    btn.className = 'choice-btn';

    const pills = c.sub.map(s => `<span class="effect-pill effect-${s.type}">${s.label}</span>`).join('');

    btn.innerHTML = `
      <span class="choice-emoji">${c.emoji}</span>
      <div class="choice-content">
        <div class="choice-text">${c.text}</div>
        <div class="choice-effects">${pills}</div>
      </div>
    `;

    btn.onclick = () => {
      list.querySelectorAll('button').forEach(b => { b.disabled = true; b.style.opacity = '0.5'; });
      btn.style.opacity = '1';
      btn.style.borderColor = 'var(--gold)';
      setTimeout(c.fn, 300);
    };

    list.appendChild(btn);
  });
}

function transition(emoji, text, callback) {
  const overlay = document.getElementById('transOverlay');
  const content = document.getElementById('transContent');
  content.innerHTML = `<div style="font-size:48px;margin-bottom:12px">${emoji}</div><div>${text}</div>`;
  overlay.classList.add('show');
  setTimeout(() => {
    overlay.classList.remove('show');
    setTimeout(callback, 400);
  }, 1600);
}

function arabNum(n) {
  return ['','Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦','Ù§','Ù¨'][n] || n;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENDINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ENDINGS = [
  // â”€â”€ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø·ÙˆÙ‘Ù„Ø© â”€â”€
  {
    id: 'legend',
    condition: () => {
      const avg = (G.people + G.army + G.nobles + G.church) / 4;
      return avg >= 58 && G.people >= 55 && G.army >= 55;
    },
    icon: 'ğŸŒŸ',
    color: '#d4a843',
    title: 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ',
    rank: 'Ù…Ø±ØªØ¨Ø©: Ø£Ø¹Ø¸Ù… Ù…Ù„ÙˆÙƒ Ø£Ø±ÙŠÙ‡Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚',
    story: () => {
      const charter = G.tags.has('charter_issued') ? ' Ø£ØµØ¯Ø± Ø§Ù„Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø°ÙŠ Ø­Ù…Ù‰ Ø§Ù„Ø´Ø¹Ø¨ Ù„Ù‚Ø±ÙˆÙ†.' : '';
      const uni = G.tags.has('university_built') ? ' ÙˆØ¨Ù†Ù‰ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ØªÙŠ Ø£Ø¶Ø§Ø¡Øª Ø§Ù„Ø¹Ù‚ÙˆÙ„.' : '';
      return `Ø­ÙƒÙ… <strong>${G.name}</strong> Ø¨Ø­ÙƒÙ…Ø© Ù†Ø§Ø¯Ø±Ø©.${charter}${uni} Ø§Ù„Ø´Ø¹Ø¨ Ø£Ø­Ø¨Ù‘Ù‡ØŒ Ø§Ù„Ø¬ÙŠØ´ Ø£Ø·Ø§Ø¹Ù‡ØŒ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø­ÙØ± Ø§Ø³Ù…Ù‡ Ø¨Ø°Ù‡Ø¨. Ø­ÙŠÙ† Ù…Ø§ØªØŒ Ø¨ÙƒÙ‰ Ø§Ù„ØºÙ†ÙŠ ÙˆØ§Ù„ÙÙ‚ÙŠØ± Ù…Ø¹Ø§Ù‹.`;
    },
  },
  // â”€â”€ Ù…Ù„Ùƒ Ø§Ù„Ø±Ø­Ù…Ø© â”€â”€
  {
    id: 'people',
    condition: () => G.people >= 70 && G.army < 50,
    icon: 'ğŸ•Šï¸',
    color: '#4caf8c',
    title: 'Ù…Ø­Ø¨ÙˆØ¨ Ø§Ù„Ø´Ø¹Ø¨',
    rank: 'Ù…Ø±ØªØ¨Ø©: Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠ',
    story: () => `Ù„Ù… ÙŠÙƒÙ† <strong>${G.name}</strong> Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ù…Ù„ÙˆÙƒ ÙˆÙ„Ø§ Ø£ØºÙ†Ø§Ù‡Ù…ØŒ Ù„ÙƒÙ†Ù‡ ÙƒØ§Ù† Ø£ÙƒØ«Ø±Ù‡Ù… Ø±Ø­Ù…Ø©. Ø§Ø®ØªØ§Ø± Ø§Ù„Ø´Ø¹Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ©ØŒ ÙˆØ§Ù„Ø¹Ø¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙŠØ¨Ø©. Ø­ÙŠÙ† Ù…Ø§ØªØŒ Ø­Ù…Ù„ Ø§Ù„ÙÙ‚Ø±Ø§Ø¡ Ù†Ø¹Ø´Ù‡ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡.`,
  },
  // â”€â”€ Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ â”€â”€
  {
    id: 'warrior',
    condition: () => G.army >= 70 && G.tags.has('led_battle'),
    icon: 'âš”ï¸',
    color: '#c94c4c',
    title: 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ù…Ø­Ø§Ø±Ø¨',
    rank: 'Ù…Ø±ØªØ¨Ø©: Ù‚Ø§Ù‡Ø± Ø§Ù„Ø«Ù†Ø¯Ø§Ø±',
    story: () => {
      const empire = G.tags.has('empire_declared') ? ' Ø«Ù… Ø£Ø¹Ù„Ù† Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ÙˆÙ…Ø¯Ù‘ Ø§Ù„Ø±Ø§ÙŠØ© Ø¥Ù„Ù‰ Ù…Ø§ ÙˆØ±Ø§Ø¡ Ø§Ù„Ø¬Ø¨Ø§Ù„.' : '';
      return `Ø®Ø±Ø¬ <strong>${G.name}</strong> Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø¬ÙŠØ´Ù‡ ÙˆØ§Ù„Ø´Ø¹Ø¨ ÙŠÙ‡ØªÙ.${empire} Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ­ÙØ¸ Ø§Ù†ØªØµØ§Ø±Ø§ØªÙ‡ â€” ÙˆÙŠØªØ¬Ø§Ù‡Ù„ Ù…Ø§ Ø¯ÙÙ…Ù‘Ø± Ø®Ù„ÙÙ‡Ø§.`;
    },
  },
  // â”€â”€ Ù…Ù„Ùƒ Ø§Ù„ÙƒÙ†ÙŠØ³Ø© â”€â”€
  {
    id: 'church',
    condition: () => G.church >= 75 && G.people < 60,
    icon: 'â›ª',
    color: '#6c6caf',
    title: 'Ù…Ù„Ùƒ Ø§Ù„ØªØ§Ø¬ ÙˆØ§Ù„Ù…Ø°Ø¨Ø­',
    rank: 'Ù…Ø±ØªØ¨Ø©: Ø£Ø¯Ø§Ø© Ø§Ù„ÙƒÙ†ÙŠØ³Ø©',
    story: () => `Ø­ÙƒÙ… <strong>${G.name}</strong>ØŒ Ù„ÙƒÙ† Ø§Ù„Ø£Ø³Ù‚Ù ÙŠÙˆØ­Ù†Ø§ Ù‡Ùˆ Ù…Ù† Ø£Ø¯Ø§Ø± Ø§Ù„Ù…Ù…Ù„ÙƒØ© ÙØ¹Ù„ÙŠØ§Ù‹. Ø§Ù„ÙƒÙ†ÙŠØ³Ø© Ø§Ù†ØªØµØ±ØªØŒ ÙˆØ§Ù„Ù…Ù„Ùƒ Ø£ØµØ¨Ø­ ÙˆØ§Ø¬Ù‡ØªÙ‡Ø§. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØªØ°ÙƒØ±Ù‡ Ù…Ù„ÙƒØ§Ù‹ ØªÙ‚ÙŠØ§Ù‹... Ø¶Ø¹ÙŠÙØ§Ù‹.`,
  },
  // â”€â”€ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø® Ø§Ù„Ø®ÙÙŠ â”€â”€
  {
    id: 'brother_twist',
    condition: () => G.tags.has('adopted_brother') && G.people >= 60,
    icon: 'ğŸ‘‘',
    color: '#c9a843',
    title: 'Ù…Ù„ÙƒØ§Ù† ÙÙŠ Ù‚Ù„Ø¨ ÙˆØ§Ø­Ø¯',
    rank: 'Ù…Ø±ØªØ¨Ø©: Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø°ÙŠ Ø£Ù†Ù‡Ù‰ Ø§Ù„ÙƒØ±Ø§Ù‡ÙŠØ©',
    story: () => `Ù‚Ø±Ù‘Ø± <strong>${G.name}</strong> Ø£Ù† ÙŠØ¹ØªØ±Ù Ø¨Ø£Ø®ÙŠÙ‡ ØºÙŠØ± Ø§Ù„Ø´Ø±Ø¹ÙŠ â€” Ù„Ø§ Ù„Ø£Ù†Ù‡ Ù…ÙØ¬Ø¨Ø±ØŒ Ø¨Ù„ Ù„Ø£Ù†Ù‡ Ø¢Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø­Ù…Ø© Ø£Ù‚ÙˆÙ‰ Ù…Ù† Ø§Ù„Ø®ÙˆÙ. Ø§Ù„Ø£Ø® Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ø¯ÙˆØ§Ù‹ØŒ ØµØ§Ø± Ø¯Ø±Ø¹Ø§Ù‹. Ø£Ø±ÙŠÙ‡Ø§Ù† Ø­ÙƒÙ…Ù‡Ø§ Ù…Ù„ÙƒØ§Ù† Ø¨Ø±ÙˆØ­ ÙˆØ§Ø­Ø¯Ø©.`,
  },
  // â”€â”€ Ù†Ù‡Ø§ÙŠØ© Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø³Ø±ÙŠØ© â”€â”€
  {
    id: 'leyla_ending',
    condition: () => G.tags.has('leyla_trusted') && G.tags.has('forgave_solomon') && G.people >= 65,
    icon: 'ğŸŒ™',
    color: '#8c6caf',
    title: 'ÙÙŠ Ø¸Ù„ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©',
    rank: 'Ù…Ø±ØªØ¨Ø©: Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø°ÙŠ Ø¹Ø±Ù Ù…ØªÙ‰ ÙŠØ³ØªÙ…Ø¹',
    story: () => `ÙƒØ§Ù†Øª <strong>Ù„ÙŠÙ„Ù‰</strong> ØªØ¹Ø±Ù Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ Ù‚ØµØ© Ù‚Ø¨Ù„ Ø£Ù† ØªØ¨Ø¯Ø£. ÙˆÙƒØ§Ù† <strong>${G.name}</strong> ÙŠØ¹Ø±Ù Ù…ØªÙ‰ ÙŠØ³ØªÙ…Ø¹. Ù…Ø¹Ø§Ù‹ Ø£Ø¯Ø§Ø±ÙˆØ§ Ø£Ø±ÙŠÙ‡Ø§Ù† Ø¨Ù‡Ø¯ÙˆØ¡ Ù„Ù… ØªØ¹Ø±ÙÙ‡ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ù…Ù† Ù‚Ø¨Ù„. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙƒØªØ¨ Ø§Ø³Ù…ÙŠÙ‡Ù…Ø§ Ù…Ø¹Ø§Ù‹ â€” ÙˆÙ‡Ø°Ø§ Ù„Ù… ÙŠØ²Ø¹Ø¬ Ø£Ø­Ø¯Ù‡Ù…Ø§.`,
  },
  // â”€â”€ Ø§Ù„Ø³Ù‚ÙˆØ· â”€â”€
  {
    id: 'collapse',
    condition: () => G.people <= 25 || G.army <= 15,
    icon: 'ğŸ’€',
    color: '#8b1a1a',
    title: 'Ø³Ù‚ÙˆØ· Ø£Ø±ÙŠÙ‡Ø§Ù†',
    rank: 'Ù…Ø±ØªØ¨Ø©: Ø¢Ø®Ø± Ù…Ù„ÙˆÙƒ Ø£Ø±ÙŠÙ‡Ø§Ù†',
    story: () => {
      const betrayal = G.tags.has('public_trial') ? ' ÙØ¶ÙŠØ­Ø© Ø³Ù„ÙŠÙ…Ø§Ù† ÙƒØ§Ù†Øª Ø§Ù„Ø´Ø±Ø§Ø±Ø©.' : '';
      return `Ù„Ø§ ÙŠÙÙƒØªØ¨ Ø§Ø³Ù… <strong>${G.name}</strong> Ø¥Ù„Ø§ Ù…Ù‚Ø±ÙˆÙ†Ø§Ù‹ Ø¨ÙƒÙ„Ù…Ø©: Ø§Ù„ÙƒØ§Ø±Ø«Ø©.${betrayal} Ø§Ù„Ø´Ø¹Ø¨ Ø«Ø§Ø±ØŒ Ø§Ù„Ø¬ÙŠØ´ ØªÙÙƒÙƒØŒ ÙˆØ§Ù„Ù…Ù…Ù„ÙƒØ© ØªØ´Ù‚Ù‚Øª. Ø£Ø±ÙŠÙ‡Ø§Ù†... Ù„Ù… ØªØ¹Ø¯ Ø£Ø±ÙŠÙ‡Ø§Ù†.`;
    },
  },
  // â”€â”€ Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ù…Ù†Ø³ÙŠ â”€â”€
  {
    id: 'forgotten',
    condition: () => true,
    icon: 'ğŸ“œ',
    color: '#806040',
    title: 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ù…Ù†Ø³ÙŠ',
    rank: 'Ù…Ø±ØªØ¨Ø©: Ù…Ù„Ùƒ Ø¹Ø§Ø¯ÙŠ ÙÙŠ Ø²Ù…Ù† ØºÙŠØ± Ø¹Ø§Ø¯ÙŠ',
    story: () => `Ø­ÙƒÙ… <strong>${G.name}</strong> Ù„Ø³Ù†ÙˆØ§Øª. Ù„Ù… ÙŠÙØ¨Ø¯Ø¹ ÙˆÙ„Ù… ÙŠÙÙ‡Ù„Ùƒ. Ù‚Ø±Ø§Ø±Ø§Øª Ù…ØªØ°Ø¨Ø°Ø¨Ø©ØŒ Ù†Ø¬Ø§Ø­Ø§Øª Ù…ØªÙˆØ§Ø¶Ø¹Ø©. Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø±Ù‘ Ø¹Ù„ÙŠÙ‡ ÙƒÙ…Ø§ ÙŠÙ…Ø±Ù‘ Ø§Ù„Ø±ÙŠØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù…Ø§Ù„ â€” Ø¨Ù„Ø§ Ø£Ø«Ø± ÙŠÙØ°ÙƒØ±.`,
  },
];

function calcEnding() {
  const ending = ENDINGS.find(e => e.condition()) || ENDINGS[ENDINGS.length-1];
  showEnding(ending);
}

function showEnding(e) {
  document.getElementById('endingSeal').textContent = e.icon;
  document.getElementById('endingTitle').textContent = e.title;
  document.getElementById('endingTitle').style.color = e.color;
  document.getElementById('endingRank').textContent = e.rank;
  document.getElementById('endingStory').innerHTML = e.story();
  document.getElementById('endingGlow').style.setProperty('--ending-color', e.color);
  document.getElementById('endingGlow').style.background =
    `radial-gradient(ellipse 80% 70% at 50% 100%, ${e.color}55 0%, transparent 70%)`;

  // Faction standings
  const fs = document.getElementById('factionStandings');
  fs.innerHTML = `<div class="standings-title">âš–ï¸ Ù…ÙŠØ²Ø§Ù† Ø§Ù„ÙØµØ§Ø¦Ù„ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­ÙƒÙ…</div>`;
  [
    {icon:'ğŸ˜ï¸', name:'Ø§Ù„Ø´Ø¹Ø¨', val: G.people, color:'#4caf8c', cls:'f-people'},
    {icon:'ğŸ—¡ï¸', name:'Ø§Ù„Ø¬ÙŠØ´', val: G.army, color:'#c94c4c', cls:'f-army'},
    {icon:'ğŸ’', name:'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡', val: G.nobles, color:'#8c6caf', cls:'f-nobles'},
    {icon:'â›ª', name:'Ø§Ù„ÙƒÙ†ÙŠØ³Ø©', val: G.church, color:'#8c8ccf', cls:'f-church'},
  ].forEach(f => {
    const row = document.createElement('div');
    row.className = 'standing-row';
    row.innerHTML = `
      <span class="standing-icon">${f.icon}</span>
      <div class="standing-info">
        <div class="standing-name">${f.name}</div>
        <div class="standing-bar-wrap">
          <div class="standing-bar-fill" style="width:${f.val}%;background:${f.color}"></div>
        </div>
      </div>
      <div class="standing-val" style="color:${f.color}">${f.val}</div>
    `;
    fs.appendChild(row);
  });

  // Chronicle
  const ch = document.getElementById('chronicle');
  ch.innerHTML = '';
  G.choices.forEach((c, i) => {
    const entry = document.createElement('div');
    entry.className = 'chronicle-entry';
    entry.innerHTML = `<span class="chronicle-icon">${c.icon}</span><span>Ø§Ù„ÙØµÙ„ ${arabNum(i+1)}: ${c.text}</span>`;
    ch.appendChild(entry);
  });

  transition('ğŸ“œ', 'Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙƒÙØªØ¨Øª...', () => {
    showScreen('ending');
  });
}

function shareResult() {
  const endingTitle = document.getElementById('endingTitle').textContent;
  const text = `ğŸ‘‘ Ù„Ø¹Ø¨Øª Ø£Ø±ÙŠÙ‡Ø§Ù†!\nØ§Ù„Ù†ØªÙŠØ¬Ø©: "${endingTitle}"\n\nØ´Ø¹Ø¨: ${G.people} | Ø¬ÙŠØ´: ${G.army} | Ù†Ø¨Ù„Ø§Ø¡: ${G.nobles} | ÙƒÙ†ÙŠØ³Ø©: ${G.church}`;
  if(navigator.share) {
    navigator.share({ title: 'Ø£Ø±ÙŠÙ‡Ø§Ù†', text });
  } else {
    navigator.clipboard.writeText(text).then(() => showBanner('ğŸ“‹', 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©!'));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  const el = document.getElementById(id);
  el.classList.add('active');
  el.scrollTo({top:0});
}

function showBanner(icon, text) {
  const b = document.getElementById('conBanner');
  document.getElementById('conIcon').textContent = icon;
  document.getElementById('conText').textContent = text;
  b.classList.add('visible');
  setTimeout(() => b.classList.remove('visible'), 2500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPLASH SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('load', () => {
  setTimeout(() => {
    const splash = document.getElementById('splash');
    splash.classList.add('hidden');
    setTimeout(() => splash.remove(), 800);
  }, 2400);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// START / RESTART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame() {
  const name = document.getElementById('kingInput').value.trim() || 'Ø§Ù„Ø³Ù„Ø·Ø§Ù†';
  G = {
    name,
    people: 60, army: 60, nobles: 60, church: 60,
    choices: [],
    tags: new Set(),
    seenEvents: new Set(),
    turn: 1,
  };
  document.getElementById('kingTitleBar').textContent = 'Ø§Ù„Ù…Ù„Ùƒ ' + name;
  updateBars();
  showScreen('game');
  setTimeout(() => {
    showScene(SCENES['debt']);
  }, 100);
}

function restartGame() {
  showScreen('intro');
  document.getElementById('kingInput').value = '';
}
</script>
</body>
</html>
