<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ø£Ø±ÙŠÙ‡Ø§Ù† â€” Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…ØµÙŠØ±</title>
<meta name="description" content="Ø£Ø±ÙŠÙ‡Ø§Ù† â€” Ù„Ø¹Ø¨Ø© Ù‚Ø±Ø§Ø±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ©. Ø£Ù†Øª Ø§Ù„Ù…Ù„ÙƒØŒ ÙˆÙƒÙ„ Ù‚Ø±Ø§Ø± ÙŠØºÙŠØ± Ù…ØµÙŠØ± Ø§Ù„Ù…Ù…Ù„ÙƒØ©.">
<meta name="theme-color" content="#050403">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #d4a843;
  --gold2: #f0c96a;
  --gold3: #8b6914;
  --gold4: #ffe9a0;
  --dark: #050403;
  --dark2: #0d0b06;
  --dark3: #181208;
  --dark4: #221a0c;
  --parchment: #e8d5a3;
  --blood: #7a1515;
  --text: #ddc99a;
  --text2: #a08860;
  --text3: #6a5840;
  --accent-teal: #4caf8c;
  --accent-purple: #8c6caf;
  --accent-red: #c94c4c;
  --accent-blue: #6c8ccf;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

html, body {
  height: 100%;
  overflow: hidden;
  background: var(--dark);
}

body {
  font-family: 'Scheherazade New', serif;
  color: var(--text);
  height: 100vh;
  overflow: hidden;
  position: relative;
}

/* â•â• CANVAS â•â• */
#bgCanvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* â•â• NOISE OVERLAY â•â• */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  opacity: 0.03;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  background-size: 128px 128px;
}

/* â•â• APP SHELL â•â• */
#app {
  position: relative;
  z-index: 2;
  height: 100vh;
  display: flex;
  flex-direction: column;
  max-width: 500px;
  margin: 0 auto;
}

/* â•â• SCREENS â•â• */
.screen {
  display: none;
  flex-direction: column;
  height: 100%;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
.screen.active { display: flex; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPLASH SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#splash {
  position: fixed;
  inset: 0;
  z-index: 999;
  background: var(--dark);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 32px;
  transition: opacity 0.8s ease, transform 0.8s ease;
}
#splash.hidden {
  opacity: 0;
  transform: scale(1.06);
  pointer-events: none;
}

.splash-crown {
  position: relative;
  width: 110px;
  height: 110px;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: splashIn 1s ease both;
}

.splash-ring {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  border: 1px solid rgba(212,168,67,0.2);
  animation: ringExpand 3s ease-in-out infinite;
}
.splash-ring:nth-child(2) { inset: -12px; animation-delay: 0.5s; border-color: rgba(212,168,67,0.12); }
.splash-ring:nth-child(3) { inset: -24px; animation-delay: 1s; border-color: rgba(212,168,67,0.07); }

@keyframes ringExpand {
  0%,100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.04); opacity: 0.5; }
}

.splash-icon {
  font-size: 52px;
  position: relative;
  z-index: 2;
  filter: drop-shadow(0 0 24px rgba(212,168,67,0.9));
  animation: crownFloat 4s ease-in-out infinite;
}

@keyframes crownFloat {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

@keyframes splashIn {
  from { opacity: 0; transform: translateY(30px) scale(0.9); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.splash-text {
  text-align: center;
  animation: splashIn 1s ease 0.3s both;
}

.splash-title {
  font-family: 'Amiri', serif;
  font-size: 58px;
  font-weight: 700;
  letter-spacing: 8px;
  background: linear-gradient(180deg, var(--gold4) 0%, var(--gold) 45%, var(--gold3) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1;
}

.splash-sub {
  font-size: 11px;
  letter-spacing: 6px;
  color: var(--text3);
  margin-top: 8px;
}

.splash-bar {
  width: 160px;
  height: 1px;
  background: rgba(212,168,67,0.08);
  border-radius: 1px;
  overflow: hidden;
  animation: splashIn 0.5s ease 0.5s both;
}
.splash-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, transparent, var(--gold2), transparent);
  animation: barLoad 2s ease 0.6s both;
  transform-origin: left;
}
@keyframes barLoad {
  from { transform: scaleX(0); }
  to { transform: scaleX(1); }
}

.splash-hint {
  font-size: 11px;
  color: var(--text3);
  letter-spacing: 3px;
  opacity: 0;
  animation: splashIn 0.5s ease 1.8s both;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTRO SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#intro {
  background: var(--dark);
  align-items: stretch;
  overflow-y: auto;
}

.intro-hero {
  position: relative;
  height: 50vh;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  overflow: hidden;
  flex-shrink: 0;
}

.intro-hero-bg {
  position: absolute;
  inset: 0;
  background:
    radial-gradient(ellipse 90% 70% at 50% 90%, rgba(212,168,67,0.18) 0%, transparent 65%),
    radial-gradient(ellipse 50% 40% at 50% 60%, rgba(139,105,20,0.12) 0%, transparent 50%),
    linear-gradient(180deg, var(--dark) 0%, var(--dark2) 100%);
}

/* Decorative geometric lines */
.intro-hero-lines {
  position: absolute;
  inset: 0;
  overflow: hidden;
  opacity: 0.15;
}
.intro-hero-lines::before,
.intro-hero-lines::after {
  content: '';
  position: absolute;
  border: 1px solid var(--gold3);
}
.intro-hero-lines::before {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -40%);
}
.intro-hero-lines::after {
  width: 140px;
  height: 140px;
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -40%);
}

.castle-emoji {
  font-size: 96px;
  position: relative;
  z-index: 2;
  filter: drop-shadow(0 0 50px rgba(212,168,67,0.6));
  animation: castleGlow 5s ease-in-out infinite;
}

@keyframes castleGlow {
  0%,100% { filter: drop-shadow(0 0 30px rgba(212,168,67,0.4)) drop-shadow(0 0 60px rgba(212,168,67,0.2)); transform: scale(1); }
  50% { filter: drop-shadow(0 0 60px rgba(212,168,67,0.7)) drop-shadow(0 0 100px rgba(212,168,67,0.35)); transform: scale(1.04); }
}

.intro-hero::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0; right: 0;
  height: 120px;
  background: linear-gradient(transparent, var(--dark));
  z-index: 3;
}

.intro-body {
  padding: 0 22px 40px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  align-items: center;
}

.intro-logo {
  text-align: center;
}
.intro-logo-ar {
  font-family: 'Amiri', serif;
  font-size: 48px;
  font-weight: 700;
  letter-spacing: 6px;
  background: linear-gradient(180deg, var(--gold4) 0%, var(--gold) 50%, var(--gold3) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.intro-logo-en {
  font-size: 10px;
  letter-spacing: 6px;
  color: var(--text3);
  margin-top: 4px;
}

/* Ornamental divider */
.ornament {
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
}
.ornament-line {
  flex: 1;
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(212,168,67,0.3));
}
.ornament-line:first-child { background: linear-gradient(270deg, transparent, rgba(212,168,67,0.3)); }
.ornament-gem {
  color: var(--gold3);
  font-size: 10px;
}

.intro-lore {
  font-family: 'Amiri', serif;
  font-size: 17px;
  line-height: 2.2;
  color: var(--text2);
  text-align: center;
  font-style: italic;
}
.intro-lore em {
  color: var(--gold2);
  font-style: normal;
  font-weight: 700;
}

/* Personality selector */
.personality-section {
  width: 100%;
}
.section-label {
  font-family: 'Amiri', serif;
  font-size: 14px;
  color: var(--gold);
  text-align: center;
  margin-bottom: 10px;
  letter-spacing: 2px;
}
.personality-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 8px;
}
.pers-card {
  background: rgba(212,168,67,0.05);
  border: 1px solid rgba(212,168,67,0.15);
  border-radius: 14px;
  padding: 12px 8px;
  cursor: pointer;
  text-align: center;
  transition: all 0.25s ease;
  user-select: none;
}
.pers-card:active { transform: scale(0.95); }
.pers-card.selected {
  background: rgba(212,168,67,0.12);
  border-color: var(--gold);
  box-shadow: 0 0 16px rgba(212,168,67,0.15);
}
.pers-icon { font-size: 28px; display: block; margin-bottom: 6px; }
.pers-name { font-size: 12px; color: var(--gold2); font-weight: 700; }
.pers-bonus { font-size: 9px; color: var(--text3); margin-top: 2px; }

/* Faction cards */
.factions-preview {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  width: 100%;
}
.faction-card {
  background: rgba(212,168,67,0.04);
  border: 1px solid rgba(212,168,67,0.12);
  border-radius: 12px;
  padding: 10px 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.faction-card-icon { font-size: 20px; }
.faction-card-info { flex: 1; }
.faction-card-name { font-size: 12px; color: var(--gold2); font-weight: 700; }
.faction-card-desc { font-size: 10px; color: var(--text3); margin-top: 1px; }

.gender-section {
  width: 100%;
}
.gender-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.gender-card {
  background: rgba(212,168,67,0.05);
  border: 1px solid rgba(212,168,67,0.15);
  border-radius: 14px;
  padding: 14px 8px;
  cursor: pointer;
  text-align: center;
  transition: all 0.25s ease;
  user-select: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}
.gender-card:active { transform: scale(0.95); }
.gender-card.selected {
  background: rgba(212,168,67,0.12);
  border-color: var(--gold);
  box-shadow: 0 0 16px rgba(212,168,67,0.15);
}
.gender-icon { font-size: 28px; }
.gender-name { font-size: 14px; color: var(--gold2); font-family: 'Amiri', serif; font-weight: 700; }


.name-label {
  font-family: 'Amiri', serif;
  font-size: 14px;
  color: var(--gold);
  text-align: center;
  margin-bottom: 8px;
}
.name-input {
  width: 100%;
  background: rgba(212,168,67,0.05);
  border: 1px solid rgba(212,168,67,0.25);
  border-radius: 14px;
  padding: 15px 20px;
  color: var(--gold2);
  font-family: 'Amiri', serif;
  font-size: 20px;
  text-align: center;
  outline: none;
  transition: all 0.3s;
  user-select: text;
}
.name-input:focus {
  border-color: var(--gold);
  box-shadow: 0 0 24px rgba(212,168,67,0.08), inset 0 0 12px rgba(212,168,67,0.03);
}
.name-input::placeholder { color: rgba(212,168,67,0.25); }

.start-btn {
  width: 100%;
  background: linear-gradient(135deg, #c9a843 0%, #a07830 50%, #8b6914 100%);
  border: none;
  border-radius: 16px;
  padding: 18px;
  color: #1a0f02;
  font-family: 'Amiri', serif;
  font-size: 22px;
  font-weight: 700;
  cursor: pointer;
  letter-spacing: 2px;
  box-shadow:
    0 6px 32px rgba(212,168,67,0.3),
    0 2px 0 rgba(255,255,255,0.08) inset,
    0 -2px 0 rgba(0,0,0,0.3) inset;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.start-btn::after {
  content: '';
  position: absolute;
  top: 0; left: -100%;
  width: 100%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
  animation: btnShimmer 3s ease infinite;
}
@keyframes btnShimmer {
  0% { left: -100%; }
  50%,100% { left: 100%; }
}
.start-btn:active {
  transform: scale(0.97) translateY(1px);
  box-shadow: 0 3px 16px rgba(212,168,67,0.2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#game { background: transparent; }

/* Stats bar */
.stats-bar {
  flex-shrink: 0;
  background: rgba(5,4,3,0.92);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-bottom: 1px solid rgba(212,168,67,0.12);
  padding: 9px 14px 10px;
  position: relative;
  z-index: 10;
}

.stats-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 9px;
}

.king-title {
  font-family: 'Amiri', serif;
  color: var(--gold);
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.personality-badge {
  font-size: 9px;
  background: rgba(212,168,67,0.1);
  border: 1px solid rgba(212,168,67,0.2);
  border-radius: 10px;
  padding: 1px 7px;
  color: var(--gold3);
  letter-spacing: 1px;
}

.chapter-indicator {
  font-size: 10px;
  color: var(--text3);
  background: rgba(212,168,67,0.06);
  border: 1px solid rgba(212,168,67,0.12);
  border-radius: 20px;
  padding: 3px 10px;
  letter-spacing: 1px;
}

.factions-bar {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  gap: 8px;
}

.faction-stat { display: flex; flex-direction: column; gap: 3px; }

.faction-stat-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.faction-stat-name { font-size: 9px; color: var(--text3); }
.faction-stat-num {
  font-size: 10px;
  font-weight: 700;
  transition: color 0.4s;
}

.faction-bar-bg {
  height: 3px;
  background: rgba(255,255,255,0.05);
  border-radius: 2px;
  overflow: hidden;
}
.faction-bar-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 0.7s cubic-bezier(0.4,0,0.2,1);
}

.f-people .faction-bar-fill { background: linear-gradient(90deg, #1a6a4a, #4caf8c); }
.f-army  .faction-bar-fill { background: linear-gradient(90deg, #7a1515, #c94c4c); }
.f-nobles .faction-bar-fill { background: linear-gradient(90deg, #4a2a7a, #8c6caf); }
.f-church .faction-bar-fill { background: linear-gradient(90deg, #2a2a5a, #6c8ccf); }

.f-people .faction-stat-num { color: #4caf8c; }
.f-army .faction-stat-num { color: #c94c4c; }
.f-nobles .faction-stat-num { color: #8c6caf; }
.f-church .faction-stat-num { color: #6c8ccf; }

/* â•â• SCENE â•â• */
.scene-container {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  display: flex;
  flex-direction: column;
  scroll-behavior: smooth;
}

.scene-visual {
  width: 100%;
  height: 200px;
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.scene-bg-gradient {
  position: absolute;
  inset: 0;
  transition: background 1s ease;
}

/* Animated particles in scene */
.scene-particles {
  position: absolute;
  inset: 0;
  overflow: hidden;
  z-index: 1;
}
.scene-particle {
  position: absolute;
  width: 2px;
  height: 2px;
  border-radius: 50%;
  background: rgba(212,168,67,0.5);
  animation: particleRise var(--dur) ease-in infinite;
  animation-delay: var(--delay);
}
@keyframes particleRise {
  0% { transform: translate(0, 0) scale(1); opacity: 0.8; }
  100% { transform: translate(var(--dx), -120px) scale(0); opacity: 0; }
}

.scene-emoji {
  font-size: 80px;
  position: relative;
  z-index: 3;
  animation: emojiFloat 5s ease-in-out infinite;
  filter: drop-shadow(0 0 30px var(--scene-color, rgba(212,168,67,0.5)));
  transition: filter 0.6s ease;
}
@keyframes emojiFloat {
  0%,100% { transform: translateY(0) scale(1) rotate(0deg); }
  33% { transform: translateY(-10px) scale(1.02) rotate(-1deg); }
  66% { transform: translateY(-5px) scale(1.01) rotate(1deg); }
}

.scene-visual::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 120px;
  background: linear-gradient(transparent, var(--dark2));
  z-index: 4;
  pointer-events: none;
}

.scene-text-area {
  padding: 16px 20px 0;
  flex: 1;
}

/* Animated memory tag */
.memory-tag {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(212,168,67,0.08);
  border: 1px solid rgba(212,168,67,0.2);
  border-radius: 8px;
  padding: 4px 12px;
  font-size: 11px;
  color: var(--gold2);
  margin-bottom: 10px;
  max-width: 100%;
  animation: tagPop 0.4s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes tagPop {
  from { opacity:0; transform: scale(0.85) translateY(6px); }
  to { opacity:1; transform: scale(1) translateY(0); }
}

.chapter-tag {
  font-size: 9px;
  letter-spacing: 4px;
  color: var(--gold3);
  text-transform: uppercase;
  margin-bottom: 6px;
}

.scene-title {
  font-family: 'Amiri', serif;
  font-size: 30px;
  font-weight: 700;
  color: var(--gold2);
  line-height: 1.3;
  margin-bottom: 14px;
  animation: titleReveal 0.5s ease both;
}
@keyframes titleReveal {
  from { opacity:0; transform: translateY(10px); }
  to { opacity:1; transform: translateY(0); }
}

.scene-body {
  font-family: 'Amiri', serif;
  font-size: 17px;
  line-height: 2.2;
  color: var(--text);
  animation: bodyReveal 0.6s ease 0.1s both;
}
@keyframes bodyReveal {
  from { opacity:0; }
  to { opacity:1; }
}

.scene-body .char-name { color: var(--gold2); font-weight: 700; }
.scene-body .dramatic { color: #e88888; font-weight: 700; }
.scene-body .good-word { color: #88e8a8; }
.scene-body .whisper {
  color: var(--text2);
  font-style: italic;
  font-size: 15px;
  display: block;
  margin: 4px 0;
  padding: 8px 14px;
  border-right: 2px solid rgba(212,168,67,0.2);
  background: rgba(212,168,67,0.03);
  border-radius: 0 8px 8px 0;
}

/* Choices */
.choices-section {
  padding: 16px 14px 28px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex-shrink: 0;
}

.choices-header {
  font-size: 10px;
  letter-spacing: 3px;
  color: var(--text3);
  margin-bottom: 4px;
  text-align: center;
}

.choice-btn {
  background: rgba(212,168,67,0.04);
  border: 1px solid rgba(212,168,67,0.16);
  border-radius: 16px;
  padding: 14px 15px;
  width: 100%;
  text-align: right;
  cursor: pointer;
  transition: all 0.25s ease;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  position: relative;
  overflow: hidden;
  animation: choiceSlide 0.4s ease both;
}
.choice-btn:nth-child(1) { animation-delay: 0.05s; }
.choice-btn:nth-child(2) { animation-delay: 0.12s; }
.choice-btn:nth-child(3) { animation-delay: 0.19s; }

@keyframes choiceSlide {
  from { opacity:0; transform: translateX(20px); }
  to { opacity:1; transform: translateX(0); }
}

.choice-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(212,168,67,0.08), transparent 60%);
  opacity: 0;
  transition: opacity 0.25s;
}
.choice-btn:hover { border-color: rgba(212,168,67,0.35); background: rgba(212,168,67,0.07); }
.choice-btn:hover::before { opacity: 1; }
.choice-btn:active { transform: scale(0.975); }
.choice-btn.chosen {
  border-color: var(--gold);
  background: rgba(212,168,67,0.1);
  box-shadow: 0 0 20px rgba(212,168,67,0.1);
}

.choice-emoji {
  font-size: 26px;
  flex-shrink: 0;
  margin-top: 2px;
}
.choice-content { flex: 1; }
.choice-text {
  font-family: 'Scheherazade New', serif;
  font-size: 15px;
  color: var(--parchment);
  line-height: 1.65;
}
.choice-effects {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 7px;
}
.effect-pill {
  font-size: 9px;
  padding: 2px 8px;
  border-radius: 20px;
  font-weight: 700;
  letter-spacing: 0.5px;
}
.effect-up { background: rgba(76,175,140,0.12); color: #4caf8c; border: 1px solid rgba(76,175,140,0.25); }
.effect-down { background: rgba(201,76,76,0.12); color: #e88888; border: 1px solid rgba(201,76,76,0.25); }
.effect-neutral { background: rgba(212,168,67,0.08); color: var(--gold2); border: 1px solid rgba(212,168,67,0.2); }

/* â•â• MAP OVERLAY â•â• */
.map-overlay {
  position: fixed;
  inset: 0;
  z-index: 80;
  background: rgba(5,4,3,0.96);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}
.map-overlay.show { opacity: 1; pointer-events: all; }

.map-title {
  font-family: 'Amiri', serif;
  font-size: 22px;
  color: var(--gold);
  margin-bottom: 20px;
  letter-spacing: 3px;
}

.map-svg {
  width: 100%;
  max-width: 400px;
  max-height: 320px;
}

.map-close {
  margin-top: 20px;
  background: transparent;
  border: 1px solid rgba(212,168,67,0.3);
  border-radius: 12px;
  padding: 10px 24px;
  color: var(--gold2);
  font-family: 'Amiri', serif;
  font-size: 15px;
  cursor: pointer;
}

/* Map button in stats bar */
.map-btn {
  background: rgba(212,168,67,0.08);
  border: 1px solid rgba(212,168,67,0.2);
  border-radius: 8px;
  padding: 4px 10px;
  color: var(--text2);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}
.map-btn:active { background: rgba(212,168,67,0.15); }

/* â•â• TRANSITION OVERLAY â•â• */
.transition-overlay {
  position: fixed;
  inset: 0;
  background: var(--dark);
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}
.transition-overlay.show { opacity: 1; pointer-events: all; }
.transition-content {
  text-align: center;
  font-family: 'Amiri', serif;
  color: var(--gold);
  opacity: 0;
  transform: scale(0.88);
  transition: all 0.35s ease 0.1s;
}
.transition-overlay.show .transition-content { opacity: 1; transform: scale(1); }
.trans-emoji { font-size: 56px; margin-bottom: 14px; display: block; }
.trans-text { font-size: 22px; line-height: 1.5; }

/* â•â• RANDOM EVENT MODAL â•â• */
.event-modal {
  position: fixed;
  inset: 0;
  z-index: 200;
  background: rgba(5,4,3,0.97);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
  animation: fadeIn 0.35s ease;
}
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

.event-inner {
  max-width: 440px;
  width: 100%;
  text-align: center;
}
.event-emoji {
  font-size: 60px;
  display: block;
  margin-bottom: 14px;
  filter: drop-shadow(0 0 24px rgba(212,168,67,0.6));
  animation: emojiFloat 4s ease-in-out infinite;
}
.event-tag {
  font-size: 9px;
  letter-spacing: 5px;
  color: var(--gold3);
  margin-bottom: 8px;
}
.event-title {
  font-family: 'Amiri', serif;
  font-size: 26px;
  font-weight: 700;
  color: var(--gold2);
  margin-bottom: 14px;
}
.event-text {
  font-family: 'Amiri', serif;
  font-size: 16px;
  line-height: 2.1;
  color: var(--text);
  margin-bottom: 24px;
}
.event-choices {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.event-choice-btn {
  background: rgba(212,168,67,0.06);
  border: 1px solid rgba(212,168,67,0.2);
  border-radius: 14px;
  padding: 14px 16px;
  width: 100%;
  cursor: pointer;
  color: var(--parchment);
  font-family: 'Scheherazade New', serif;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
  text-align: right;
  transition: all 0.2s;
}
.event-choice-btn:active { background: rgba(212,168,67,0.12); border-color: var(--gold); }

/* â•â• REACTION TOAST â•â• */
.reaction-toast {
  position: fixed;
  bottom: 55px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: rgba(8,6,4,0.97);
  border: 1px solid rgba(212,168,67,0.3);
  border-radius: 14px;
  padding: 10px 22px;
  font-family: 'Amiri', serif;
  font-size: 14px;
  color: var(--gold2);
  z-index: 60;
  opacity: 0;
  transition: all 0.35s cubic-bezier(0.34,1.56,0.64,1);
  pointer-events: none;
  white-space: nowrap;
  max-width: 88vw;
  text-align: center;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 16px rgba(0,0,0,0.4);
}
.reaction-toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* â•â• CONSEQUENCE BANNER â•â• */
.consequence-banner {
  position: fixed;
  top: 0;
  left: 50%;
  width: min(92%, 460px);
  background: rgba(5,4,3,0.97);
  border: 1px solid rgba(212,168,67,0.3);
  border-top: none;
  border-radius: 0 0 16px 16px;
  padding: 12px 20px;
  z-index: 50;
  text-align: center;
  font-family: 'Amiri', serif;
  font-size: 15px;
  color: var(--gold2);
  line-height: 1.7;
  transform: translateX(-50%) translateY(-100%);
  transition: transform 0.4s cubic-bezier(0.4,0,0.2,1);
  backdrop-filter: blur(12px);
}
.consequence-banner.visible { transform: translateX(-50%) translateY(0); }
.con-icon { font-size: 22px; display: block; margin-bottom: 4px; }

/* â•â• STAT FLASH â•â• */
@keyframes statFlashUp {
  0% { transform: scale(1); }
  30% { transform: scale(1.5); }
  60% { transform: scale(1.2); color: #88e8a8; text-shadow: 0 0 8px #4caf8c; }
  100% { transform: scale(1); }
}
@keyframes statFlashDown {
  0% { transform: scale(1); }
  30% { transform: scale(1.5); }
  60% { transform: scale(1.2); color: #e88888; text-shadow: 0 0 8px #c94c4c; }
  100% { transform: scale(1); }
}
.flash-up { animation: statFlashUp 0.6s ease; }
.flash-down { animation: statFlashDown 0.6s ease; }

/* â•â• CRITICAL WARNING â•â• */
@keyframes critPulse {
  0%,100% { box-shadow: 0 0 0 0 rgba(201,76,76,0); }
  50% { box-shadow: 0 0 0 4px rgba(201,76,76,0.25); }
}
.critical-stat { animation: critPulse 1.5s ease infinite; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ENDING SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#ending {
  align-items: center;
  overflow-y: auto;
}

.ending-header {
  width: 100%;
  min-height: 300px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  padding: 50px 24px 36px;
  overflow: hidden;
}

.ending-glow {
  position: absolute;
  inset: 0;
  opacity: 0.4;
}

/* Stars animation on ending */
.ending-stars {
  position: absolute;
  inset: 0;
  overflow: hidden;
}
.ending-star {
  position: absolute;
  width: 2px;
  height: 2px;
  background: var(--gold2);
  border-radius: 50%;
  animation: starTwinkle var(--d) ease-in-out infinite;
  animation-delay: var(--dl);
}
@keyframes starTwinkle {
  0%,100% { opacity: 0.3; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.5); }
}

.ending-seal {
  font-size: 100px;
  position: relative;
  z-index: 2;
  animation: sealReveal 1s cubic-bezier(0.34,1.56,0.64,1) both;
  filter: drop-shadow(0 0 40px var(--e-color, rgba(212,168,67,0.5)));
}
@keyframes sealReveal {
  from { opacity:0; transform: scale(0.5) rotate(-10deg); }
  to { opacity:1; transform: scale(1) rotate(0deg); }
}

.ending-title {
  font-family: 'Amiri', serif;
  font-size: 36px;
  font-weight: 700;
  text-align: center;
  position: relative;
  z-index: 2;
  margin-top: 14px;
  line-height: 1.3;
  animation: titleReveal 0.6s ease 0.3s both;
}
.ending-rank {
  font-size: 10px;
  letter-spacing: 4px;
  color: var(--text3);
  position: relative;
  z-index: 2;
  margin-top: 6px;
  animation: titleReveal 0.6s ease 0.5s both;
}

.ending-body {
  padding: 0 20px 50px;
  display: flex;
  flex-direction: column;
  gap: 22px;
  width: 100%;
}

.ending-story {
  font-family: 'Amiri', serif;
  font-size: 18px;
  line-height: 2.3;
  color: var(--text2);
  text-align: center;
  font-style: italic;
}
.ending-story strong { color: var(--gold2); font-style: normal; }

/* Faction standings */
.faction-standings {
  background: rgba(212,168,67,0.04);
  border: 1px solid rgba(212,168,67,0.12);
  border-radius: 18px;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}
.standings-title {
  font-family: 'Amiri', serif;
  font-size: 15px;
  color: var(--gold);
  text-align: center;
  margin-bottom: 4px;
}
.standing-row { display: flex; align-items: center; gap: 12px; }
.standing-icon { font-size: 20px; flex-shrink: 0; }
.standing-info { flex: 1; }
.standing-name { font-size: 11px; color: var(--text3); }
.standing-bar-wrap {
  height: 5px;
  background: rgba(255,255,255,0.04);
  border-radius: 3px;
  margin-top: 5px;
  overflow: hidden;
}
.standing-bar-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 1s ease 0.5s;
}
.standing-val {
  font-size: 14px;
  font-weight: 700;
  min-width: 34px;
  text-align: left;
}

/* Chronicle */
.chronicle-box {
  background: rgba(0,0,0,0.25);
  border: 1px solid rgba(212,168,67,0.1);
  border-radius: 18px;
  padding: 20px;
}
.chronicle-title {
  font-family: 'Amiri', serif;
  font-size: 15px;
  color: var(--gold);
  margin-bottom: 14px;
  text-align: center;
}
.chronicle-entry {
  display: flex;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  font-size: 13px;
  color: var(--text2);
  animation: entrySlide 0.4s ease both;
}
@keyframes entrySlide {
  from { opacity:0; transform: translateX(10px); }
  to { opacity:1; transform: translateX(0); }
}
.chronicle-entry:last-child { border-bottom: none; }
.chronicle-icon { font-size: 14px; flex-shrink: 0; margin-top: 1px; }

/* Personality summary */
.personality-summary {
  background: rgba(212,168,67,0.04);
  border: 1px solid rgba(212,168,67,0.12);
  border-radius: 18px;
  padding: 18px 20px;
  text-align: center;
}
.pers-sum-title {
  font-family: 'Amiri', serif;
  font-size: 14px;
  color: var(--gold);
  margin-bottom: 10px;
}
.pers-sum-icon { font-size: 36px; display: block; margin-bottom: 6px; }
.pers-sum-name { font-family: 'Amiri', serif; font-size: 18px; color: var(--gold2); }
.pers-sum-desc { font-size: 13px; color: var(--text3); margin-top: 6px; line-height: 1.7; }

/* Score display */
.score-display {
  background: linear-gradient(135deg, rgba(212,168,67,0.08), rgba(139,105,20,0.05));
  border: 1px solid rgba(212,168,67,0.2);
  border-radius: 18px;
  padding: 18px 20px;
  text-align: center;
}
.score-label { font-size: 10px; letter-spacing: 4px; color: var(--text3); margin-bottom: 8px; }
.score-value {
  font-family: 'Amiri', serif;
  font-size: 52px;
  font-weight: 700;
  background: linear-gradient(180deg, var(--gold4), var(--gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.score-rank { font-size: 12px; color: var(--text2); margin-top: 4px; }

.replay-section {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.btn-gold {
  width: 100%;
  background: linear-gradient(135deg, #c9a843 0%, #a07830 50%, #8b6914 100%);
  border: none;
  border-radius: 16px;
  padding: 17px;
  color: #1a0f02;
  font-family: 'Amiri', serif;
  font-size: 20px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 4px 24px rgba(212,168,67,0.25);
}
.btn-gold:active { transform: scale(0.97); }

.btn-outline {
  width: 100%;
  background: transparent;
  border: 1px solid rgba(212,168,67,0.25);
  border-radius: 16px;
  padding: 14px;
  color: var(--gold2);
  font-family: 'Amiri', serif;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s;
}
.btn-outline:active { background: rgba(212,168,67,0.06); }

/* â•â• SAVE INDICATOR â•â• */
.save-indicator {
  position: fixed;
  top: 16px;
  right: 16px;
  transform: translateY(-40px);
  background: rgba(76,175,140,0.10);
  border: 1px solid rgba(76,175,140,0.25);
  border-radius: 20px;
  padding: 4px 12px;
  font-size: 10px;
  color: #4caf8c;
  z-index: 40;
  opacity: 0;
  transition: all 0.4s ease;
  letter-spacing: 1px;
}
.save-indicator.show {
  opacity: 1;
  transform: translateY(0);
}

/* â•â• ACHIEVEMENT POPUP â•â• */
.achievement-popup {
  position: fixed;
  bottom: 110px;
  left: 50%;
  transform: translateX(-50%) translateY(30px);
  background: rgba(5,4,3,0.97);
  border: 1px solid rgba(212,168,67,0.5);
  border-radius: 16px;
  padding: 14px 24px;
  z-index: 70;
  text-align: center;
  opacity: 0;
  pointer-events: none;
  transition: all 0.5s cubic-bezier(0.34,1.56,0.64,1);
  min-width: 240px;
  backdrop-filter: blur(12px);
  box-shadow: 0 4px 24px rgba(212,168,67,0.12);
}
.achievement-popup.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}
.ach-icon { font-size: 24px; display: block; margin-bottom: 4px; }
.ach-title { font-size: 10px; letter-spacing: 3px; color: var(--gold3); }
.ach-name { font-family: 'Amiri', serif; font-size: 16px; color: var(--gold2); margin-top: 2px; }

/* â•â• SCROLLBAR â•â• */
::-webkit-scrollbar { width: 2px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(212,168,67,0.15); border-radius: 2px; }

/* â•â• MOBILE TWEAKS â•â• */
@media (max-width: 360px) {
  .choice-text { font-size: 13px; }
  .choice-btn { padding: 11px 12px; }
  .choice-emoji { font-size: 22px; }
  .scene-emoji { font-size: 64px; }
  .ending-title { font-size: 30px; }
}
/* â•â• YEAR DISPLAY â•â• */
.year-display {
  font-size: 9px;
  color: var(--text3);
  letter-spacing: 1px;
  transition: all 0.4s ease;
}
.year-display.milestone {
  color: var(--gold2);
  animation: yearPulse 0.6s ease;
}
@keyframes yearPulse {
  0%,100% { transform: scale(1); }
  50% { transform: scale(1.1); color: var(--gold4); }
}

/* â•â• MOOD TRANSITION on body â•â• */
body {
  transition: background 1.5s ease;
}
body.mood-danger { background: #06020200; }
body.mood-peaceful { background: #030508; }

/* â•â• SCENE MOOD OVERLAY â•â• */
.scene-bg-gradient {
  transition: background 1.2s ease !important;
}

/* â•â• NEWSPAPER POPUP â•â• */
.newspaper-overlay {
  position: fixed;
  inset: 0;
  z-index: 150;
  background: rgba(5,4,3,0.92);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  animation: fadeIn 0.3s ease;
}
.newspaper-inner {
  max-width: 420px;
  width: 100%;
  background: #f5e8c8;
  border-radius: 4px;
  padding: 0;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.8);
  animation: paperDrop 0.5s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes paperDrop {
  from { opacity:0; transform: translateY(-30px) rotate(-2deg) scale(0.95); }
  to { opacity:1; transform: translateY(0) rotate(0deg) scale(1); }
}
.newspaper-masthead {
  background: #1a0f02;
  color: #c9a843;
  text-align: center;
  padding: 10px 16px;
  font-family: 'Amiri', serif;
  border-bottom: 3px double #c9a843;
}
.newspaper-name {
  font-size: 22px;
  font-weight: 700;
  letter-spacing: 4px;
}
.newspaper-date {
  font-size: 9px;
  letter-spacing: 2px;
  color: #8b6914;
  margin-top: 2px;
}
.newspaper-body {
  padding: 16px 18px 20px;
  color: #1a0f02;
}
.newspaper-headline {
  font-family: 'Amiri', serif;
  font-size: 20px;
  font-weight: 700;
  line-height: 1.4;
  border-bottom: 1px solid #8b6914;
  padding-bottom: 10px;
  margin-bottom: 10px;
  color: #1a0f02;
}
.newspaper-sub {
  font-family: 'Amiri', serif;
  font-size: 13px;
  line-height: 1.9;
  color: #3a2a10;
  font-style: italic;
}
.newspaper-byline {
  font-size: 10px;
  color: #8b6914;
  margin-top: 10px;
  text-align: left;
  letter-spacing: 1px;
}
.newspaper-btn {
  display: block;
  width: calc(100% - 32px);
  margin: 0 16px 16px;
  background: #1a0f02;
  color: #c9a843;
  border: none;
  border-radius: 4px;
  padding: 10px;
  font-family: 'Amiri', serif;
  font-size: 14px;
  cursor: pointer;
  text-align: center;
  letter-spacing: 1px;
}

/* â•â• CHARACTER PORTRAITS in dialogue â•â• */
.char-portrait {
  display: inline;
  white-space: nowrap;
}
.char-portrait-avatar {
  font-size: 13px;
  margin-left: 2px;
  vertical-align: -1px;
}
.char-portrait-name {
  color: var(--gold2);
  font-weight: 700;
  font-family: 'Amiri', serif;
  font-style: normal;
  font-size: inherit;
}

/* â•â• MAP EVENTS (animated markers) â•â• */
.map-event-marker {
  animation: mapPing 1.5s ease-in-out infinite;
}
@keyframes mapPing {
  0%,100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(1.3); }
}

/* â•â• NEW GAME+ BADGE â•â• */
.ng-plus-badge {
  position: fixed;
  top: 0; left: 0; right: 0;
  background: linear-gradient(90deg, #1a0a30, #2a1060, #1a0a30);
  border-bottom: 1px solid rgba(140,100,220,0.4);
  padding: 8px;
  text-align: center;
  font-family: 'Amiri', serif;
  font-size: 12px;
  color: #c09af0;
  letter-spacing: 3px;
  z-index: 20;
  animation: ngBadgeIn 0.5s ease;
}
@keyframes ngBadgeIn {
  from { transform: translateY(-100%); }
  to { transform: translateY(0); }
}

/* â•â• NG+ SCENE MODIFIER badge â•â• */
.ng-scene-tag {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  background: rgba(140,100,220,0.12);
  border: 1px solid rgba(140,100,220,0.3);
  border-radius: 8px;
  padding: 3px 10px;
  font-size: 10px;
  color: #c09af0;
  margin-bottom: 8px;
  letter-spacing: 1px;
}

/* â•â• ENDING YEAR STAT â•â• */
.ending-years {
  text-align: center;
  font-family: 'Amiri', serif;
  margin-bottom: 6px;
}
.ending-years-num {
  font-size: 48px;
  font-weight: 700;
  background: linear-gradient(180deg, var(--gold4), var(--gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: block;
  line-height: 1;
}
.ending-years-label {
  font-size: 11px;
  color: var(--text3);
  letter-spacing: 3px;
  margin-top: 4px;
}

/* â•â• LANGUAGE SELECT SCREEN â•â• */
#langSelect {
  position: fixed; inset: 0; z-index: 9999;
  background: var(--dark);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 36px;
  transition: opacity 0.7s ease, transform 0.7s ease;
}
#langSelect.hidden {
  opacity: 0; transform: scale(1.05); pointer-events: none;
}
.ls-crown { font-size: 52px; filter: drop-shadow(0 0 28px rgba(212,168,67,0.9)); }
.ls-name {
  font-family: 'Amiri', serif; font-size: 52px; font-weight: 700;
  letter-spacing: 6px; line-height: 1; text-align: center;
  background: linear-gradient(180deg, var(--gold4) 0%, var(--gold) 45%, var(--gold3) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.ls-sub {
  font-size: 9px; letter-spacing: 5px; color: var(--text3);
  margin-top: 6px; font-family: 'Georgia', serif; text-align: center;
}
.ls-divider {
  display: flex; align-items: center; gap: 14px; width: 220px;
}
.ls-divider-line {
  flex: 1; height: 1px;
  background: linear-gradient(90deg, transparent, rgba(212,168,67,0.25));
}
.ls-divider-line:first-child { background: linear-gradient(270deg, transparent, rgba(212,168,67,0.25)); }
.ls-divider-gem { color: var(--gold3); font-size: 9px; }
.ls-prompt { font-size: 10px; letter-spacing: 4px; color: var(--text3); font-family: 'Georgia', serif; }
.ls-buttons { display: flex; gap: 16px; }
.ls-btn {
  display: flex; flex-direction: column; align-items: center; gap: 10px;
  padding: 22px 32px; background: rgba(212,168,67,0.04);
  border: 1px solid rgba(212,168,67,0.2); border-radius: 20px;
  cursor: pointer; transition: all 0.3s ease; min-width: 120px;
  position: relative; overflow: hidden;
}
.ls-btn::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(212,168,67,0.1), transparent 60%);
  opacity: 0; transition: opacity 0.3s;
}
.ls-btn:hover { border-color: rgba(212,168,67,0.55); background: rgba(212,168,67,0.08); }
.ls-btn:hover::before { opacity: 1; }
.ls-btn:active { transform: scale(0.96); }
.ls-btn-flag { font-size: 30px; line-height: 1; }
.ls-btn-lang { font-size: 18px; font-weight: 700; color: var(--gold2); letter-spacing: 2px; }
.ls-btn-ar .ls-btn-lang { font-family: 'Amiri', serif; font-size: 22px; }
.ls-btn-en .ls-btn-lang { font-family: 'Georgia', serif; }
.ls-btn-hint { font-size: 9px; color: var(--text3); letter-spacing: 1px; }
.ls-btn-ar .ls-btn-hint { font-family: 'Amiri', serif; font-size: 11px; }
.ls-footer { font-size: 9px; letter-spacing: 2px; color: rgba(100,90,70,0.4); font-family: 'Georgia', serif; }
@keyframes lsItemIn {
  from { opacity: 0; transform: translateY(16px); }
  to   { opacity: 1; transform: translateY(0); }
}
#langSelect .ls-crown  { animation: lsItemIn 0.6s ease 0.15s both, crownFloat 4s ease-in-out 0.75s infinite; }
#langSelect .ls-title  { animation: lsItemIn 0.6s ease 0.28s both; }
#langSelect .ls-divider{ animation: lsItemIn 0.5s ease 0.40s both; }
#langSelect .ls-prompt { animation: lsItemIn 0.5s ease 0.50s both; }
#langSelect .ls-buttons{ animation: lsItemIn 0.6s ease 0.60s both; }
#langSelect .ls-footer { animation: lsItemIn 0.5s ease 0.78s both; }

</style>
</head>
<body>

<!-- Language Selection Screen -->
<div id="langSelect">
  <span class="ls-crown">ğŸ‘‘</span>
  <div class="ls-title">
    <div class="ls-name">Ø£Ø±ÙŠÙ‡Ø§Ù†</div>
    <div class="ls-sub">ARIHAN â€” KINGDOM OF FATE</div>
  </div>
  <div class="ls-divider">
    <div class="ls-divider-line"></div>
    <span class="ls-divider-gem">âœ¦</span>
    <span class="ls-divider-gem">â—†</span>
    <span class="ls-divider-gem">âœ¦</span>
    <div class="ls-divider-line"></div>
  </div>
  <div class="ls-prompt">SELECT LANGUAGE Â· Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©</div>
  <div class="ls-buttons">
    <button class="ls-btn ls-btn-ar" onclick="chooseLang('ar')">
      <span class="ls-btn-flag">ğŸŒ™</span>
      <span class="ls-btn-lang">Ø¹Ø±Ø¨ÙŠ</span>
      <span class="ls-btn-hint">Arabic</span>
    </button>
    <button class="ls-btn ls-btn-en" onclick="chooseLang('en')">
      <span class="ls-btn-flag">âš”ï¸</span>
      <span class="ls-btn-lang">English</span>
      <span class="ls-btn-hint">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</span>
    </button>
  </div>
  <div class="ls-footer">ARIHAN Â· Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…ØµÙŠØ±</div>
</div>

<canvas id="bgCanvas"></canvas>

<!-- Language Toggle -->
<div id="langToggle" style="
  position:fixed; top:12px; left:12px; z-index:1000;
  display:flex; background:rgba(5,4,3,0.88);
  border:1px solid rgba(212,168,67,0.3); border-radius:22px;
  overflow:hidden; backdrop-filter:blur(12px);
  box-shadow:0 2px 14px rgba(0,0,0,0.5);
">
  <button id="btnAr" onclick="setLang('ar')" style="
    padding:6px 14px; font-size:12px; letter-spacing:1px;
    font-family:'Amiri',serif; color:#d4a843;
    background:rgba(212,168,67,0.15); border:none; cursor:pointer;
    transition:all 0.2s; border-radius:22px 0 0 22px;
  ">Ø¹</button>
  <button id="btnEn" onclick="setLang('en')" style="
    padding:6px 14px; font-size:11px; letter-spacing:2px;
    font-family:'Georgia',serif; color:#a08860;
    background:transparent; border:none; cursor:pointer;
    transition:all 0.2s; border-radius:0 22px 22px 0;
  ">EN</button>
</div>

<!-- Overlays -->
<div class="transition-overlay" id="transOverlay">
  <div class="transition-content" id="transContent">
    <span class="trans-emoji" id="transEmoji"></span>
    <div class="trans-text" id="transText"></div>
  </div>
</div>
<div class="consequence-banner" id="conBanner">
  <span class="con-icon" id="conIcon"></span>
  <span id="conText"></span>
</div>
<div class="reaction-toast" id="reactionToast"></div>
<div class="save-indicator" id="saveIndicator">ğŸ’¾ ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</div>
<div class="achievement-popup" id="achievePopup">
  <span class="ach-icon" id="achIcon"></span>
  <div class="ach-title">Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯</div>
  <div class="ach-name" id="achName"></div>
</div>

<!-- Map overlay -->
<div class="map-overlay" id="mapOverlay">
  <div class="map-title">ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ù…Ù…Ù„ÙƒØ© Ø£Ø±ÙŠÙ‡Ø§Ù†</div>
  <svg class="map-svg" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="mg1" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#1c170a"/>
        <stop offset="100%" stop-color="#080604"/>
      </radialGradient>
    </defs>
    <!-- Sea -->
    <rect width="400" height="300" fill="url(#mg1)"/>
    <!-- Main land -->
    <path d="M60,40 Q120,20 200,30 Q280,20 340,50 Q370,80 360,140 Q370,200 340,250 Q280,280 200,275 Q120,280 60,250 Q30,200 40,140 Q30,80 60,40Z" fill="#1a1408" stroke="rgba(212,168,67,0.2)" stroke-width="1"/>
    <!-- Northern territory (Thandar) -->
    <path d="M130,25 Q180,10 250,20 Q290,15 320,40 Q300,60 240,55 Q180,55 140,60 Q110,50 130,25Z" fill="#0d0a06" stroke="rgba(180,50,50,0.4)" stroke-width="1.5" stroke-dasharray="4,3"/>
    <text x="220" y="42" fill="#8b3a3a" font-size="10" text-anchor="middle" font-family="serif">Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©</text>
    <!-- Capital -->
    <circle cx="200" cy="140" r="14" fill="rgba(212,168,67,0.15)" stroke="rgba(212,168,67,0.5)" stroke-width="1.5"/>
    <circle cx="200" cy="140" r="5" fill="#d4a843"/>
    <text x="200" y="165" fill="#d4a843" font-size="11" text-anchor="middle" font-family="serif">Ø§Ù„Ø¹Ø§ØµÙ…Ø©</text>
    <!-- Landmark: Eastern palace -->
    <rect x="300" y="130" width="18" height="18" rx="2" fill="rgba(140,108,175,0.2)" stroke="rgba(140,108,175,0.4)" stroke-width="1"/>
    <text x="309" y="145" fill="#8c6caf" font-size="9" text-anchor="middle">â›©ï¸</text>
    <text x="309" y="162" fill="#8c6caf" font-size="8" text-anchor="middle" font-family="serif">Ø§Ù„Ø´Ø±Ù‚</text>
    <!-- Western mountains -->
    <path d="M65,100 L85,70 L105,100Z" fill="rgba(212,168,67,0.08)" stroke="rgba(212,168,67,0.2)" stroke-width="1"/>
    <path d="M80,110 L100,80 L120,110Z" fill="rgba(212,168,67,0.06)" stroke="rgba(212,168,67,0.15)" stroke-width="1"/>
    <text x="90" y="130" fill="#6a5830" font-size="8" text-anchor="middle" font-family="serif">Ø§Ù„Ø¬Ø¨Ø§Ù„</text>
    <!-- Southern desert -->
    <ellipse cx="200" cy="250" rx="70" ry="20" fill="rgba(139,100,20,0.12)" stroke="rgba(139,100,20,0.2)" stroke-width="1"/>
    <text x="200" y="255" fill="#6a5030" font-size="9" text-anchor="middle" font-family="serif">Ø§Ù„ØµØ­Ø±Ø§Ø¡ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©</text>
    <!-- River -->
    <path d="M140,40 Q150,80 145,120 Q140,160 155,200" fill="none" stroke="rgba(76,140,200,0.3)" stroke-width="2"/>
    <text x="130" y="120" fill="#3a6080" font-size="8" font-family="serif">Ù†Ù‡Ø± Ø£Ø±ÙŠÙ‡Ø§Ù†</text>
    <!-- Army marker if at war -->
    <circle cx="200" cy="55" r="6" fill="rgba(201,76,76,0.2)" stroke="rgba(201,76,76,0.5)" stroke-width="1" id="mapWarMarker"/>
    <text x="200" y="59" fill="#c94c4c" font-size="8" text-anchor="middle">âš”ï¸</text>
    <!-- Compass -->
    <g transform="translate(340,240)">
      <circle r="18" fill="rgba(212,168,67,0.05)" stroke="rgba(212,168,67,0.2)" stroke-width="1"/>
      <text x="0" y="-7" fill="rgba(212,168,67,0.5)" font-size="9" text-anchor="middle">Ø´</text>
      <text x="0" y="13" fill="rgba(212,168,67,0.5)" font-size="9" text-anchor="middle">Ø¬</text>
      <text x="-13" y="4" fill="rgba(212,168,67,0.5)" font-size="9" text-anchor="middle">Øº</text>
      <text x="13" y="4" fill="rgba(212,168,67,0.5)" font-size="9" text-anchor="middle">Ø´</text>
    </g>
  </svg>
  <button class="map-close" onclick="closeMap()">âœ• Ø£ØºÙ„Ù‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
</div>

<!-- SPLASH -->
<div id="splash">
  <div class="splash-crown">
    <div class="splash-ring"></div>
    <div class="splash-ring"></div>
    <div class="splash-ring"></div>
    <span class="splash-icon">ğŸ‘‘</span>
  </div>
  <div class="splash-text">
    <div class="splash-title">Ø£Ø±ÙŠÙ‡Ø§Ù†</div>
    <div class="splash-sub">Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…ØµÙŠØ±</div>
  </div>
  <div class="splash-bar"><div class="splash-bar-fill"></div></div>
  <div class="splash-hint">Ø§Ù„Ù…Ù…Ù„ÙƒØ© ØªÙ†ØªØ¸Ø±Ùƒ...</div>
</div>

<div id="app">

<!-- â•â• INTRO â•â• -->
<div class="screen active" id="intro">
  <div class="intro-hero">
    <div class="intro-hero-bg"></div>
    <div class="intro-hero-lines"></div>
    <div class="castle-emoji">ğŸ°</div>
  </div>
  <div class="intro-body">
    <div class="intro-logo">
      <div class="intro-logo-ar">Ø£Ø±ÙŠÙ‡Ø§Ù†</div>
      <div class="intro-logo-en">ARIHAN â€” KINGDOM OF FATE</div>
    </div>
    <div class="ornament">
      <div class="ornament-line"></div>
      <div class="ornament-gem">âœ¦</div>
      <div class="ornament-gem">â—†</div>
      <div class="ornament-gem">âœ¦</div>
      <div class="ornament-line"></div>
    </div>
    <p class="intro-lore">
      Ù…Ù…Ù„ÙƒØ© <em>Ø£Ø±ÙŠÙ‡Ø§Ù†</em> ØªÙ†Ø²Ù Ù…Ù† Ø§Ù„Ø¯Ø§Ø®Ù„.
      Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø±Ø§Ø­Ù„ ØªØ±Ùƒ ÙˆØ±Ø§Ø¡Ù‡ Ø¯ÙŠÙˆÙ†Ø§Ù‹ Ø«Ù‚ÙŠÙ„Ø©ØŒ
      ÙØµØ§Ø¦Ù„ Ù…ØªÙ†Ø§Ø«Ø±Ø©ØŒ ÙˆØ¹Ø±Ø´Ø§Ù‹ ÙŠÙ‡Ø²Ù‘Ù‡ Ø§Ù„Ø®ÙˆÙ.
      <br><br>
      Ø£Ù†Øª Ø§Ù„ÙˆØ±ÙŠØ« Ø§Ù„ÙˆØ­ÙŠØ¯ â€” ÙˆØ§Ù„Ù‚Ù„Ù… Ø¨ÙŠØ¯Ùƒ.
      ÙƒÙ„ Ù‚Ø±Ø§Ø± Ø³ÙŠÙØ­ÙƒÙ‰ ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®
      Ø£Ùˆ ÙŠÙØ·Ù…Ø³ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¨Ø¯.
    </p>
    <div class="ornament">
      <div class="ornament-line"></div>
      <div class="ornament-gem">âœ¦</div>
      <div class="ornament-line"></div>
    </div>

    <!-- Personality selector -->
    <div class="personality-section">
      <div class="section-label">âœ¦ Ø·Ø¨ÙŠØ¹Ø© Ø­ÙƒÙ…Ùƒ âœ¦</div>
      <div class="personality-grid">
        <div class="pers-card" data-pers="sage" onclick="selectPers(this)">
          <span class="pers-icon">ğŸ¦‰</span>
          <div class="pers-name">Ø§Ù„Ø­ÙƒÙŠÙ…</div>
          <div class="pers-bonus">+Ø­ÙƒÙ…Ø§Ø¡ Ø¨Ø¯Ø§ÙŠØ©</div>
        </div>
        <div class="pers-card selected" data-pers="warrior" onclick="selectPers(this)">
          <span class="pers-icon">âš”ï¸</span>
          <div class="pers-name">Ø§Ù„Ù…Ø­Ø§Ø±Ø¨</div>
          <div class="pers-bonus">+Ø¬ÙŠØ´ Ø¨Ø¯Ø§ÙŠØ©</div>
        </div>
        <div class="pers-card" data-pers="diplomat" onclick="selectPers(this)">
          <span class="pers-icon">ğŸ•Šï¸</span>
          <div class="pers-name">Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠ</div>
          <div class="pers-bonus">+Ø´Ø¹Ø¨ Ø¨Ø¯Ø§ÙŠØ©</div>
        </div>
      </div>
    </div>

    <div class="factions-preview">
      <div class="faction-card"><span class="faction-card-icon">ğŸ˜ï¸</span><div class="faction-card-info"><div class="faction-card-name">Ø§Ù„Ø´Ø¹Ø¨</div><div class="faction-card-desc">Ù‚ÙˆØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</div></div></div>
      <div class="faction-card"><span class="faction-card-icon">ğŸ—¡ï¸</span><div class="faction-card-info"><div class="faction-card-name">Ø§Ù„Ø¬ÙŠØ´</div><div class="faction-card-desc">Ø­Ø±Ø§Ø³ Ø§Ù„Ø¹Ø±Ø´</div></div></div>
      <div class="faction-card"><span class="faction-card-icon">ğŸ’</span><div class="faction-card-info"><div class="faction-card-name">Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡</div><div class="faction-card-desc">Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø«Ø±ÙˆØ©</div></div></div>
      <div class="faction-card"><span class="faction-card-icon">ğŸ“œ</span><div class="faction-card-info"><div class="faction-card-name">Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡</div><div class="faction-card-desc">Ù…Ø´ÙˆØ±Ø© ÙˆØ±Ø£ÙŠ</div></div></div>
    </div>

    <div class="name-section">
      <div class="name-label" id="nameLabelText">âœ¦ Ù…Ø§ Ø§Ø³Ù…Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØŸ âœ¦</div>
      <input class="name-input" id="kingInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ..." maxlength="18" autocomplete="off">
    </div>

    <!-- Gender selector -->
    <div class="gender-section">
      <div class="section-label">âœ¦ Ù…Ù† ØªÙƒÙˆÙ†ØŸ âœ¦</div>
      <div class="gender-grid">
        <div class="gender-card selected" data-gender="male" onclick="selectGender(this)">
          <span class="gender-icon">ğŸ‘‘</span>
          <span class="gender-name">Ù…Ù„Ùƒ</span>
        </div>
        <div class="gender-card" data-gender="female" onclick="selectGender(this)">
          <span class="gender-icon">ğŸ‘¸</span>
          <span class="gender-name">Ù…Ù„ÙƒØ©</span>
        </div>
      </div>
    </div>

    <button class="start-btn" id="startBtn" onclick="startGame()">âš”ï¸ ØªØ³Ù„Ù‘Ù… Ø§Ù„Ø¹Ø±Ø´ âš”ï¸</button>
  </div>
</div>

<!-- â•â• GAME â•â• -->
<div class="screen" id="game">
  <div class="stats-bar">
    <div class="stats-top">
      <div style="display:flex;flex-direction:column;gap:2px">
        <div class="king-title" id="kingTitleBar">Ø§Ù„Ù…Ù„Ùƒ</div>
        <div class="year-display" id="yearDisplay">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø§Ù„Ø­ÙƒÙ…</div>
      </div>
      <div style="display:flex;gap:6px;align-items:center">
        <button class="map-btn" onclick="toggleMap()">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
        <div class="chapter-indicator" id="chapterIndicator">Ø§Ù„ÙØµÙ„ Ù¡</div>
      </div>
    </div>
    <div class="factions-bar">
      <div class="faction-stat f-people">
        <div class="faction-stat-header">
          <span class="faction-stat-name">ğŸ˜ï¸ Ø§Ù„Ø´Ø¹Ø¨</span>
          <span class="faction-stat-num" id="num-people">60</span>
        </div>
        <div class="faction-bar-bg"><div class="faction-bar-fill" id="bar-people" style="width:60%"></div></div>
      </div>
      <div class="faction-stat f-army">
        <div class="faction-stat-header">
          <span class="faction-stat-name">ğŸ—¡ï¸ Ø§Ù„Ø¬ÙŠØ´</span>
          <span class="faction-stat-num" id="num-army">60</span>
        </div>
        <div class="faction-bar-bg"><div class="faction-bar-fill" id="bar-army" style="width:60%"></div></div>
      </div>
      <div class="faction-stat f-nobles">
        <div class="faction-stat-header">
          <span class="faction-stat-name">ğŸ’ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡</span>
          <span class="faction-stat-num" id="num-nobles">60</span>
        </div>
        <div class="faction-bar-bg"><div class="faction-bar-fill" id="bar-nobles" style="width:60%"></div></div>
      </div>
      <div class="faction-stat f-church">
        <div class="faction-stat-header">
          <span class="faction-stat-name">ğŸ“œ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡</span>
          <span class="faction-stat-num" id="num-church">60</span>
        </div>
        <div class="faction-bar-bg"><div class="faction-bar-fill" id="bar-church" style="width:60%"></div></div>
      </div>
    </div>
  </div>
  <div class="scene-container" id="sceneContainer">
    <div class="scene-visual" id="sceneVisual">
      <div class="scene-bg-gradient" id="sceneBg"></div>
      <div class="scene-particles" id="sceneParticles"></div>
      <div class="scene-emoji" id="sceneEmoji">ğŸ›ï¸</div>
    </div>
    <div class="scene-text-area">
      <div class="memory-tag" id="memoryTag" style="display:none">ğŸ“œ <span id="memoryText"></span></div>
      <div class="chapter-tag" id="chapterTag"></div>
      <div class="scene-title" id="sceneTitle"></div>
      <div class="scene-body" id="sceneBody"></div>
    </div>
    <div class="choices-section">
      <div class="choices-header" id="choicesHeader">â€” Ø§Ø®ØªØ± Ù…Ø³Ø§Ø±Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„Ùƒ â€”</div>
      <div id="choicesList"></div>
    </div>
  </div>
</div>

<!-- â•â• ENDING â•â• -->
<div class="screen" id="ending">
  <div class="ending-header">
    <div class="ending-glow" id="endingGlow"></div>
    <div class="ending-stars" id="endingStars"></div>
    <div class="ending-seal" id="endingSeal"></div>
    <div class="ending-title" id="endingTitle"></div>
    <div class="ending-rank" id="endingRank"></div>
  </div>
  <div class="ending-body">
    <div class="ornament">
      <div class="ornament-line"></div>
      <div class="ornament-gem">âœ¦</div>
      <div class="ornament-gem">â—†</div>
      <div class="ornament-gem">âœ¦</div>
      <div class="ornament-line"></div>
    </div>
    <p class="ending-story" id="endingStory"></p>
    <div class="score-display" id="scoreDisplay">
      <div class="score-label">Ù†Ù‚Ø§Ø· Ø§Ù„Ø­ÙƒÙ…</div>
      <div class="score-value" id="scoreValue">0</div>
      <div class="score-rank" id="scoreRankText"></div>
    </div>
    <div class="personality-summary" id="personalitySummary"></div>
    <div class="faction-standings" id="factionStandings"></div>
    <div class="chronicle-box">
      <div class="chronicle-title">ğŸ“œ Ø³Ø¬Ù„ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„Ùƒ</div>
      <div id="chronicle"></div>
    </div>
    <div class="replay-section">
      <button class="btn-gold" onclick="restartGame()">ğŸ”„ Ø§Ø¨Ø¯Ø£ Ù…Ø³Ø§Ø±Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹</button>
      <button class="btn-outline" onclick="shareResult()">ğŸ“¤ Ø´Ø§Ø±Ùƒ Ù†Ù‡Ø§ÙŠØªÙƒ</button>
    </div>
  </div>
</div>

</div><!-- /app -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTICLES BACKGROUND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
let pts = [];

function initCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  pts = Array.from({length: 100}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 1.4 + 0.2,
    alpha: Math.random() * 0.5 + 0.08,
    speed: Math.random() * 0.18 + 0.04,
    tw: Math.random() * Math.PI * 2,
    ts: Math.random() * 0.018 + 0.004,
    hue: Math.random() > 0.85 ? 40 : 35,
  }));
}

function drawCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#050403';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  pts.forEach(p => {
    p.tw += p.ts;
    p.y -= p.speed;
    if (p.y < -2) { p.y = canvas.height + 2; p.x = Math.random() * canvas.width; }
    const a = p.alpha * (0.55 + 0.45 * Math.sin(p.tw));
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
    ctx.fillStyle = `hsla(${p.hue},70%,70%,${a})`;
    ctx.fill();
  });
  requestAnimationFrame(drawCanvas);
}
initCanvas(); drawCanvas();
window.addEventListener('resize', initCanvas);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PERSONALITIES = {
  sage:     { icon:'ğŸ¦‰', name:'Ø§Ù„Ø­ÙƒÙŠÙ…',     bonus:{church:15},  desc:'ØªÙØ¶Ù‘Ù„ Ø§Ù„Ø­ÙƒÙ…Ø© ÙˆØ§Ù„Ø¹Ù„Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ©. Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠØ«Ù‚ÙˆÙ† Ø¨Ùƒ Ù…Ù†Ø° Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.' },
  warrior:  { icon:'âš”ï¸', name:'Ø§Ù„Ù…Ø­Ø§Ø±Ø¨',   bonus:{army:15},    desc:'ÙˆÙ„Ø¯Øª Ù„ØªÙ‚Ø§ØªÙ„. Ø§Ù„Ø¬ÙŠØ´ ÙŠØ±Ø§Ùƒ Ø£Ø­Ø¯ Ù…Ù†Ù‡Ù….' },
  diplomat: { icon:'ğŸ•Šï¸', name:'Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠ', bonus:{people:15}, desc:'Ø§Ù„ÙƒÙ„Ù…Ø© Ø³Ù„Ø§Ø­Ùƒ. Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ±Ù‰ ÙÙŠÙƒ Ø­Ø§ÙƒÙ…Ø§Ù‹ Ø¹Ø§Ø¯Ù„Ø§Ù‹ Ù„Ø§ Ù…Ù„ÙƒØ§Ù‹.' },
};

let selectedPers = 'warrior';
let selectedGender = 'male'; // 'male' | 'female'

function selectGender(el) {
  document.querySelectorAll('.gender-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  selectedGender = el.dataset.gender;
  // Update label and placeholder
  const isFemale = selectedGender === 'female';
  document.getElementById('nameLabelText').textContent = isFemale ? 'âœ¦ Ù…Ø§ Ø§Ø³Ù…ÙƒÙ Ø£ÙŠØªÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØ©ØŸ âœ¦' : 'âœ¦ Ù…Ø§ Ø§Ø³Ù…Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØŸ âœ¦';
  document.getElementById('kingInput').placeholder = isFemale ? 'Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…ÙƒÙ...' : 'Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ...';
  document.getElementById('startBtn').textContent = isFemale ? 'âš”ï¸ ØªØ³Ù„Ù‘Ù…ÙŠ Ø§Ù„Ø¹Ø±Ø´ âš”ï¸' : 'âš”ï¸ ØªØ³Ù„Ù‘Ù… Ø§Ù„Ø¹Ø±Ø´ âš”ï¸';
}

// Gender-aware text helper â€” works before and during game
function gT(male, female) {
  const gender = (G && G.gender) ? G.gender : selectedGender;
  return gender === 'female' ? female : male;
}

let G = {
  name: '', personality: 'warrior',
  people: 60, army: 60, nobles: 60, church: 60,
  choices: [], tags: new Set(), seenEvents: new Set(),
  turn: 0, achievements: [],
};

function selectPers(el) {
  document.querySelectorAll('.pers-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  selectedPers = el.dataset.pers;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCENES DATABASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SCENES = {

  debt: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„ â€” ÙˆØ±Ø§Ø«Ø© Ø§Ù„Ø£Ø¹Ø¨Ø§Ø¡',
    title: 'Ø¯ÙŠÙˆÙ† Ø§Ù„Ø£Ø¨',
    emoji: 'ğŸ›ï¸',
    color: 'rgba(140,100,20,0.5)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(140,100,20,0.5) 0%, rgba(20,15,5,0.8) 55%, rgba(5,4,3,1) 100%)',
    text: () => `
      ÙÙˆØ± Ø¬Ù„ÙˆØ³Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø´ØŒ ÙŠÙÙ†Ø§Ø¯ÙŠÙƒ <span class="char-name">Ø§Ù„ÙˆØ²ÙŠØ± Ø§Ù„Ø£ÙƒØ¨Ø± Ù…Ø±ÙˆØ§Ù† Ø§Ù„Ø¯Ø§Ù‡ÙŠØ©</span>.
      ÙˆØ¬Ù‡Ù‡ Ø´Ø§Ø­Ø¨ ÙƒÙ…Ù† ÙŠØ­Ù…Ù„ Ø®Ø¨Ø±Ø§Ù‹ ÙŠÙƒØ³Ø± Ø§Ù„Ø¸Ù‡Ø±.
      <br><br>
      <span class="whisper">"Ø¬Ù„Ø§Ù„Ø© ${gT('Ø§Ù„Ù…Ù„Ùƒ','Ø§Ù„Ù…Ù„ÙƒØ©')}... Ø®Ø²ÙŠÙ†Ù†Ø§ Ù…Ø«Ù‚Ù„ Ø¨Ø¯ÙŠÙˆÙ† Ø£Ø¨ÙŠÙƒ Ø±Ø­Ù…Ù‡ Ø§Ù„Ù„Ù‡. Ø§Ù„Ù…ØµØ§Ø±Ù Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ© ØªÙ†ØªØ¸Ø±. Ø¥Ù† Ù„Ù… Ù†Ø¯ÙØ¹ Ø®Ù„Ø§Ù„ Ø£Ø±Ø¨Ø¹ÙŠÙ† ÙŠÙˆÙ…Ø§Ù‹ØŒ Ø£Ø±Ø³Ù„ÙˆØ§ Ù…Ø­ØµÙ‘Ù„ÙŠÙ† Ù…Ø³Ù„Ø­ÙŠÙ†."</span>
      <br><br>
      Ø«Ù„Ø§Ø«Ø© ÙˆØ¬ÙˆÙ‡ ØªØªØ·Ù„Ø¹ Ø¥Ù„ÙŠÙƒ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰:
      Ø§Ù„ØªØ§Ø¬Ø± <span class="char-name">Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ</span>ØŒ ÙˆØ§Ù„Ù‚Ø§Ø¦Ø¯ <span class="char-name">Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø®Ø§Ù„Ø¯</span>ØŒ ÙˆØ§Ù„Ø­ÙƒÙŠÙ… <span class="char-name">Ø²ÙŠØ¯ Ø§Ù„ÙˆÙ‚ÙˆØ±</span>.
      ÙƒÙ„ÙŒÙ‘ Ù…Ù†Ù‡Ù… ÙŠÙ…Ù„Ùƒ Ø­Ù„Ø§Ù‹ â€” ÙˆÙƒÙ„ÙŒÙ‘ Ù…Ù†Ù‡Ù… ÙŠØ±ÙŠØ¯ Ø«Ù…Ù†Ø§Ù‹.
    `,
    memory: null,
    choices: [
      {
        emoji: 'ğŸ’', text: 'Ø£ÙØ±Ø¶ Ø¶Ø±ÙŠØ¨Ø© Ø·Ø§Ø±Ø¦Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙˆÙƒØ¨Ø§Ø± Ø§Ù„ØªØ¬Ø§Ø±',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +8', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’18', type: 'down' }, { label: '+Ø®Ø²ÙŠÙ†Ø©', type: 'neutral' }],
        fn: () => {
          apply({nobles:-18, people:8});
          G.tags.add('taxed_nobles');
          chronicle('ğŸ’', 'ÙØ±Ø¶ Ø¶Ø±ÙŠØ¨Ø© Ø·Ø§Ø±Ø¦Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡');
          checkAchievement('bold_start', 'ğŸ¦', 'Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø±ÙŠØ¦Ø©');
          transition('âš–ï¸', 'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØªØ°Ù…Ø±ÙˆÙ†... Ù„ÙƒÙ† Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ø£Ø®Ø°Øª Ù†ÙÙØ³Ù‡Ø§', () => go('drought'));
        }
      },
      {
        emoji: 'âš”ï¸', text: 'Ø£Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø¬ÙŠØ´ Ø§Ù„ØªÙ†Ø§Ø²Ù„ Ø¹Ù† Ù…ÙƒØ§ÙØ¢ØªÙ‡Ù… Ù…Ù‚Ø§Ø¨Ù„ ÙˆØ¹Ø¯ Ø¨Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ©',
        sub: [{ label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’20', type: 'down' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +5', type: 'up' }, { label: 'Ø®Ø·Ø±: ÙˆØ¹Ø¯ Ø«Ù‚ÙŠÙ„', type: 'neutral' }],
        fn: () => {
          apply({army:-20, people:5, church:5});
          G.tags.add('army_debt');
          chronicle('âš”ï¸', 'Ø·Ù„Ø¨ ØªØ¶Ø­ÙŠØ© Ù…Ù† Ø§Ù„Ø¬ÙŠØ´ Ø¨ÙˆØ¹Ø¯ Ø¨Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ©');
          transition('ğŸ—¡ï¸', 'Ø§Ù„Ø¬Ù†Ø¯ ÙŠØªØ°Ù…Ø±ÙˆÙ†... Ø§Ù„ÙˆØ¹Ø¯ Ø«Ù‚ÙŠÙ„', () => go('drought'));
        }
      },
      {
        emoji: 'ğŸ“œ', text: 'Ø£Ø·Ù„Ø¨ Ù‚Ø±Ø¶Ø§Ù‹ Ù…Ù† Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù…ØªÙŠØ§Ø²Ø§Øª ÙˆÙ…ÙƒØ§Ù†Ø© ÙÙŠ Ø§Ù„Ø¯ÙŠÙˆØ§Ù†',
        sub: [{ label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +18', type: 'up' }, { label: 'âˆ’Ø§Ø³ØªÙ‚Ù„Ø§Ù„ÙŠØ© Ø§Ù„Ø­ÙƒÙ…', type: 'down' }, { label: '+Ø®Ø²ÙŠÙ†Ø©', type: 'neutral' }],
        fn: () => {
          apply({church:18, nobles:-5});
          G.tags.add('church_debt');
          chronicle('ğŸ“œ', 'Ø§Ø³ØªØ¹Ø§Ø± Ù…Ù† Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù…ØªÙŠØ§Ø²Ø§Øª');
          transition('ğŸ–‹ï¸', 'Ø§Ù„Ø­ÙƒÙŠÙ… ÙŠØ¨ØªØ³Ù…... Ù„Ù„Ø¹Ù„Ù…Ø§Ø¡ Ø§Ù„Ø¢Ù† Ø«Ù…Ù†Ù‡Ù…', () => go('drought'));
        }
      },
    ]
  },

  drought: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ â€” Ø§Ù„Ø£Ø±Ø¶ Ø§Ù„Ø¸Ø§Ù…Ø¦Ø©',
    title: 'ØµÙŠÙ Ø§Ù„Ø¬Ø­ÙŠÙ…',
    emoji: 'ğŸŒ¾',
    color: 'rgba(120,60,10,0.6)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(120,60,10,0.6) 0%, rgba(15,10,3,0.8) 55%, rgba(5,4,3,1) 100%)',
    text: () => {
      const base = `
        Ø«Ù„Ø§Ø«Ø© Ø£Ø´Ù‡Ø± Ø¨Ù„Ø§ Ù…Ø·Ø±. Ù…Ø­Ø§ØµÙŠÙ„ Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ© ØªÙ…ÙˆØª ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ØŒ
        ÙˆØ§Ù„ÙÙ„Ø§Ø­ÙˆÙ† ÙŠØ³ÙŠØ±ÙˆÙ† Ù†Ø­Ùˆ Ø§Ù„Ø¹Ø§ØµÙ…Ø© Ø¨ÙˆØ¬ÙˆÙ‡ ÙŠØ§Ø¨Ø³Ø© ÙƒØ§Ù„Ø·ÙŠÙ† Ø§Ù„Ù…ØªØ´Ù‚Ù‚.
        <br><br>
        <span class="char-name">Ù…Ø±ÙˆØ§Ù† Ø§Ù„Ø¯Ø§Ù‡ÙŠØ©</span> ÙŠØ¶Ø¹ Ø£Ù…Ø§Ù…Ùƒ ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ù…Ø±Ø¹Ø¨Ø§Ù‹:
        <span class="whisper">"Ø¥Ù† Ù„Ù… Ù†ØªØ¯Ø®Ù„ Ø®Ù„Ø§Ù„ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†ØŒ Ø³ØªØ¨Ø¯Ø£ ÙˆÙÙŠØ§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„."</span>
        <br><br>
      `;
      if (G.tags.has('taxed_nobles')) return base + `Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ù„ØºØ§Ø¶Ø¨ÙˆÙ† <span class="dramatic">ÙŠÙØ­Ø¬Ù…ÙˆÙ† Ø¹Ù† Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</span> Ø§Ø­ØªØ¬Ø§Ø¬Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©. Ø§Ù„Ø£Ø²Ù…Ø© Ø£Ø¹Ù…Ù‚ Ù…Ù…Ø§ ÙƒØ§Ù†Øª Ø³ØªÙƒÙˆÙ†.`;
      if (G.tags.has('army_debt')) return base + `Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„Ø³Ø§Ø®Ø·ÙˆÙ† <span class="dramatic">ÙŠÙØ¨Ø·Ø¦ÙˆÙ†</span> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯Ø§Øª Ù…ØªØ¹Ù…Ø¯ÙŠÙ†. Ø§Ù„ÙˆØ¹Ø¯ Ù„Ù… ÙŠÙÙˆÙÙ Ø¨Ø¹Ø¯.`;
      if (G.tags.has('church_debt')) return base + `<span class="good-word">Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠÙØªØ­ÙˆÙ† Ø¯ÙŠÙˆØ§Ù†Ù‡Ù…</span> Ù„Ù„Ø¬Ø§Ø¦Ø¹ÙŠÙ† Ø¨Ø¯ÙˆÙ† Ø£Ù† ÙŠØ³ØªØ£Ø°Ù†ÙˆØ§ â€” ÙˆØªÙØ­Ø³Ø¨ Ù„Ù‡Ù… Ù„Ø§ Ù„Ùƒ.`;
      return base + `Ø§Ù„Ù…Ø¬Ø§Ø¹Ø© ØªÙ‚ØªØ±Ø¨ ÙˆØ§Ù„ÙˆÙ‚Øª ÙŠÙ†ÙØ¯.`;
    },
    memory: () => G.tags.has('taxed_nobles') ? 'ğŸ“Œ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ØºØ§Ø¶Ø¨ÙˆÙ† Ù…Ù† Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©' :
                  G.tags.has('army_debt') ? 'âš”ï¸ Ø§Ù„Ø¬ÙŠØ´ Ù„Ù… ÙŠÙÙƒØ§ÙÙØ£ Ø¨Ø¹Ø¯ ÙƒÙ…Ø§ ÙˆØ¹Ø¯Øª' :
                  G.tags.has('church_debt') ? 'ğŸ“œ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ù‚ÙˆØ© Ù…Ø³ØªÙ‚Ù„Ø© Ø§Ù„Ø¢Ù†' : null,
    choices: [
      {
        emoji: 'ğŸ ', text: 'Ø§ÙØªØ­ Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø­Ø¨ÙˆØ¨ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù…Ø¬Ø§Ù†Ø§Ù‹ â€” Ù„Ø§ Ø£Ø­Ø¯ ÙŠØ¬ÙˆØ¹',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +28', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’10', type: 'down' }, { label: 'âˆ’Ù…Ø®Ø²ÙˆÙ†', type: 'neutral' }],
        fn: () => {
          apply({people:28, army:-10});
          G.tags.add('opened_stores');
          chronicle('ğŸ ', 'ÙØªØ­ Ø§Ù„Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù„Ù„Ø´Ø¹Ø¨');
          transition('â¤ï¸', 'Ø§Ù„Ø´Ø¹Ø¨ ÙŠÙ‡ØªÙ Ø¨Ø§Ø³Ù…Ùƒ ÙÙŠ ÙƒÙ„ Ø´Ø§Ø±Ø¹!', () => go('rebellion'));
        }
      },
      {
        emoji: 'â›ï¸', text: 'Ø£Ø±Ø³Ù„ Ø§Ù„Ø¬ÙŠØ´ Ù„Ø­ÙØ± Ù‚Ù†ÙˆØ§Øª Ø±ÙŠ Ù…Ù† Ø§Ù„Ù†Ù‡Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +16', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +6', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’14', type: 'down' }],
        fn: () => {
          apply({people:16, nobles:6, army:-14});
          G.tags.add('dug_canals');
          chronicle('â›ï¸', 'Ø£Ù…Ø± Ø§Ù„Ø¬ÙŠØ´ Ø¨Ø­ÙØ± Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙŠ');
          transition('ğŸ’§', 'Ø§Ù„Ù…Ø§Ø¡ ÙŠØªØ¯ÙÙ‚... ÙˆØ§Ù„Ø£Ø±Ø¶ ØªØ¹ÙˆØ¯ Ù„Ù„Ø­ÙŠØ§Ø©', () => go('rebellion'));
        }
      },
      {
        emoji: 'ğŸ’°', text: 'Ø§Ø´ØªØ±Ù Ø§Ù„Ø­Ø¨ÙˆØ¨ Ù…Ù† Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠÙŠÙ† Ø¨Ø£ÙŠ Ø³Ø¹Ø±',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +12', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +10', type: 'up' }, { label: 'âˆ’Ø®Ø²ÙŠÙ†Ø© ÙƒØ¨ÙŠØ±', type: 'down' }],
        fn: () => {
          apply({people:12, nobles:10, church:-5});
          G.tags.add('bought_grain');
          chronicle('ğŸ’°', 'Ø´Ø±Ø§Ø¡ Ø§Ù„Ø­Ø¨ÙˆØ¨ Ù…Ù† Ø§Ù„Ø´Ù…Ø§Ù„ Ø¨Ø§Ù„Ø®Ø²ÙŠÙ†Ø©');
          transition('ğŸŒ¾', 'Ø§Ù„Ø­Ø¨ÙˆØ¨ ÙˆØµÙ„Øª... Ù„ÙƒÙ† Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ù†Ø²ÙØª', () => go('rebellion'));
        }
      },
    ]
  },

  rebellion: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø« â€” Ø§Ù„ÙØªÙ†Ø© ØªØ´Ø¨Ù‘',
    title: 'Ø£Ù…ÙŠØ± Ø§Ù„Ø´Ø±Ù‚ ÙŠÙ‚Ø·Ø¹ Ø¨ÙŠØ¹ØªÙ‡',
    emoji: 'âš¡',
    color: 'rgba(120,20,20,0.6)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(120,20,20,0.6) 0%, rgba(15,5,5,0.8) 55%, rgba(5,4,3,1) 100%)',
    text: () => {
      const base = `
        Ø±Ø³Ø§Ù„Ø© Ù…ÙØ³Ø±ÙÙ‘Ø¨Ø© ØªØµÙ„ Ù…Ù† Ø§Ù„Ù‚ØµØ± Ø§Ù„Ø´Ø±Ù‚ÙŠ:
        <span class="char-name">Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù† Ø¯Ø±Ø§ÙƒÙˆÙ</span> ÙŠÙØµØ±Ù‘Ø­ Ø£Ù† Ø§Ù„Ø¹Ø±Ø´ ÙŠØ³ØªØ­Ù‚ Ù…ÙÙ† Ù‡Ùˆ Ø£Ø¬Ø¯Ø±.
        Ø£ÙˆÙ‚Ù Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ØŒ ÙˆØ³Ø­Ø¨ Ø¬Ù†ÙˆØ¯Ù‡ Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯.
        <br><br>
        <span class="char-name">Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø®Ø§Ù„Ø¯</span> ÙŠØ¶Ø±Ø¨ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: <span class="whisper">"Ø¯Ø¹Ù†ÙŠ Ø£Ø³ÙŠØ± Ø¥Ù„ÙŠÙ‡ Ø§Ù„Ø¢Ù†. Ù‡Ø°Ø§ Ø§Ù„Ù…ØªÙ…Ø±Ø¯ Ù„Ø§ ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ø­ÙˆØ§Ø±."</span>
        <br><br>
      `;
      if (G.tags.has('opened_stores')) return base + `<span class="good-word">Ø´Ø¹Ø¨Ùƒ ÙŠÙ‚Ù Ø®Ù„ÙÙƒ Ø¨Ù‚ÙˆØ©</span> Ø¨Ø¹Ø¯ Ø£Ù† Ø£Ø·Ø¹Ù…ØªÙ‡Ù… â€” Ù„ÙƒÙ† Ø§Ù„Ø¬ÙŠØ´ Ù„Ø§ ÙŠØ²Ø§Ù„ Ù…ØªØ°Ø¨Ø°Ø¨Ø§Ù‹.`;
      if (G.tags.has('army_debt')) return base + `<span class="dramatic">Ø§Ù„Ø¬Ù†ÙˆØ¯ ÙŠØªØ±Ø¯Ø¯ÙˆÙ† ÙÙŠ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</span> â€” Ø°ÙƒØ±Ù‰ Ø§Ù„ÙˆØ¹Ø¯ ØºÙŠØ± Ø§Ù„Ù…ÙÙˆÙÙ‰ Ø­Ø§Ø¶Ø±Ø© ÙÙŠ Ø£Ø°Ù‡Ø§Ù†Ù‡Ù….`;
      return base + `Ø§Ù„Ù…ÙˆÙ‚Ù Ø­Ø±Ø¬ØŒ ÙˆÙƒÙ„ Ø®Ø·ÙˆØ© Ù„Ù‡Ø§ Ø«Ù…Ù†Ù‡Ø§.`;
    },
    memory: () => G.tags.has('army_debt') ? 'âš ï¸ Ø§Ù„Ø¬ÙŠØ´ Ù„Ø§ ÙŠØ²Ø§Ù„ ØºØ§Ø¶Ø¨Ø§Ù‹ Ù…Ù† ÙˆØ¹Ø¯Ùƒ' :
                  G.tags.has('opened_stores') ? 'ğŸ’š Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ¤ÙŠØ¯Ùƒ Ø¨Ù‚ÙˆØ© â€” Ù‡Ø°Ø§ Ø±ØµÙŠØ¯' : null,
    choices: [
      {
        emoji: 'âš”ï¸', text: 'Ø£Ø±Ø³Ù„ Ø¬ÙŠØ´Ø§Ù‹ Ù„Ø¥Ø®Ù…Ø§Ø¯ Ø§Ù„ØªÙ…Ø±Ø¯ ÙÙˆØ±Ø§Ù‹ ÙˆØ¨Ø§Ù„Ù‚ÙˆØ©',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +12', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’20', type: 'down' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +6', type: 'up' }],
        fn: () => {
          const penalty = G.tags.has('army_debt') ? -12 : 0;
          apply({army: 12 + penalty, people:-20, nobles:6});
          G.tags.add('crushed_rebel');
          chronicle('âš”ï¸', 'Ø£Ø®Ù…Ø¯ ØªÙ…Ø±Ø¯ Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù† Ø¨Ø§Ù„Ù‚ÙˆØ©');
          transition('ğŸ—¡ï¸', 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø³Ù‚Ø·Øª... Ø§Ù„Ø¯Ù… ÙŠØ³ØªÙˆØ¬Ø¨ Ø§Ù„Ø¯Ù…', () => go('war_council'));
        }
      },
      {
        emoji: 'ğŸ¤', text: 'Ø£Ø¯Ø¹ÙˆÙ‡ Ù„Ù…Ø£Ø¯Ø¨Ø© ÙˆØ£Ø¹Ø±Ø¶ Ø¹Ù„ÙŠÙ‡ Ù…Ù†ØµØ¨ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø£ÙˆÙ„',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +12', type: 'up' }, { label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’12', type: 'down' }],
        fn: () => {
          apply({church:10, people:12, nobles:-12});
          G.tags.add('diplomacy_rebel');
          chronicle('ğŸ¤', 'ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø§Ù„Ø£Ù…ÙŠØ± ÙˆÙ…Ù†Ø­Ù‡ Ù…Ù†ØµØ¨Ø§Ù‹');
          transition('ğŸ•Šï¸', 'Ø§Ù„Ø£Ù…ÙŠØ± Ù‚Ø¨Ù„... Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙˆÙ† ÙŠØªØ³Ø§Ø¡Ù„ÙˆÙ†', () => go('war_council'));
        }
      },
      {
        emoji: 'ğŸ“œ', text: 'Ø§ØªÙ‡Ù…Ù‡ Ø¹Ù„Ù†Ø§Ù‹ Ø¨Ø§Ù„Ø®ÙŠØ§Ù†Ø© ÙˆØ§Ù†ØªØ¸Ø± Ø¯Ø¹Ù… Ø§Ù„ÙØµØ§Ø¦Ù„',
        sub: [{ label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +16', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’5', type: 'down' }, { label: 'Ù†ØªÙŠØ¬Ø© ØºÙŠØ± Ù…Ø¶Ù…ÙˆÙ†Ø©', type: 'neutral' }],
        fn: () => {
          const churchBonus = G.tags.has('church_debt') ? 22 : 16;
          apply({church: churchBonus, army:-5, people: 5});
          G.tags.add('public_accusation');
          chronicle('ğŸ“œ', 'Ø§ØªÙ‡Ù… Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ù„Ù†Ø§Ù‹ ÙˆØ§Ù†ØªØ¸Ø± Ø§Ù„Ø¯Ø¹Ù…');
          transition('âš–ï¸', 'Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ­ÙƒÙ…... ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ±Ø§Ù‚Ø¨', () => go('war_council'));
        }
      },
    ]
  },

  war_council: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø« ÙˆÙ†ØµÙ â€” ØºØ±ÙØ© Ø§Ù„Ø­Ø±Ø¨',
    title: 'Ù…Ø¬Ù„Ø³ Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„ÙƒØ¨ÙŠØ±',
    emoji: 'ğŸ—ºï¸',
    color: 'rgba(80,50,10,0.6)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(80,50,10,0.6) 0%, rgba(12,8,3,0.85) 55%, rgba(5,4,3,1) 100%)',
    text: () => {
      const base = `
        Ø£Ø±Ø¨Ø¹Ø© ÙˆØ¬ÙˆÙ‡ ØªØ­Ø¯Ù‘Ù‚ ÙÙŠ Ø®Ø±ÙŠØ·Ø© Ø£Ø±ÙŠÙ‡Ø§Ù† Ø§Ù„Ù…Ù…Ø¯ÙˆØ¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©.
        <span class="char-name">Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø®Ø§Ù„Ø¯</span> ÙŠÙ‚Ø±Ø¹ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø¨Ù‚Ø¨Ø¶ØªÙ‡:
        <span class="whisper">"Ø§Ù„Ø«Ù†Ø¯Ø§Ø± ØªØªØ­Ø±Ùƒ. Ø§Ø³ØªØ®Ø¨Ø§Ø±Ø§ØªÙ†Ø§ ØªØ¤ÙƒØ¯ Ø«Ù„Ø§Ø«ÙŠÙ† Ø£Ù„ÙØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯."</span>
        <br><br>
        <span class="char-name">Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©</span> ØªØ±Ø³Ù… Ø¯ÙˆØ§Ø¦Ø± Ø¨Ø¥ØµØ¨Ø¹Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©:
        <span class="whisper">"Ø§Ù„Ø­Ø±Ø¨ Ù„ÙŠØ³Øª Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„ÙˆØ­ÙŠØ¯ â€” Ù‡Ù… ÙŠØ±ÙŠØ¯ÙˆÙ† Ù…Ù…Ø±Ø§Ù‹ ØªØ¬Ø§Ø±ÙŠØ§Ù‹ØŒ Ù„Ø§ Ø£Ø±Ø¶Ø§Ù‹."</span>
        <br><br>
        <span class="char-name">Ø²ÙŠØ¯ Ø§Ù„ÙˆÙ‚ÙˆØ±</span> ÙŠØµÙ…Øª Ø·ÙˆÙŠÙ„Ø§Ù‹ Ø«Ù… ÙŠØ±ÙØ¹ Ø±Ø£Ø³Ù‡:
        <span class="whisper">"Ø¬Ù„Ø§Ù„ØªÙƒØŒ Ø§Ù„Ø¬ÙŠØ´ ÙŠØ­ØªØ§Ø¬ Ø£Ø³Ø¨ÙˆØ¹Ø§Ù‹ Ù„Ù„Ø­Ø´Ø¯. Ø§Ø´ØªØ±Ù Ø§Ù„ÙˆÙ‚Øª."</span>
        <br><br>
      `;
      if (G.tags.has('diplomacy_rebel')) return base + `<span class="char-name">Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù†</span> ÙŠÙ‚Ù ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ù‡Ø§Ø¯Ø¦Ø§Ù‹. Ø­ÙŠÙ† ØªÙ„ØªÙ‚ÙŠ Ø¹ÙŠÙ†Ø§ÙƒÙ…Ø§ ÙŠÙˆÙ…Ø¦ Ø¨Ø±Ø£Ø³Ù‡ â€” <span class="good-word">Ø¬Ù†ÙˆØ¯Ù‡ ÙÙŠ Ø·Ø±ÙŠÙ‚Ù‡Ù….</span>`;
      if (G.tags.has('crushed_rebel')) return base + `Ø§Ù„Ø§Ù†ØªØµØ§Ø± Ø§Ù„Ø£Ø®ÙŠØ± Ù…Ù†Ø­ Ø¬ÙŠØ´Ùƒ <span class="good-word">Ø«Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©</span>ØŒ Ù„ÙƒÙ† Ø·Ø§Ø±Ù‚ ÙŠØ­Ø°Ø±: <span class="whisper">"Ø§Ù„Ø«Ù†Ø¯Ø§Ø± ØªØ¹Ù„Ù‘Ù…Øª Ù…Ù† Ø£Ø®Ø·Ø§Ø¦Ù‡Ø§."</span>`;
      if (G.tags.has('army_debt')) return base + `<span class="dramatic">ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ©ØŒ Ø«Ù„Ø§Ø«Ø© Ù‚Ø§Ø¯Ø© ÙŠØªÙ‡Ø§Ù…Ø³ÙˆÙ†.</span> Ø·Ø§Ø±Ù‚ ÙŠÙØ¹Ù„Ù…Ùƒ Ø¨Ø¹ÙŠÙˆÙ† Ù‚Ù„Ù‚Ø©: <span class="whisper">"Ø§Ù„ÙˆØ¹Ø¯ Ù„Ù… ÙŠÙÙˆÙÙ Ø¨Ø¹Ø¯ØŒ Ø¬Ù„Ø§Ù„ØªÙƒ."</span>`;
      return base + `Ø§Ù„Ù…Ø¬Ù„Ø³ ÙŠÙ†ØªØ¸Ø±. Ø§Ù„Ù‚Ø±Ø§Ø± Ù„Ùƒ ÙˆØ­Ø¯Ùƒ.`;
    },
    memory: () => G.tags.has('diplomacy_rebel') ? 'ğŸ¤ Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù† Ø­Ù„ÙŠÙ Ø¨Ø¬Ù†ÙˆØ¯Ù‡ Ø§Ù„Ø¢Ù†' :
                  G.tags.has('army_debt') ? 'âš ï¸ Ø§Ù„Ù‚Ø§Ø¯Ø© ÙŠØªØ°ÙƒØ±ÙˆÙ† Ø§Ù„ÙˆØ¹Ø¯ â€” Ø§Ù„ÙˆÙ„Ø§Ø¡ Ù…ØªØ²Ø¹Ø²Ø¹' :
                  G.tags.has('crushed_rebel') ? 'âš”ï¸ Ø§Ù†ØªØµØ§Ø±Ùƒ Ø§Ù„Ø£Ø®ÙŠØ± Ø¹Ø²Ù‘Ø² Ù…ÙƒØ§Ù†ØªÙƒ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©' : 'ğŸ—ºï¸ Ù…Ø¬Ù„Ø³ Ø§Ù„Ø­Ø±Ø¨ ÙŠØªØ´Ø§ÙˆØ±',
    choices: [
      {
        emoji: 'ğŸ—¡ï¸', text: 'ØµØ§Ø¯Ù‚ Ø¹Ù„Ù‰ Ø®Ø·Ø© Ø·Ø§Ø±Ù‚ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ© â€” Ø§Ù„Ø­Ø±Ø¨ Ù…Ø¹ Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ù„Ø§ Ù…ÙØ± Ù…Ù†Ù‡Ø§',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +14', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +6', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’8', type: 'down' }],
        fn: () => {
          apply({army:14, nobles:6, people:-8});
          G.tags.add('council_war');
          chronicle('ğŸ—¡ï¸', 'ØµØ§Ø¯Ù‚ Ø¹Ù„Ù‰ Ø®Ø·Ø© Ø§Ù„Ø­Ø±Ø¨ ÙÙŠ Ù…Ø¬Ù„Ø³ Ø§Ù„ÙˆØ²Ø±Ø§Ø¡');
          transition('âš”ï¸', 'ØºØ±ÙØ© Ø§Ù„Ø­Ø±Ø¨ Ù‚Ø±Ø±Øª... Ø§Ù„Ø®Ø·Ø© Ø¨Ø¯Ø£Øª', () => go('invasion'));
        }
      },
      {
        emoji: 'ğŸ•Šï¸', text: 'ØªØ¨Ù†Ù‘ Ø±Ø£ÙŠ Ù„ÙŠÙ„Ù‰ â€” Ø£Ø±Ø³Ù„ Ù…Ø¨Ø¹ÙˆØ«Ø§Ù‹ Ù„ÙÙ‡Ù… Ù…Ø·Ø§Ù„Ø¨ Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +14', type: 'up' }, { label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +8', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’6', type: 'down' }],
        fn: () => {
          apply({people:14, church:8, army:-6});
          G.tags.add('council_diplomacy');
          G.tags.add('sent_envoy');
          chronicle('ğŸ•Šï¸', 'Ø£Ø±Ø³Ù„ Ù…Ø¨Ø¹ÙˆØ«Ø§Ù‹ Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ§Ù‹ Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø«Ù†Ø¯Ø§Ø±');
          checkAchievement('master_diplomat', 'ğŸŒ', 'Ø³ÙŠØ¯ Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ©');
          transition('ğŸ“œ', 'Ø§Ù„Ù…Ø¨Ø¹ÙˆØ« ÙŠØªØ­Ø±Ùƒ... ÙˆØ§Ù„Ø«Ù†Ø¯Ø§Ø± ØªØªÙˆÙ‚Ù Ù…Ø¤Ù‚ØªØ§Ù‹', () => go('invasion'));
        }
      },
      {
        emoji: 'ğŸ’°', text: 'ØªØ¨Ù†Ù‘ Ø±Ø£ÙŠ Ø²ÙŠØ¯ â€” Ø§Ø´ØªØ±Ù Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ù…Ø§Ù„ Ø«Ù… Ù‚Ø±Ø±',
        sub: [{ label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’8', type: 'down' }, { label: 'ÙˆÙ‚Øª Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„ØªØ­Ø¶ÙŠØ±', type: 'neutral' }],
        fn: () => {
          apply({church:10, nobles:-8, army:8});
          G.tags.add('council_delay');
          G.tags.add('bought_time');
          chronicle('ğŸ’°', 'Ø§Ø´ØªØ±Ù‰ ÙˆÙ‚ØªØ§Ù‹ Ø¨Ø§Ù„Ø°Ù‡Ø¨ Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¬ÙŠØ´');
          transition('â³', 'Ø§Ù„Ø°Ù‡Ø¨ ÙŠØ´ØªØ±ÙŠ Ø§Ù„ÙˆÙ‚Øª... Ø§Ù„Ø¬ÙŠØ´ ÙŠØªØ­Ø´Ø¯', () => go('invasion'));
        }
      },
    ]
  },

  invasion: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø±Ø§Ø¨Ø¹ â€” Ø§Ù„ØºØ²Ùˆ',
    title: 'Ø£Ø³ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ ØªØ²Ø­Ù',
    emoji: 'ğŸº',
    color: 'rgba(60,20,80,0.6)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(60,20,80,0.6) 0%, rgba(10,5,15,0.8) 55%, rgba(5,4,3,1) 100%)',
    text: () => {
      const base = `
        Ø«Ù„Ø§Ø«ÙˆÙ† Ø£Ù„Ù Ø¬Ù†Ø¯ÙŠ Ù…Ù† <span class="char-name">Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©</span> ÙŠØ¹Ø¨Ø±ÙˆÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯.
        Ù‚Ø§Ø¦Ø¯Ù‡Ù… <span class="char-name">Ø§Ù„Ø¬Ù†Ø±Ø§Ù„ Ø«ÙˆØ±ÙÙŠÙ†</span> ÙŠÙØ±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø©:
        <span class="whisper"><span class="dramatic">"Ø§Ø³ØªØ³Ù„Ù…ÙˆØ§ Ø£Ùˆ Ù†Ø­Ø±Ù‚ Ø§Ù„Ù‚Ø±Ù‰ ÙˆØ§Ø­Ø¯Ø© ØªÙ„Ùˆ Ø§Ù„Ø£Ø®Ø±Ù‰."</span></span>
        <br><br>
        Ù…Ø¬Ù„Ø³ Ø§Ù„Ø­Ø±Ø¨ ÙŠÙ†Ø¹Ù‚Ø¯ ÙÙŠ ØºØ±ÙØ© ÙŠÙ…Ù„Ø¤Ù‡Ø§ Ø§Ù„Ø¯Ø®Ø§Ù† ÙˆØ§Ù„Ø®ÙˆÙ.
        <br><br>
      `;
      if (G.tags.has('sent_envoy')) return base + `<span class="good-word">Ù…Ø¨Ø¹ÙˆØ«Ùƒ Ø¹Ø§Ø¯ Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø«Ù…ÙŠÙ†Ø©:</span> Ø§Ù„Ø«Ù†Ø¯Ø§Ø± ØªØ±ÙŠØ¯ Ø§Ù„Ù…Ù…Ø± Ø§Ù„ØªØ¬Ø§Ø±ÙŠ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ ÙÙ‚Ø· â€” Ù„ÙŠØ³ Ø§Ù„Ø£Ø±Ø¶ ÙƒÙ„Ù‡Ø§. <span class="char-name">Ø·Ø§Ø±Ù‚</span> ÙŠØ±Ù‰ ÙØ±ØµØ©.`;
      if (G.tags.has('bought_time')) return base + `<span class="good-word">Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø§Ù„Ø°ÙŠ Ø§Ø´ØªØ±ÙŠØªÙ‡</span> Ø¬Ø¹Ù„ Ø§Ù„Ø¬ÙŠØ´ Ø£ÙƒØ«Ø± Ø§Ø³ØªØ¹Ø¯Ø§Ø¯Ø§Ù‹. Ø§Ù„Ø®Ø·Ø· ÙˆÙØ¶Ø¹ØªØŒ ÙˆØ§Ù„Ù…Ø¤Ù† Ø¬ÙÙ…Ø¹Øª.`;
      if (G.tags.has('council_war')) return base + `Ø®Ø·Ø© Ø·Ø§Ø±Ù‚ Ø¬Ø§Ù‡Ø²Ø©. Ø§Ù„Ø¬Ù†ÙˆØ¯ ÙŠØ¹Ø±ÙÙˆÙ† Ù…ÙˆØ§Ù‚Ø¹Ù‡Ù…. <span class="good-word">Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ÙÙŠ ÙŠØ¯Ùƒ.</span>`;
      if (G.tags.has('crushed_rebel') && G.tags.has('dug_canals')) return base + `Ø¬ÙŠØ´Ùƒ <span class="good-word">Ù…ÙˆØ­Ù‘Ø¯ ÙˆÙ…ÙˆØ±Ø§Ù„ÙŠ Ù…Ø±ØªÙØ¹</span>ØŒ ÙˆÙ‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙŠ ØªØ¶Ù…Ù† Ù…Ø¤Ù† Ø§Ù„Ù…Ø¯Ù†.`;
      if (G.tags.has('diplomacy_rebel')) return base + `<span class="char-name">Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù†</span> ÙŠÙØ¹Ø±Ø¶ Ø¹Ù„ÙŠÙƒ Ø¬Ù†ÙˆØ¯Ù‡ â€” Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ© Ø£Ø«Ù…Ø±Øª!`;
      if (G.tags.has('army_debt')) return base + `<span class="dramatic">Ø¨Ø¹Ø¶ Ù‚Ø§Ø¯Ø© Ø§Ù„Ø¬ÙŠØ´ ÙŠØªØ°Ù…Ø±ÙˆÙ† Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù</span> â€” Ø§Ù„ÙˆØ¹Ø¯ Ù„Ù… ÙŠÙÙˆÙÙ Ø¨Ø¹Ø¯.`;
      return base + `Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø­ØªÙ…ÙŠØ©... ÙƒÙŠÙ ØªØ®ÙˆØ¶Ù‡Ø§ØŸ`;
    },
    memory: () => G.tags.has('diplomacy_rebel') ? 'ğŸ¤ Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù† Ø§Ù„Ø¢Ù† Ø­Ù„ÙŠÙÙƒ' :
                  G.tags.has('crushed_rebel') ? 'âš”ï¸ Ø¬ÙŠØ´Ùƒ Ù…Ø­Ø§Ø±Ø¨ ÙˆÙ…Ù†ØªØµØ± Ù…Ø³Ø¨Ù‚Ø§Ù‹' :
                  G.tags.has('army_debt') ? 'âš ï¸ Ø§Ù„Ø¬ÙŠØ´ ÙŠØªØ°ÙƒØ± ÙˆØ¹Ø¯Ùƒ ØºÙŠØ± Ø§Ù„Ù…ÙÙˆÙÙ‰' : null,
    choices: [
      {
        emoji: 'ğŸ—¡ï¸', text: () => gT('Ø£Ø®Ø±Ø¬ Ø¨Ù†ÙØ³Ùƒ Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ø¬ÙŠØ´ â€” Ø§Ù„Ù…Ù„Ùƒ ÙŠÙ‚Ø§ØªÙ„!', 'Ø§Ø®Ø±Ø¬ÙŠ Ø¨Ù†ÙØ³Ùƒ Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ø¬ÙŠØ´ â€” Ø§Ù„Ù…Ù„ÙƒØ© ØªÙ‚Ø§ØªÙ„!'),
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +22', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +16', type: 'up' }, { label: 'Ø®Ø·Ø± Ø´Ø®ØµÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ùƒ', type: 'neutral' }],
        fn: () => {
          const bonus = G.tags.has('diplomacy_rebel') ? 12 : 0;
          apply({army:22+bonus, people:16, nobles:6});
          G.tags.add('led_battle');
          chronicle('ğŸ—¡ï¸', 'Ù‚Ø§Ø¯ Ø§Ù„Ø¬ÙŠØ´ Ø´Ø®ØµÙŠØ§Ù‹ ÙÙŠ Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø«Ù†Ø¯Ø§Ø±');
          checkAchievement('king_of_warriors', 'âš”ï¸', 'Ù…Ù„Ùƒ Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ÙŠÙ†');
          transition('âš”ï¸', gT('Ø§Ù„Ù…Ù„Ùƒ ÙŠÙ‚Ø§ØªÙ„! Ù…Ø¹Ù†ÙˆÙŠØ§Øª Ø§Ù„Ø¬Ù†Ø¯ ØªØ­Ù„Ù‘Ù‚ Ø¹Ø§Ù„ÙŠØ§Ù‹!', 'Ø§Ù„Ù…Ù„ÙƒØ© ØªÙ‚Ø§ØªÙ„! Ù…Ø¹Ù†ÙˆÙŠØ§Øª Ø§Ù„Ø¬Ù†Ø¯ ØªØ­Ù„Ù‘Ù‚ Ø¹Ø§Ù„ÙŠØ§Ù‹!'), () => go('plague'));
        }
      },
      {
        emoji: 'ğŸ³ï¸', text: 'ØªÙØ§ÙˆØ¶ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„ØªÙ†Ø§Ø²Ù„ Ø¹Ù† Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„Ø­Ø¯ÙˆØ¯',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’18', type: 'down' }, { label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’10', type: 'down' }],
        fn: () => {
          apply({people:10, nobles:-18, church:-5, army:-10});
          G.tags.add('surrendered_land');
          chronicle('ğŸ³ï¸', 'ØªÙ†Ø§Ø²Ù„ Ø¹Ù† Ø£Ø±Ø§Ø¶Ù Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø±Ø¨');
          transition('ğŸ“œ', 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¬Ø§Ø¡... Ø¨Ø«Ù…Ù† ÙŠØ¬Ø±Ø­ Ø§Ù„ÙƒØ¨Ø±ÙŠØ§Ø¡', () => go('plague'));
        }
      },
      {
        emoji: 'ğŸ”¥', text: 'ØªÙƒØªÙŠÙƒ Ø§Ù„Ø£Ø±Ø¶ Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø© â€” Ø£Ø®Ù„Ù Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙƒÙ…ØµÙŠØ¯Ø©',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +16', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’12', type: 'down' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +8', type: 'up' }],
        fn: () => {
          apply({army:16, people:-12, nobles:8});
          G.tags.add('scorched_earth');
          chronicle('ğŸ”¥', 'Ø­Ø±Ù‚ Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙƒÙ…ØµÙŠØ¯Ø© Ù„Ù„ØºØ²Ø§Ø©');
          transition('ğŸŒ‘', 'Ø§Ù„ØºØ²Ø§Ø© ØªØ±Ø§Ø¬Ø¹ÙˆØ§... Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ÙŠØ© Ø¯ÙÙ…Ù‘Ø±Øª', () => go('plague'));
        }
      },
    ]
  },

  plague: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø®Ø§Ù…Ø³ â€” Ø§Ù„Ø·Ø§Ø¹ÙˆÙ† Ø§Ù„Ø£Ø³ÙˆØ¯',
    title: 'Ø§Ù„Ù…ÙˆØª ÙŠØ·Ø±Ù‚ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨',
    emoji: 'ğŸ’€',
    color: 'rgba(20,40,70,0.7)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(20,40,70,0.7) 0%, rgba(5,8,20,0.8) 55%, rgba(5,4,3,1) 100%)',
    text: () => {
      const base = `
        Ø¬Ù†ÙˆØ¯ Ø¹Ø§Ø¦Ø¯ÙˆÙ† Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø£Ø­Ø¶Ø±ÙˆØ§ Ù…Ø¹Ù‡Ù… ÙˆØ¨Ø§Ø¡Ù‹ Ù„Ø§ ÙŠÙØ±Ù‰.
        <br><br>
        ÙÙŠ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†ØŒ Ø£ÙØºÙ„Ù‚ Ø«Ù„Ø« Ø­ÙˆØ§Ù†ÙŠØª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©. Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ ÙŠØ­Ø±Ù‚ÙˆÙ† Ø§Ù„Ø¬Ø«Ø« Ù„ÙŠÙ„Ø§Ù‹.
        <span class="char-name">Ø§Ù„Ø­ÙƒÙŠÙ… Ø±Ø§Ø´Ø¯</span> ÙŠØ¯Ø¹Ùˆ Ù„Ù…Ø¬Ù„Ø³ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ØŒ Ø£Ù…Ø§ <span class="char-name">Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù…Ù„ÙƒÙŠ ÙƒØ§Ø±Ø§Ø²</span> ÙÙŠÙ‚ÙˆÙ„:
        <span class="whisper">"Ø§Ù„Ø¹Ø²Ù„ Ø§Ù„ØµØ§Ø±Ù… Ù‡Ùˆ Ø§Ù„Ø­Ù„ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø¹Ù„Ù…ÙŠØ§Ù‹ØŒ Ø¬Ù„Ø§Ù„ØªÙƒ."</span>
        <br><br>
      `;
      if (G.tags.has('led_battle')) return base + `<span class="good-word">Ø´Ø¹Ø¨Ùƒ ÙŠØ«Ù‚ Ø¨Ùƒ ØªÙ…Ø§Ù…Ø§Ù‹</span> Ø¨Ø¹Ø¯ Ø£Ù† Ø±Ø£ÙˆÙƒ ØªÙ‚Ø§ØªÙ„ Ù…Ø¹Ù‡Ù… â€” Ù‚Ø±Ø§Ø±Ø§ØªÙƒ Ø³ØªÙØ·Ø§Ø¹ Ø¯ÙˆÙ† ØªØ±Ø¯Ø¯.`;
      if (G.tags.has('scorched_earth')) return base + `<span class="dramatic">Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ÙŠØ© Ø§Ù„Ù…Ø¯Ù…Ø±Ø©</span> ØªØ´ÙƒÙ‘Ù„ Ù…Ù†Ø§Ø·Ù‚ Ø¨Ø§Ø¦Ø³Ø© ÙŠØµØ¹Ø¨ Ø¹Ø²Ù„Ù‡Ø§.`;
      if (G.tags.has('church_debt')) return base + `<span class="char-name">Ø§Ù„Ø­ÙƒÙŠÙ…</span> ÙŠÙØ°ÙƒÙ‘Ø±Ùƒ Ø¨Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙˆÙŠØ±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¶Ù…Ù†ÙŠØ©: <span class="whisper">"Ù†Ø­Ù† Ù‡Ù†Ø§... ÙƒÙ…Ø§ ÙƒÙ†Ø§ Ø¯Ø§Ø¦Ù…Ø§Ù‹."</span>`;
      return base + `${gT('Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ØªÙ†ØªØ¸Ø± Ù‚Ø±Ø§Ø±Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„Ùƒ.', 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ØªÙ†ØªØ¸Ø± Ù‚Ø±Ø§Ø±Ùƒ Ø£ÙŠØªÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØ©.')}`;
    },
    memory: () => G.tags.has('church_debt') ? 'ğŸ“œ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠÙ†ØªØ¸Ø±ÙˆÙ† Ù…Ù‚Ø§Ø¨Ù„ Ù…Ø³Ø§Ø¹Ø¯ØªÙ‡Ù…' :
                  G.tags.has('led_battle') ? 'ğŸ’š Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ«Ù‚ Ø¨Ù‚ÙŠØ§Ø¯ØªÙƒ Ø¨Ù„Ø§ ØªØ­ÙØ¸' :
                  G.tags.has('scorched_earth') ? 'âš ï¸ Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ù…Ø¯Ù…Ø±Ø© ØªØ²ÙŠØ¯ Ø§Ù„Ø£Ù…Ø± ØªØ¹Ù‚ÙŠØ¯Ø§Ù‹' : null,
    choices: [
      {
        emoji: 'ğŸš§', text: 'Ø¹Ø²Ù„ ØªØ§Ù… Ù„Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØµØ§Ø¨Ø© Ø­ØªÙ‰ Ù„Ùˆ Ø£Ø¶Ø±Ù‘ Ø¨Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯',
        sub: [{ label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’22', type: 'down' }, { label: '+Ø§Ù„Ø¬ÙŠØ´ +6', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +12', type: 'up' }],
        fn: () => {
          apply({people:-22, army:6, nobles:12});
          G.tags.add('isolated');
          chronicle('ğŸš§', 'Ø¹Ø²Ù„ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØµØ§Ø¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„');
          transition('ğŸŒ‘', 'Ø§Ù„ÙˆØ¨Ø§Ø¡ ÙŠØªØ±Ø§Ø¬Ø¹... Ù„ÙƒÙ† Ø¬Ø±Ø­ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø¹Ù…ÙŠÙ‚', () => triggerRandomEvent(() => go('treasury_dilemma')));
        }
      },
      {
        emoji: 'â¤ï¸', text: 'ÙƒÙ„ Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ù„Ù„Ø¹Ù„Ø§Ø¬ â€” Ù„Ù† ÙŠÙ…ÙˆØª Ø£Ø­Ø¯ ÙˆØ­ÙŠØ¯Ø§Ù‹',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +28', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’12', type: 'down' }, { label: 'âˆ’Ø®Ø²ÙŠÙ†Ø© ÙƒØ¨ÙŠØ±', type: 'down' }],
        fn: () => {
          apply({people:28, nobles:-12, church:10});
          G.tags.add('healed_all');
          G.tags.add('treasury_empty');
          chronicle('â¤ï¸', 'ØµØ±Ù Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù…Ø±Ø¶Ù‰');
          checkAchievement('heart_of_gold', 'â¤ï¸', 'Ù‚Ù„Ø¨ Ù…Ù† Ø°Ù‡Ø¨');
          transition('â¤ï¸', 'Ù„Ø§ Ø£Ø­Ø¯ Ù…Ø§Øª ÙˆØ­ÙŠØ¯Ø§Ù‹... Ù‡Ø°Ø§ Ù„Ù† ÙŠÙÙ†Ø³Ù‰', () => triggerRandomEvent(() => go('treasury_dilemma')));
        }
      },
      {
        emoji: 'ğŸ“œ', text: 'Ø£ÙÙˆÙƒÙ„ Ù„Ù„Ø¹Ù„Ù…Ø§Ø¡ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø²Ù…Ø© Ù…Ù‚Ø§Ø¨Ù„ Ù…Ù†Ø­ Ø£ÙˆØ³Ø¹',
        sub: [{ label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +22', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +10', type: 'up' }, { label: 'âˆ’Ø³Ù„Ø·Ø© Ø§Ù„Ù…Ù„Ùƒ', type: 'down' }],
        fn: () => {
          const churchMod = G.tags.has('church_debt') ? 28 : 22;
          apply({church: churchMod, people:10, nobles:-5});
          G.tags.add('church_led');
          chronicle('ğŸ“œ', 'Ø£ÙˆÙƒÙ„ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ¨Ø§Ø¡ Ù…Ù‚Ø§Ø¨Ù„ Ù…Ù†Ø­');
          transition('ğŸ–‹ï¸', 'Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠÙØ¯ÙŠØ±ÙˆÙ† Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©... ÙˆØ§Ù„Ù…Ù„Ùƒ ÙŠØ±Ø§Ù‚Ø¨', () => triggerRandomEvent(() => go('treasury_dilemma')));
        }
      },
    ]
  },

  treasury_dilemma: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø®Ø§Ù…Ø³ ÙˆÙ†ØµÙ â€” ÙˆØ²Ù† Ø§Ù„Ø°Ù‡Ø¨',
    title: 'Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ØªÙØ­ØªØ¶Ø±',
    emoji: 'âš–ï¸',
    color: 'rgba(90,60,10,0.65)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(90,60,10,0.65) 0%, rgba(12,8,3,0.85) 55%, rgba(5,4,3,1) 100%)',
    text: () => {
      const base = `
        <span class="char-name">Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ</span>ØŒ Ø£ÙƒØ¨Ø± ØªØ¬Ø§Ø± Ø§Ù„Ù…Ù…Ù„ÙƒØ©ØŒ ÙŠØ·Ù„Ø¨ Ù…Ù‚Ø§Ø¨Ù„Ø© Ø¹Ø§Ø¬Ù„Ø©.
        ÙŠØ¬Ù„Ø³ Ø£Ù…Ø§Ù…Ùƒ ÙˆÙŠØ¶Ø¹ Ø¯ÙØªØ±Ø§Ù‹ Ø¶Ø®Ù…Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© â€” Ø£Ø±Ù‚Ø§Ù… ÙˆØ£Ø±Ù‚Ø§Ù… ÙˆØ£Ø±Ù‚Ø§Ù….
        <br><br>
        <span class="whisper">"Ø¬Ù„Ø§Ù„ØªÙƒØŒ Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ØªÙƒÙÙŠ Ù„Ø«Ù„Ø§Ø«Ø© Ø£Ø´Ù‡Ø±. Ø¨Ø¹Ø¯Ù‡Ø§ Ù„Ù† Ù†Ø³ØªØ·ÙŠØ¹ Ø¯ÙØ¹ Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø¬ÙŠØ´."</span>
        <br><br>
      `;
      if (G.tags.has('treasury_empty')) return base + `<span class="dramatic">Ø§Ù„ÙˆØ¨Ø§Ø¡ Ø§Ø³ØªÙ†Ø²Ù Ø¢Ø®Ø± Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ§Øª.</span> Ø¬Ø§Ø¨Ø± ÙŠÙØ±Ø¯Ù: <span class="whisper">"Ø§Ù„ÙˆØ¶Ø¹ Ø£Ø³ÙˆØ£ Ù…Ù…Ø§ ÙƒÙ†Øª Ø£ØªÙˆÙ‚Ø¹ØŒ Ø¬Ù„Ø§Ù„ØªÙƒ."</span>`;
      if (G.tags.has('healed_all')) return base + `Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ¹Ø±Ù ØªØ¶Ø­ÙŠØªÙƒ ÙˆÙŠØ¯Ø¹ÙˆÙƒ Ø¨Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„ØµØ§Ù„Ø­ â€” <span class="good-word">Ù„ÙƒÙ† Ø§Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…ÙÙ„Ø³ Ù„Ø§ ÙŠØ­ÙƒÙ… Ø·ÙˆÙŠÙ„Ø§Ù‹.</span>`;
      if (G.tags.has('bought_grain')) return base + `Ø´Ø±Ø§Ø¡ Ø§Ù„Ø­Ø¨ÙˆØ¨ Ù…Ù† Ø§Ù„Ø´Ù…Ø§Ù„ Ø£ÙØ±Øº Ø§Ø­ØªÙŠØ§Ø·ÙŠØ§Ù‹ Ù„Ù… ÙŠÙØ³ØªØ±Ø¬Ø¹ Ø¨Ø¹Ø¯. Ø¬Ø§Ø¨Ø± Ù„Ø§ ÙŠÙØ®ÙÙŠ Ù‚Ù„Ù‚Ù‡.`;
      return base + `Ø§Ù„Ø£Ø²Ù…Ø© Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© Ù„Ù… ØªÙƒÙ† Ù…ÙØ§Ø¬Ø£Ø© â€” Ù„ÙƒÙ† Ø­Ø¬Ù…Ù‡Ø§ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠÙØµØ¯Ù….`;
    },
    memory: () => G.tags.has('treasury_empty') ? 'ğŸ’¸ Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ø´Ø¨Ù‡ ÙØ§Ø±ØºØ© Ø¨Ø¹Ø¯ Ø¹Ù„Ø§Ø¬ Ø§Ù„ÙˆØ¨Ø§Ø¡' :
                  G.tags.has('church_debt') ? 'ğŸ“œ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ø£Ù‚Ø±Ø¶ÙˆÙƒ Ù‚Ø¨Ù„Ø§Ù‹ â€” Ù‡Ù„ ÙŠÙØ¹Ù„ÙˆÙ†Ù‡Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ØŸ' :
                  'âš–ï¸ Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ ÙŠØ¹Ø±Ù Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙƒÙ„Ù‡Ø§',
    choices: [
      {
        emoji: 'ğŸ’', text: 'Ø§Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø¬Ø§Ø¨Ø± Ø§Ù…ØªÙŠØ§Ø²Ø§Øª ØªØ¬Ø§Ø±ÙŠØ© Ù…Ù‚Ø§Ø¨Ù„ Ù‚Ø±Ø¶ Ø·Ø§Ø±Ø¦',
        sub: [{ label: '+Treasury', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’8', type: 'down' }],
        fn: () => {
          apply({nobles:10, people:-8, army:5});
          G.tags.add('yusuf_deal');
          chronicle('ğŸ’', 'Ø¹Ù‚Ø¯ ØµÙÙ‚Ø© Ù…Ø¹ Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ Ù…Ù‚Ø§Ø¨Ù„ Ù‚Ø±Ø¶ ÙˆØ§Ù…ØªÙŠØ§Ø²Ø§Øª');
          transition('ğŸ’°', 'Ø§Ù„Ø°Ù‡Ø¨ ÙŠØªØ¯ÙÙ‚... Ù„ÙƒÙ† Ø¬Ø§Ø¨Ø± Ø£ØµØ¨Ø­ Ø´Ø±ÙŠÙƒØ§Ù‹ Ù„Ø§ ØªØ§Ø¬Ø±Ø§Ù‹', () => go('betrayal'));
        }
      },
      {
        emoji: 'ğŸ“œ', text: 'Ø§ÙØ±Ø¶ Ø¶Ø±ÙŠØ¨Ø© Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ© Ø¹Ù„Ù‰ ÙƒØ¨Ø§Ø± Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙˆØ§Ù„ØªØ¬Ø§Ø±',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +12', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’22', type: 'down' }, { label: '+Treasury', type: 'up' }],
        fn: () => {
          apply({people:12, nobles:-22, church:5});
          G.tags.add('emergency_tax');
          chronicle('ğŸ“œ', 'ÙØ±Ø¶ Ø¶Ø±ÙŠØ¨Ø© Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø«Ø±ÙŠØ§Ø¡ Ù„Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø®Ø²ÙŠÙ†Ø©');
          transition('âš–ï¸', 'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØºÙ„ÙˆÙ† ØºØ¶Ø¨Ø§Ù‹... Ù„ÙƒÙ† Ø§Ù„Ø¯ÙˆÙ„Ø© ØªØªÙ†ÙØ³', () => go('betrayal'));
        }
      },
      {
        emoji: 'ğŸ›ï¸', text: 'Ø¨Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„Ù…Ù„ÙƒÙŠØ© â€” Ø§Ù„ØªØ¶Ø­ÙŠØ© ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ù‚ØµØ±',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +18', type: 'up' }, { label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +8', type: 'up' }, { label: 'âˆ’Ù…Ù…ØªÙ„ÙƒØ§Øª Ù…Ù„ÙƒÙŠØ©', type: 'down' }],
        fn: () => {
          apply({people:18, church:8, army:-5});
          G.tags.add('sold_lands');
          G.tags.add('king_sacrifice');
          chronicle('ğŸ›ï¸', 'Ø¨Ø§Ø¹ Ø£Ø±Ø§Ø¶ÙŠ Ù…Ù„ÙƒÙŠØ© Ù„Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø®Ø²ÙŠÙ†Ø©');
          checkAchievement('sacrifice_king', 'ğŸ›ï¸', '');
          transition('ğŸŒ…', gT('Ø§Ù„Ø´Ø¹Ø¨ ØµÙØ¯Ù…... Ø«Ù… Ø¨ÙƒÙ‰. Ø§Ù„Ù…Ù„Ùƒ ÙŠØ¶Ø­ÙŠ Ø¨Ù†ÙØ³Ù‡', 'Ø§Ù„Ø´Ø¹Ø¨ ØµÙØ¯Ù…... Ø«Ù… Ø¨ÙƒÙ‰. Ø§Ù„Ù…Ù„ÙƒØ© ØªØ¶Ø­ÙŠ Ø¨Ù†ÙØ³Ù‡Ø§'), () => go('betrayal'));
        }
      },
    ]
  },

  betrayal: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø³Ø§Ø¯Ø³ â€” Ø§Ù„Ø®Ù†Ø¬Ø± Ù…Ù† Ø§Ù„Ø¸Ù‡Ø±',
    title: 'Ø®ÙŠØ§Ù†Ø© Ù…Ø±ÙˆØ§Ù† Ø§Ù„Ø¯Ø§Ù‡ÙŠØ©',
    emoji: 'ğŸ—¡ï¸',
    color: 'rgba(80,8,8,0.8)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(80,8,8,0.8) 0%, rgba(15,3,3,0.8) 55%, rgba(5,4,3,1) 100%)',
    text: () => {
      const ngKnows = G.tags.has('ng_knows_murder')
        ? `<div class="ng-scene-tag">âœ¦ NG+ â€” Ø£Ù†Øª ØªØ¹Ø±Ù Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ÙŠØ¸Ù†ÙˆÙ†</div>
           <span class="good-word">Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ… ÙˆÙ„ÙŠÙ„Ù‰ Ø£Ø¹Ø·Ø§Ùƒ Ø§Ù„Ø³Ø¨Ù‚.</span>
           Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ø§ ØªÙØ§Ø¬Ø¦Ùƒ. Ù…Ø±ÙˆØ§Ù† Ù„Ø§ ÙŠØ¹Ù„Ù… Ø£Ù†Ùƒ ØªØ¹Ø±Ù â€”
           <span class="dramatic">ÙˆÙ‡Ø°Ø§ Ø£Ù‚ÙˆÙ‰ Ø³Ù„Ø§Ø­ ÙÙŠ ÙŠØ¯Ùƒ Ø§Ù„Ø¢Ù†.</span><br><br>` : '';
      const base = `${ngKnows}
        ÙÙŠ Ù„ÙŠÙ„Ø© Ø¨Ø§Ø±Ø¯Ø©ØŒ Ø±Ø³Ø§Ù„Ø© Ù…Ø¬Ù‡ÙˆÙ„Ø© ØªØ­Øª ÙˆØ³Ø§Ø¯ØªÙƒ.
        ÙÙŠÙ‡Ø§ Ø£Ø¯Ù„Ø© Ù…ÙÙØµÙ‘Ù„Ø©: <span class="char-name">Ù…Ø±ÙˆØ§Ù† Ø§Ù„Ø¯Ø§Ù‡ÙŠØ©</span>ØŒ ÙˆØ²ÙŠØ±Ùƒ Ù…Ù†Ø° Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ â€”
        Ù‡Ùˆ Ù…Ù† Ø£ÙˆØµÙ‰ Ø£Ø¨Ø§Ùƒ Ø¨Ø§Ù„Ù‚Ø±ÙˆØ¶ Ø§Ù„ØªÙŠ Ø£Ø«Ù‚Ù„Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø©ØŒ
        ÙˆÙ‡Ùˆ Ù…Ù† ÙƒØ§Ù† ÙŠÙØ³Ø±Ù‘Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø«Ù†Ø¯Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„ØºØ²Ùˆ.
        <br><br>
        <span class="whisper">ØµÙˆØª ÙÙŠ Ø±Ø£Ø³Ùƒ: "Ø¥Ù† ØªØµØ±ÙØª Ø¨Ø§Ù†Ø¯ÙØ§Ø¹ØŒ Ø³ØªÙØ­ÙˆÙ‘Ù„ Ù†ØµÙ Ø§Ù„Ø¯ÙŠÙˆØ§Ù† Ø¶Ø¯Ùƒ."</span>
        <br><br>
      `;
      if (G.tags.has('yusuf_deal')) return base + `<span class="dramatic">Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ ÙŠÙØ¨ØªØ³Ù… ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ©</span> â€” ØµÙÙ‚ØªÙƒÙ…Ø§ Ø±Ø¨Ø·ØªÙ‡ Ø¨ÙƒØŒ Ù„ÙƒÙ†Ù‡Ø§ Ø±Ø¨Ø·ØªÙƒ Ø¨Ù‡ Ø£ÙŠØ¶Ø§Ù‹. Ù‡Ù„ Ù‡Ùˆ Ù…ØªÙˆØ±Ø· Ù…Ø¹ Ù…Ø±ÙˆØ§Ù†ØŸ`;
      if (G.tags.has('king_sacrifice')) return base + `<span class="good-word">Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ¹Ø±Ù ØªØ¶Ø­ÙŠØªÙƒ Ø¨Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ.</span> Ù‡Ø°Ø§ Ø§Ù„Ø±ØµÙŠØ¯ Ù‚Ø¯ ÙŠØ­Ù…ÙŠÙƒ Ù…Ù† Ø±Ø¯Ø© Ø§Ù„ÙØ¹Ù„.`;
      if (G.tags.has('diplomacy_rebel')) return base + `<span class="char-name">Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù†</span> Ø­Ù„ÙŠÙÙƒ ÙŠØ¤ÙƒØ¯: <span class="good-word">"Ø±Ø£ÙŠØª Ù…Ø±ÙˆØ§Ù† ÙŠÙ„ØªÙ‚ÙŠ Ø¨Ø¬ÙˆØ§Ø³ÙŠØ³ Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø¨Ø£Ù… Ø¹ÙŠÙ†ÙŠ."</span>`;
      if (G.tags.has('taxed_nobles')) return base + `<span class="dramatic">Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ù„ØºØ§Ø¶Ø¨ÙˆÙ† ÙŠØ¯Ø¹Ù…ÙˆÙ† Ù…Ø±ÙˆØ§Ù† Ø³Ø±Ø§Ù‹</span> â€” ÙŠØ±ÙˆÙ† ÙÙŠÙ‡ Ø­Ù„ÙŠÙØ§Ù‹ Ø¶Ø¯Ùƒ.`;
      return base + `Ø§Ù„Ù‚ØµØ± ÙŠØ­Ø¨Ø³ Ø£Ù†ÙØ§Ø³Ù‡. Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙŠØ±Ø§Ù‚Ø¨ ÙƒÙŠÙ ØªØªØµØ±Ù.`;
    },
    memory: () => G.tags.has('diplomacy_rebel') ? 'ğŸ¤ Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù† Ø´Ø§Ù‡Ø¯ Ø¹ÙŠØ§Ù† Ø¶Ø¯ Ù…Ø±ÙˆØ§Ù†' :
                  G.tags.has('taxed_nobles') ? 'âš ï¸ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø®Ù„Ù Ù…Ø±ÙˆØ§Ù† â€” ØªØµØ±Ù Ø¨Ø­Ø°Ø±' :
                  'ğŸ—¡ï¸ Ù…Ø±ÙˆØ§Ù† ÙƒØ§Ù† Ø£Ù‚Ø±Ø¨ Ø§Ù„Ù†Ø§Ø³ Ø¥Ù„ÙŠÙƒ',
    choices: [
      {
        emoji: 'âš–ï¸', text: 'Ù…Ø­Ø§ÙƒÙ…Ø© Ø¹Ù„Ù†ÙŠØ© â€” Ø§Ù„Ø£Ø¯Ù„Ø© Ø£Ù…Ø§Ù… Ø§Ù„Ø¬Ù…ÙŠØ¹',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +16', type: 'up' }, { label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’18', type: 'down' }],
        fn: () => {
          apply({people:16, church:10, nobles:-18});
          G.tags.add('public_trial');
          chronicle('âš–ï¸', 'Ø­Ø§ÙƒÙ… Ù…Ø±ÙˆØ§Ù† Ø¹Ù„Ù†Ø§Ù‹ Ø£Ù…Ø§Ù… Ø§Ù„Ø´Ø¹Ø¨ ÙˆØ§Ù„ÙØµØ§Ø¦Ù„');
          transition('âš–ï¸', 'Ø§Ù„Ù…Ø­Ø§ÙƒÙ…Ø© ØªÙ‡Ø²Ù‘ Ø£Ø±ÙŠÙ‡Ø§Ù†... Ù„Ø§ Ø´ÙŠØ¡ Ø¨Ø¹Ø¯Ù‡Ø§ ÙƒÙ…Ø§ ÙƒØ§Ù†', () => go('pretender'));
        }
      },
      {
        emoji: 'ğŸŒ‘', text: 'Ø¥Ø¨Ø¹Ø§Ø¯Ù‡ Ø¨Ù‡Ø¯ÙˆØ¡ Ø¨Ù„Ø§ Ø¶Ø¬Ø© â€” Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ù„Ø§ ØªØªØ­Ù…Ù„ ÙØ¶ÙŠØ­Ø©',
        sub: [{ label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +12', type: 'up' }, { label: '+Ø§Ù„Ø¬ÙŠØ´ +5', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’6', type: 'down' }],
        fn: () => {
          apply({nobles:12, army:5, people:-6});
          G.tags.add('silent_exile');
          chronicle('ğŸŒ‘', 'Ø£Ø¨Ø¹Ø¯ Ù…Ø±ÙˆØ§Ù† ÙÙŠ ØµÙ…Øª Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡');
          transition('ğŸŒ™', 'Ù…Ø±ÙˆØ§Ù† ØºØ§Ø¯Ø±... Ù„ÙƒÙ† Ø£Ø³Ø±Ø§Ø±Ù‡ Ø¨Ù‚ÙŠØª ÙÙŠ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†', () => go('pretender'));
        }
      },
      {
        emoji: 'ğŸ¤', text: 'Ù…Ù†Ø­Ù‡ ÙØ±ØµØ© Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø±Ø­Ù…Ø©',
        sub: [{ label: '+Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†Ø§Ø¯Ø±Ø©', type: 'neutral' }, { label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +8', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +5', type: 'up' }],
        fn: () => {
          const bonus = G.tags.has('church_debt') ? 12 : 8;
          apply({church: bonus, people:5, nobles:5});
          G.tags.add('forgave_solomon');
          G.tags.add('solomon_secret');
          chronicle('ğŸ¤', 'Ù…Ù†Ø­ Ù…Ø±ÙˆØ§Ù† ÙØ±ØµØ© Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù ÙˆØ§Ù„Ø±Ø­Ù…Ø©');
          transition('ğŸ•¯ï¸', 'Ù…Ø±ÙˆØ§Ù† Ø¨ÙƒÙ‰... ÙˆØ§Ø¹ØªØ±Ù Ø¨Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ØªÙˆÙ‚Ø¹Øª', () => go('pretender'));
        }
      },
    ]
  },

  pretender: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø³Ø§Ø¨Ø¹ â€” Ø¯Ù… Ø§Ù„Ù…Ù„ÙˆÙƒ',
    title: 'Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø´',
    emoji: 'ğŸ‘‘',
    color: 'rgba(80,55,10,0.7)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(80,55,10,0.7) 0%, rgba(15,10,3,0.8) 55%, rgba(5,4,3,1) 100%)',
    text: () => {
      const base = `
        Ù…Ù† Ø¨Ù„Ø§Ø¯ Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø© ÙŠØµÙ„ Ø´Ø§Ø¨ ÙŠØ¯Ù‘Ø¹ÙŠ Ø£Ù†Ù‡ <span class="dramatic">Ø§Ø¨Ù† Ø£Ø¨ÙŠÙƒ Ù…Ù† Ø²ÙˆØ§Ø¬ Ø³Ø±ÙŠ</span>.
        Ù…Ø¹Ù‡ ÙˆØ«Ø§Ø¦Ù‚ ØªØ¨Ø¯Ùˆ Ø£ØµÙŠÙ„Ø©ØŒ ÙˆØ®Ø§ØªÙ… Ù…Ù„ÙƒÙŠ Ù‚Ø¯ÙŠÙ… Ù„Ù… ÙŠØ±ÙÙ‡ Ø¥Ù„Ø§ Ø§Ù„Ù‚Ù„ÙŠÙ„ÙˆÙ†.
        <br><br>
        <span class="char-name">Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©</span> ØªØ¬Ù„Ø³ Ø£Ù…Ø§Ù…Ùƒ ÙˆØ¹ÙŠÙ†Ø§Ù‡Ø§ Ù‚Ù„Ù‚ØªØ§Ù†:
        <span class="whisper">"Ø¬Ù„Ø§Ù„ØªÙƒØŒ Ø¥Ù† ÙƒØ§Ù† Ø­Ù‚ÙŠÙ‚ÙŠØ§Ù‹ ÙÙ†ØµÙ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø³ØªØªØ¨Ø¹Ù‡. ÙˆØ¥Ù† ÙƒØ§Ù† ÙƒØ§Ø°Ø¨Ø§Ù‹ ÙÙ…Ù† Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„Ù‡ØŸ"</span>
        <br><br>
      `;
      if (G.tags.has('solomon_secret')) return base + `<span class="good-word">Ù…Ø±ÙˆØ§Ù† Ø§Ø¹ØªØ±Ù Ø¨Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©:</span> Ù‡Ø°Ø§ Ø§Ù„Ø´Ø§Ø¨ Ø­Ù‚ÙŠÙ‚ÙŠ â€” Ø£Ø¨ÙˆÙƒ Ø£Ø®Ø¨Ø±Ù‡ Ù‚Ø¨Ù„ Ù…ÙˆØªÙ‡ Ø¨Ø³Ù†ÙˆØ§Øª. <span class="dramatic">Ø£Ø®ÙˆÙƒ ØºÙŠØ± Ø§Ù„Ø´Ø±Ø¹ÙŠ Ø­ÙŠÙ‘.</span>`;
      if (G.tags.has('public_trial')) return base + `Ø¨Ø¹Ø¯ ÙØ¶ÙŠØ­Ø© Ù…Ø±ÙˆØ§Ù†ØŒ <span class="dramatic">Ø§Ù„Ø´Ø¹Ø¨ Ù…Ø³ØªØ¹Ø¯ Ù„ØªØµØ¯ÙŠÙ‚ Ø£ÙŠ Ø§Ø¯Ø¹Ø§Ø¡</span> ÙŠØ²Ø¹Ø²Ø¹ Ø§Ù„Ø¹Ø±Ø´.`;
      if (G.tags.has('crushed_rebel')) return base + `Ù‚ÙˆØªÙƒ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ© ØªÙ‚Ù Ø®Ù„ÙÙƒ â€” Ù„ÙƒÙ† <span class="whisper">Ø§Ù„Ø³ÙŠÙˆÙ Ù„Ø§ ØªÙØ³ÙƒØª Ø§Ù„Ø´Ùƒ.</span>`;
      return base + `Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ù…Ø¯ÙÙˆÙ†Ø©... ÙˆØ¹Ù„ÙŠÙƒ Ø£Ù† ØªÙ‚Ø±Ø±.`;
    },
    memory: () => G.tags.has('solomon_secret') ? 'ğŸ’€ Ù…Ø±ÙˆØ§Ù† ÙƒØ´Ù: Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø£Ø®ÙˆÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ' :
                  G.tags.has('public_trial') ? 'âš–ï¸ Ù…Ø­Ø§ÙƒÙ…Ø© Ù…Ø±ÙˆØ§Ù† Ø²Ø±Ø¹Øª Ø§Ù„Ø´Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù„ÙˆØ¨' :
                  'ğŸ‘‘ Ù…Ù† Ø£Ø±Ø³Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø´Ø§Ø¨ØŸ ÙˆÙ„Ù…Ø§Ø°Ø§ Ø§Ù„Ø¢Ù†ØŸ',
    choices: [
      {
        emoji: 'ğŸ§¬', text: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ù… Ø£Ù…Ø§Ù… Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙˆØ§Ù„Ù†Ø¨Ù„Ø§Ø¡ â€” Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ÙÙˆÙ‚ Ø§Ù„Ø¬Ù…ÙŠØ¹',
        sub: [{ label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +16', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +10', type: 'up' }, { label: 'Ø§Ù„Ø­Ù‚ Ø³ÙŠÙÙƒØ´Ù', type: 'neutral' }],
        fn: () => {
          const isReal = G.tags.has('solomon_secret');
          if (isReal) {
            apply({people:10, church:16, nobles:-10});
            G.tags.add('brother_revealed');
            chronicle('ğŸ§¬', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ù… ÙƒØ´Ù: Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø£Ø® Ø­Ù‚ÙŠÙ‚ÙŠ');
            checkAchievement('truth_seeker', 'ğŸ”', 'Ø·Ø§Ù„Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©');
            transition('ğŸ˜±', 'Ø§Ù„ØµØ¯Ù…Ø© ØªØ³Ø±ÙŠ ÙÙŠ Ø§Ù„Ù‚ØµØ±... Ø£Ø®ÙˆÙƒ Ø­ÙŠÙ‘!', () => go('legacy'));
          } else {
            apply({people:10, church:16, nobles:12});
            G.tags.add('pretender_exposed');
            chronicle('ğŸ§¬', 'ÙØ¶Ø­ Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø§Ù„ÙƒØ§Ø°Ø¨ Ø£Ù…Ø§Ù… Ø§Ù„Ø¬Ù…ÙŠØ¹');
            checkAchievement('truth_seeker', 'ğŸ”', 'Ø·Ø§Ù„Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©');
            transition('ğŸ¯', 'Ø§Ù„Ù…Ø­ØªØ§Ù„ Ø§Ù†ÙƒØ´Ù! Ø§Ù„Ø¹Ø±Ø´ Ù„Ùƒ ÙˆØ­Ø¯Ùƒ!', () => go('legacy'));
          }
        }
      },
      {
        emoji: 'âš”ï¸', text: 'Ø§Ø¹ØªÙ‚Ù„Ù‡ ÙÙˆØ±Ø§Ù‹ â€” Ù…Ù† ÙŠØ´ÙƒÙ‘Ùƒ ÙÙŠ Ø§Ù„Ù…Ù„Ùƒ ÙŠØ³ØªØ­Ù‚ Ø§Ù„Ø²Ù†Ø²Ø§Ù†Ø©',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +12', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’22', type: 'down' }, { label: 'âˆ’Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ âˆ’12', type: 'down' }],
        fn: () => {
          apply({army:12, people:-22, church:-12});
          G.tags.add('imprisoned_pretender');
          chronicle('âš”ï¸', 'Ø³Ø¬Ù† Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø¯ÙˆÙ† Ù…Ø­Ø§ÙƒÙ…Ø© Ø¹Ù„Ù†ÙŠØ©');
          transition('ğŸ”’', 'Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† ØªØ¨ØªÙ„Ø¹Ù‡... ÙˆØ§Ù„Ø´Ø§Ø¦Ø¹Ø§Øª ØªØ¨Ù‚Ù‰ Ø­Ø±Ø©', () => go('legacy'));
        }
      },
      {
        emoji: 'ğŸ•Šï¸', text: 'Ø§Ø¹ØªØ±Ù Ø¨Ù‡ Ø£Ø®Ø§Ù‹ ÙˆØ§Ù…Ù†Ø­Ù‡ Ù„Ù‚Ø¨Ø§Ù‹ Ø´Ø±ÙÙŠØ§Ù‹ â€” Ø£Ù‚Ø±Ø¨ Ø§Ù„Ø¹Ø¯Ùˆ',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +22', type: 'up' }, { label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’6', type: 'down' }],
        fn: () => {
          apply({people:22, church:10, nobles:-6, army:5});
          G.tags.add('adopted_brother');
          chronicle('ğŸ•Šï¸', 'Ø§Ø¹ØªØ±Ù Ø¨Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø£Ø®Ø§Ù‹ ÙˆÙ…Ù†Ø­Ù‡ Ù„Ù‚Ø¨Ø§Ù‹ Ø´Ø±ÙÙŠØ§Ù‹');
          checkAchievement('merciful_king', 'ğŸ•Šï¸', 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø±Ø­ÙŠÙ…');
          transition('ğŸ‘‘', 'Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ­Ø¨Ù‘ Ø§Ù„Ø±Ø­Ù…Ø©... ÙˆØ§Ù„Ø£Ø® ÙŠØ¨ØªØ³Ù… Ø¨Ø¹ÙŠÙˆÙ† Ø¨Ø§Ø±Ø¯Ø©', () => go('legacy'));
        }
      },
    ]
  },

  // â”€â”€ Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø§Ù„Ø²ÙˆØ§Ø¬ Ø§Ù„Ø³ÙŠØ§Ø³ÙŠ â”€â”€
  political_marriage: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù…Ù† â€” ÙˆØµÙ…Ø© Ø§Ù„Ø¯Ù…',
    title: 'ÙˆØµÙ…Ø© Ø§Ù„ØªØ­Ø§Ù„Ù',
    emoji: 'ğŸ’',
    color: 'rgba(60,40,80,0.6)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(60,40,80,0.6) 0%, rgba(10,5,15,0.8) 55%, rgba(5,4,3,1) 100%)',
    text: () => `
      Ø³ÙØ±Ø§Ø¡ Ù…Ù† Ø«Ù„Ø§Ø« Ù…Ù†Ø§Ø·Ù‚ ÙŠØªÙ†Ø§ÙØ³ÙˆÙ† Ø¹Ù„Ù‰ ØªØ­Ø§Ù„ÙÙƒ Ø¹Ø¨Ø± Ø§Ù„Ø²ÙˆØ§Ø¬.
      <span class="char-name">Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©</span> ØªØ¶Ø¹ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø£Ù…Ø§Ù…Ùƒ:
      <br><br>
      Ø§Ø¨Ù†Ø© Ø§Ù„Ø¬Ù†Ø±Ø§Ù„ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ø«Ù†Ø¯Ø§Ø± â€” ØªØ­Ø§Ù„Ù ÙŠÙÙˆÙ‚Ù Ø§Ù„Ø­Ø±ÙˆØ¨.
      Ø£Ù…ÙŠØ±Ø© Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ù…Ù† Ø§Ù„Ø´Ø±Ù‚ â€” ØªÙØ³ÙƒØª Ù…Ø¹Ø§Ø±Ø¶ØªÙ‡Ù… ÙˆØªÙ…Ù„Ø£ Ø§Ù„Ø®Ø²ÙŠÙ†Ø©.
      ÙˆØ­ÙÙŠØ¯Ø© ÙƒØ¨ÙŠØ± Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ â€” ØªÙ…Ù†Ø­Ùƒ Ø´Ø±Ø¹ÙŠØ© Ø¯ÙŠÙ†ÙŠØ© Ù„Ø§ ØªÙØ¶Ø§Ù‡Ù‰.
      <br><br>
      <span class="whisper">"ÙƒÙ„ Ø§Ø®ØªÙŠØ§Ø±ØŒ Ø¬Ù„Ø§Ù„ØªÙƒØŒ ÙŠÙØºÙ„Ù‚ Ø¨Ø§Ø¨Ø§Ù‹ ÙˆÙŠÙØªØ­ Ø«Ù„Ø§Ø«Ø©."</span>
    `,
    memory: () => G.tags.has('surrendered_land') ? 'ğŸ³ï¸ Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ù„Ù… ØªÙ†Ø³Ù ØªÙ†Ø§Ø²Ù„Ùƒ Ø¹Ù† Ø£Ø±Ø§Ø¶ÙŠÙƒ' :
                  G.tags.has('brother_revealed') ? 'ğŸ‘‘ ÙˆØ¬ÙˆØ¯ Ø£Ø®ÙŠÙƒ ÙŠÙØ¹Ù‚Ù‘Ø¯ Ø£ÙŠ ØªØ­Ø§Ù„Ù' : null,
    choices: [
      {
        emoji: 'âš”ï¸', text: 'Ø§Ø¨Ù†Ø© Ø§Ù„Ø¬Ù†Ø±Ø§Ù„ â€” Ø§Ù„Ø³Ù„Ø§Ù… Ù…Ø¹ Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø£Ù‡Ù… Ù…Ù† ÙƒÙ„ Ø´ÙŠØ¡',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +18', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’10', type: 'down' }, { label: '+Ø³Ù„Ø§Ù… Ø´Ù…Ø§Ù„ÙŠ', type: 'neutral' }],
        fn: () => {
          apply({army:18, nobles:-10, people:5});
          G.tags.add('married_north');
          chronicle('ğŸ’', 'ØªØ²ÙˆÙ‘Ø¬ Ø§Ø¨Ù†Ø© Ø§Ù„Ø¬Ù†Ø±Ø§Ù„ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ');
          transition('ğŸ•Šï¸', 'Ø§Ù„Ø­Ø±Ø¨ ØªØªÙˆÙ‚Ù... ÙˆØ§Ù„ØªØ­Ø§Ù„Ù ÙŠÙØ±Ø³Ù‰', () => go('legacy'));
        }
      },
      {
        emoji: 'ğŸ’', text: 'Ø£Ù…ÙŠØ±Ø© Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ â€” Ø§Ù„Ø«Ø±ÙˆØ© ÙˆØ§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ø£Ø³Ø§Ø³ Ø§Ù„Ø­ÙƒÙ…',
        sub: [{ label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +20', type: 'up' }, { label: '+Ø®Ø²ÙŠÙ†Ø©', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’8', type: 'down' }],
        fn: () => {
          apply({nobles:20, people:-8, army:5});
          G.tags.add('married_nobles');
          chronicle('ğŸ’', 'ØªØ²ÙˆÙ‘Ø¬ Ø£Ù…ÙŠØ±Ø© Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ù…Ù† Ø§Ù„Ø´Ø±Ù‚');
          transition('ğŸ’', 'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØ­ØªÙÙ„ÙˆÙ†... Ø§Ù„Ø´Ø¹Ø¨ ÙŠØªØ±Ù‚Ù‘Ø¨', () => go('legacy'));
        }
      },
      {
        emoji: 'ğŸ“œ', text: 'Ø§Ø¨Ù†Ø© ÙƒØ¨ÙŠØ± Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ â€” Ø§Ù„Ø­ÙƒÙ…Ø© ÙˆØ§Ù„Ù…Ø´ÙˆØ±Ø© Ù„Ø§ ØªÙØ´ØªØ±Ù‰ Ø¨Ù…Ø§Ù„',
        sub: [{ label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +22', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +10', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’8', type: 'down' }],
        fn: () => {
          const churchBonus = G.tags.has('church_debt') ? 28 : 22;
          apply({church: churchBonus, people:10, nobles:-8});
          G.tags.add('married_church');
          chronicle('ğŸ’', 'ØªØ²ÙˆÙ‘Ø¬ Ø§Ø¨Ù†Ø© ÙƒØ¨ÙŠØ± Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡');
          transition('ğŸ–‹ï¸', 'Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠÙØ¤ÙŠØ¯ÙˆÙ†... Ù…ÙƒØ§Ù†ØªÙ‡Ù… ØªØ±Ø³Ù‘Ø®Øª Ù…Ø¹Ùƒ', () => go('legacy'));
        }
      },
    ]
  },

  legacy: {
    chapter: 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£Ø®ÙŠØ± â€” Ø¥Ø±Ø« Ø£Ø±ÙŠÙ‡Ø§Ù†',
    title: 'Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø£Ø®ÙŠØ±',
    emoji: 'ğŸŒ…',
    color: 'rgba(100,70,20,0.6)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(100,70,20,0.6) 0%, rgba(15,10,3,0.8) 55%, rgba(5,4,3,1) 100%)',
    text: () => {
      const base = `
        Ø¹Ø´Ø± Ø³Ù†ÙˆØ§Øª Ù…Ø±Ù‘Øª Ø¹Ù„Ù‰ Ø¬Ù„ÙˆØ³Ùƒ Ø¹Ù„Ù‰ Ø¹Ø±Ø´ Ø£Ø±ÙŠÙ‡Ø§Ù†.
        Ø§Ù„Ù…Ù…Ù„ÙƒØ© ØªØºÙŠÙ‘Ø±Øª. Ø£Ù†Øª ØªØºÙŠÙ‘Ø±Øª. ÙˆØ§Ù„Ø¢Ù† Ø£Ù…Ø§Ù…Ùƒ Ù‚Ø±Ø§Ø± ÙˆØ§Ø­Ø¯ Ø³ÙŠÙØ­Ø¯Ø¯ ÙƒÙŠÙ ØªÙØ°ÙƒØ±.
        <br><br>
        <span class="char-name">Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©</span> ØªÙ‚Ù Ø¨Ø¬Ø§Ù†Ø¨Ùƒ Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©:
        <span class="whisper">"Ø¬Ù„Ø§Ù„ØªÙƒØŒ ${gT('ÙƒÙ„ Ù…Ù„Ùƒ ÙŠØªØ±Ùƒ Ø´ÙŠØ¦Ø§Ù‹. Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØªØ±Ùƒ','ÙƒÙ„Ù‘ Ù…Ù„ÙƒØ© ØªØªØ±Ùƒ Ø´ÙŠØ¦Ø§Ù‹. Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ÙŠÙ† Ø£Ù† ØªØªØ±ÙƒÙŠ')} Ù„Ø£Ø±ÙŠÙ‡Ø§Ù†ØŸ"</span>
        <br><br>
      `;
      if (G.tags.has('brother_revealed') || G.tags.has('adopted_brother'))
        return base + `<span class="char-name">Ø£Ø®ÙˆÙƒ</span> ÙŠÙ‚Ù ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© ÙŠØ±Ø§Ù‚Ø¨. Ø¹ÙŠÙ†Ø§Ù‡ Ù„Ø§ ØªÙƒØ´ÙØ§Ù† Ø´ÙŠØ¦Ø§Ù‹ â€” Ø§Ù„Ø­Ø¨ØŸ Ø§Ù„Ø­Ù‚Ø¯ØŸ Ø£Ù… Ø§Ù„Ø·Ù…ÙˆØ­ØŸ`;
      if (G.tags.has('king_sacrifice'))
        return base + `<span class="good-word">Ø§Ù„Ø´Ø¹Ø¨ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠÙØ±Ø¯Ø¯ Ù‚ØµØ© Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø°ÙŠ Ø¨Ø§Ø¹ Ø£Ø±Ø¶Ù‡</span> Ù„ÙŠØ·Ø¹Ù…Ù‡Ù…. Ù„ÙŠÙ„Ù‰ ØªÙØ±Ø¨Øª Ø¹Ù„Ù‰ ÙƒØªÙÙƒ: <span class="whisper">"Ù…Ø§ Ø¨Ø°Ù„ØªÙ‡ Ù„Ù† ÙŠÙÙ†Ø³Ù‰."</span>`;
      if (G.tags.has('healed_all'))
        return base + `Ø§Ù„Ø´Ø¹Ø¨ Ø§Ù„Ø°ÙŠ Ø¹Ø§Ù„Ø¬Øª Ø¬Ø±Ø§Ø­Ù‡ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠÙ‡ØªÙ Ø¨Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ø£Ø³ÙˆØ§Ù‚. <span class="char-name">ÙƒØ§Ø±Ø§Ø² Ø§Ù„Ø·Ø¨ÙŠØ¨</span> ÙŠÙ‚Ù Ø®Ù„Ù Ù„ÙŠÙ„Ù‰ Ø¨Ø¹ÙŠÙˆÙ† Ù…Ù…ØªÙ†Ø©.`;
      if (G.tags.has('led_battle'))
        return base + `Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„Ø°ÙŠÙ† Ù‚Ø§ØªÙ„Øª Ù…Ø¹Ù‡Ù… ØµØ§Ø±ÙˆØ§ Ø¢Ø¨Ø§Ø¡ ÙˆØ£Ù…Ù‡Ø§Øª â€” ÙŠØ­ÙƒÙˆÙ† Ù„Ø£Ø·ÙØ§Ù„Ù‡Ù… Ø¹Ù† Ù…Ù„ÙƒÙ‡Ù… Ø§Ù„Ø°ÙŠ Ù†Ø²Ù„ Ù…Ù† Ø¹Ø±Ø´Ù‡ ÙˆØ­Ù…Ù„ Ø§Ù„Ø³ÙŠÙ.`;
      if (G.tags.has('yusuf_deal'))
        return base + `<span class="char-name">Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ</span> ÙŠØ¬Ù„Ø³ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©. Ù†Ø¸Ø±Ø© Ù„ÙŠÙ„Ù‰ Ø¥Ù„ÙŠÙ‡ Ø¨Ø§Ø±Ø¯Ø©: <span class="whisper">"Ø¨Ø¹Ø¶ Ø§Ù„ØµÙÙ‚Ø§Øª ØªØ¨Ù‚Ù‰ Ù…Ø¹Ùƒ Ø£Ø·ÙˆÙ„ Ù…Ù…Ø§ ØªØ±ÙŠØ¯ØŒ Ø¬Ù„Ø§Ù„ØªÙƒ."</span>`;
      return base + `Ø£Ø±ÙŠÙ‡Ø§Ù† ØªÙ†ØªØ¸Ø±. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠÙØ¹Ø¯Ù‘ Ù‚Ù„Ù…Ù‡.`;
    },
    memory: () => {
      if (G.tags.has('adopted_brother') || G.tags.has('brother_revealed')) return 'ğŸ‘‘ Ø£Ø®ÙˆÙƒ Ù„Ø§ ÙŠØ²Ø§Ù„ ÙÙŠ Ø§Ù„Ù‚ØµØ± ÙŠØ±Ø§Ù‚Ø¨';
      if (G.tags.has('forgave_solomon')) return 'ğŸ•¯ï¸ Ø±Ø­Ù…ØªÙƒ Ø¨Ù…Ø±ÙˆØ§Ù† Ø¹Ù„Ù‘Ù…Øª Ø§Ù„Ù†Ø§Ø³ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¹Ø¯Ù„';
      return 'ğŸ“œ Ø¹Ø´Ø± Ø³Ù†ÙˆØ§Øª Ù…Ù† Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ØªÙ‚ÙˆØ¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø­Ø¸Ø©';
    },
    choices: [
      {
        emoji: 'ğŸ“œ', text: 'Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø­Ù‚ÙˆÙ‚ â€” Ø£ÙˆÙ„ Ù‚Ø§Ù†ÙˆÙ† ÙŠØ­Ù…ÙŠ Ø§Ù„Ø´Ø¹Ø¨ Ù…Ù† Ø¸Ù„Ù… Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +32', type: 'up' }, { label: 'âˆ’Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ âˆ’26', type: 'down' }, { label: '+Ø¥Ø±Ø« ØªØ§Ø±ÙŠØ®ÙŠ', type: 'neutral' }],
        fn: () => {
          apply({people:32, nobles:-26, church:10});
          G.tags.add('charter_issued');
          chronicle('ğŸ“œ', 'Ø£ØµØ¯Ø± Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨');
          transition('ğŸ“œ', 'Ø§Ù„Ù…ÙŠØ«Ø§Ù‚ ÙŠÙÙ‚Ø±Ø£ ÙÙŠ ÙƒÙ„ Ù‚Ø±ÙŠØ©... Ø§Ø³Ù…Ùƒ ÙŠÙÙ†Ù‚Ø´ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®', calcEnding);
        }
      },
      {
        emoji: 'ğŸ“', text: 'Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ â€” Ø§Ù„Ø¹Ù„Ù… ÙˆØ§Ù„Ø·Ø¨ Ù„ÙƒÙ„ Ø£Ø¨Ù†Ø§Ø¡ Ø£Ø±ÙŠÙ‡Ø§Ù†',
        sub: [{ label: '+Ø§Ù„Ø´Ø¹Ø¨ +22', type: 'up' }, { label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +12', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +10', type: 'up' }],
        fn: () => {
          apply({people:22, church:12, nobles:10, army:5});
          G.tags.add('university_built');
          chronicle('ğŸ“', 'Ø£Ø³Ù‘Ø³ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ Ù„Ø£Ø¨Ù†Ø§Ø¡ Ø£Ø±ÙŠÙ‡Ø§Ù†');
          transition('ğŸŒŸ', 'Ø§Ù„Ù†ÙˆØ± ÙŠÙØ¶Ø§Ø¡... ÙˆØ§Ù„Ø¬Ù‡Ù„ ÙŠØªØ±Ø§Ø¬Ø¹', calcEnding);
        }
      },
      {
        emoji: 'ğŸ°', text: 'Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© â€” Ø£Ø±ÙŠÙ‡Ø§Ù† ØªØªÙˆØ³Ø¹ ÙˆØ§Ù„Ø«Ù†Ø¯Ø§Ø± Ø³ØªØ¯ÙØ¹ Ø§Ù„Ø«Ù…Ù†',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +32', type: 'up' }, { label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +16', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø´Ø¹Ø¨ âˆ’22', type: 'down' }],
        fn: () => {
          apply({army:32, nobles:16, people:-22, church:-5});
          G.tags.add('empire_declared');
          chronicle('ğŸ°', 'Ø£Ø¹Ù„Ù† Ø£Ø±ÙŠÙ‡Ø§Ù† Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ÙˆØ¨Ø¯Ø£ Ø§Ù„ØªÙˆØ³Ø¹');
          transition('ğŸ”¥', 'Ø§Ù„Ø±Ø§ÙŠØ© ØªØ±ØªÙØ¹... ÙˆØ§Ù„Ø­Ø±Ø¨ ØªØ¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯', calcEnding);
        }
      },
    ]
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANDOM EVENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const RANDOM_EVENTS = [
  {
    id: 'spy_caught',
    weight: 3,
    emoji: 'ğŸ•µï¸',
    title: 'Ø¬Ø§Ø³ÙˆØ³ ÙÙŠ Ø§Ù„Ù‚ØµØ±',
    text: 'Ø­Ø±Ù‘Ø§Ø³Ùƒ ÙŠÙÙ…Ø³ÙƒÙˆÙ† Ø¨Ø±Ø¬Ù„ ÙŠÙØµÙˆÙ‘Ø± Ø®Ø±Ø§Ø¦Ø· Ø§Ù„Ù‚ØµØ± Ù„ÙŠÙ„Ø§Ù‹. Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªØ¬ÙˆØ§Ø¨ØŒ ÙŠÙƒØ´Ù Ø£Ù†Ù‡ ÙŠØ¹Ù…Ù„ Ù„Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠÙŠÙ† Ø§Ù„Ø±Ø§ØºØ¨ÙŠÙ† ÙÙŠ Ø²Ø¹Ø²Ø¹Ø© Ø¹Ø±Ø´Ùƒ.',
    choices: [
      { text: 'Ø§Ø¹Ø¯Ù…Ù‡ ÙÙˆØ±Ø§Ù‹ â€” Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¢Ø®Ø±ÙŠÙ†', emoji: 'âš”ï¸', apply:{army:8, people:-6}, tag: null },
      { text: 'Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ø¹Ù…ÙŠÙ„Ø§Ù‹ Ù…Ø²Ø¯ÙˆØ¬Ø§Ù‹', emoji: 'ğŸ­', apply:{nobles:6, church:5}, tag: 'double_agent' },
    ]
  },
  {
    id: 'harvest_miracle',
    weight: 2,
    emoji: 'ğŸŒ¾',
    title: 'Ù…ÙˆØ³Ù… Ø§Ù„Ø¨Ø±ÙƒØ©',
    text: 'Ø®Ù„Ø§ÙØ§Ù‹ Ù„Ù„ØªÙˆÙ‚Ø¹Ø§ØªØŒ Ø¬Ø§Ø¡ Ø§Ù„Ø­ØµØ§Ø¯ ÙˆÙÙŠØ±Ø§Ù‹ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…. Ø§Ù„ÙÙ„Ø§Ø­ÙˆÙ† ÙŠÙ‚ÙˆÙ„ÙˆÙ† Ø¥Ù†Ù‡ Ø¨Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ù„Ù‡ Ø¹Ù„Ù‰ Ù…Ù„ÙƒÙƒ Ø§Ù„ØµØ§Ù„Ø­.',
    choices: [
      { text: 'ÙˆØ²Ù‘Ø¹ Ø§Ù„ÙØ§Ø¦Ø¶ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ‚Ø±Ø§Ø¡ ÙƒØ§Ù…Ù„Ø§Ù‹', emoji: 'ğŸ˜ï¸', apply:{people:18, nobles:-5}, tag: 'distributed_harvest' },
      { text: 'Ø§Ø¯Ù‘Ø®Ø±Ù‡ ÙÙŠ Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ù„Ù„Ø·ÙˆØ§Ø±Ø¦', emoji: 'ğŸ’°', apply:{nobles:12, army:5}, tag: null },
    ]
  },
  {
    id: 'leyla_arrives',
    weight: 4,
    emoji: 'ğŸŒ™',
    title: 'Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„ØºØ±ÙŠØ¨Ø©',
    text: 'Ø§Ù…Ø±Ø£Ø© ØªØ¯Ø¹Ù‰ <strong>Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©</strong> ØªØ·Ù„Ø¨ Ù…Ù‚Ø§Ø¨Ù„ØªÙƒ. Ø¯Ø±Ø³Øª ÙÙŠ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ§Øª Ø§Ù„Ø´Ø±Ù‚ ÙˆØªÙØ­Ø³Ù† Ø³Ø¨Ø¹ Ù„ØºØ§Øª. Ø¹ÙŠÙ†Ø§Ù‡Ø§ ØªÙ‚Ø±Ø¢Ù† Ø§Ù„ØºØ±Ù Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø§Ø³.',
    choices: [
      { text: 'Ø§Ù‚Ø¨Ù„Ù‡Ø§ Ù…Ø³ØªØ´Ø§Ø±Ø©Ù‹ Ø´Ø®ØµÙŠØ©', emoji: 'ğŸŒ™', apply:{church:-5, people:8}, tag: 'leyla_trusted' },
      { text: 'Ø§Ø±ÙØ¶ â€” Ø§Ù„Ù‚ØµØ± Ù„ÙŠØ³ Ù„Ù„ØºØ±Ø¨Ø§Ø¡', emoji: 'ğŸšª', apply:{army:5, nobles:5}, tag: null },
    ]
  },
  {
    id: 'merchants_petition',
    weight: 3,
    emoji: 'ğŸ’¼',
    title: 'ÙˆÙØ¯ Ø§Ù„ØªØ¬Ø§Ø±',
    text: 'Ø¹Ø´Ø±ÙˆÙ† ØªØ§Ø¬Ø±Ø§Ù‹ ÙŠØ·Ø§Ù„Ø¨ÙˆÙ† Ø¨Ø¥Ù„ØºØ§Ø¡ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø·Ø±Ù‚. ÙŠÙ‚ÙˆÙ„ÙˆÙ† Ø¥Ù†Ù‡Ø§ ØªÙÙÙ‚Ø± Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯. Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØ¹Ø§Ø±Ø¶ÙˆÙ† â€” Ù‡Ø°Ù‡ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¬Ø²Ø¡ Ù…Ù† Ø¯Ø®Ù„Ù‡Ù….',
    choices: [
      { text: 'Ø£Ù„ØºÙÙ‡Ø§ â€” Ø§Ù„ØªØ¬Ø§Ø±Ø© ØªÙØºÙ†ÙŠ Ø§Ù„Ø¬Ù…ÙŠØ¹', emoji: 'ğŸ›’', apply:{people:12, nobles:-18}, tag: 'trade_freed' },
      { text: 'Ø®ÙÙ‘Ø¶Ù‡Ø§ Ù„Ù„Ù†ØµÙ â€” Ø­Ù„Ù‘ ÙˆØ³Ø·', emoji: 'âš–ï¸', apply:{people:6, nobles:-6}, tag: null },
    ]
  },
  {
    id: 'army_promotion',
    weight: 2,
    emoji: 'ğŸ–ï¸',
    title: 'Ø¨Ø·Ù„ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©',
    text: 'Ø¶Ø§Ø¨Ø· Ø´Ø§Ø¨ Ù…Ù† Ø¹Ø§Ø¦Ù„Ø© ÙÙ‚ÙŠØ±Ø© Ø£Ù†Ù‚Ø° ÙƒØªÙŠØ¨Ø© Ø¨Ø£ÙƒÙ…Ù„Ù‡Ø§. Ø·Ø§Ø±Ù‚ ÙŠÙ‚ØªØ±Ø­ ØªØ±Ù‚ÙŠØªÙ‡ Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø­Ø±Ø³ Ø§Ù„Ù…Ù„ÙƒÙŠ. Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØ±ÙØ¶ÙˆÙ† â€” Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ù„ÙŠØ³Øª Ù†Ø¨ÙŠÙ„Ø©.',
    choices: [
      { text: 'Ø±Ù‚Ù‘Ù‡ â€” Ø§Ù„ÙƒÙØ§Ø¡Ø© ÙÙˆÙ‚ Ø§Ù„Ù†Ø³Ø¨', emoji: 'â­', apply:{army:22, nobles:-12}, tag: 'merit_promotion' },
      { text: 'Ù…Ù†Ø­Ù‡ Ù…ÙŠØ¯Ø§Ù„ÙŠØ© â€” Ø§Ù„ØªÙ‚Ø§Ù„ÙŠØ¯ Ù…Ù‡Ù…Ø©', emoji: 'ğŸ…', apply:{army:6, nobles:6}, tag: null },
    ]
  },
  {
    id: 'secret_library',
    weight: 2,
    emoji: 'ğŸ“š',
    title: 'Ù…ÙƒØªØ¨Ø© Ø£Ø¨ÙŠÙƒ Ø§Ù„Ø³Ø±ÙŠØ©',
    text: 'Ø®Ù„Ù Ø¬Ø¯Ø§Ø± ÙÙŠ Ù…Ø®Ø²Ù† Ù‚Ø¯ÙŠÙ…ØŒ ØªØ¬Ø¯ Ù…ÙƒØªØ¨Ø© Ù…Ø®ÙÙŠØ© Ø£Ø¨ÙŠÙƒ. ÙÙŠÙ‡Ø§ ÙˆØ«Ø§Ø¦Ù‚ Ø³Ø±ÙŠØ© â€” Ø¨Ø¹Ø¶Ù‡Ø§ ÙŠÙƒØ´Ù ØµÙÙ‚Ø§Øª Ø®ÙÙŠØ©ØŒ ÙˆØ¨Ø¹Ø¶Ù‡Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®Ø±Ø§Ø¦Ø· Ù„ÙƒÙ†ÙˆØ² Ù…Ø¯ÙÙˆÙ†Ø©.',
    choices: [
      { text: 'Ø£ÙØ¹Ù„Ù† Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ â€” Ø§Ù„Ø´ÙØ§ÙÙŠØ© Ø£ÙˆÙ„Ø§Ù‹', emoji: 'ğŸ“œ', apply:{people:14, church:8, nobles:-8}, tag: 'revealed_docs' },
      { text: 'Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø±Ø§Ø¦Ø· Ø³Ø±Ø§Ù‹', emoji: 'ğŸ—ºï¸', apply:{army:8, nobles:10}, tag: 'secret_treasure' },
    ]
  },
  {
    id: 'wandering_healer',
    weight: 2,
    emoji: 'ğŸ§™',
    title: 'Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„ØºØ±ÙŠØ¨',
    text: 'Ø·Ø¨ÙŠØ¨ Ø±Ø­Ù‘Ø§Ù„ ÙŠØ¯Ù‘Ø¹ÙŠ Ø£Ù†Ù‡ ÙŠÙ…ØªÙ„Ùƒ Ø¹Ù„Ø§Ø¬Ø§Ù‹ Ù„Ø£Ù…Ø±Ø§Ø¶ Ù„Ø§ Ø¹Ù„Ø§Ø¬ Ù„Ù‡Ø§. Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠØªÙ‡Ù…ÙˆÙ†Ù‡ Ø¨Ø§Ù„Ø¯Ø¬Ù„. Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ¤Ù…Ù† Ø¨Ù‡ ÙˆÙŠØ¬ØªÙ…Ø¹ Ø­ÙˆÙ„Ù‡.',
    choices: [
      { text: 'Ø§Ø¯Ø¹Ù‡ Ù„Ù„Ù‚ØµØ± ÙˆØªØ¨Ù†Ù‘Ù‡ Ø±Ø³Ù…ÙŠØ§Ù‹', emoji: 'ğŸŒ¿', apply:{people:16, church:-14}, tag: 'healer_protected' },
      { text: 'Ø§Ø·Ø±Ø¯Ù‡ â€” Ù„Ø§ Ù…Ø¬Ø§Ù„ Ù„Ù„Ø®Ø±Ø§ÙØ§Øª', emoji: 'ğŸš«', apply:{church:12, people:-10}, tag: null },
    ]
  },
  {
    id: 'poet_scandal',
    weight: 2,
    emoji: 'ğŸ“',
    title: 'Ù‚ØµÙŠØ¯Ø© ØªÙ‡Ø²Ù‘ Ø§Ù„Ø¯ÙŠÙˆØ§Ù†',
    text: 'Ø´Ø§Ø¹Ø± Ø´Ø§Ø¨ Ù†Ø´Ø± Ù‚ØµÙŠØ¯Ø© Ø³Ø§Ø®Ø±Ø© ØªÙ‡Ø¬Ùˆ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙˆØªÙ…Ø¬Ù‘Ø¯ Ø§Ù„Ø´Ø¹Ø¨. Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØ·Ø§Ù„Ø¨ÙˆÙ† Ø¨Ù‚Ø·Ø¹ Ù„Ø³Ø§Ù†Ù‡. Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ±Ø¯Ø¯ Ø§Ù„Ù‚ØµÙŠØ¯Ø© ÙÙŠ ÙƒÙ„ Ø²Ù‚Ø§Ù‚.',
    choices: [
      { text: 'Ø§Ø­Ù…Ù Ø§Ù„Ø´Ø§Ø¹Ø± â€” Ø­Ø±ÙŠØ© Ø§Ù„Ø±Ø£ÙŠ Ù…Ù‚Ø¯Ø³Ø©', emoji: 'ğŸ–Šï¸', apply:{people:18, nobles:-16}, tag: 'poet_protected' },
      { text: 'Ø§Ø³Ø¬Ù†Ù‡ â€” Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø± ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡', emoji: 'â›“ï¸', apply:{nobles:10, people:-14, army:5}, tag: null },
      { text: 'Ø§Ø¹ÙÙ Ø¹Ù†Ù‡ ÙˆØ§Ø¬Ø¹Ù„Ù‡ Ø´Ø§Ø¹Ø± Ø§Ù„Ø¨Ù„Ø§Ø·', emoji: 'ğŸ‘‘', apply:{people:10, nobles:-5, church:8}, tag: 'court_poet' },
    ]
  },
  {
    id: 'earthquake',
    weight: 2,
    emoji: 'ğŸŒ‹',
    title: 'Ø²Ù„Ø²Ø§Ù„ Ø§Ù„Ø´Ø±Ù‚',
    text: 'Ø²Ù„Ø²Ø§Ù„ ÙŠØ¶Ø±Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ©. Ø£Ù„Ù Ø¨ÙŠØª Ù…Ù†Ù‡Ø§Ø±ØŒ ÙˆØ¢Ù„Ø§Ù Ø§Ù„Ù†Ø§Ø²Ø­ÙŠÙ† ÙŠØ³ÙŠØ±ÙˆÙ† Ù†Ø­Ùˆ Ø§Ù„Ø¹Ø§ØµÙ…Ø©. Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ØªØ¦Ù† â€” Ù„ÙƒÙ† Ø§Ù„Ø¶Ù…ÙŠØ± ÙŠØªÙƒÙ„Ù….',
    choices: [
      { text: 'Ø£Ø¹Ù„Ù† Ø­Ø§Ù„Ø© Ø·ÙˆØ§Ø±Ø¦ ÙˆØ£Ø±Ø³Ù„ ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯', emoji: 'ğŸ†˜', apply:{people:22, army:-8, nobles:-8}, tag: 'quake_hero' },
      { text: 'Ø£Ø±Ø³Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ø­Ø¯ÙˆØ¯Ø© ÙˆØªØ§Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª', emoji: 'âš–ï¸', apply:{people:8, nobles:5}, tag: null },
    ]
  },
  {
    id: 'foreign_ambassador',
    weight: 3,
    emoji: 'ğŸŒ',
    title: 'Ø³ÙÙŠØ± Ù…Ù† Ø§Ù„ØºØ±Ø¨ Ø§Ù„Ø¨Ø¹ÙŠØ¯',
    text: 'Ø³ÙÙŠØ± Ù…Ù† Ù…Ù…Ù„ÙƒØ© Ø¨Ø¹ÙŠØ¯Ø© ÙŠØ¹Ø±Ø¶ ØªØ­Ø§Ù„ÙØ§Ù‹ ØªØ¬Ø§Ø±ÙŠØ§Ù‹ â€” Ø·Ø±Ù‚ Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ£Ø³ÙˆØ§Ù‚ Ù„Ù… ØªÙØ¹Ø±Ù. Ù„ÙƒÙ† Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠØªØ´ÙƒÙƒÙˆÙ† ÙÙŠ Ù†ÙˆØ§ÙŠØ§Ù‡.',
    choices: [
      { text: 'ÙˆÙ‚Ù‘Ø¹ Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯Ø© â€” Ø§Ù„ØªØ¬Ø§Ø±Ø© ØªÙØ«Ø±ÙŠ Ø§Ù„Ø¬Ù…ÙŠØ¹', emoji: 'ğŸ¤', apply:{nobles:14, people:8, church:-8}, tag: 'western_trade' },
      { text: 'Ø§Ø±ÙØ¶ Ø­ØªÙ‰ ØªØ¯Ø±Ø³ Ø§Ù„Ø£Ù…Ø± Ø£Ø¹Ù…Ù‚', emoji: 'ğŸ”', apply:{church:10, army:5}, tag: 'rejected_west' },
    ]
  },
  {
    id: 'royal_treasury_thief',
    weight: 2,
    emoji: 'ğŸ’°',
    title: 'Ø§Ù„Ù„Øµ ÙÙŠ Ø§Ù„Ø®Ø²ÙŠÙ†Ø©',
    text: 'Ø­Ø§Ø±Ø³ Ù‚Ø¯ÙŠÙ… ÙŠÙØ¶Ø¨Ø· ÙˆÙ‡Ùˆ ÙŠØ³Ø±Ù‚ Ù…Ù† Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ©. Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ ÙŠÙƒØ´Ù Ø£Ù†Ù‡ ÙƒØ§Ù† ÙŠÙØ±Ø³Ù„ Ø§Ù„Ù…Ø§Ù„ Ù„Ø¹Ø§Ø¦Ù„ØªÙ‡ Ø§Ù„Ù…Ø­ØªØ§Ø¬Ø©. Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† ÙˆØ§Ø¶Ø­ â€” Ù„ÙƒÙ† Ø§Ù„Ù‚Ù„Ø¨ ÙŠØªÙƒÙ„Ù….',
    choices: [
      { text: 'Ø£Ù‚ØµÙÙ‡ ÙˆØ¹Ø§Ù‚Ø¨Ù‡ â€” Ù„Ø§ Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ù„Ù„Ù‚Ø§Ù†ÙˆÙ†', emoji: 'âš–ï¸', apply:{army:8, nobles:6, people:-8}, tag: null },
      { text: 'Ø§Ø¹ÙÙ Ø¹Ù†Ù‡ ÙˆØ§ØµØ±Ù Ù„Ø¹Ø§Ø¦Ù„ØªÙ‡ Ù…Ù† Ø§Ù„Ø®Ø²ÙŠÙ†Ø©', emoji: 'â¤ï¸', apply:{people:16, church:8, army:-6}, tag: 'merciful_choice' },
    ]
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACHIEVEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ACHIEVEMENT_DEFS = {
  bold_start:      { icon:'ğŸ¦', name: () => gT('Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø±ÙŠØ¦Ø©','Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø±ÙŠØ¦Ø©') },
  king_of_warriors:{ icon:'âš”ï¸', name: () => gT('Ù…Ù„Ùƒ Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ÙŠÙ†','Ù…Ù„ÙƒØ© Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ÙŠÙ†') },
  heart_of_gold:   { icon:'â¤ï¸', name: () => gT('Ù‚Ù„Ø¨ Ù…Ù† Ø°Ù‡Ø¨','Ù‚Ù„Ø¨ Ù…Ù† Ø°Ù‡Ø¨') },
  merciful_king:   { icon:'ğŸ•Šï¸', name: () => gT('Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø±Ø­ÙŠÙ…','Ø§Ù„Ù…Ù„ÙƒØ© Ø§Ù„Ø±Ø­ÙŠÙ…Ø©') },
  sacrifice_king:  { icon:'ğŸ›ï¸', name: () => gT('Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø°ÙŠ Ø¶Ø­Ù‰','Ø§Ù„Ù…Ù„ÙƒØ© Ø§Ù„ØªÙŠ Ø¶Ø­Ù‘Øª') },
  master_diplomat: { icon:'ğŸŒ', name: () => gT('Ø³ÙŠØ¯ Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ©','Ø³ÙŠØ¯Ø© Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ©') },
  truth_seeker:    { icon:'ğŸ”', name: () => gT('Ø·Ø§Ù„Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©','Ø·Ø§Ù„Ø¨Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©') },
  iron_will:       { icon:'ğŸ”±', name: () => gT('Ø¥Ø±Ø§Ø¯Ø© Ù…Ù† Ø­Ø¯ÙŠØ¯','Ø¥Ø±Ø§Ø¯Ø© Ù…Ù† Ø­Ø¯ÙŠØ¯') },
};

function checkAchievement(id, icon, name) {
  if (G.achievements.includes(id)) return;
  G.achievements.push(id);
  const def = ACHIEVEMENT_DEFS[id];
  const displayName = def ? (typeof def.name === 'function' ? def.name() : def.name) : name;
  showAchievement(def ? def.icon : icon, displayName);
}

let achTimer = null;
let achQueue = [];
let achBusy = false;

function showAchievement(icon, name) {
  achQueue.push({icon, name});
  if (!achBusy) processAchQueue();
}

function processAchQueue() {
  if (achQueue.length === 0) { achBusy = false; return; }
  achBusy = true;
  const {icon, name} = achQueue.shift();
  const el = document.getElementById('achievePopup');
  document.getElementById('achIcon').textContent = icon;
  document.getElementById('achName').textContent = name;
  el.classList.add('show');
  if (achTimer) clearTimeout(achTimer);
  achTimer = setTimeout(() => {
    el.classList.remove('show');
    setTimeout(processAchQueue, 500);
  }, 4000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const REACTIONS = {
  people: {
    up:   ['Ø§Ù„Ø´Ø¹Ø¨ ÙŠÙ‡ØªÙ Ø¨Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ø£Ø²Ù‚Ø©!', 'Ø§Ù„Ù‚Ù„ÙˆØ¨ ØªÙ…ÙŠÙ„ Ø¥Ù„ÙŠÙƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø­Ø§ÙƒÙ…', 'Ø±Ø¶Ø§ Ø§Ù„Ø´Ø¹Ø¨ ÙŠÙØ±Ø³Ù‘Ø® Ø§Ù„Ø¹Ø±Ø´', 'ÙØ±Ø­ ÙŠØ¹Ù…Ù‘ Ø£Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©'],
    down: ['Ù‡Ù…Ù‡Ù…Ø§Øª Ø§Ù„Ø³Ø®Ø· ØªÙ…Ù„Ø£ Ø§Ù„Ø£Ø²Ù‚Ø©...', 'Ø§Ù„ØºØ¶Ø¨ ÙŠØªØµØ§Ø¹Ø¯ ÙÙŠ Ø§Ù„Ø´ÙˆØ§Ø±Ø¹', 'Ø«Ù‚Ø© Ø§Ù„Ø´Ø¹Ø¨ ØªØªØ¢ÙƒÙ„ Ø´ÙŠØ¦Ø§Ù‹ ÙØ´ÙŠØ¦Ø§Ù‹', 'Ø§Ù„Ø´ÙƒÙˆÙ‰ ØªØ³Ø¨Ù‚ Ø§Ù„Ø¹ØµÙŠØ§Ù†...']
  },
  army: {
    up:   ['Ø§Ù„Ø¬Ù†ÙˆØ¯ ÙŠØ±ÙØ¹ÙˆÙ† Ø³ÙŠÙˆÙÙ‡Ù… ÙˆÙ„Ø§Ø¡Ù‹!', 'Ø§Ù„Ø¬ÙŠØ´ Ø£Ø´Ø¯Ù‘ ØªÙ…Ø§Ø³ÙƒØ§Ù‹ Ø§Ù„ÙŠÙˆÙ…', 'Ù…Ø¹Ù†ÙˆÙŠØ§Øª Ø§Ù„Ø¬Ù†Ø¯ ÙÙŠ Ø£Ø¹Ù„Ø§Ù‡Ø§!', 'Ø§Ù„Ø«ÙƒÙ†Ø§Øª ØªØ¯ÙˆÙŠ Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ùƒ!'],
    down: ['Ù‡Ù…Ø³ Ø§Ù„Ø³Ø®Ø· ÙŠØ¬Ø±ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù†ÙˆØ¯...', 'Ø§Ù„Ø¬ÙŠØ´ ÙŠÙÙ‚Ø¯ Ø­Ù…Ø§Ø³Ù‡ Ø´ÙŠØ¦Ø§Ù‹ ÙØ´ÙŠØ¦Ø§Ù‹', 'Ø§Ù„ØªØ°Ù…Ø± ÙŠÙ†ØªØ´Ø± Ø¨ÙŠÙ† ØµÙÙˆÙ Ø§Ù„Ø¬Ù†Ø¯', 'Ø§Ù„ÙˆÙ„Ø§Ø¡ ÙŠØ¨Ø¯Ø£ Ø¨Ø§Ù„ØªØµØ¯Ù‘Ø¹...']
  },
  nobles: {
    up:   ['Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠÙØ¨Ø¯ÙˆÙ† Ø±Ø¶Ø§Ù‡Ù… Ø¹Ù†Ùƒ', 'Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ù†ÙÙˆØ° ÙŠÙ‚ÙÙˆÙ† ÙÙŠ ØµÙÙ‘Ùƒ', 'Ø§Ù„Ø«Ø±ÙˆØ© ØªØªØ¯ÙÙ‚ Ù†Ø­Ùˆ Ø®Ø²ÙŠÙ†ØªÙƒ'],
    down: ['Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØªØ´Ø§ÙˆØ±ÙˆÙ† Ø®Ù„Ù Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ù…ØºÙ„Ù‚Ø©...', 'Ø§Ù„Ù…Ø§Ù„ ÙŠØ´Ø­Ù‘ ÙˆØ£ØµØ­Ø§Ø¨Ù‡ ÙŠØ¨ØªØ¹Ø¯ÙˆÙ†', 'ØºØ¶Ø¨ Ø®Ø§ÙØª ÙŠØºÙ„ÙŠ ÙÙŠ Ù‚ØµÙˆØ± Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡...']
  },
  church: {
    up:   ['Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠÙØ²ÙƒÙ‘ÙˆÙ†Ùƒ ÙˆÙŠÙØ¤ÙŠØ¯ÙˆÙ† Ù‚Ø±Ø§Ø±Ùƒ', 'Ø´Ø±Ø¹ÙŠÙ‘ØªÙƒ ØªØ²Ø¯Ø§Ø¯ Ø±Ø³ÙˆØ®Ø§Ù‹', 'Ø§Ù„Ø­ÙƒÙŠÙ… Ø±Ø§Ø´Ø¯ ÙŠÙØ´ÙŠØ¯ Ø¨Ø­ÙƒÙ…ØªÙƒ'],
    down: ['Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠÙØ¨Ø¯ÙˆÙ† ØªØ­ÙÙ‘Ø¸Ø§Ù‹ ÙˆØ§Ø¶Ø­Ø§Ù‹...', 'Ø´Ø±Ø¹ÙŠÙ‘ØªÙƒ Ø¨Ø§ØªØª Ù…ÙˆØ¶Ø¹ ØªØ³Ø§Ø¤Ù„', 'Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠØªØ±Ø¯Ù‘Ø¯ÙˆÙ† ÙÙŠ Ø¯Ø¹Ù…Ùƒ...']
  }
};

let toastTimer = null;
function showReaction(msg) {
  const toast = document.getElementById('reactionToast');
  toast.textContent = msg;
  toast.classList.add('show');
  if (toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toast.classList.remove('show'), 3500);
}

function clearReaction() {
  const toast = document.getElementById('reactionToast');
  toast.classList.remove('show');
  if (toastTimer) clearTimeout(toastTimer);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CORE FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let pendingReaction = null;

function _apply_base(delta) {
  const reactions = [];
  ['people','army','nobles','church'].forEach(f => {
    if (delta[f] !== undefined && delta[f] !== 0) {
      G[f] = clamp(G[f] + delta[f]);
      const numEl = document.getElementById('num-'+f);
      numEl.classList.remove('flash-up','flash-down');
      void numEl.offsetWidth;
      if (delta[f] > 0) {
        numEl.classList.add('flash-up');
        const msgs = REACTIONS[f]?.up;
        if (msgs) reactions.push(msgs[Math.floor(Math.random()*msgs.length)]);
      } else {
        numEl.classList.add('flash-down');
        const msgs = REACTIONS[f]?.down;
        if (msgs) reactions.push(msgs[Math.floor(Math.random()*msgs.length)]);
      }
    }
  });
  updateBars();
  // Store reaction to show AFTER transition, not during it
  if (reactions.length > 0) pendingReaction = reactions[0];
}

function clamp(v) { return Math.max(0, Math.min(100, v)); }

function updateBars() {
  ['people','army','nobles','church'].forEach(f => {
    const v = G[f];
    const bar = document.getElementById('bar-'+f);
    const num = document.getElementById('num-'+f);
    bar.style.width = v + '%';
    num.textContent = v;
    num.style.color = v <= 18 ? '#e88888' : v >= 78 ? '#88e8a8' : '';
    const bg = bar.parentElement;
    if (v <= 22) {
      bg.style.boxShadow = '0 0 8px rgba(201,76,76,0.35)';
      bg.classList.add('critical-stat');
    } else {
      bg.style.boxShadow = '';
      bg.classList.remove('critical-stat');
    }
  });
}

function _go_base(sceneId) {
  G.turn++;
  // Inject political marriage between pretender and legacy
  if (sceneId === 'legacy' && !G.tags.has('had_marriage_scene')) {
    G.tags.add('had_marriage_scene');
    showScene(SCENES['political_marriage']);
    return;
  }
  showScene(SCENES[sceneId]);
  autoSave();
}

function chronicle(icon, text) {
  G.choices.push({ icon, text });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCENE RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSceneParticles() {
  const container = document.getElementById('sceneParticles');
  container.innerHTML = '';
  for (let i = 0; i < 14; i++) {
    const p = document.createElement('div');
    p.className = 'scene-particle';
    const x = Math.random() * 100;
    const dur = (Math.random() * 3 + 2) + 's';
    const delay = (Math.random() * 3) + 's';
    const dx = (Math.random() - 0.5) * 40 + 'px';
    p.style.cssText = `
      left:${x}%;bottom:0;
      --dur:${dur};--delay:${delay};--dx:${dx};
    `;
    container.appendChild(p);
  }
}

function _showScene_base(sc) {
  document.getElementById('sceneContainer').scrollTo({top:0, behavior:'smooth'});

  // Visual
  document.getElementById('sceneEmoji').textContent = sc.emoji;
  document.getElementById('sceneBg').style.background = sc.mood;
  document.getElementById('sceneEmoji').style.setProperty('--scene-color', sc.color || 'rgba(212,168,67,0.5)');
  buildSceneParticles();

  // Text
  document.getElementById('chapterTag').textContent = sc.chapter;
  document.getElementById('sceneTitle').textContent = sc.title;
  document.getElementById('chapterIndicator').textContent = 'Ø§Ù„ÙØµÙ„ ' + arabNum(G.turn);
  document.getElementById('choicesHeader').textContent = gT('â€” Ø§Ø®ØªØ± Ù…Ø³Ø§Ø±Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„Ùƒ â€”', 'â€” Ø§Ø®ØªØ§Ø±ÙŠ Ù…Ø³Ø§Ø±Ùƒ Ø£ÙŠØªÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØ© â€”');

  // Force re-animation
  const title = document.getElementById('sceneTitle');
  const body = document.getElementById('sceneBody');
  title.style.animation = 'none'; void title.offsetWidth; title.style.animation = '';
  body.style.animation = 'none'; void body.offsetWidth; body.style.animation = '';

  const bodyText = typeof sc.text === 'function' ? sc.text() : sc.text;
  body.innerHTML = bodyText;

  // Memory tag
  const memFn = sc.memory;
  let memVal = typeof memFn === 'function' ? memFn() : memFn;
  const memTag = document.getElementById('memoryTag');
  if (memVal) {
    document.getElementById('memoryText').textContent = memVal;
    memTag.style.display = 'inline-flex';
    memTag.style.animation = 'none'; void memTag.offsetWidth; memTag.style.animation = '';
  } else {
    memTag.style.display = 'none';
  }

  // Choices
  const list = document.getElementById('choicesList');
  list.innerHTML = '';
  sc.choices.forEach((c, i) => {
    const btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.style.animationDelay = (i * 0.07) + 's';

    const pills = c.sub.map(s => `<span class="effect-pill effect-${s.type}">${s.label}</span>`).join('');
    btn.innerHTML = `
      <span class="choice-emoji">${c.emoji}</span>
      <div class="choice-content">
        <div class="choice-text">${typeof c.text === 'function' ? c.text() : c.text}</div>
        <div class="choice-effects">${pills}</div>
      </div>
    `;
    btn.onclick = () => {
      if (btn.disabled) return;
      list.querySelectorAll('.choice-btn').forEach(b => { b.disabled = true; b.style.opacity = '0.45'; });
      btn.style.opacity = '1';
      btn.classList.add('chosen');
      setTimeout(c.fn, 350);
    };
    list.appendChild(btn);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRANSITION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function transition(emoji, text, callback) {
  // Clear any existing toast before transitioning
  clearReaction();
  const overlay = document.getElementById('transOverlay');
  document.getElementById('transEmoji').textContent = emoji;
  document.getElementById('transText').textContent = text;
  overlay.classList.add('show');
  setTimeout(() => {
    overlay.classList.remove('show');
    setTimeout(() => {
      callback();
      // Show the pending reaction AFTER the scene loads (800ms delay feels natural)
      if (pendingReaction) {
        const msg = pendingReaction;
        pendingReaction = null;
        setTimeout(() => showReaction(msg), 800);
      }
    }, 450);
  }, 2000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANDOM EVENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function triggerRandomEvent(callback) {
  const unseen = RANDOM_EVENTS.filter(e => !G.seenEvents.has(e.id));
  if (unseen.length === 0) { callback(); return; }

  const totalWeight = unseen.reduce((s,e) => s+e.weight, 0);
  let rand = Math.random() * totalWeight;
  let chosen = unseen[0];
  for (const e of unseen) {
    rand -= e.weight;
    if (rand <= 0) { chosen = e; break; }
  }
  G.seenEvents.add(chosen.id);

  const modal = document.createElement('div');
  modal.className = 'event-modal';
  modal.innerHTML = `
    <div class="event-inner">
      <span class="event-emoji">${chosen.emoji}</span>
      <div class="event-tag">â€” Ø­Ø¯Ø« Ø·Ø§Ø±Ø¦ â€”</div>
      <div class="event-title">${chosen.title}</div>
      <div class="event-text">${chosen.text}</div>
      <div class="event-choices" id="evChoices"></div>
    </div>
  `;
  document.body.appendChild(modal);

  const choicesEl = modal.querySelector('#evChoices');
  chosen.choices.forEach(c => {
    const btn = document.createElement('button');
    btn.className = 'event-choice-btn';
    btn.innerHTML = `<span style="font-size:22px">${c.emoji}</span><span>${c.text}</span>`;
    btn.onclick = () => {
      apply(c.apply);
      if (c.tag) G.tags.add(c.tag);
      modal.style.opacity = '0';
      modal.style.transition = 'opacity 0.35s';
      setTimeout(() => { modal.remove(); callback(); }, 380);
    };
    choicesEl.appendChild(btn);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleMap() {
  document.getElementById('mapOverlay').classList.toggle('show');
}
function closeMap() {
  document.getElementById('mapOverlay').classList.remove('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO SAVE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function autoSave() {
  try {
    const saveData = {
      ...G,
      tags: Array.from(G.tags),
      seenEvents: Array.from(G.seenEvents),
    };
    localStorage.setItem('arihan_save', JSON.stringify(saveData));
    showSaveIndicator();
  } catch(e) {}
}

function loadSave() {
  try {
    const raw = localStorage.getItem('arihan_save');
    if (!raw) return null;
    const data = JSON.parse(raw);
    data.tags = new Set(data.tags || []);
    data.seenEvents = new Set(data.seenEvents || []);
    return data;
  } catch(e) { return null; }
}

let saveTimer = null;
function showSaveIndicator() {
  const el = document.getElementById('saveIndicator');
  el.classList.add('show');
  if (saveTimer) clearTimeout(saveTimer);
  saveTimer = setTimeout(() => el.classList.remove('show'), 2500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENDINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ENDINGS = [
  {
    id: 'legend',
    condition: () => {
      const avg = (G.people+G.army+G.nobles+G.church)/4;
      return avg >= 60 && G.people >= 58 && G.army >= 55;
    },
    icon: 'ğŸŒŸ', color: '#d4a843',
    title: 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ',
    rank: 'Ø§Ù„Ù…Ø±ØªØ¨Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø£Ø¹Ø¸Ù… Ù…Ù„ÙˆÙƒ Ø£Ø±ÙŠÙ‡Ø§Ù†',
    story: () => {
      const charter = G.tags.has('charter_issued') ? ' Ø£ØµØ¯Ø± Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø°ÙŠ Ø­Ù…Ù‰ Ø§Ù„Ø´Ø¹Ø¨ Ù„Ù‚Ø±ÙˆÙ†.' : '';
      const uni = G.tags.has('university_built') ? ' ÙˆØ¨Ù†Ù‰ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ Ø§Ù„ØªÙŠ Ø£Ø¶Ø§Ø¡Øª Ø§Ù„Ø¹Ù‚ÙˆÙ„ ÙˆØ£Ù†Ø¬Ø¨Øª Ø£Ø·Ø¨Ø§Ø¡ ÙˆØ¹Ù„Ù…Ø§Ø¡.' : '';
      const battle = G.tags.has('led_battle') ? gT(' Ù†Ø²Ù„ Ø¹Ù† Ø¹Ø±Ø´Ù‡ ÙˆÙ‚Ø§ØªÙ„ Ù…Ø¹ Ø¬Ù†ÙˆØ¯Ù‡ ÙƒØªÙØ§Ù‹ Ù„ÙƒØªÙ ÙÙŠ Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø«Ù†Ø¯Ø§Ø±.', ' Ù†Ø²Ù„Øª Ø¹Ù† Ø¹Ø±Ø´Ù‡Ø§ ÙˆÙ‚Ø§ØªÙ„Øª Ù…Ø¹ Ø¬Ù†ÙˆØ¯Ù‡Ø§ ÙƒØªÙØ§Ù‹ Ù„ÙƒØªÙ ÙÙŠ Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø«Ù†Ø¯Ø§Ø±.') : '';
      const sacrifice = G.tags.has('king_sacrifice') ? gT(' ÙˆØ­ÙŠÙ† Ø¶Ø§Ù‚Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø©ØŒ Ø¨Ø§Ø¹ Ø£Ø±Ø§Ø¶ÙŠÙ‡ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù„ÙŠÙØ·Ø¹Ù… Ø§Ù„Ø´Ø¹Ø¨.', ' ÙˆØ­ÙŠÙ† Ø¶Ø§Ù‚Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø©ØŒ Ø¨Ø§Ø¹Øª Ø£Ø±Ø§Ø¶ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù„ØªÙØ·Ø¹Ù… Ø§Ù„Ø´Ø¹Ø¨.') : '';
      const leyla = G.tags.has('leyla_trusted') ? gT(' ÙˆÙƒØ§Ù†Øª Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø© Ù…Ø±Ø¢ØªÙ‡ Ø§Ù„ØªÙŠ Ù„Ø§ ØªÙƒØ°Ø¨.', ' ÙˆÙƒØ§Ù†Øª Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø© Ø³Ù†Ø¯Ù‡Ø§ Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠØ®Ø°Ù„.') : '';
      return gT(
        `Ø­ÙƒÙ… <strong>${G.name}</strong> Ø¨Ø­ÙƒÙ…Ø© Ù†Ø¯Ø± Ù†Ø¸ÙŠØ±Ù‡Ø§ ÙÙŠ ØªØ§Ø±ÙŠØ® Ø£Ø±ÙŠÙ‡Ø§Ù†.${battle}${sacrifice}${charter}${uni}${leyla} Ø§Ù„Ø´Ø¹Ø¨ Ø£Ø­Ø¨Ù‘Ù‡ØŒ Ø§Ù„Ø¬ÙŠØ´ ÙˆØ«Ù‚ Ø¨Ù‡ØŒ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ø­ØªØ±Ù…ÙˆÙ‡ØŒ ÙˆØ§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ø£Ø°Ø¹Ù†ÙˆØ§ Ù„Ø±Ø¤ÙŠØªÙ‡. Ø­ÙŠÙ† Ù„ÙØ¸ Ø£Ù†ÙØ§Ø³Ù‡ØŒ Ø¨ÙƒÙ‰ Ø§Ù„ØºÙ†ÙŠ ÙˆØ§Ù„ÙÙ‚ÙŠØ± ÙˆØ¬Ù†Ø¯ÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ´ÙŠØ® Ø§Ù„Ù‚Ø±ÙŠØ© Ù…Ø¹Ø§Ù‹. Ø§Ø³Ù…Ù‡ Ù†ÙÙ‚Ø´ Ø°Ù‡Ø¨Ø§Ù‹ Ø¹Ù„Ù‰ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ø§ØµÙ…Ø© ÙˆÙ„Ø§ ÙŠØ²Ø§Ù„ ÙŠÙÙ‚Ø±Ø£ Ø­ØªÙ‰ Ø§Ù„ÙŠÙˆÙ….`,
        `Ø­ÙƒÙ…Øª <strong>${G.name}</strong> Ø¨Ø­ÙƒÙ…Ø© Ù†Ø¯Ø± Ù†Ø¸ÙŠØ±Ù‡Ø§ ÙÙŠ ØªØ§Ø±ÙŠØ® Ø£Ø±ÙŠÙ‡Ø§Ù†.${battle}${sacrifice}${charter}${uni}${leyla} Ø§Ù„Ø´Ø¹Ø¨ Ø£Ø­Ø¨Ù‘Ù‡Ø§ØŒ Ø§Ù„Ø¬ÙŠØ´ ÙˆØ«Ù‚ Ø¨Ù‡Ø§ØŒ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ø­ØªØ±Ù…ÙˆÙ‡Ø§ØŒ ÙˆØ§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ø£Ø°Ø¹Ù†ÙˆØ§ Ù„Ø±Ø¤ÙŠØªÙ‡Ø§. Ø­ÙŠÙ† Ù„ÙØ¸Øª Ø£Ù†ÙØ§Ø³Ù‡Ø§ØŒ Ø¨ÙƒÙ‰ Ø§Ù„ØºÙ†ÙŠ ÙˆØ§Ù„ÙÙ‚ÙŠØ± ÙˆØ¬Ù†Ø¯ÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© ÙˆØ´ÙŠØ® Ø§Ù„Ù‚Ø±ÙŠØ© Ù…Ø¹Ø§Ù‹. Ø§Ø³Ù…Ù‡Ø§ Ù†ÙÙ‚Ø´ Ø°Ù‡Ø¨Ø§Ù‹ Ø¹Ù„Ù‰ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ø§ØµÙ…Ø© ÙˆÙ„Ø§ ÙŠØ²Ø§Ù„ ÙŠÙÙ‚Ø±Ø£ Ø­ØªÙ‰ Ø§Ù„ÙŠÙˆÙ….`
      );
    },
  },
  {
    id: 'sacrifice_legend',
    condition: () => G.tags.has('king_sacrifice') && G.tags.has('healed_all') && G.people >= 68,
    icon: 'ğŸ›ï¸', color: '#c0d4a8',
    title: 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø°ÙŠ Ø£Ø¹Ø·Ù‰ ÙƒÙ„ Ø´ÙŠØ¡',
    rank: 'Ø±Ù…Ø² Ø§Ù„ØªØ¶Ø­ÙŠØ© ÙÙŠ Ø£Ø±ÙŠÙ‡Ø§Ù†',
    story: () => {
      const uni = G.tags.has('university_built') ? gT(' Ø«Ù… Ø¨Ù†Ù‰ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø¹Ù„Ù‰ Ù…Ø§ ØªØ¨Ù‚Ù‰ Ù…Ù† Ø§Ù„Ø®Ø²ÙŠÙ†Ø©.', ' Ø«Ù… Ø¨Ù†Øª Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø¹Ù„Ù‰ Ù…Ø§ ØªØ¨Ù‚Ù‰ Ù…Ù† Ø§Ù„Ø®Ø²ÙŠÙ†Ø©.') : '';
      return gT(
        `Ù„Ù… ÙŠÙƒÙ† <strong>${G.name}</strong> Ø§Ù„Ø£ØºÙ†Ù‰ ÙˆÙ„Ø§ Ø§Ù„Ø£Ù‚ÙˆÙ‰ØŒ Ù„ÙƒÙ†Ù‡ ÙƒØ§Ù† Ø§Ù„Ø£ÙƒØ«Ø± Ø¹Ø·Ø§Ø¡Ù‹. Ø¨Ø§Ø¹ Ø£Ø±Ø§Ø¶ÙŠÙ‡ Ù„ÙŠÙØ·Ø¹Ù… Ø§Ù„Ø¬Ø§Ø¦Ø¹ÙŠÙ†ØŒ ÙˆÙØªØ­ Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙƒØ§Ù…Ù„Ø§Ù‹ Ù„ÙŠØ¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø¶Ù‰.${uni} Ø­ÙŠÙ† Ù…Ø§Øª ÙÙ‚ÙŠØ±Ø§Ù‹ Ø¨Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ù„ÙˆÙƒØŒ Ø­Ù…Ù„ Ø§Ù„Ø´Ø¹Ø¨ Ù†Ø¹Ø´Ù‡ Ø¨Ø£ÙŠØ¯Ù ØºÙŠØ± Ù…ØªØ¹Ø¨Ø© â€” Ù„Ø£Ù†Ù‡ ÙƒØ§Ù† Ø£Ø«Ù‚Ù„ Ø§Ù„Ù…Ù„ÙˆÙƒ Ø¹Ù„Ù‰ Ù‚Ù„Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ£Ø®ÙÙ‘Ù‡Ù… Ø¹Ù„Ù‰ ÙƒØ§Ù‡Ù„ Ø§Ù„Ø´Ø¹Ø¨.`,
        `Ù„Ù… ØªÙƒÙ† <strong>${G.name}</strong> Ø§Ù„Ø£ØºÙ†Ù‰ ÙˆÙ„Ø§ Ø§Ù„Ø£Ù‚ÙˆÙ‰ØŒ Ù„ÙƒÙ†Ù‡Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø¹Ø·Ø§Ø¡Ù‹. Ø¨Ø§Ø¹Øª Ø£Ø±Ø§Ø¶ÙŠÙ‡Ø§ Ù„ØªÙØ·Ø¹Ù… Ø§Ù„Ø¬Ø§Ø¦Ø¹ÙŠÙ†ØŒ ÙˆÙØªØ­Øª Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙƒØ§Ù…Ù„Ø§Ù‹ Ù„ØªØ¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø¶Ù‰.${uni} Ø­ÙŠÙ† Ù…Ø§ØªØª ÙÙ‚ÙŠØ±Ø©Ù‹ Ø¨Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ù„ÙˆÙƒØŒ Ø­Ù…Ù„ Ø§Ù„Ø´Ø¹Ø¨ Ù†Ø¹Ø´Ù‡Ø§ Ø¨Ø£ÙŠØ¯Ù ØºÙŠØ± Ù…ØªØ¹Ø¨Ø© â€” Ù„Ø£Ù†Ù‡Ø§ ÙƒØ§Ù†Øª Ø£Ø«Ù‚Ù„ Ø§Ù„Ù…Ù„ÙƒØ§Øª Ø¹Ù„Ù‰ Ù‚Ù„Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ£Ø®ÙÙ‘Ù‡Ù† Ø¹Ù„Ù‰ ÙƒØ§Ù‡Ù„ Ø§Ù„Ø´Ø¹Ø¨.`
      );
    },
  },
  {
    id: 'people_king',
    condition: () => G.people >= 75 && G.army < 50,
    icon: 'ğŸ•Šï¸', color: '#4caf8c',
    title: 'Ù…Ø­Ø¨ÙˆØ¨ Ø§Ù„Ø´Ø¹Ø¨',
    rank: 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠ',
    story: () => {
      const healed = G.tags.has('healed_all') ? gT(' ØµØ±Ù Ø®Ø²ÙŠÙ†ØªÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¯ÙˆÙ† ØªØ±Ø¯Ø¯.', ' ØµØ±ÙØª Ø®Ø²ÙŠÙ†ØªÙ‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø¯ÙˆÙ† ØªØ±Ø¯Ø¯.') : '';
      const stores = G.tags.has('opened_stores') ? gT(' ÙˆÙØªØ­ Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø­Ø¨ÙˆØ¨ Ø­ÙŠÙ† Ø¬Ø§Ø¹ Ø§Ù„ÙÙ‚Ø±Ø§Ø¡.', ' ÙˆÙØªØ­Øª Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø­Ø¨ÙˆØ¨ Ø­ÙŠÙ† Ø¬Ø§Ø¹ Ø§Ù„ÙÙ‚Ø±Ø§Ø¡.') : '';
      const poet = G.tags.has('poet_protected') ? gT(' ÙˆØ­Ù…Ù‰ Ø§Ù„Ø´Ø§Ø¹Ø± Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù„ Ù…Ø§ ÙŠØ®Ø§ÙÙ‡ Ø§Ù„Ù…Ù„ÙˆÙƒ.', ' ÙˆØ­Ù…Øª Ø§Ù„Ø´Ø§Ø¹Ø± Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù„ Ù…Ø§ ÙŠØ®Ø§ÙÙ‡ Ø§Ù„Ù…Ù„ÙˆÙƒ.') : '';
      return gT(
        `Ù„Ù… ÙŠÙƒÙ† <strong>${G.name}</strong> Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ù…Ù„ÙˆÙƒ ÙˆÙ„Ø§ Ø£ØºÙ†Ø§Ù‡Ù…ØŒ Ù„ÙƒÙ†Ù‡ ÙƒØ§Ù† Ø£ÙƒØ«Ø±Ù‡Ù… Ø±Ø­Ù…Ø©.${healed}${stores}${poet} Ø§Ø®ØªØ§Ø± Ø§Ù„Ø´Ø¹Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ©ØŒ ÙˆØ§Ù„Ø¹Ø¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙŠØ¨Ø©. Ø­ÙŠÙ† Ù…Ø§ØªØŒ Ø­Ù…Ù„ Ø§Ù„ÙÙ‚Ø±Ø§Ø¡ Ù†Ø¹Ø´Ù‡ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ â€” ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ø°ÙŠÙ† Ù„Ù… ÙŠØ¹Ø±ÙÙˆÙ‡ ÙˆØ¶Ø¹ÙˆØ§ Ø§Ù„Ø²Ù‡ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø¨Ø±Ù‡ Ù„Ø£Ù† Ø£Ù…Ù‡Ø§ØªÙ‡Ù… Ø­ÙƒÙŠÙ† Ù„Ù‡Ù… Ù‚ØµØªÙ‡.`,
        `Ù„Ù… ØªÙƒÙ† <strong>${G.name}</strong> Ø£Ù‚ÙˆÙ‰ Ø§Ù„Ù…Ù„ÙƒØ§Øª ÙˆÙ„Ø§ Ø£ØºÙ†Ø§Ù‡Ù†ØŒ Ù„ÙƒÙ†Ù‡Ø§ ÙƒØ§Ù†Øª Ø£ÙƒØ«Ø±Ù‡Ù† Ø±Ø­Ù…Ø©Ù‹.${healed}${stores}${poet} Ø§Ø®ØªØ§Ø±Øª Ø§Ù„Ø´Ø¹Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ©ØŒ ÙˆØ§Ù„Ø¹Ø¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙŠØ¨Ø©. Ø­ÙŠÙ† Ù…Ø§ØªØªØŒ Ø­Ù…Ù„ Ø§Ù„ÙÙ‚Ø±Ø§Ø¡ Ù†Ø¹Ø´Ù‡Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ â€” ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ø°ÙŠÙ† Ù„Ù… ÙŠØ¹Ø±ÙÙˆÙ‡Ø§ ÙˆØ¶Ø¹ÙˆØ§ Ø§Ù„Ø²Ù‡ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø¨Ø±Ù‡Ø§ Ù„Ø£Ù† Ø£Ù…Ù‡Ø§ØªÙ‡Ù… Ø­ÙƒÙŠÙ† Ù„Ù‡Ù… Ù‚ØµØªÙ‡Ø§.`
      );
    },
  },
  {
    id: 'warrior_king',
    condition: () => G.army >= 72 && G.tags.has('led_battle'),
    icon: 'âš”ï¸', color: '#c94c4c',
    title: 'Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ù…Ø­Ø§Ø±Ø¨',
    rank: 'Ù‚Ø§Ù‡Ø± Ø§Ù„Ø«Ù†Ø¯Ø§Ø±',
    story: () => {
      const empire = G.tags.has('empire_declared') ? gT(' Ø«Ù… Ø£Ø¹Ù„Ù† Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ÙˆÙ…Ø¯Ù‘ Ø§Ù„Ø±Ø§ÙŠØ© Ø¥Ù„Ù‰ Ù…Ø§ ÙˆØ±Ø§Ø¡ Ø§Ù„Ø¬Ø¨Ø§Ù„.', ' Ø«Ù… Ø£Ø¹Ù„Ù†Øª Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ÙˆÙ…Ø¯Ù‘Øª Ø§Ù„Ø±Ø§ÙŠØ© Ø¥Ù„Ù‰ Ù…Ø§ ÙˆØ±Ø§Ø¡ Ø§Ù„Ø¬Ø¨Ø§Ù„.') : '';
      const diplomat = G.tags.has('sent_envoy') ? gT(' ÙˆÙ„ÙƒÙ†Ù‡ Ø¹Ø±Ù Ù…ØªÙ‰ ÙŠÙØ±Ø³Ù„ Ø§Ù„Ù…Ø¨Ø¹ÙˆØ« Ù‚Ø¨Ù„ Ø§Ù„Ø³ÙŠÙ.', ' ÙˆÙ„ÙƒÙ†Ù‡Ø§ Ø¹Ø±ÙØª Ù…ØªÙ‰ ØªÙØ±Ø³Ù„ Ø§Ù„Ù…Ø¨Ø¹ÙˆØ« Ù‚Ø¨Ù„ Ø§Ù„Ø³ÙŠÙ.') : '';
      return gT(
        `Ø®Ø±Ø¬ <strong>${G.name}</strong> Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø¬ÙŠØ´Ù‡ ÙˆØ§Ù„Ø´Ø¹Ø¨ ÙŠÙ‡ØªÙ.${empire}${diplomat} Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ­ÙØ¸ Ø§Ù†ØªØµØ§Ø±Ø§ØªÙ‡ â€” ÙˆÙŠÙ†Ø³Ù‰ Ù…Ø§ Ø¯ÙÙ…Ù‘Ø± Ø®Ù„ÙÙ‡Ø§. Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„Ø°ÙŠÙ† Ù‚Ø§ØªÙ„ÙˆØ§ Ù…Ø¹Ù‡ ÙŠØ±ÙˆÙˆÙ† Ù„Ø£Ø­ÙØ§Ø¯Ù‡Ù…: "Ø±Ø£ÙŠØª Ø§Ù„Ù…Ù„Ùƒ ÙŠØ´Ø±Ø¨ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù†Ù‡Ø± ÙˆÙ†Ø­Ù†."`,
        `Ø®Ø±Ø¬Øª <strong>${G.name}</strong> Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø¬ÙŠØ´Ù‡Ø§ ÙˆØ§Ù„Ø´Ø¹Ø¨ ÙŠÙ‡ØªÙ.${empire}${diplomat} Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ­ÙØ¸ Ø§Ù†ØªØµØ§Ø±Ø§ØªÙ‡Ø§ â€” ÙˆÙŠÙ†Ø³Ù‰ Ù…Ø§ Ø¯ÙÙ…Ù‘Ø± Ø®Ù„ÙÙ‡Ø§. Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„Ø°ÙŠÙ† Ù‚Ø§ØªÙ„ÙˆØ§ Ù…Ø¹Ù‡Ø§ ÙŠØ±ÙˆÙˆÙ† Ù„Ø£Ø­ÙØ§Ø¯Ù‡Ù…: "Ø±Ø£ÙŠØª Ø§Ù„Ù…Ù„ÙƒØ© ØªØ´Ø±Ø¨ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù†Ù‡Ø± ÙˆÙ†Ø­Ù†."`
      );
    },
  },
  {
    id: 'diplomat_king',
    condition: () => G.tags.has('sent_envoy') && G.tags.has('diplomacy_rebel') && G.tags.has('council_diplomacy') && G.people >= 58,
    icon: 'ğŸŒ¿', color: '#4c9caf',
    title: () => gT('Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø°ÙŠ Ù„Ù… ÙŠÙØ´Ù‡Ø± Ø³ÙŠÙØ§Ù‹', 'Ø§Ù„Ù…Ù„ÙƒØ© Ø§Ù„ØªÙŠ Ù„Ù… ØªÙØ´Ù‡Ø± Ø³ÙŠÙØ§Ù‹'),
    rank: 'Ø³ÙŠØ¯ Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§Ù„ØªÙØ§Ù‡Ù…',
    story: () => {
      const brother = G.tags.has('adopted_brother') ? gT(' ÙˆØ£Ø®ÙˆÙ‡ Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ ØµØ§Ø± Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±ÙŠÙ† ÙˆÙØ§Ø¡Ù‹.', ' ÙˆØ§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø´ ØµØ§Ø± Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø³ØªØ´Ø§Ø±ÙŠÙ† ÙˆÙØ§Ø¡Ù‹.') : '';
      return gT(
        `ÙƒØ§Ù† Ù…Ø³ØªØ´Ø§Ø±Ùˆ <strong>${G.name}</strong> ÙŠÙ‚ÙˆÙ„ÙˆÙ† Ù„Ù‡: "Ø§Ù„Ø­Ø±Ø¨ Ø£Ø³Ø±Ø¹". ÙÙƒØ§Ù† ÙŠØ¬ÙŠØ¨: "Ø§Ù„Ø­Ø±Ø¨ Ù„Ø§ ØªÙØ¨Ù†ÙŠ Ù…Ø¯ÙŠÙ†Ø©." ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø§Ù„Ù…ØªÙ…Ø±Ø¯ÙŠÙ†ØŒ Ø±Ø§Ø³Ù„ Ø£Ø¹Ø¯Ø§Ø¡Ù‡ØŒ Ø¨Ø¹Ø« Ù…Ø¨Ø¹ÙˆØ«ÙŠÙ‡ Ù‚Ø¨Ù„ Ø¬Ù†ÙˆØ¯Ù‡.${brother} Ø£Ø±ÙŠÙ‡Ø§Ù† ÙÙŠ Ø¹Ù‡Ø¯Ù‡ Ù„Ù… ØªÙÙˆØ±ÙÙ‘Ø« Ø£Ø±Ø§Ù…Ù„ â€” ÙˆÙ‡Ø°Ø§ ÙˆØ­Ø¯Ù‡ ÙƒØ§ÙÙ Ù„ÙŠÙÙƒØªØ¨ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©.`,
        `ÙƒØ§Ù† Ù…Ø³ØªØ´Ø§Ø±Ùˆ <strong>${G.name}</strong> ÙŠÙ‚ÙˆÙ„ÙˆÙ† Ù„Ù‡Ø§: "Ø§Ù„Ø­Ø±Ø¨ Ø£Ø³Ø±Ø¹". ÙÙƒØ§Ù†Øª ØªØ¬ÙŠØ¨: "Ø§Ù„Ø­Ø±Ø¨ Ù„Ø§ ØªÙØ¨Ù†ÙŠ Ù…Ø¯ÙŠÙ†Ø©." ØªÙØ§ÙˆØ¶Øª Ù…Ø¹ Ø§Ù„Ù…ØªÙ…Ø±Ø¯ÙŠÙ†ØŒ Ø±Ø§Ø³Ù„Øª Ø£Ø¹Ø¯Ø§Ø¡Ù‡Ø§ØŒ Ø¨Ø¹Ø«Øª Ù…Ø¨Ø¹ÙˆØ«ÙŠÙ‡Ø§ Ù‚Ø¨Ù„ Ø¬Ù†ÙˆØ¯Ù‡Ø§.${brother} Ø£Ø±ÙŠÙ‡Ø§Ù† ÙÙŠ Ø¹Ù‡Ø¯Ù‡Ø§ Ù„Ù… ØªÙÙˆØ±ÙÙ‘Ø« Ø£Ø±Ø§Ù…Ù„ â€” ÙˆÙ‡Ø°Ø§ ÙˆØ­Ø¯Ù‡ ÙƒØ§ÙÙ Ù„ÙŠÙÙƒØªØ¨ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©.`
      );
    },
  },
  {
    id: 'church_puppet',
    condition: () => G.church >= 78 && G.people < 58,
    icon: 'ğŸ“œ', color: '#6c8ccf',
    title: 'Ù…Ù„Ùƒ ÙÙŠ Ø¸Ù„ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡',
    rank: 'ØªØ§Ø±ÙŠØ® ÙƒØªØ¨Ù‡ ØºÙŠØ±Ù‡',
    story: () => {
      const debt = G.tags.has('church_debt') ? gT(' Ù…Ù†Ø° Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ Ø­ÙŠÙ† Ø§Ø³ØªØ¹Ø§Ø± Ù…Ù† Ø®Ø²ÙŠÙ†ØªÙ‡Ù…ØŒ Ø±Ø³Ù…ÙˆØ§ Ø·Ø±ÙŠÙ‚Ù‡.', ' Ù…Ù†Ø° Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ Ø­ÙŠÙ† Ø§Ø³ØªØ¹Ø§Ø±Øª Ù…Ù† Ø®Ø²ÙŠÙ†ØªÙ‡Ù…ØŒ Ø±Ø³Ù…ÙˆØ§ Ø·Ø±ÙŠÙ‚Ù‡Ø§.') : '';
      return gT(
        `Ø­ÙƒÙ… <strong>${G.name}</strong>ØŒ Ù„ÙƒÙ† Ø§Ù„Ø­ÙƒÙŠÙ… Ø±Ø§Ø´Ø¯ Ù‡Ùˆ Ù…Ù† Ø±Ø³Ù… Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ÙØ¹Ù„ÙŠØ§Ù‹.${debt} Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ø§Ù†ØªØµØ±ÙˆØ§ØŒ ÙˆØ§Ù„Ù…Ù„Ùƒ ØµØ§Ø± ÙˆØ§Ø¬Ù‡ØªÙ‡Ù… Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©. Ø­ÙŠÙ† Ù…Ø§ØªØŒ Ø¬Ø§Ø¡ Ø®Ù„ÙŠÙØªÙ‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ø£ÙŠØ¶Ø§Ù‹. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ°ÙƒØ± Ø§Ø³Ù… Ø±Ø§Ø´Ø¯ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ùƒ.`,
        `Ø­ÙƒÙ…Øª <strong>${G.name}</strong>ØŒ Ù„ÙƒÙ† Ø§Ù„Ø­ÙƒÙŠÙ… Ø±Ø§Ø´Ø¯ Ù‡Ùˆ Ù…Ù† Ø±Ø³Ù… Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ÙØ¹Ù„ÙŠØ§Ù‹.${debt} Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ø§Ù†ØªØµØ±ÙˆØ§ØŒ ÙˆØ§Ù„Ù…Ù„ÙƒØ© ØµØ§Ø±Øª ÙˆØ§Ø¬Ù‡ØªÙ‡Ù… Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©. Ø­ÙŠÙ† Ù…Ø§ØªØªØŒ Ø¬Ø§Ø¡ Ø®Ù„ÙŠÙØªÙ‡Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ø£ÙŠØ¶Ø§Ù‹. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ°ÙƒØ± Ø§Ø³Ù… Ø±Ø§Ø´Ø¯ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„ÙƒØ©.`
      );
    },
  },
  {
    id: 'noble_puppet',
    condition: () => G.nobles >= 78 && G.people < 45,
    icon: 'ğŸ’', color: '#9c7caf',
    title: 'Ù…Ù„Ùƒ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡',
    rank: 'Ø§Ù„Ø¹Ø±Ø´ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„ÙØ§Ø±Øº',
    story: () => {
      const yusuf = G.tags.has('yusuf_deal') ? ' Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ ÙƒØ§Ù† Ø£ÙƒØ«Ø± Ø§Ù„ÙˆØ¬ÙˆÙ‡ Ø­Ø¶ÙˆØ±Ø§Ù‹ ÙÙŠ Ø§Ù„Ù‚ØµØ±.' : '';
      return gT(
        `Ø­ÙƒÙ… <strong>${G.name}</strong> Ù…Ù† Ø¹Ø±Ø´ Ù…Ø·Ù„ÙŠ Ø¨Ø§Ù„Ø°Ù‡Ø¨ØŒ Ù„ÙƒÙ† Ø§Ù„Ø°Ù‡Ø¨ Ù„Ù… ÙŠÙƒÙ† Ø°Ù‡Ø¨Ù‡.${yusuf} Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø£Ø¹Ø·ÙˆÙ‡ Ø§Ù„Ù„Ù‚Ø¨ ÙˆØ§Ø­ØªÙØ¸ÙˆØ§ Ø¨Ø§Ù„Ø³Ù„Ø·Ø©. Ø§Ù„Ø´Ø¹Ø¨ ÙÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬ ÙŠÙ†Ø§Ø¯ÙŠ Ø¨Ù…Ù„Ùƒ ÙŠØ±Ø§Ù‡Ù…. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ³Ø¬Ù„ Ø¹Ù‡Ø¯Ù‡: "Ø­ÙƒÙ…Ù‡ Ø§Ù„Ø£Ø«Ø±ÙŠØ§Ø¡ØŒ ÙˆØ¯ÙØ¹ Ø§Ù„Ø«Ù…Ù† Ø§Ù„ÙÙ‚Ø±Ø§Ø¡."`,
        `Ø­ÙƒÙ…Øª <strong>${G.name}</strong> Ù…Ù† Ø¹Ø±Ø´ Ù…Ø·Ù„ÙŠ Ø¨Ø§Ù„Ø°Ù‡Ø¨ØŒ Ù„ÙƒÙ† Ø§Ù„Ø°Ù‡Ø¨ Ù„Ù… ÙŠÙƒÙ† Ø°Ù‡Ø¨Ù‡Ø§.${yusuf} Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø£Ø¹Ø·ÙˆÙ‡Ø§ Ø§Ù„Ù„Ù‚Ø¨ ÙˆØ§Ø­ØªÙØ¸ÙˆØ§ Ø¨Ø§Ù„Ø³Ù„Ø·Ø©. Ø§Ù„Ø´Ø¹Ø¨ ÙÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬ ÙŠÙ†Ø§Ø¯ÙŠ Ø¨Ù…Ù„ÙƒØ© ØªØ±Ø§Ù‡Ù…. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ³Ø¬Ù„ Ø¹Ù‡Ø¯Ù‡Ø§: "Ø­ÙƒÙ…Ù‡Ø§ Ø§Ù„Ø£Ø«Ø±ÙŠØ§Ø¡ØŒ ÙˆØ¯ÙØ¹ Ø§Ù„Ø«Ù…Ù† Ø§Ù„ÙÙ‚Ø±Ø§Ø¡."`
      );
    },
  },
  {
    id: 'brother_king',
    condition: () => (G.tags.has('adopted_brother') || G.tags.has('brother_revealed')) && G.people >= 62,
    icon: 'ğŸ‘‘', color: '#c9a843',
    title: 'Ù…Ù„ÙƒØ§Ù† Ø¨Ø±ÙˆØ­ ÙˆØ§Ø­Ø¯Ø©',
    rank: 'Ù…Ù† Ø£Ù†Ù‡Ù‰ ÙƒØ±Ø§Ù‡ÙŠØ© Ø§Ù„Ø¯Ù…',
    story: () => {
      const real = G.tags.has('solomon_secret') ? gT(' Ø¹Ù„Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø§Ø¹ØªØ±Ø§Ù Ù…Ø±ÙˆØ§Ù† â€” ÙˆÙ…Ø¹ Ø°Ù„Ùƒ ÙØªØ­ Ø°Ø±Ø§Ø¹ÙŠÙ‡.', ' Ø¹Ù„Ù…Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø§Ø¹ØªØ±Ø§Ù Ù…Ø±ÙˆØ§Ù† â€” ÙˆÙ…Ø¹ Ø°Ù„Ùƒ ÙØªØ­Øª Ø°Ø±Ø§Ø¹ÙŠÙ‡Ø§.') : '';
      return gT(
        `Ù‚Ø±Ù‘Ø± <strong>${G.name}</strong> Ø£Ù† Ø§Ù„Ø±Ø­Ù…Ø© Ø£Ù‚ÙˆÙ‰ Ù…Ù† Ø§Ù„Ø®ÙˆÙ.${real} Ø§Ù„Ø£Ø® Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø®Ø·Ø± Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ØŒ ØµØ§Ø± Ø£ÙˆØ«Ù‚ Ø§Ù„Ø­Ù„ÙØ§Ø¡. Ø£Ø±ÙŠÙ‡Ø§Ù† Ø¹Ø±ÙØª Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© Ù…Ù„ÙƒØ§Ù‹ ÙŠØ´Ø§ÙˆØ± Ø£Ø®Ø§Ù‡ Ù‚Ø¨Ù„ Ù…Ø¬Ù„Ø³Ù‡. Ø§Ù„Ø´Ø¹Ø¨ Ù‚Ø§Ù„: "Ù‡Ø°Ø§ Ù…Ù„Ùƒ Ù„Ø§ ÙŠØ®Ø´Ù‰ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©."`,
        `Ù‚Ø±Ù‘Ø±Øª <strong>${G.name}</strong> Ø£Ù† Ø§Ù„Ø±Ø­Ù…Ø© Ø£Ù‚ÙˆÙ‰ Ù…Ù† Ø§Ù„Ø®ÙˆÙ.${real} Ø§Ù„Ø£Ø® Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø®Ø·Ø± Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ØŒ ØµØ§Ø± Ø£ÙˆØ«Ù‚ Ø§Ù„Ø­Ù„ÙØ§Ø¡. Ø£Ø±ÙŠÙ‡Ø§Ù† Ø¹Ø±ÙØª Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© Ù…Ù„ÙƒØ©Ù‹ ØªØ´Ø§ÙˆØ± Ù…Ù† ØªØ«Ù‚ Ø¨Ù‡ Ù‚Ø¨Ù„ Ù…Ø¬Ù„Ø³Ù‡Ø§. Ø§Ù„Ø´Ø¹Ø¨ Ù‚Ø§Ù„: "Ù‡Ø°Ù‡ Ù…Ù„ÙƒØ© Ù„Ø§ ØªØ®Ø´Ù‰ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©."`
      );
    },
  },
  {
    id: 'leyla_ending',
    condition: () => G.tags.has('leyla_trusted') && G.tags.has('forgave_solomon') && G.people >= 68,
    icon: 'ğŸŒ™', color: '#8c6caf',
    title: () => gT('ÙÙŠ Ø¸Ù„ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©', 'Ø­ÙƒÙŠÙ…ØªØ§Ù† ÙˆØ¹Ø±Ø´ ÙˆØ§Ø­Ø¯'),
    rank: () => gT('Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø°ÙŠ Ø¹Ø±Ù Ù…ØªÙ‰ ÙŠØ³ØªÙ…Ø¹', 'Ø§Ù„Ù…Ù„ÙƒØ© Ø§Ù„ØªÙŠ Ø¹Ø±ÙØª Ù…ØªÙ‰ ØªØ³ØªÙ…Ø¹'),
    story: () => {
      const ng = G.tags.has('ng_leyla_secret') ? ' ÙˆÙƒØ§Ù†Øª Ù„ÙŠÙ„Ù‰ ØªØ­Ù…Ù„ Ø³Ø±Ø§Ù‹ Ø£Ø¹Ù…Ù‚: Ù‡ÙŠ Ø§Ø¨Ù†Ø© Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ…ØŒ Ø§Ù„Ø´Ø§Ù‡Ø¯ Ø¹Ù„Ù‰ ÙƒÙ„ Ø´ÙŠØ¡.' : '';
      return gT(
        `ÙƒØ§Ù†Øª <strong>Ù„ÙŠÙ„Ù‰</strong> ØªØ¹Ø±Ù Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ Ù‚ØµØ© Ù‚Ø¨Ù„ Ø£Ù† ØªØ¨Ø¯Ø£.${ng} ÙˆÙƒØ§Ù† <strong>${G.name}</strong> ÙŠØ¹Ø±Ù Ù…ØªÙ‰ ÙŠØµÙ…Øª ÙˆÙ…ØªÙ‰ ÙŠØªÙƒÙ„Ù…. Ù…Ø¹Ø§Ù‹ Ø£Ø¯Ø§Ø±ÙˆØ§ Ø£Ø±ÙŠÙ‡Ø§Ù† Ø¨Ù‡Ø¯ÙˆØ¡ Ù„Ù… ØªØ¹Ø±ÙÙ‡ Ù…Ù† Ù‚Ø¨Ù„. Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ÙƒØ¨Ø±Ù‰ Ø§ØªÙÙ‘Ø®Ø°Øª ÙÙŠ ØºØ±Ù Ù‡Ø§Ø¯Ø¦Ø© Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø¶Ø¬ÙŠØ¬. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙƒØªØ¨ Ø§Ø³Ù…ÙŠÙ‡Ù…Ø§ Ù…Ø¹Ø§Ù‹ â€” Ø§Ù„Ù…Ù„Ùƒ ÙˆØ§Ù„Ø­ÙƒÙŠÙ…Ø© â€” ÙÙŠ ÙØµÙ„ ÙˆØ§Ø­Ø¯.`,
        `ÙƒØ§Ù†Øª <strong>Ù„ÙŠÙ„Ù‰</strong> ØªØ¹Ø±Ù Ù†Ù‡Ø§ÙŠØ© ÙƒÙ„ Ù‚ØµØ© Ù‚Ø¨Ù„ Ø£Ù† ØªØ¨Ø¯Ø£.${ng} ÙˆÙƒØ§Ù†Øª <strong>${G.name}</strong> ØªØ¹Ø±Ù Ù…ØªÙ‰ ØªØµÙ…Øª ÙˆÙ…ØªÙ‰ ØªØªÙƒÙ„Ù…. Ø­ÙƒÙŠÙ…ØªØ§Ù†ØŒ Ø¹Ø±Ø´ ÙˆØ§Ø­Ø¯ØŒ ÙˆØ£Ø±ÙŠÙ‡Ø§Ù† Ù„Ù… ØªØ´Ù‡Ø¯ Ù…Ø«Ù„Ù‡Ù…Ø§. Ø§Ù„ØªØ§Ø±ÙŠØ® ÙƒØªØ¨ Ø§Ø³Ù…ÙŠÙ‡Ù…Ø§ Ù…Ø¹Ø§Ù‹ â€” Ø§Ù„Ù…Ù„ÙƒØ© ÙˆØ§Ù„Ø­ÙƒÙŠÙ…Ø© â€” ÙÙŠ ÙØµÙ„ Ù„Ø§ ÙŠÙØ·ÙˆÙ‰.`
      );
    },
  },
  {
    id: 'empire',
    condition: () => G.tags.has('empire_declared') && G.army >= 70,
    icon: 'ğŸ”¥', color: '#d46020',
    title: () => gT('Ù…Ø¤Ø³Ø³ Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©', 'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©'),
    rank: 'Ø§Ù„ÙØ§ØªØ­ Ø§Ù„Ø£Ø¹Ø¸Ù…',
    story: () => {
      const charter = G.tags.has('charter_issued') ? gT(' Ù„ÙƒÙ†Ù‡ ÙÙŠ Ø¢Ø®Ø± Ø£ÙŠØ§Ù…Ù‡ Ø£ØµØ¯Ø± Ø§Ù„Ù…ÙŠØ«Ø§Ù‚ â€” Ø±Ø¨Ù…Ø§ ØªÙƒÙÙŠØ±Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø¯Ù…Ø§Ø¡.', ' Ù„ÙƒÙ†Ù‡Ø§ ÙÙŠ Ø¢Ø®Ø± Ø£ÙŠØ§Ù…Ù‡Ø§ Ø£ØµØ¯Ø±Øª Ø§Ù„Ù…ÙŠØ«Ø§Ù‚ â€” Ø±Ø¨Ù…Ø§ ØªÙƒÙÙŠØ±Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø¯Ù…Ø§Ø¡.') : '';
      return gT(
        `<strong>${G.name}</strong> Ù„Ù… ÙŠÙƒØªÙÙ Ø¨Ø£Ø±ÙŠÙ‡Ø§Ù†. Ø§Ù„Ø±Ø§ÙŠØ© Ø§Ø±ØªÙØ¹Øª ÙÙŠ Ø£Ø±Ø§Ø¶Ù Ù„Ù… ÙŠØ­Ù„Ù… Ø¨Ù‡Ø§ Ø£Ø¨ÙˆÙ‡. Ø§Ù„Ø«Ù†Ø¯Ø§Ø± ØªØ±Ø§Ø¬Ø¹Øª. Ø§Ù„Ø­Ø¯ÙˆØ¯ ØªÙˆØ³Ø¹Øª. Ø§Ù„Ù‚Ø±Ù‰ Ø¨Ù†ÙÙŠØª Ø¹Ù„Ù‰ Ø£Ù†Ù‚Ø§Ø¶ Ù…Ø§ Ù‡ÙØ¯Ù….${charter} Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ°ÙƒØ±Ù‡ ÙØ§ØªØ­Ø§Ù‹ Ø¹Ø¸ÙŠÙ…Ø§Ù‹ â€” ÙˆØ´Ø¹Ø±Ø§Ø¡ Ø¢Ø®Ø±ÙˆÙ† ÙŠØ°ÙƒØ±ÙˆÙ†Ù‡ Ø¨ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰.`,
        `<strong>${G.name}</strong> Ù„Ù… ØªÙƒØªÙÙ Ø¨Ø£Ø±ÙŠÙ‡Ø§Ù†. Ø§Ù„Ø±Ø§ÙŠØ© Ø§Ø±ØªÙØ¹Øª ÙÙŠ Ø£Ø±Ø§Ø¶Ù Ù„Ù… ÙŠØ­Ù„Ù… Ø¨Ù‡Ø§ Ø£Ø¨ÙˆÙ‡Ø§. Ø§Ù„Ø«Ù†Ø¯Ø§Ø± ØªØ±Ø§Ø¬Ø¹Øª. Ø§Ù„Ø­Ø¯ÙˆØ¯ ØªÙˆØ³Ø¹Øª. Ø§Ù„Ù‚Ø±Ù‰ Ø¨Ù†ÙÙŠØª Ø¹Ù„Ù‰ Ø£Ù†Ù‚Ø§Ø¶ Ù…Ø§ Ù‡ÙØ¯Ù….${charter} Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ°ÙƒØ±Ù‡Ø§ ÙØ§ØªØ­Ø©Ù‹ Ø¹Ø¸ÙŠÙ…Ø© â€” ÙˆØ´Ø¹Ø±Ø§Ø¡ Ø¢Ø®Ø±ÙˆÙ† ÙŠØ°ÙƒØ±ÙˆÙ†Ù‡Ø§ Ø¨ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰.`
      );
    },
  },
  {
    id: 'collapse_betrayed',
    condition: () => G.people <= 22 && G.tags.has('public_trial'),
    icon: 'ğŸ—¡ï¸', color: '#7a1010',
    title: 'Ù…Ù…Ù„ÙƒØ© Ø¨Ù„Ø§ Ø°Ø§ÙƒØ±Ø©',
    rank: 'Ø³Ù‚Ø· ÙÙŠ Ø¹Ù‡Ø¯ Ø§Ù„ÙØ¶Ø§Ø¦Ø­',
    story: () => gT(
      `Ù…Ø­Ø§ÙƒÙ…Ø© Ù…Ø±ÙˆØ§Ù† ÙƒØ§Ù†Øª Ø§Ù„Ø´Ø±Ø§Ø±Ø© Ø§Ù„ØªÙŠ Ø£Ø´Ø¹Ù„Ù‡Ø§ <strong>${G.name}</strong> Ø¨ÙŠØ¯Ù‡. Ø§Ù„ÙØ¶ÙŠØ­Ø© Ø¨Ø¯Ù‘Ø¯Øª Ù…Ø§ ÙƒØ§Ù† ÙŠØªØ¨Ù‚Ù‰ Ù…Ù† Ø«Ù‚Ø©. Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ØªØ­Ø§Ù„ÙÙˆØ§ØŒ Ø§Ù„Ø´Ø¹Ø¨ Ù…Ù„Ù‘ØŒ ÙˆØ§Ù„Ø¬ÙŠØ´ Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø§Ø¦Ø¯ Ø¬Ø¯ÙŠØ¯. Ø³Ù‚Ø· Ø§Ù„Ø¹Ø±Ø´ ÙÙŠ Ù„ÙŠÙ„Ø© Ù…Ø·ÙŠØ±Ø©ØŒ ÙˆÙƒØªØ¨ Ø§Ù„Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ø³Ø¬ÙˆÙ†: "Ø§Ù„Ù…Ù„Ùƒ Ù†ÙØ³Ù‡ Ø£ÙˆÙ‚Ø¯ Ø§Ù„Ù†Ø§Ø± Ø§Ù„ØªÙŠ Ø£Ø­Ø±Ù‚ØªÙ‡."`,
      `Ù…Ø­Ø§ÙƒÙ…Ø© Ù…Ø±ÙˆØ§Ù† ÙƒØ§Ù†Øª Ø§Ù„Ø´Ø±Ø§Ø±Ø© Ø§Ù„ØªÙŠ Ø£Ø´Ø¹Ù„ØªÙ‡Ø§ <strong>${G.name}</strong> Ø¨ÙŠØ¯Ù‡Ø§. Ø§Ù„ÙØ¶ÙŠØ­Ø© Ø¨Ø¯Ù‘Ø¯Øª Ù…Ø§ ÙƒØ§Ù† ÙŠØªØ¨Ù‚Ù‰ Ù…Ù† Ø«Ù‚Ø©. Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ØªØ­Ø§Ù„ÙÙˆØ§ØŒ Ø§Ù„Ø´Ø¹Ø¨ Ù…Ù„Ù‘ØŒ ÙˆØ§Ù„Ø¬ÙŠØ´ Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø§Ø¦Ø¯ Ø¬Ø¯ÙŠØ¯. Ø³Ù‚Ø· Ø§Ù„Ø¹Ø±Ø´ ÙÙŠ Ù„ÙŠÙ„Ø© Ù…Ø·ÙŠØ±Ø©ØŒ ÙˆÙƒØªØ¨ Ø§Ù„Ø´Ø§Ø¹Ø± Ø§Ù„Ù…Ø³Ø¬ÙˆÙ†: "Ø§Ù„Ù…Ù„ÙƒØ© Ù†ÙØ³Ù‡Ø§ Ø£ÙˆÙ‚Ø¯Øª Ø§Ù„Ù†Ø§Ø± Ø§Ù„ØªÙŠ Ø£Ø­Ø±Ù‚ØªÙ‡Ø§."`
    ),
  },
  {
    id: 'collapse',
    condition: () => G.people <= 22 || G.army <= 14,
    icon: 'ğŸ’€', color: '#8b1a1a',
    title: 'Ø³Ù‚ÙˆØ· Ø£Ø±ÙŠÙ‡Ø§Ù†',
    rank: 'Ø¢Ø®Ø± Ù…Ù„ÙˆÙƒ Ø§Ù„Ø£Ø³Ø±Ø©',
    story: () => {
      const note = G.tags.has('scorched_earth') ? ' Ø§Ù„Ø£Ø±Ø§Ø¶ÙŠ Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø© Ù„Ù… ØªØªØ¹Ø§Ù Ø£Ø¨Ø¯Ø§Ù‹.' : G.tags.has('army_debt') ? ' Ø§Ù„Ø¬ÙŠØ´ Ø§Ù„Ø°ÙŠ Ø®ÙØ°Ù„ ÙˆØ¹Ø¯Ù‡ ÙƒØ§Ù† Ø¢Ø®Ø± Ù…Ù† Ø£Ø³Ù„Ù… Ø§Ù„Ø­ØµÙ†.' : '';
      return `Ù„Ø§ ÙŠÙÙƒØªØ¨ Ø§Ø³Ù… <strong>${G.name}</strong> Ø¥Ù„Ø§ Ù…Ù‚Ø±ÙˆÙ†Ø§Ù‹ Ø¨ÙƒÙ„Ù…Ø©: Ø§Ù„ÙƒØ§Ø±Ø«Ø©.${note} Ø§Ù„Ø´Ø¹Ø¨ Ø«Ø§Ø±ØŒ Ø§Ù„Ø¬ÙŠØ´ ØªÙÙƒÙƒØŒ ÙˆØ§Ù„Ù…Ù…Ù„ÙƒØ© ØªØ´Ù‚Ù‚Øª ÙƒØ§Ù„Ø®Ø²Ù Ø§Ù„Ù‚Ø¯ÙŠÙ…. Ø£Ø±ÙŠÙ‡Ø§Ù†... Ù„Ù… ØªØ¹Ø¯ Ø£Ø±ÙŠÙ‡Ø§Ù† Ø§Ù„ØªÙŠ ÙˆØ±Ø«Ù‡Ø§.`;
    },
  },
  {
    id: 'forgotten',
    condition: () => true,
    icon: 'ğŸ“œ', color: '#806040',
    title: () => gT('Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ù…Ù†Ø³ÙŠ', 'Ø§Ù„Ù…Ù„ÙƒØ© Ø§Ù„Ù…Ù†Ø³ÙŠØ©'),
    rank: () => gT('Ù…Ù„Ùƒ Ø¹Ø§Ø¯ÙŠ ÙÙŠ Ø²Ù…Ù† ØºÙŠØ± Ø¹Ø§Ø¯ÙŠ', 'Ù…Ù„ÙƒØ© Ø¹Ø§Ø¯ÙŠØ© ÙÙŠ Ø²Ù…Ù† ØºÙŠØ± Ø¹Ø§Ø¯ÙŠ'),
    story: () => {
      const choices_count = G.choices.length;
      return gT(
        `Ø­ÙƒÙ… <strong>${G.name}</strong> Ù„Ø³Ù†ÙˆØ§Øª. ${choices_count >= 8 ? 'Ø§ØªØ®Ø° Ù‚Ø±Ø§Ø±Ø§Øª ÙƒØ«ÙŠØ±Ø© â€” Ù„ÙƒÙ† Ù„Ø§ ÙŠÙØ°ÙƒØ± Ù…Ù†Ù‡Ø§ Ø´ÙŠØ¡.' : 'Ø­ÙƒÙ… Ø¨ØµÙ…Øª Ø£Ù‚Ø±Ø¨ Ù„Ù„ØªØ±Ø¯Ø¯.'} Ù„Ù… ÙŠÙØ¨Ø¯Ø¹ ÙˆÙ„Ù… ÙŠÙÙ‡Ù„Ùƒ. Ù‚Ø±Ø§Ø±Ø§Øª Ù…ØªØ°Ø¨Ø°Ø¨Ø©ØŒ Ù†Ø¬Ø§Ø­Ø§Øª Ù…ØªÙˆØ§Ø¶Ø¹Ø© ÙˆØ¥Ø®ÙØ§Ù‚Ø§Øª Ù…Ù‚Ø¨ÙˆÙ„Ø©. Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø±Ù‘ Ø¹Ù„ÙŠÙ‡ ÙƒÙ…Ø§ ÙŠÙ…Ø±Ù‘ Ø§Ù„Ø±ÙŠØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù…Ø§Ù„ â€” ÙŠØ­Ø±Ùƒ ÙˆÙ„Ø§ ÙŠÙØºÙŠØ±.`,
        `Ø­ÙƒÙ…Øª <strong>${G.name}</strong> Ù„Ø³Ù†ÙˆØ§Øª. ${choices_count >= 8 ? 'Ø§ØªØ®Ø°Øª Ù‚Ø±Ø§Ø±Ø§Øª ÙƒØ«ÙŠØ±Ø© â€” Ù„ÙƒÙ† Ù„Ø§ ÙŠÙØ°ÙƒØ± Ù…Ù†Ù‡Ø§ Ø´ÙŠØ¡.' : 'Ø­ÙƒÙ…Øª Ø¨ØµÙ…Øª Ø£Ù‚Ø±Ø¨ Ù„Ù„ØªØ±Ø¯Ø¯.'} Ù„Ù… ØªÙØ¨Ø¯Ø¹ ÙˆÙ„Ù… ØªÙÙ‡Ù„Ùƒ. Ù‚Ø±Ø§Ø±Ø§Øª Ù…ØªØ°Ø¨Ø°Ø¨Ø©ØŒ Ù†Ø¬Ø§Ø­Ø§Øª Ù…ØªÙˆØ§Ø¶Ø¹Ø© ÙˆØ¥Ø®ÙØ§Ù‚Ø§Øª Ù…Ù‚Ø¨ÙˆÙ„Ø©. Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø±Ù‘ Ø¹Ù„ÙŠÙ‡Ø§ ÙƒÙ…Ø§ ÙŠÙ…Ø±Ù‘ Ø§Ù„Ø±ÙŠØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù…Ø§Ù„ â€” ÙŠØ­Ø±Ùƒ ÙˆÙ„Ø§ ÙŠÙØºÙŠØ±.`
      );
    },
  },
];

function calcEnding() {
  const ending = ENDINGS.find(e => e.condition()) || ENDINGS[ENDINGS.length-1];
  showEnding(ending);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcScore() {
  const avg = (G.people + G.army + G.nobles + G.church) / 4;
  const balance = 100 - Math.max(
    Math.abs(G.people - avg),
    Math.abs(G.army - avg),
    Math.abs(G.nobles - avg),
    Math.abs(G.church - avg)
  );
  const achBonus = G.achievements.length * 8;
  const chronicleBonus = G.choices.length * 5;
  return Math.round(avg * 0.5 + balance * 0.3 + achBonus + chronicleBonus);
}

function getScoreRank(score) {
  if (score >= 90) return 'Ø£Ø³Ø·ÙˆØ±ÙŠ ğŸŒŸ';
  if (score >= 75) return 'Ù…Ù…ØªØ§Ø² â­';
  if (score >= 58) return 'Ø¬ÙŠØ¯ ğŸ…';
  if (score >= 42) return 'Ù…ØªÙˆØ³Ø· ğŸ“œ';
  return 'Ø¶Ø¹ÙŠÙ ğŸ’€';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENDING SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function _showEnding_base(e) {
  // Set ending colors
  document.getElementById('endingSeal').textContent = e.icon;
  const title = typeof e.title === 'function' ? e.title() : e.title;
  const rank  = typeof e.rank  === 'function' ? e.rank()  : e.rank;
  document.getElementById('endingTitle').textContent = title;
  document.getElementById('endingTitle').style.color = e.color;
  document.getElementById('endingRank').textContent = rank;
  document.getElementById('endingStory').innerHTML = e.story();

  document.getElementById('endingGlow').style.background =
    `radial-gradient(ellipse 90% 80% at 50% 100%, ${e.color}50 0%, transparent 70%)`;

  // Stars
  const starsEl = document.getElementById('endingStars');
  starsEl.innerHTML = '';
  for (let i = 0; i < 30; i++) {
    const s = document.createElement('div');
    s.className = 'ending-star';
    s.style.cssText = `
      left:${Math.random()*100}%;
      top:${Math.random()*100}%;
      --d:${(Math.random()*3+2)}s;
      --dl:${(Math.random()*3)}s;
    `;
    starsEl.appendChild(s);
  }

  // Score
  const score = calcScore();
  document.getElementById('scoreValue').textContent = score;
  document.getElementById('scoreRankText').textContent = getScoreRank(score);

  // Personality summary
  const pers = PERSONALITIES[G.personality];
  document.getElementById('personalitySummary').innerHTML = `
    <div class="pers-sum-title">âœ¦ Ø·Ø¨ÙŠØ¹Ø© Ø­ÙƒÙ…Ùƒ âœ¦</div>
    <span class="pers-sum-icon">${pers.icon}</span>
    <div class="pers-sum-name">${pers.name}</div>
    <div class="pers-sum-desc">${pers.desc}</div>
  `;

  // Faction standings
  const fs = document.getElementById('factionStandings');
  fs.innerHTML = `<div class="standings-title">âš–ï¸ Ù…ÙŠØ²Ø§Ù† Ø§Ù„ÙØµØ§Ø¦Ù„ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­ÙƒÙ…</div>`;
  [
    {icon:'ğŸ˜ï¸', name:'Ø§Ù„Ø´Ø¹Ø¨', val:G.people, color:'#4caf8c'},
    {icon:'ğŸ—¡ï¸', name:'Ø§Ù„Ø¬ÙŠØ´', val:G.army, color:'#c94c4c'},
    {icon:'ğŸ’', name:'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡', val:G.nobles, color:'#8c6caf'},
    {icon:'ğŸ“œ', name:'Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡', val:G.church, color:'#6c8ccf'},
  ].forEach((f, i) => {
    const row = document.createElement('div');
    row.className = 'standing-row';
    row.style.animationDelay = (i * 0.1) + 's';
    row.innerHTML = `
      <span class="standing-icon">${f.icon}</span>
      <div class="standing-info">
        <div class="standing-name">${f.name}</div>
        <div class="standing-bar-wrap">
          <div class="standing-bar-fill" style="width:0%;background:${f.color};transition:width 1s ease ${0.4 + i*0.15}s"></div>
        </div>
      </div>
      <div class="standing-val" style="color:${f.color}">${f.val}</div>
    `;
    fs.appendChild(row);
    // Animate bar
    setTimeout(() => {
      row.querySelector('.standing-bar-fill').style.width = f.val + '%';
    }, 100);
  });

  // Chronicle
  const ch = document.getElementById('chronicle');
  ch.innerHTML = '';
  G.choices.forEach((c, i) => {
    const entry = document.createElement('div');
    entry.className = 'chronicle-entry';
    entry.style.animationDelay = (i * 0.08) + 's';
    entry.innerHTML = `<span class="chronicle-icon">${c.icon}</span><span>Ø§Ù„ÙØµÙ„ ${arabNum(i+1)}: ${c.text}</span>`;
    ch.appendChild(entry);
  });

  // Clear save
  try { localStorage.removeItem('arihan_save'); } catch(e) {}

  transition('ğŸ“œ', 'Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙƒÙØªØ¨Øª... ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙŠÙØ³Ø¬Ù‘Ù„', () => {
    showScreen('ending');
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shareResult() {
  const title = document.getElementById('endingTitle').textContent;
  const score = document.getElementById('scoreValue').textContent;
  const pers = PERSONALITIES[G.personality];
  const titleEl = typeof ending.title === 'function' ? ending.title() : ending.title;
  const text = `ğŸ‘‘ Ù„Ø¹Ø¨Øª Ø£Ø±ÙŠÙ‡Ø§Ù†!\n\n${gT('Ø§Ù„Ù…Ù„Ùƒ','Ø§Ù„Ù…Ù„ÙƒØ©')}: ${G.name} (${pers.icon} ${pers.name})\nØ§Ù„Ù†Ù‡Ø§ÙŠØ©: "${titleEl}"\nÙ†Ù‚Ø§Ø· Ø§Ù„Ø­ÙƒÙ…: ${score}\n\nØ´Ø¹Ø¨: ${G.people} | Ø¬ÙŠØ´: ${G.army} | Ù†Ø¨Ù„Ø§Ø¡: ${G.nobles} | Ø¹Ù„Ù…Ø§Ø¡: ${G.church}\n\nØ£Ø±ÙŠÙ‡Ø§Ù† â€” Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…ØµÙŠØ±`;
  if (navigator.share) {
    navigator.share({ title: 'Ø£Ø±ÙŠÙ‡Ø§Ù†', text });
  } else {
    navigator.clipboard?.writeText(text).then(() => showBanner('ğŸ“‹', 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©!'));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function arabNum(n) {
  return ['','Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦','Ù§','Ù¨','Ù©','Ù¡Ù '][n] || n;
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  const el = document.getElementById(id);
  el.classList.add('active');
  el.scrollTo({top:0});
}

function showBanner(icon, text) {
  const b = document.getElementById('conBanner');
  document.getElementById('conIcon').textContent = icon;
  document.getElementById('conText').textContent = text;
  b.classList.add('visible');
  setTimeout(() => b.classList.remove('visible'), 2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPLASH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('load', () => {
  setTimeout(() => {
    const splash = document.getElementById('splash');
    splash.classList.add('hidden');
    setTimeout(() => splash.remove(), 900);
  }, 2600);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// START / RESTART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function _startGame_base() {
  const name = document.getElementById('kingInput').value.trim() || gT('Ø§Ù„Ø³Ù„Ø·Ø§Ù†', 'Ø§Ù„Ø³Ù„Ø·Ø§Ù†Ø©');
  const pers = PERSONALITIES[selectedPers];

  G = {
    name,
    personality: selectedPers,
    gender: selectedGender,
    people: 60, army: 60, nobles: 60, church: 60,
    choices: [], tags: new Set(), seenEvents: new Set(),
    turn: 1, achievements: [],
  };

  // Apply personality bonus
  apply(pers.bonus);

  const title = gT('Ø§Ù„Ù…Ù„Ùƒ', 'Ø§Ù„Ù…Ù„ÙƒØ©');
  document.getElementById('kingTitleBar').innerHTML = `${title} ${name} <span class="personality-badge">${pers.icon} ${pers.name}</span>`;

  updateBars();
  showScreen('game');
  setTimeout(() => showScene(SCENES['debt']), 120);
}

function _restartGame_base() {
  try { localStorage.removeItem('arihan_save'); } catch(e) {}
  showScreen('intro');
  document.getElementById('kingInput').value = '';
}


// â•â• INITIAL GLOBAL ASSIGNMENTS â•â•
var go = _go_base;
var showScene = _showScene_base;
var apply = _apply_base;
var startGame = _startGame_base;
var restartGame = _restartGame_base;
var showEnding = _showEnding_base;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù¢ â€” YEAR COUNTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const YEAR_NAMES = [
  '','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©',
  'Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø³Ø§Ø¯Ø³Ø©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù…Ù†Ø©',
  'Ø§Ù„Ø³Ù†Ø© Ø§Ù„ØªØ§Ø³Ø¹Ø©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¹Ø§Ø´Ø±Ø©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ø¯ÙŠØ© Ø¹Ø´Ø±Ø©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø¹Ø´Ø±Ø©',
  'Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ø¹Ø´Ø±Ø©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© Ø¹Ø´Ø±Ø©','Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø© Ø¹Ø´Ø±Ø©'
];
const CHAPTER_YEARS = { debt:1, drought:2, rebellion:4, war_council:5, invasion:6, plague:7, treasury_dilemma:8, betrayal:9, pretender:10, political_marriage:11, legacy:12 };

function updateYearDisplay(sceneId) {
  const yr = CHAPTER_YEARS[sceneId] || G.turn;
  const label = YEAR_NAMES[yr] || `Ø§Ù„Ø³Ù†Ø© ${yr}`;
  const el = document.getElementById('yearDisplay');
  if (!el) return;
  const isMilestone = yr === 5 || yr === 10;
  el.textContent = `${label} Ù…Ù† Ø§Ù„Ø­ÙƒÙ…`;
  if (isMilestone) {
    el.classList.add('milestone');
    setTimeout(() => el.classList.remove('milestone'), 800);
  }
  G.currentYear = yr;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù¡Ù¡ â€” MOOD / DAY-NIGHT SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SCENE_MOOD_TYPE = {
  debt: 'neutral', drought: 'danger', rebellion: 'danger',
  invasion: 'dark', plague: 'dark', betrayal: 'dark',
  pretender: 'tense', political_marriage: 'warm', legacy: 'warm'
};

const MOOD_PALETTE = {
  neutral: { bg:'#050403', particle:'35,70%,70%', vignetteOpacity: 0.0 },
  warm:    { bg:'#070502', particle:'42,75%,72%', vignetteOpacity: 0.0 },
  tense:   { bg:'#050305', particle:'30,60%,65%', vignetteOpacity: 0.3 },
  danger:  { bg:'#060303', particle:'15,65%,60%', vignetteOpacity: 0.5 },
  dark:    { bg:'#020305', particle:'220,50%,60%', vignetteOpacity: 0.7 },
};

let currentMood = 'neutral';
let moodVignetteEl = null;

function applySceneMood(sceneId) {
  const moodKey = SCENE_MOOD_TYPE[sceneId] || 'neutral';
  if (moodKey === currentMood) return;
  currentMood = moodKey;
  const palette = MOOD_PALETTE[moodKey];

  // Body bg
  document.body.style.background = palette.bg;

  // Vignette overlay
  if (!moodVignetteEl) {
    moodVignetteEl = document.createElement('div');
    moodVignetteEl.style.cssText = `
      position:fixed;inset:0;z-index:1;pointer-events:none;
      transition:opacity 1.5s ease;
    `;
    document.body.appendChild(moodVignetteEl);
  }

  if (moodKey === 'dark') {
    moodVignetteEl.style.background = 'radial-gradient(ellipse at 50% 0%, transparent 40%, rgba(2,3,8,0.7) 100%)';
    moodVignetteEl.style.opacity = '1';
  } else if (moodKey === 'danger') {
    moodVignetteEl.style.background = 'radial-gradient(ellipse at 50% 0%, transparent 40%, rgba(8,2,2,0.5) 100%)';
    moodVignetteEl.style.opacity = '1';
  } else if (moodKey === 'warm') {
    moodVignetteEl.style.background = 'radial-gradient(ellipse at 50% 100%, rgba(30,20,5,0.3) 0%, transparent 60%)';
    moodVignetteEl.style.opacity = '1';
  } else {
    moodVignetteEl.style.opacity = '0';
  }

  // Update particle color
  window._particleHue = palette.particle;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù¡Ù¢ â€” DYNAMIC MAP EVENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MAP_EVENTS = [];  // { id, x, y, icon, label, color }

function addMapEvent(id, x, y, icon, label, color) {
  if (MAP_EVENTS.find(e => e.id === id)) return;
  MAP_EVENTS.push({ id, x, y, icon, label, color });
}

function renderMapEvents() {
  const svg = document.querySelector('.map-svg');
  if (!svg) return;
  // Remove old dynamic markers
  svg.querySelectorAll('.dyn-marker').forEach(el => el.remove());

  MAP_EVENTS.forEach(ev => {
    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    g.classList.add('dyn-marker', 'map-event-marker');
    g.innerHTML = `
      <circle cx="${ev.x}" cy="${ev.y}" r="8" fill="${ev.color}33" stroke="${ev.color}" stroke-width="1.5"/>
      <text x="${ev.x}" y="${ev.y + 4}" text-anchor="middle" font-size="9">${ev.icon}</text>
      <text x="${ev.x}" y="${ev.y + 18}" text-anchor="middle" fill="${ev.color}" font-size="7" font-family="serif">${ev.label}</text>
    `;
    svg.appendChild(g);
  });
}

// Override toggleMap to also render events
const _origToggleMap = window.toggleMap;
window.toggleMap = function() {
  renderMapEvents();
  document.getElementById('mapOverlay').classList.toggle('show');
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù¡Ù£ â€” CHARACTER PORTRAITS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Each named character has an avatar emoji + color
const CHAR_DATA = {
  'Ù…Ø±ÙˆØ§Ù† Ø§Ù„Ø¯Ø§Ù‡ÙŠØ©':   { avatar:'ğŸ§™', color:'#8b6c3a', trust: 80 },
  'Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø®Ø§Ù„Ø¯':    { avatar:'âš”ï¸', color:'#8a3a3a', trust: 80 },
  'Ø²ÙŠØ¯ Ø§Ù„ÙˆÙ‚ÙˆØ±':  { avatar:'ğŸ“œ', color:'#3a5a8a', trust: 80 },
  'Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ':      { avatar:'ğŸ’°', color:'#6a8a3a', trust: 60 },
  'Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©':    { avatar:'ğŸŒ™', color:'#6a3a8a', trust: 70 },
  'Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù†':     { avatar:'ğŸ—¡ï¸', color:'#8a5a3a', trust: 40 },
  'Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ…':      { avatar:'ğŸ•¯ï¸', color:'#5a4a2a', trust: 60 },
  'Ø§Ù„Ø¬Ù†Ø±Ø§Ù„ Ø«ÙˆØ±ÙÙŠÙ†':   { avatar:'ğŸº', color:'#4a4a4a', trust: 0  },
};

// Replace <span class="char-name">X</span> with portrait chip
function injectPortraits(html) {
  return html.replace(/class="char-name">([^<]+)<\/span>/g, (match, name) => {
    const data = CHAR_DATA[name.trim()];
    if (!data) return match;
    // Ø±Ù…Ø² ØµØºÙŠØ± + Ø§Ù„Ø§Ø³Ù… Ø¨Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ ÙÙ‚Ø· â€” Ø¨Ø³ÙŠØ· ÙˆØ£Ù†ÙŠÙ‚
    return `class="char-portrait"><span class="char-portrait-avatar">${data.avatar}</span><span class="char-portrait-name">${name}</span></span>`;
  });
}

// Trust modifier â€” choices affecting chars change their displayed trust
function setCharTrust(charName, delta) {
  if (CHAR_DATA[charName]) {
    CHAR_DATA[charName].trust = Math.max(0, Math.min(100, CHAR_DATA[charName].trust + delta));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù¡Ù¤ â€” NEWSPAPER BETWEEN CHAPTERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØµØ­ÙŠÙØ© = Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø°ÙŠ Ø§Ù†ØªÙ‡Ù‰ Ù„Ù„ØªÙˆ (ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø± Ù…Ø¨Ø§Ø´Ø±Ø©)
const NEWSPAPERS = {
  debt: {
    headline: 'Ù…Ù„Ùƒ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø´ â€” ÙˆØ£ÙˆÙ„ Ù‚Ø±Ø§Ø± ÙŠÙØ«ÙŠØ± Ø§Ù„Ø¬Ø¯Ù„',
    sub: 'Ù…ØµØ§Ø¯Ø± Ù…Ù† Ø§Ù„Ø¯ÙŠÙˆØ§Ù†: Ø®Ø·ÙˆØ© Ø¬Ø±ÙŠØ¦Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¯ÙŠÙˆÙ† Ø§Ù„Ø£Ø¨ ØªÙØ¹ÙŠØ¯ Ø±Ø³Ù… Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù†ÙÙˆØ°',
  },
  drought: {
    headline: 'Ø£Ø±ÙŠÙ‡Ø§Ù† ØªÙˆØ§Ø¬Ù‡ Ø§Ù„Ø¬ÙØ§Ù â€” ÙˆÙ‚Ø±Ø§Ø± Ø§Ù„Ù…Ù„Ùƒ ÙŠÙØ±Ù‚ Ø§Ù„Ø±Ø£ÙŠ Ø§Ù„Ø¹Ø§Ù…',
    sub: 'Ø¨ÙŠÙ† Ù…Ù† ÙŠØ´ÙƒØ± ÙˆÙ…Ù† ÙŠØªØ°Ù…Ø±: Ø±Ø¯ÙˆØ¯ Ø§Ù„ÙØ¹Ù„ Ø¹Ù„Ù‰ Ù‚Ø±Ø§Ø± Ù…ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø²Ù…Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©',
  },
  rebellion: {
    headline: 'ØªÙ…Ø±Ø¯ Ø§Ù„Ø´Ø±Ù‚... ÙˆØ§Ù„Ù…Ù„Ùƒ ÙŠØ®ØªØ§Ø± Ø£Ø³Ù„ÙˆØ¨Ù‡ ÙÙŠ Ø§Ù„Ø±Ø¯',
    sub: 'Ø§Ù„Ù…Ø­Ù„Ù„ÙˆÙ† ÙŠØªØ³Ø§Ø¡Ù„ÙˆÙ†: Ù‡Ù„ Ù‚Ø±Ø§Ø± Ø§Ù„Ù…Ù„Ùƒ Ø³ÙŠÙ‚ÙˆÙŠ Ø§Ù„Ù…Ø±ÙƒØ² Ø£Ù… ÙŠØ²ÙŠØ¯ Ø§Ù„Ø´Ù‚Ø§Ù‚ØŸ',
  },
  invasion: {
    headline: 'Ø§Ù„ØºØ²Ùˆ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ ÙŠÙÙƒØ´Ù Ù…Ø¹Ø¯Ù† Ø§Ù„Ù…Ù„ÙˆÙƒ',
    sub: 'Ø£Ø±ÙŠÙ‡Ø§Ù† Ø®Ø±Ø¬Øª Ù…Ù† Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø±Ø¨ â€” Ù„ÙƒÙ† Ø§Ù„Ø«Ù…Ù† Ù…Ø§ Ø²Ø§Ù„ ÙŠÙØ­Ø³Ø¨',
  },
  plague: {
    headline: 'Ø§Ù„ÙˆØ¨Ø§Ø¡ ÙŠØªØ±Ø§Ø¬Ø¹... ÙˆØ³Ø¤Ø§Ù„ Ù…Ù† Ø¯ÙØ¹ Ø§Ù„Ø«Ù…Ù† ÙŠØ¨Ù‚Ù‰ Ù…Ø¹Ù„Ù‚Ø§Ù‹',
    sub: 'Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆÙÙŠØ§Øª ØªÙ†Ø®ÙØ¶ØŒ Ù„ÙƒÙ† Ø§Ù„Ø¬Ø±ÙˆØ­ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© ÙˆØ§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ© Ù„Ø§ ØªØ²Ø§Ù„ Ù…ÙØªÙˆØ­Ø©',
  },
  betrayal: {
    headline: 'Ù‚Ø¶ÙŠØ© Ù…Ø±ÙˆØ§Ù† â€” ÙˆØ§Ù„Ù‚ØµØ± Ù„Ù† ÙŠÙƒÙˆÙ† ÙƒÙ…Ø§ ÙƒØ§Ù†',
    sub: 'ÙƒÙŠÙ ØªØ¹Ø§Ù…Ù„ Ø§Ù„Ù…Ù„Ùƒ Ù…Ø¹ Ø§Ù„Ø®ÙŠØ§Ù†Ø©ØŸ Ø³Ø¤Ø§Ù„ Ø³ÙŠØ­Ø¯Ø¯ Ø·Ø¨ÙŠØ¹Ø© Ø­ÙƒÙ…Ù‡ Ù„Ù„Ø£Ø¨Ø¯',
  },
  pretender: {
    headline: 'Ù„ØºØ² Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø­ÙØ³Ù… â€” Ù„ÙƒÙ† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„Ù… ØªÙ†ØªÙ‡',
    sub: 'Ù‚Ø±Ø§Ø± Ø§Ù„Ù…Ù„Ùƒ ÙÙŠ Ù‚Ø¶ÙŠØ© Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø±Ø³Ù… ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø©: Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ùƒ ÙŠØ­ÙƒÙ… Ø¨Ù€...',
  },
  political_marriage: {
    headline: 'Ø²ÙˆØ§Ø¬ Ø§Ù„Ù‚ØµØ± â€” ØªØ­Ø§Ù„Ù ÙŠÙØ¹ÙŠØ¯ Ø±Ø³Ù… Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø³ÙŠØ§Ø³ÙŠ',
    sub: 'Ø§Ù„ÙØµØ§Ø¦Ù„ Ø§Ù„Ø£Ø±Ø¨Ø¹ ØªØ­Ù„Ù‘Ù„ Ø§Ù„ØªØ¯Ø§Ø¹ÙŠØ§Øª: Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø­ Ø§Ù„Ø£ÙƒØ¨Ø± Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø²ÙˆØ§Ø¬ØŸ',
  },
};

let _pendingNewspaper = null;
let _pendingNewspaperCb = null;

function showNewspaper(sceneId, callback) {
  const data = NEWSPAPERS[sceneId];
  if (!data) { callback(); return; }

  const yr = CHAPTER_YEARS[sceneId] || G.currentYear || G.turn;
  const yearLabel = YEAR_NAMES[yr] ? YEAR_NAMES[yr] + gT(' Ù…Ù† Ø­ÙƒÙ… Ø§Ù„Ù…Ù„Ùƒ ', ' Ù…Ù† Ø­ÙƒÙ… Ø§Ù„Ù…Ù„ÙƒØ© ') + G.name : `Ø§Ù„Ø³Ù†Ø© ${yr}`;

  const overlay = document.createElement('div');
  overlay.className = 'newspaper-overlay';
  overlay.innerHTML = `
    <div class="newspaper-inner">
      <div class="newspaper-masthead">
        <div class="newspaper-name">Ø¬Ø±ÙŠØ¯Ø© Ø£Ø±ÙŠÙ‡Ø§Ù†</div>
        <div class="newspaper-date">${yearLabel}</div>
      </div>
      <div class="newspaper-body">
        <div class="newspaper-headline">${data.headline}</div>
        <div class="newspaper-sub">${data.sub}</div>
        <div class="newspaper-byline">ØµØ­Ø§ÙØ© Ø£Ø±ÙŠÙ‡Ø§Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø© â€” Ù…Ù†Ø° ØªØ£Ø³ÙŠØ³ Ø§Ù„Ù…Ù…Ù„ÙƒØ©</div>
      </div>
      <button class="newspaper-btn" id="npClose">ØªØ§Ø¨Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© â†</button>
    </div>
  `;
  document.body.appendChild(overlay);
  overlay.querySelector('#npClose').onclick = () => {
    overlay.style.opacity = '0';
    overlay.style.transition = 'opacity 0.3s';
    setTimeout(() => { overlay.remove(); callback(); }, 300);
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ù¡Ù§ â€” NEW GAME +
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let isNewGamePlus = false;
let ngPlusUnlocked = false;

// NG+ secret scenes injected into the flow
const NG_PLUS_SCENES = {
  // Ø¨Ø¹Ø¯ debt â€” Ù„Ù‚Ø§Ø¡ Ø³Ø±ÙŠ Ù…Ø¹ Ø¬Ø§Ø³ÙˆØ³
  ng_spy: {
    chapter: 'âœ¦ New Game+ â€” Ù…Ø§ Ù„Ù… ØªØ¹Ø±ÙÙ‡ ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰',
    title: 'Ø³Ø± Ø£Ø¨ÙŠÙƒ Ø§Ù„Ù…ÙŠØª',
    emoji: 'ğŸ•¯ï¸',
    color: 'rgba(80,40,120,0.7)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(80,40,120,0.7) 0%, rgba(10,5,20,0.9) 55%, rgba(5,4,3,1) 100%)',
    isNGPlus: true,
    text: () => `
      ÙÙŠ Ø£ÙˆÙ„ Ù„ÙŠÙ„Ø© ØªÙ†Ø§Ù… ÙÙŠÙ‡Ø§ ${gT('Ù…Ù„ÙƒØ§Ù‹','Ù…Ù„ÙƒØ©Ù‹')}ØŒ ÙŠØ¯Ø®Ù„ Ø¹Ù„ÙŠÙƒ Ø±Ø¬Ù„ Ø¹Ø¬ÙˆØ² Ù„Ù… ØªØ±Ù‡ Ù…Ù† Ù‚Ø¨Ù„.
      ÙŠÙÙ‚Ø¯Ù‘Ù… Ù†ÙØ³Ù‡: <span class="char-name">Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ…</span> â€” Ø­Ø§Ø±Ø³ Ø£Ø³Ø±Ø§Ø± Ø£Ø¨ÙŠÙƒ Ø§Ù„Ø®Ø§Øµ Ù…Ù†Ø° Ø«Ù„Ø§Ø«ÙŠÙ† Ø¹Ø§Ù…Ø§Ù‹.
      <br><br>
      <span class="whisper">"Ø¬Ù„Ø§Ù„ØªÙƒØŒ Ø£Ø¨ÙˆÙƒ Ø±Ø­Ù…Ù‡ Ø§Ù„Ù„Ù‡ Ø£ÙˆØµØ§Ù†ÙŠ Ø¨Ø´ÙŠØ¡ ÙˆØ§Ø­Ø¯: Ø¥Ù† Ù…Ø§Øª Ù‚Ø¨Ù„ Ø£Ù† ÙŠÙØ®Ø¨Ø±Ùƒ â€” Ø£Ù†Ø§ Ù…Ù† ÙŠÙØ®Ø¨Ø±Ùƒ."</span>
      <br><br>
      Ø«Ù… ÙŠØ¶Ø¹ Ø£Ù…Ø§Ù…Ùƒ Ø«Ù„Ø§Ø«Ø© Ø£Ø´ÙŠØ§Ø¡: <span class="dramatic">Ø±Ø³Ø§Ù„Ø© Ù…Ø®ØªÙˆÙ…Ø© Ø¨Ø®ØªÙ… Ù…Ø±ÙˆØ§Ù† Ø§Ù„Ø¯Ø§Ù‡ÙŠØ©</span>ØŒ ÙˆØ®Ø±ÙŠØ·Ø© Ù„ØºØ±ÙØ© Ø³Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù‚ØµØ±ØŒ ÙˆØ¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø©: <span class="whisper">"Ø£Ø¨ÙˆÙƒ Ù„Ù… ÙŠÙ…Øª Ø¨Ù…Ø±Ø¶ Ø·Ø¨ÙŠØ¹ÙŠ."</span>
      <br><br>
      Ù†ØµØ± ÙŠÙ†ØªØ¸Ø±. Ø¹ÙŠÙ†Ø§Ù‡ Ù„Ø§ ÙŠÙƒØ°Ø¨Ø§Ù† â€” Ù„ÙƒÙ†Ù‡Ù…Ø§ ÙŠØ®ÙÙŠØ§Ù† Ø§Ù„ÙƒØ«ÙŠØ± Ø£ÙŠØ¶Ø§Ù‹.
    `,
    memory: () => 'ğŸ•¯ï¸ NG+ â€” Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ… ÙŠØ­Ù…Ù„ Ø£Ø³Ø±Ø§Ø± Ø£Ø¨ÙŠÙƒ',
    choices: [
      {
        emoji: 'ğŸ”', text: 'Ø§ÙØªØ­ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø¯Ø®Ù„ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø³Ø±ÙŠØ© â€” Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ÙƒØ§Ù…Ù„Ø© Ø£Ùˆ Ù„Ø§ Ø´ÙŠØ¡',
        sub: [{ label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +8', type: 'up' }, { label: 'âˆ’Ø§Ù„Ø¬ÙŠØ´ âˆ’5 (Ø§Ù„Ø´Ùƒ ÙŠØ³Ø±ÙŠ)', type: 'down' }, { label: 'ØªÙƒØ´Ù Ø³Ø± Ù…Ø±ÙˆØ§Ù† Ù…Ø¨ÙƒØ±Ø§Ù‹', type: 'neutral' }],
        fn: () => {
          apply({church:8, army:-5});
          G.tags.add('ng_spy_letter');
          G.tags.add('ng_knows_murder');
          G.tags.add('leyla_trusted');
          chronicle('ğŸ•¯ï¸', '[NG+] Ø§ÙƒØªØ´Ù Ø³Ø± Ù…Ù‚ØªÙ„ Ø£Ø¨ÙŠÙ‡ Ù…Ù† Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ…');
          // Ù…Ø±ÙˆØ§Ù† ÙÙŠ Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø®ÙŠØ§Ù†Ø© Ø³ÙŠÙƒÙˆÙ† Ù…ÙˆÙ‚ÙÙ‡ Ù…Ø®ØªÙ„ÙØ§Ù‹
          go('drought');
        }
      },
      {
        emoji: 'ğŸšª', text: 'Ø§Ø·Ø±Ø¯ Ù†ØµØ± â€” Ù…Ù† ÙŠØ£ØªÙŠ Ø¨Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ÙˆØªÙ‰ ÙÙŠ Ø§Ù„Ù„ÙŠÙ„ Ù„Ø§ ÙŠÙØ¤ØªÙ…Ù†',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +8 (Ø­Ø²Ù…)', type: 'up' }, { label: 'ØªØ¨Ù‚Ù‰ ÙÙŠ Ø§Ù„Ø¸Ù„Ø§Ù…', type: 'neutral' }],
        fn: () => {
          apply({army:8});
          G.tags.add('ng_rejected_nasr');
          chronicle('ğŸšª', '[NG+] Ø·Ø±Ø¯ Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ… ÙˆØ±ÙØ¶ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©');
          go('drought');
        }
      },
      {
        emoji: 'ğŸ¤', text: 'Ø§Ø³ØªÙ…Ø¹ Ù„ÙƒÙ„ Ø´ÙŠØ¡ Ù„ÙƒÙ† Ù„Ø§ ØªØªØµØ±Ù Ø¨Ø¹Ø¯ â€” Ø§Ù„ÙˆÙ‚Øª Ø³Ù„Ø§Ø­',
        sub: [{ label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +5', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +3', type: 'up' }, { label: 'ÙˆØ±Ù‚Ø© Ø¶ØºØ· Ù…Ø­ÙÙˆØ¸Ø©', type: 'neutral' }],
        fn: () => {
          apply({church:5, people:3});
          G.tags.add('ng_spy_letter');
          G.tags.add('ng_patient_king');
          chronicle('ğŸ¤', '[NG+] Ø§Ø³ØªÙ…Ø¹ Ù„Ù†ØµØ± ÙˆØ§Ù†ØªØ¸Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨');
          go('drought');
        }
      },
    ]
  },

  // Ø¨Ø¹Ø¯ rebellion â€” Ù„Ù‚Ø§Ø¡ Ù…Ø¹ Ù„ÙŠÙ„Ù‰
  ng_leyla: {
    chapter: 'âœ¦ New Game+ â€” Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø¢Ø®Ø±',
    title: 'Ù„ÙŠÙ„Ù‰ â€” Ù…Ù† Ù‡ÙŠ ÙØ¹Ù„Ø§Ù‹ØŸ',
    emoji: 'ğŸŒ™',
    color: 'rgba(60,30,100,0.7)',
    mood: 'radial-gradient(ellipse at 50% 110%, rgba(60,30,100,0.7) 0%, rgba(8,4,18,0.9) 55%, rgba(5,4,3,1) 100%)',
    isNGPlus: true,
    text: () => {
      const knowsMurder = G.tags.has('ng_knows_murder');
      const base = `
        Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø© ØªØ·Ù„Ø¨ Ù…Ù‚Ø§Ø¨Ù„Ø© Ø®Ø§ØµØ© â€” Ø¨Ù„Ø§ Ø­Ø±Ø§Ø³ØŒ Ø¨Ù„Ø§ Ø´Ù‡ÙˆØ¯.
        ØªØ¬Ù„Ø³ Ø£Ù…Ø§Ù…Ùƒ ÙˆØªØ¶Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø´ÙŠØ¦Ø§Ù‹ Ù„Ù… ØªØªÙˆÙ‚Ø¹Ù‡:
        <span class="dramatic">Ø®Ø§ØªÙ… ÙŠØ­Ù…Ù„ Ø´Ø¹Ø§Ø± Ø¹Ø§Ø¦Ù„Ø© Ø£Ø¨ÙŠÙƒ... Ø§Ù„Ø°ÙŠ Ø§Ø¹ØªÙÙ‚Ø¯ Ø£Ù†Ù‡ Ø¶Ø§Ø¹ Ù…Ù†Ø° Ø¹Ø´Ø±ÙŠÙ† Ø¹Ø§Ù…Ø§Ù‹.</span>
        <br><br>
        <span class="whisper">"Ø¬Ù„Ø§Ù„ØªÙƒØŒ Ø£Ù†Ø§ Ù„Ø³Øª Ù…Ø¬Ø±Ø¯ Ù…Ø³ØªØ´Ø§Ø±Ø©. Ø£Ù…ÙŠ ÙƒØ§Ù†Øª Ø®Ø§Ø¯Ù…Ø© Ø£Ø¨ÙŠÙƒ Ø§Ù„Ù…Ù‚Ø±Ø¨Ø©. ÙˆØ£Ø¨ÙŠ..."</span>
        ØªØªÙˆÙ‚Ù. Ø¹ÙŠÙ†Ø§Ù‡Ø§ ØªØ¨Ø­Ø«Ø§Ù† ÙÙŠ ÙˆØ¬Ù‡Ùƒ Ø¹Ù† Ø´ÙŠØ¡.
        <span class="whisper">"Ø£Ø¨ÙŠ Ù‡Ùˆ Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ…."</span>
        <br><br>
      `;
      if (knowsMurder) {
        return base + `<span class="good-word">Ø§Ù„ØµÙˆØ±Ø© ØªÙƒØªÙ…Ù„</span> â€” Ù„ÙŠÙ„Ù‰ ØªØ¹Ø±Ù Ø£Ù† Ø£Ø¨Ø§Ù‡Ø§ Ø£Ø®Ø¨Ø±Ùƒ. ÙˆÙ‡ÙŠ Ø¬Ø§Ø¡Øª Ù„ØªÙÙƒÙ…Ù„ Ù…Ø§ Ø¨Ø¯Ø£Ù‡.`;
      }
      return base + `ØªÙ†Ø¸Ø± Ø¥Ù„ÙŠÙƒ Ø¨Ø¹ÙŠÙˆÙ† Ù‡Ø§Ø¯Ø¦Ø©: <span class="whisper">"Ø£Ø¹Ø±Ù Ù…Ø§ Ù„Ø§ ØªØ¹Ø±ÙÙ‡ Ø¹Ù† Ù…ÙˆØª Ø£Ø¨ÙŠÙƒ. ÙˆØ§Ù„Ø³Ø¤Ø§Ù„: Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ¹Ø±ÙØŸ"</span>`;
    },
    memory: () => G.tags.has('ng_knows_murder') ? 'ğŸŒ™ NG+ â€” Ù„ÙŠÙ„Ù‰ Ø§Ø¨Ù†Ø© Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ…' : 'ğŸŒ™ NG+ â€” Ù„ÙŠÙ„Ù‰ ØªØ¹Ø±Ù Ø³Ø± Ø£Ø¨ÙŠÙƒ',
    choices: [
      {
        emoji: 'ğŸ’¬', text: 'Ø§Ø³Ù…Ø¹Ù‡Ø§ ÙƒØ§Ù…Ù„Ø§Ù‹ â€” Ù‡Ø°Ø§ Ø§Ù„Ù„Ù‚Ø§Ø¡ Ù„Ù… ÙŠÙƒÙ† ØµØ¯ÙØ©',
        sub: [{ label: '+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ +10', type: 'up' }, { label: '+Ø§Ù„Ø´Ø¹Ø¨ +5', type: 'up' }, { label: 'ØªÙØªØ­ Ù…Ø³Ø§Ø± Ù„ÙŠÙ„Ù‰ Ø§Ù„ÙƒØ§Ù…Ù„', type: 'neutral' }],
        fn: () => {
          apply({church:10, people:5});
          G.tags.add('ng_leyla_secret');
          G.tags.add('leyla_trusted');
          G.tags.add('ng_knows_murder');
          chronicle('ğŸŒ™', '[NG+] Ø¹Ø±Ù Ø­Ù‚ÙŠÙ‚Ø© Ù„ÙŠÙ„Ù‰ ÙˆÙØªØ­ Ù…Ø¹Ù‡Ø§ ØªØ­Ø§Ù„ÙØ§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹');
          // ÙÙŠ Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø®ÙŠØ§Ù†Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹: Ù„ÙŠÙ„Ù‰ Ø³ØªÙƒÙˆÙ† Ø´Ø§Ù‡Ø¯Ø§Ù‹ Ø¶Ø¯ Ù…Ø±ÙˆØ§Ù†
          go('war_council');
        }
      },
      {
        emoji: 'âš–ï¸', text: 'Ø£Ø·Ù„Ø¨ Ù…Ù†Ù‡Ø§ ÙˆØ«ÙŠÙ‚Ø© Ø±Ø³Ù…ÙŠØ© â€” Ø§Ù„ÙƒÙ„Ø§Ù… ÙˆØ­Ø¯Ù‡ Ù„Ø§ ÙŠÙƒÙÙŠ ÙÙŠ Ø§Ù„Ù‚ØµØ±',
        sub: [{ label: '+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ +5', type: 'up' }, { label: 'Ù„ÙŠÙ„Ù‰ ØªØ­ØªØ±Ù… Ø­Ø²Ù…Ùƒ', type: 'neutral' }],
        fn: () => {
          apply({nobles:5, church:5});
          G.tags.add('leyla_trusted');
          G.tags.add('ng_leyla_cautious');
          chronicle('âš–ï¸', '[NG+] Ø·Ù„Ø¨ Ù…Ù† Ù„ÙŠÙ„Ù‰ ÙˆØ«ÙŠÙ‚Ø© Ø±Ø³Ù…ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØµØ¯ÙŠÙ‚');
          go('war_council');
        }
      },
      {
        emoji: 'ğŸš¶', text: 'Ù‚Ù ÙˆØºØ§Ø¯Ø± â€” Ø§Ù„Ù‚ØµØ± ÙŠÙƒÙÙŠÙ‡ Ø§Ù„Ø£Ø³Ø±Ø§Ø±',
        sub: [{ label: '+Ø§Ù„Ø¬ÙŠØ´ +8 (Ø­Ø²Ù…)', type: 'up' }, { label: 'Ù„ÙŠÙ„Ù‰ ØªØ®ØªÙÙŠ Ù…Ù† Ø§Ù„Ù…Ø´Ù‡Ø¯', type: 'down' }],
        fn: () => {
          apply({army:8});
          chronicle('ğŸš¶', '[NG+] Ø±ÙØ¶ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ÙŠÙ„Ù‰ ÙˆØ£ØºÙ„Ù‚ Ø§Ù„Ø¨Ø§Ø¨');
          go('war_council');
        }
      },
    ]
  },
};

// NG+ hard mode: all faction penalties increased by 30%
function ngApplyModifier(delta) {
  if (!isNewGamePlus) return delta;
  const modified = {...delta};
  ['people','army','nobles','church'].forEach(f => {
    if (modified[f] < 0) modified[f] = Math.round(modified[f] * 1.3);
  });
  return modified;
}

// NG+ scene injection
const _originalGo = null; // captured below

function showNGPlusBadge() {
  if (document.getElementById('ngBadge')) return;
  const badge = document.createElement('div');
  badge.id = 'ngBadge';
  badge.className = 'ng-plus-badge';
  badge.textContent = 'âœ¦ ÙˆØ¶Ø¹ Ø§Ù„Ø­ÙƒÙ… Ø§Ù„ØµØ¹Ø¨ â€” New Game+ âœ¦';
  document.getElementById('game').prepend(badge);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PATCH: override go() to wire everything
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window.go = function(sceneId) {
  const prevScene = G.currentScene || null;
  G.currentScene = sceneId;

  // NG+ scene injections
  if (isNewGamePlus) {
    if (sceneId === 'drought' && !G.tags.has('ng_spy_done')) {
      G.tags.add('ng_spy_done');
      G.turn++;
      updateYearDisplay('ng_spy');
      applySceneMood('ng_spy');
      showScene(NG_PLUS_SCENES['ng_spy']);
      return;
    }
    if (sceneId === 'war_council' && !G.tags.has('ng_leyla_done')) {
      G.tags.add('ng_leyla_done');
      G.turn++;
      updateYearDisplay('ng_leyla');
      applySceneMood('ng_leyla');
      showScene(NG_PLUS_SCENES['ng_leyla']);
      return;
    }
  }

  // Apply NG+ modifier to next scene (patch apply)
  G.turn++;

  // Inject political marriage
  if (sceneId === 'legacy' && !G.tags.has('had_marriage_scene')) {
    G.tags.add('had_marriage_scene');
    updateYearDisplay('political_marriage');
    applySceneMood('political_marriage');
    showNewspaper(prevScene, () => showScene(SCENES['political_marriage']));
    autoSave();
    return;
  }

  updateYearDisplay(sceneId);
  applySceneMood(sceneId);

  // Add map events based on scene
  triggerMapEvent(sceneId);

  // Ø§Ù„ØµØ­ÙŠÙØ© ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø± (Ø¹Ù† Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠ)ØŒ Ø«Ù… ØªÙ†ØªÙ‚Ù„ Ù„Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
  showNewspaper(prevScene, () => {
    if (SCENES[sceneId]) showScene(SCENES[sceneId]);
  });
  autoSave();
};

function triggerMapEvent(sceneId) {
  if (sceneId === 'invasion') addMapEvent('invasion', 200, 55, 'âš”ï¸', 'ØºØ²Ùˆ Ø§Ù„Ø«Ù†Ø¯Ø§Ø±', '#c94c4c');
  if (sceneId === 'plague') addMapEvent('plague', 200, 140, 'ğŸ’€', 'Ø§Ù„ÙˆØ¨Ø§Ø¡', '#6c4caf');
  if (G.tags.has('scorched_earth')) addMapEvent('burned', 200, 75, 'ğŸ”¥', 'Ø£Ø±Ø§Ø¶Ù Ù…Ø­Ø±ÙˆÙ‚Ø©', '#c97830');
  if (G.tags.has('dug_canals')) addMapEvent('canals', 155, 120, 'ğŸ’§', 'Ù‚Ù†ÙˆØ§Øª Ø±ÙŠ', '#4c8caf');
  if (G.tags.has('surrendered_land')) addMapEvent('lost_land', 200, 48, 'ğŸ³ï¸', 'Ø£Ø±Ø§Ø¶Ù Ù…ÙØªÙ†Ø§Ø²ÙÙ„ Ø¹Ù†Ù‡Ø§', '#808080');
  if (G.tags.has('university_built')) addMapEvent('uni', 200, 155, 'ğŸ“', 'Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©', '#4caf8c');
  if (G.tags.has('empire_declared')) addMapEvent('empire', 200, 30, 'ğŸ°', 'Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ©', '#d4a843');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PATCH: override showScene() to inject portraits & NG+ tag
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _showScene_orig = _showScene_base;
window.showScene = function(sc) {
  _showScene_orig(sc);
  // Inject portraits after body is set
  const body = document.getElementById('sceneBody');
  if (body) body.innerHTML = injectPortraits(body.innerHTML);

  // NG+ indicator
  const existing = document.getElementById('ngSceneTag');
  if (existing) existing.remove();
  if (sc.isNGPlus) {
    const tag = document.createElement('div');
    tag.id = 'ngSceneTag';
    tag.className = 'ng-scene-tag';
    tag.innerHTML = 'âœ¦ Ù…Ø´Ù‡Ø¯ Ø­ØµØ±ÙŠ â€” New Game+';
    document.getElementById('chapterTag').after(tag);
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PATCH: override apply() for NG+ modifier
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _apply_orig = _apply_base;
window.apply = function(delta) {
  _apply_orig(isNewGamePlus ? ngApplyModifier(delta) : delta);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEW GAME + UNLOCK & RESTART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function checkNGPlusUnlock() {
  // Unlock after first complete playthrough
  try {
    const runs = parseInt(localStorage.getItem('arihan_runs') || '0');
    if (runs >= 1) ngPlusUnlocked = true;
  } catch(e) {}
}

function incrementRuns() {
  try {
    const runs = parseInt(localStorage.getItem('arihan_runs') || '0');
    localStorage.setItem('arihan_runs', runs + 1);
    if (runs >= 0) ngPlusUnlocked = true;
  } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PATCH: startGame + restartGame
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _startGame_orig = _startGame_base;
window.startGame = function() {
  checkNGPlusUnlock();
  _startGame_orig();
  updateYearDisplay('debt');
  applySceneMood('debt');
};

const _restartGame_orig = _restartGame_base;
window.restartGame = function() {
  incrementRuns();
  isNewGamePlus = false;
  selectedGender = 'male';
  currentMood = 'neutral';
  if (moodVignetteEl) { moodVignetteEl.style.opacity = '0'; }
  document.getElementById('ngBadge')?.remove();
  // Reset gender UI
  document.querySelectorAll('.gender-card').forEach(c => c.classList.remove('selected'));
  document.querySelector('.gender-card[data-gender="male"]').classList.add('selected');
  document.getElementById('nameLabelText').textContent = 'âœ¦ Ù…Ø§ Ø§Ø³Ù…Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØŸ âœ¦';
  document.getElementById('kingInput').placeholder = 'Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ...';
  document.getElementById('startBtn').textContent = 'âš”ï¸ ØªØ³Ù„Ù‘Ù… Ø§Ù„Ø¹Ø±Ø´ âš”ï¸';
  // Reset char trust
  Object.keys(CHAR_DATA).forEach(k => {
    CHAR_DATA[k].trust = k === 'Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù†' ? 40 : k === 'Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ' ? 60 : k === 'Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©' ? 70 : 80;
  });
  _restartGame_orig();
};

function startNewGamePlus() {
  if (!ngPlusUnlocked) return;
  isNewGamePlus = true;
  const nameVal = document.getElementById('kingInput').value.trim() || 'Ø§Ù„Ø³Ù„Ø·Ø§Ù†';
  document.getElementById('kingInput').value = nameVal;
  startGame();
  setTimeout(() => showNGPlusBadge(), 200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PATCH: showEnding â€” add year + NG+ button
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const _showEnding_orig = _showEnding_base;
window.showEnding = function(e) {
  incrementRuns();
  _showEnding_orig(e);

  // Add years ruled stat before story
  const storyEl = document.getElementById('endingStory');
  const yearsDiv = document.createElement('div');
  yearsDiv.className = 'ending-years';
  yearsDiv.innerHTML = `
    <span class="ending-years-num">${G.currentYear || 10}</span>
    <div class="ending-years-label">Ø³Ù†ÙˆØ§Øª Ù…Ù† Ø§Ù„Ø­ÙƒÙ…</div>
  `;
  storyEl.before(yearsDiv);

  // NG+ button
  checkNGPlusUnlock();
  const replaySection = document.querySelector('.replay-section');
  if (ngPlusUnlocked && replaySection) {
    const existing = document.getElementById('ngBtn');
    if (!existing) {
      const btn = document.createElement('button');
      btn.id = 'ngBtn';
      btn.style.cssText = `
        width:100%;background:linear-gradient(135deg,#2a1060,#4a20a0,#2a1060);
        border:1px solid rgba(140,100,220,0.5);border-radius:16px;
        padding:15px;color:#c09af0;font-family:'Amiri',serif;
        font-size:17px;cursor:pointer;margin-top:4px;
        box-shadow:0 4px 20px rgba(100,60,200,0.2);
        transition:all 0.2s;
      `;
      btn.innerHTML = 'âœ¦ New Game+ â€” Ø§Ù„Ø­ÙƒÙ… Ø§Ù„ØµØ¹Ø¨';
      btn.onclick = startNewGamePlus;
      replaySection.appendChild(btn);
    }
  }
};

// Init on load
checkNGPlusUnlock();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—
// â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘
// â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
// â•šâ•â•â•â•â•â• â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•
// COMPLETE BILINGUAL SYSTEM â€” AR / EN
// Characters: Marwan | Jasper the Merchant | Leyla | Nasr | Ivan
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let currentLang = 'ar';
try { currentLang = localStorage.getItem('arihan_lang') || 'ar'; } catch(e){}

// â”€â”€ Character name localizer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function localizeNames(html) {
  if (currentLang === 'ar') return html;
  return html
    .replace(/Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù† Ø¯Ø±Ø§ÙƒÙˆÙ/g, 'Prince Ivan Drakoff')
    .replace(/Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù†/g, 'Prince Ivan')
    .replace(/Ù…Ø±ÙˆØ§Ù† Ø§Ù„Ø¯Ø§Ù‡ÙŠØ©/g, 'Marwan')
    .replace(/Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ/g, 'Jasper')
    .replace(/Ù„ÙŠÙ„Ù‰ Ø§Ù„Ø­ÙƒÙŠÙ…Ø©/g, 'Leyla')
    .replace(/Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ…/g, 'Nasr')
    .replace(/Ø¥ÙŠÙØ§Ù†/g, 'Ivan')
    .replace(/Ù…Ø±ÙˆØ§Ù†/g, 'Marwan')
    .replace(/Ø¬Ø§Ø¨Ø±/g, 'Jasper')
    .replace(/Ù„ÙŠÙ„Ù‰/g, 'Leyla')
    .replace(/Ù†ØµØ±/g, 'Nasr')
    .replace(/Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø®Ø§Ù„Ø¯/g, 'General Tariq')
    .replace(/Ø·Ø§Ø±Ù‚/g, 'Tariq')
    .replace(/Ø²ÙŠØ¯ Ø§Ù„ÙˆÙ‚ÙˆØ±/g, 'Elder Zaid')
    .replace(/Ø²ÙŠØ¯/g, 'Zaid')
    .replace(/ÙƒØ§Ø±Ø§Ø² Ø§Ù„Ø·Ø¨ÙŠØ¨/g, 'Karaz the Physician')
    .replace(/ÙƒØ§Ø±Ø§Ø²/g, 'Karaz')
    .replace(/Ø§Ù„Ø­ÙƒÙŠÙ… Ø±Ø§Ø´Ø¯/g, 'Elder Rashid')
    .replace(/Ø§Ù„Ø¬Ù†Ø±Ø§Ù„ Ø«ÙˆØ±ÙÙŠÙ†/g, 'General Thorvinn')
    .replace(/Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©/g, 'the Kingdom of Thandar')
    .replace(/Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©/g, 'Northern Thandar')
    .replace(/Ø§Ù„Ø«Ù†Ø¯Ø§Ø±/g, 'Thandar')
    .replace(/Ø£Ø±ÙŠÙ‡Ø§Ù†/g, 'Arihan');
}

// â”€â”€ Sub-label translator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function translateSub(lbl) {
  if (currentLang === 'ar') return lbl;
  return lbl
    .replace(/\+Ø§Ù„Ø´Ø¹Ø¨/g,'+People').replace(/[âˆ’-]Ø§Ù„Ø´Ø¹Ø¨/g,'âˆ’People')
    .replace(/\+Ø§Ù„Ø¬ÙŠØ´/g,'+Army').replace(/[âˆ’-]Ø§Ù„Ø¬ÙŠØ´/g,'âˆ’Army')
    .replace(/\+Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡/g,'+Nobles').replace(/[âˆ’-]Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡/g,'âˆ’Nobles')
    .replace(/\+Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡/g,'+Scholars').replace(/[âˆ’-]Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡/g,'âˆ’Scholars')
    .replace(/[âˆ’-]Ø®Ø²ÙŠÙ†Ø© ÙƒØ¨ÙŠØ±/g,'âˆ’Treasury (large)').replace(/\+Ø®Ø²ÙŠÙ†Ø© ÙƒØ¨ÙŠØ±/g,'+Treasury (large)')
    .replace(/[âˆ’-]Ø®Ø²ÙŠÙ†Ø©/g,'âˆ’Treasury').replace(/\+Ø®Ø²ÙŠÙ†Ø©/g,'+Treasury')
    .replace(/\+Treasury/g,'+Treasury')
    .replace(/[âˆ’-]Ù…Ø®Ø²ÙˆÙ†/g,'âˆ’Grain stocks').replace(/\+Ù…Ø®Ø²ÙˆÙ†/g,'+Grain stocks')
    .replace(/Ø®Ø·Ø± Ø´Ø®ØµÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ùƒ/g,'Risk to the ruler personally')
    .replace(/Ø®Ø·Ø± Ø´Ø®ØµÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙƒØ©/g,'Risk to the ruler personally')
    .replace(/Ø®Ø·Ø±: ÙˆØ¹Ø¯ Ø«Ù‚ÙŠÙ„/g,'Risk: a heavy promise')
    .replace(/[âˆ’-]Ø§Ø³ØªÙ‚Ù„Ø§Ù„ÙŠØ© Ø§Ù„Ø­ÙƒÙ…/g,'âˆ’Ruler independence')
    .replace(/ØªÙƒØ´Ù Ø³Ø± Ù…Ø±ÙˆØ§Ù† Ù…Ø¨ÙƒØ±Ø§Ù‹/g,"Reveals Marwan's secret early")
    .replace(/ØªØ¨Ù‚Ù‰ ÙÙŠ Ø§Ù„Ø¸Ù„Ø§Ù…/g,'You remain in the dark')
    .replace(/ÙˆØ±Ù‚Ø© Ø¶ØºØ· Ù…Ø­ÙÙˆØ¸Ø©/g,'A card held in reserve')
    .replace(/ØªÙØªØ­ Ù…Ø³Ø§Ø± Ù„ÙŠÙ„Ù‰ Ø§Ù„ÙƒØ§Ù…Ù„/g,"Opens Leyla's full storyline")
    .replace(/Ù„ÙŠÙ„Ù‰ ØªØ­ØªØ±Ù… Ø­Ø²Ù…Ùƒ/g,"Leyla respects your resolve")
    .replace(/Ù„ÙŠÙ„Ù‰ ØªØ®ØªÙÙŠ Ù…Ù† Ø§Ù„Ù…Ø´Ù‡Ø¯/g,'Leyla disappears from the story')
    .replace(/ÙˆÙ‚Øª Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„ØªØ­Ø¶ÙŠØ±/g,'Extra preparation time')
    .replace(/\+Ø³Ù„Ø§Ù… Ø´Ù…Ø§Ù„ÙŠ/g,'+Northern peace')
    .replace(/Ø§Ù„Ø­Ù‚ Ø³ÙŠÙÙƒØ´Ù/g,'Truth will be revealed')
    .replace(/Ù†ØªÙŠØ¬Ø© ØºÙŠØ± Ù…Ø¶Ù…ÙˆÙ†Ø©/g,'Outcome uncertain')
    .replace(/\+Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†Ø§Ø¯Ø±Ø©/g,'+Rare intelligence')
    .replace(/[âˆ’-]Ø³Ù„Ø·Ø© Ø§Ù„Ù…Ù„Ùƒ/g,"âˆ’Ruler's authority")
    .replace(/\+Ø¥Ø±Ø« ØªØ§Ø±ÙŠØ®ÙŠ/g,'+Historical legacy')
    .replace(/[âˆ’-]Ù…Ù…ØªÙ„ÙƒØ§Øª Ù…Ù„ÙƒÙŠØ©/g,'âˆ’Royal properties')
    .replace(/Ø§Ù„Ø´Ùƒ ÙŠØ³Ø±ÙŠ/g,'suspicion spreads')
    .replace(/Ø­Ø²Ù…/g,'resolve')
    .replace(/[âˆ’-]Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡/g,'âˆ’Nobles')
    .replace(/ØªÙØªØ­ Ù…Ø³Ø§Ø±/g,'Unlocks path');
}

// â”€â”€ Transition text map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TRANS_EN = {
  'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØªØ°Ù…Ø±ÙˆÙ†... Ù„ÙƒÙ† Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ø£Ø®Ø°Øª Ù†ÙÙØ³Ù‡Ø§':  'The nobles grumbleâ€¦ but the treasury catches its breath',
  'Ø§Ù„Ø¬Ù†Ø¯ ÙŠØªØ°Ù…Ø±ÙˆÙ†... Ø§Ù„ÙˆØ¹Ø¯ Ø«Ù‚ÙŠÙ„':                  'The soldiers complainâ€¦ the promise weighs heavy',
  'Ø§Ù„Ø­ÙƒÙŠÙ… ÙŠØ¨ØªØ³Ù…... Ù„Ù„Ø¹Ù„Ù…Ø§Ø¡ Ø§Ù„Ø¢Ù† Ø«Ù…Ù†Ù‡Ù…':           'The Scholar smilesâ€¦ the learned now have their price',
  'Ø§Ù„Ø´Ø¹Ø¨ ÙŠÙ‡ØªÙ Ø¨Ø§Ø³Ù…Ùƒ ÙÙŠ ÙƒÙ„ Ø´Ø§Ø±Ø¹!':                 'The people cheer your name in every street!',
  'Ø§Ù„Ù…Ø§Ø¡ ÙŠØªØ¯ÙÙ‚... ÙˆØ§Ù„Ø£Ø±Ø¶ ØªØ¹ÙˆØ¯ Ù„Ù„Ø­ÙŠØ§Ø©':             'Water flowsâ€¦ and the land returns to life',
  'Ø§Ù„Ø­Ø¨ÙˆØ¨ ÙˆØµÙ„Øª... Ù„ÙƒÙ† Ø§Ù„Ø®Ø²ÙŠÙ†Ø© Ù†Ø²ÙØª':              'The grain arrivedâ€¦ but the treasury bled',
  'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø³Ù‚Ø·Øª... Ø§Ù„Ø¯Ù… ÙŠØ³ØªÙˆØ¬Ø¨ Ø§Ù„Ø¯Ù…':     'The eastern city has fallenâ€¦ blood demands blood',
  'Ø§Ù„Ø£Ù…ÙŠØ± Ù‚Ø¨Ù„... Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙˆÙ† ÙŠØªØ³Ø§Ø¡Ù„ÙˆÙ†':        'The Prince acceptedâ€¦ the other nobles wonder',
  'Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ­ÙƒÙ…... ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ±Ø§Ù‚Ø¨':                  'The people judgeâ€¦ and history watches',
  'ØºØ±ÙØ© Ø§Ù„Ø­Ø±Ø¨ Ù‚Ø±Ø±Øª... Ø§Ù„Ø®Ø·Ø© Ø¨Ø¯Ø£Øª':                'The war room has decidedâ€¦ the plan is in motion',
  'Ø§Ù„Ù…Ø¨Ø¹ÙˆØ« ÙŠØªØ­Ø±Ùƒ... ÙˆØ§Ù„Ø«Ù†Ø¯Ø§Ø± ØªØªÙˆÙ‚Ù Ù…Ø¤Ù‚ØªØ§Ù‹':        'The envoy movesâ€¦ Thandar pauses temporarily',
  'Ø§Ù„Ø°Ù‡Ø¨ ÙŠØ´ØªØ±ÙŠ Ø§Ù„ÙˆÙ‚Øª... Ø§Ù„Ø¬ÙŠØ´ ÙŠØªØ­Ø´Ø¯':             'Gold buys timeâ€¦ the army musters',
  'Ø§Ù„Ù…Ù„Ùƒ ÙŠÙ‚Ø§ØªÙ„! Ù…Ø¹Ù†ÙˆÙŠØ§Øª Ø§Ù„Ø¬Ù†Ø¯ ØªØ­Ù„Ù‘Ù‚ Ø¹Ø§Ù„ÙŠØ§Ù‹!':     'The King fights! Troop morale soars!',
  'Ø§Ù„Ù…Ù„ÙƒØ© ØªÙ‚Ø§ØªÙ„! Ù…Ø¹Ù†ÙˆÙŠØ§Øª Ø§Ù„Ø¬Ù†Ø¯ ØªØ­Ù„Ù‘Ù‚ Ø¹Ø§Ù„ÙŠØ§Ù‹!':    'The Queen fights! Troop morale soars!',
  'Ø§Ù„Ø³Ù„Ø§Ù… Ø¬Ø§Ø¡... Ø¨Ø«Ù…Ù† ÙŠØ¬Ø±Ø­ Ø§Ù„ÙƒØ¨Ø±ÙŠØ§Ø¡':             'Peace cameâ€¦ at a price that wounds pride',
  'Ø§Ù„ØºØ²Ø§Ø© ØªØ±Ø§Ø¬Ø¹ÙˆØ§... Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ÙŠØ© Ø¯ÙÙ…Ù‘Ø±Øª':      'The invaders retreatedâ€¦ the border villages were destroyed',
  'Ø§Ù„ÙˆØ¨Ø§Ø¡ ÙŠØªØ±Ø§Ø¬Ø¹... Ù„ÙƒÙ† Ø¬Ø±Ø­ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø¹Ù…ÙŠÙ‚':        'The plague retreatsâ€¦ but the city\'s wound runs deep',
  'Ù„Ø§ Ø£Ø­Ø¯ Ù…Ø§Øª ÙˆØ­ÙŠØ¯Ø§Ù‹... Ù‡Ø°Ø§ Ù„Ù† ÙŠÙÙ†Ø³Ù‰':           'No one died aloneâ€¦ that will never be forgotten',
  'Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠÙØ¯ÙŠØ±ÙˆÙ† Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©... ÙˆØ§Ù„Ù…Ù„Ùƒ ÙŠØ±Ø§Ù‚Ø¨': 'The Scholars manage city affairsâ€¦ the ruler watches',
  'Ø§Ù„Ø°Ù‡Ø¨ ÙŠØªØ¯ÙÙ‚... Ù„ÙƒÙ† Ø¬Ø§Ø¨Ø± Ø£ØµØ¨Ø­ Ø´Ø±ÙŠÙƒØ§Ù‹ Ù„Ø§ ØªØ§Ø¬Ø±Ø§Ù‹': 'Gold flowsâ€¦ but Jasper is now a partner, not a merchant',
  'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØºÙ„ÙˆÙ† ØºØ¶Ø¨Ø§Ù‹... Ù„ÙƒÙ† Ø§Ù„Ø¯ÙˆÙ„Ø© ØªØªÙ†ÙØ³':     'The nobles seetheâ€¦ but the state breathes again',
  'Ø§Ù„Ø´Ø¹Ø¨ ØµÙØ¯Ù…... Ø«Ù… Ø¨ÙƒÙ‰. Ø§Ù„Ù…Ù„Ùƒ ÙŠØ¶Ø­ÙŠ Ø¨Ù†ÙØ³Ù‡':      'The people were shockedâ€¦ then wept. The King sacrifices',
  'Ø§Ù„Ø´Ø¹Ø¨ ØµÙØ¯Ù…... Ø«Ù… Ø¨ÙƒÙ‰. Ø§Ù„Ù…Ù„ÙƒØ© ØªØ¶Ø­ÙŠ Ø¨Ù†ÙØ³Ù‡Ø§':    'The people were shockedâ€¦ then wept. The Queen sacrifices',
  'Ø§Ù„Ù…Ø­Ø§ÙƒÙ…Ø© ØªÙ‡Ø²Ù‘ Ø£Ø±ÙŠÙ‡Ø§Ù†... Ù„Ø§ Ø´ÙŠØ¡ Ø¨Ø¹Ø¯Ù‡Ø§ ÙƒÙ…Ø§ ÙƒØ§Ù†': 'The trial shakes Arihanâ€¦ nothing after it is the same',
  'Ù…Ø±ÙˆØ§Ù† ØºØ§Ø¯Ø±... Ù„ÙƒÙ† Ø£Ø³Ø±Ø§Ø±Ù‡ Ø¨Ù‚ÙŠØª ÙÙŠ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†':     'Marwan leftâ€¦ but his secrets remained in the walls',
  'Ù…Ø±ÙˆØ§Ù† Ø¨ÙƒÙ‰... ÙˆØ§Ø¹ØªØ±Ù Ø¨Ø£ÙƒØ«Ø± Ù…Ù…Ø§ ØªÙˆÙ‚Ø¹Øª':          'Marwan weptâ€¦ and confessed more than you expected',
  'Ø§Ù„ØµØ¯Ù…Ø© ØªØ³Ø±ÙŠ ÙÙŠ Ø§Ù„Ù‚ØµØ±... Ø£Ø®ÙˆÙƒ Ø­ÙŠÙ‘!':            'Shock ripples through the palaceâ€¦ your brother is alive!',
  'Ø§Ù„Ù…Ø­ØªØ§Ù„ Ø§Ù†ÙƒØ´Ù! Ø§Ù„Ø¹Ø±Ø´ Ù„Ùƒ ÙˆØ­Ø¯Ùƒ!':                'The impostor is exposed! The throne is yours alone!',
  'Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† ØªØ¨ØªÙ„Ø¹Ù‡... ÙˆØ§Ù„Ø´Ø§Ø¦Ø¹Ø§Øª ØªØ¨Ù‚Ù‰ Ø­Ø±Ø©':         'The walls swallow himâ€¦ but the rumours remain free',
  'Ø§Ù„Ø´Ø¹Ø¨ ÙŠØ­Ø¨Ù‘ Ø§Ù„Ø±Ø­Ù…Ø©... ÙˆØ§Ù„Ø£Ø® ÙŠØ¨ØªØ³Ù… Ø¨Ø¹ÙŠÙˆÙ† Ø¨Ø§Ø±Ø¯Ø©': 'The people love mercyâ€¦ and the brother smiles with cold eyes',
  'Ø§Ù„Ø­Ø±Ø¨ ØªØªÙˆÙ‚Ù... ÙˆØ§Ù„ØªØ­Ø§Ù„Ù ÙŠÙØ±Ø³Ù‰':               'War pausesâ€¦ the alliance is sealed',
  'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ ÙŠØ­ØªÙÙ„ÙˆÙ†... Ø§Ù„Ø´Ø¹Ø¨ ÙŠØªØ±Ù‚Ù‘Ø¨':              'The nobles celebrateâ€¦ the people watch and wait',
  'Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ ÙŠÙØ¤ÙŠØ¯ÙˆÙ†... Ù…ÙƒØ§Ù†ØªÙ‡Ù… ØªØ±Ø³Ù‘Ø®Øª Ù…Ø¹Ùƒ':        'The Scholars approveâ€¦ their standing is secured alongside yours',
  'Ø§Ù„Ù…ÙŠØ«Ø§Ù‚ ÙŠÙÙ‚Ø±Ø£ ÙÙŠ ÙƒÙ„ Ù‚Ø±ÙŠØ©... Ø§Ø³Ù…Ùƒ ÙŠÙÙ†Ù‚Ø´ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®': 'The Charter is read in every villageâ€¦ your name is etched in history',
  'Ø§Ù„Ù†ÙˆØ± ÙŠÙØ¶Ø§Ø¡... ÙˆØ§Ù„Ø¬Ù‡Ù„ ÙŠØªØ±Ø§Ø¬Ø¹':                  'Light is kindledâ€¦ and ignorance retreats',
  'Ø§Ù„Ø±Ø§ÙŠØ© ØªØ±ØªÙØ¹... ÙˆØ§Ù„Ø­Ø±Ø¨ ØªØ¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯':          'The banner risesâ€¦ and war begins anew',
  'Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙƒÙØªØ¨Øª... ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙŠÙØ³Ø¬Ù‘Ù„':             'The ending is writtenâ€¦ and history records',
};

function transEN(text) {
  if (currentLang === 'ar') return text;
  return TRANS_EN[text] || text;
}

// â”€â”€ SCENES_EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SCENES_EN = {
  debt: {
    chapter: 'Chapter One â€” The Weight of Inheritance',
    title: "Father's Debts",
    text: () => `
      The moment you take the throne, <span class="char-name">Grand Vizier Marwan</span> summons you.
      His face is pale, as one who carries news that could break a man's back.
      <br><br>
      <span class="whisper">"Your Majestyâ€¦ our treasury is crushed under your father's debts. The northern banks are waiting. If we don't pay within forty days, they will send armed collectors."</span>
      <br><br>
      Three faces stare at you in the grand hall:
      the merchant <span class="char-name">Jasper</span>, the commander <span class="char-name">General Tariq</span>, and the elder <span class="char-name">Elder Zaid</span>.
      Each holds a solution â€” and each wants a price.
    `,
    memory: null,
    choices_text: [
      'Impose emergency taxes on nobles and wealthy merchants',
      'Ask the army to forgo their bonuses â€” in exchange for a promise to double them',
      "Borrow from the Scholars' treasury in exchange for privileges and council seats",
    ],
    chronicle: [
      'Imposed emergency taxes on the nobles',
      'Asked the army to sacrifice bonuses for a future promise',
      "Borrowed from the Scholars' treasury in exchange for privileges",
    ],
  },
  drought: {
    chapter: 'Chapter Two â€” The Thirsty Land',
    title: "Hell's Summer",
    text: () => {
      let extra = 'Famine approaches and time is running out.';
      if (G.tags.has('taxed_nobles')) extra = `The furious nobles <span class="dramatic">refuse to help</span>, protesting the taxes. The crisis runs deeper than it had to.`;
      else if (G.tags.has('army_debt')) extra = `The resentful soldiers <span class="dramatic">deliberately slow</span> supply distribution. The promise has yet to be kept.`;
      else if (G.tags.has('church_debt')) extra = `<span class="good-word">The Scholars open their hall</span> to the starving without asking permission â€” and the credit goes to them, not you.`;
      return `
        Three months without rain. The southern villages' crops wither in the fields,
        and farmers march toward the capital with faces dry as cracked mud.
        <br><br>
        <span class="char-name">Marwan</span> lays a frightening report before you:
        <span class="whisper">"If we don't intervene within two weeks, children will start dying."</span>
        <br><br>
        ${extra}
      `;
    },
    memory: () => G.tags.has('taxed_nobles') ? 'ğŸ“Œ The nobles are furious over the taxes' :
                  G.tags.has('army_debt') ? 'âš”ï¸ The army was not rewarded as you promised' :
                  G.tags.has('church_debt') ? 'ğŸ“œ The Scholars are now an independent power' : null,
    choices_text: [
      'Open the royal grain stores for free â€” no one goes hungry',
      'Send the army to dig irrigation canals from the northern river',
      'Buy grain from northern merchants at any price',
    ],
    chronicle: [
      'Opened royal grain stores for the people',
      'Ordered the army to dig irrigation canals',
      'Bought grain from the North with the treasury',
    ],
  },
  rebellion: {
    chapter: 'Chapter Three â€” Strife Ignites',
    title: 'Prince Ivan Breaks His Oath',
    text: () => {
      let extra = 'The situation is delicate, and every step has its price.';
      if (G.tags.has('opened_stores')) extra = `<span class="good-word">Your people stand firmly behind you</span> after you fed them â€” but the army remains wavering.`;
      else if (G.tags.has('army_debt')) extra = `<span class="dramatic">The soldiers hesitate to comply</span> â€” the memory of the broken promise looms in their minds.`;
      return `
        A leaked message arrives from the Eastern Palace:
        <span class="char-name">Prince Ivan Drakoff</span> declares that the throne deserves someone more worthy.
        He has stopped paying taxes and withdrawn his soldiers from the borders.
        <br><br>
        <span class="char-name">Tariq</span> slams the table: <span class="whisper">"Let me march on him now. This rebel deserves no parley."</span>
        <br><br>
        ${extra}
      `;
    },
    memory: () => G.tags.has('army_debt') ? "âš ï¸ The army is still angry over your broken promise" :
                  G.tags.has('opened_stores') ? 'ğŸ’š The people strongly support you â€” that\'s leverage' : null,
    choices_text: [
      'Send the army to crush the rebellion immediately by force',
      'Invite him to a banquet and offer him the position of Chief Advisor',
      'Publicly accuse him of treason and wait for the factions to rally',
    ],
    chronicle: [
      "Crushed Prince Ivan's rebellion by force",
      'Negotiated with the Prince and granted him a position',
      'Publicly accused the Prince and awaited faction support',
    ],
  },
  war_council: {
    chapter: 'Chapter Three & a Half â€” The War Room',
    title: 'The Grand War Council',
    text: () => {
      let extra = 'The council waits. The decision is yours alone.';
      if (G.tags.has('diplomacy_rebel')) extra = `<span class="char-name">Prince Ivan</span> stands quietly in the corner. When your eyes meet, he nods â€” <span class="good-word">his soldiers are on their way.</span>`;
      else if (G.tags.has('crushed_rebel')) extra = `Your last victory gave the army <span class="good-word">high confidence</span>, but Tariq warns: <span class="whisper">"Thandar has learned from its mistakes."</span>`;
      else if (G.tags.has('army_debt')) extra = `<span class="dramatic">In the corner, three commanders whisper.</span> Tariq informs you with worried eyes: <span class="whisper">"The promise has not been kept yet, Your Majesty."</span>`;
      return `
        Four faces stare at the map of Arihan spread across the table.
        <span class="char-name">Tariq</span> pounds the table with his fist:
        <span class="whisper">"Thandar is moving. Our intelligence confirms thirty thousand troops at the border."</span>
        <br><br>
        <span class="char-name">Leyla</span> traces circles on the map with her finger:
        <span class="whisper">"War is not the only option â€” they want a trade route, not land."</span>
        <br><br>
        <span class="char-name">Elder Zaid</span> falls silent for a long moment, then raises his head:
        <span class="whisper">"Your Majesty, the army needs a week to muster. Buy time."</span>
        <br><br>
        ${extra}
      `;
    },
    memory: () => G.tags.has('diplomacy_rebel') ? 'ğŸ¤ Prince Ivan is now an ally with his soldiers' :
                  G.tags.has('army_debt') ? 'âš ï¸ Commanders remember the promise â€” loyalty shaky' :
                  G.tags.has('crushed_rebel') ? 'âš”ï¸ Your last victory strengthened your military standing' : 'ğŸ—ºï¸ The War Council deliberates',
    choices_text: [
      "Endorse Tariq's military plan â€” war with Thandar is inevitable",
      "Adopt Leyla's approach â€” send an envoy to understand Thandar's demands first",
      "Adopt Zaid's counsel â€” buy time with gold, then decide",
    ],
    chronicle: [
      'Endorsed the war plan in the war council',
      "Sent a diplomatic envoy to probe Thandar's intentions",
      'Bought time with gold to prepare the army',
    ],
  },
  invasion: {
    chapter: 'Chapter Four â€” The Invasion',
    title: 'The Northern Lions March',
    text: () => {
      let extra = 'Battle is inevitableâ€¦ how will you fight it?';
      if (G.tags.has('sent_envoy')) extra = `<span class="good-word">Your envoy returned with valuable intelligence:</span> Thandar wants only the northern trade route â€” not all the land. <span class="char-name">Tariq</span> sees an opportunity.`;
      else if (G.tags.has('bought_time')) extra = `<span class="good-word">The extra month you purchased</span> made the army far more prepared. Plans were laid, supplies gathered.`;
      else if (G.tags.has('council_war')) extra = `Tariq's plan is ready. Soldiers know their positions. <span class="good-word">The initiative is yours.</span>`;
      else if (G.tags.has('crushed_rebel') && G.tags.has('dug_canals')) extra = `Your army is <span class="good-word">unified with high morale</span>, and the irrigation canals ensure cities are supplied.`;
      else if (G.tags.has('diplomacy_rebel')) extra = `<span class="char-name">Prince Ivan</span> offers you his soldiers â€” diplomacy has borne fruit!`;
      else if (G.tags.has('army_debt')) extra = `<span class="dramatic">Some army commanders grumble loudly</span> â€” the promise was never kept.`;
      return `
        Thirty thousand soldiers from <span class="char-name">the Kingdom of Thandar</span> cross the border.
        Their commander <span class="char-name">General Thorvinn</span> sends one message:
        <span class="whisper"><span class="dramatic">"Surrender, or we burn villages one by one."</span></span>
        <br><br>
        The war council convenes in a room thick with smoke and fear.
        <br><br>
        ${extra}
      `;
    },
    memory: () => G.tags.has('diplomacy_rebel') ? 'ğŸ¤ Prince Ivan is now your ally' :
                  G.tags.has('crushed_rebel') ? 'âš”ï¸ Your army is battle-hardened and victorious' :
                  G.tags.has('army_debt') ? 'âš ï¸ The army remembers your unfulfilled promise' : null,
    choices_text: [
      () => gT('Lead the army yourself â€” the King fights!', 'Lead the army yourself â€” the Queen fights!'),
      'Negotiate in exchange for ceding border territories',
      'Scorched earth tactics â€” evacuate the border as a trap',
    ],
    chronicle: [
      'Led the army personally in the Battle of Thandar',
      'Ceded territories to stop the war',
      'Burned the border as a trap for the invaders',
    ],
  },
  plague: {
    chapter: 'Chapter Five â€” The Black Plague',
    title: 'Death Knocks at the Doors',
    text: () => {
      let extra = 'The city awaits your decision, Your Majesty.';
      if (G.tags.has('led_battle')) extra = `<span class="good-word">Your people trust you completely</span> after seeing you fight alongside them â€” your decisions will be obeyed without hesitation.`;
      else if (G.tags.has('scorched_earth')) extra = `<span class="dramatic">The destroyed border villages</span> form wretched zones nearly impossible to quarantine.`;
      else if (G.tags.has('church_debt')) extra = `<span class="char-name">Elder Zaid</span> reminds you of the old debt and sends an implicit message: <span class="whisper">"We are hereâ€¦ as we always have been."</span>`;
      return `
        Soldiers returning from the border brought back an unseen plague.
        <br><br>
        Within two weeks, a third of the city's shops closed. Physicians burn bodies by night.
        <span class="char-name">Elder Zaid</span> calls for a council of scholars, while <span class="char-name">Karaz the royal physician</span> says:
        <span class="whisper">"Strict quarantine is the only scientifically sound solution, Your Majesty."</span>
        <br><br>
        ${extra}
      `;
    },
    memory: () => G.tags.has('church_debt') ? 'ğŸ“œ The Scholars are waiting in exchange for their help' :
                  G.tags.has('led_battle') ? 'ğŸ’š The people trust your leadership without reservation' :
                  G.tags.has('scorched_earth') ? 'âš ï¸ The destroyed villages complicate matters further' : null,
    choices_text: [
      'Total quarantine of infected cities, even at economic cost',
      'Spend the entire treasury on treatment â€” no one dies alone',
      'Delegate crisis management to the Scholars in exchange for broader concessions',
    ],
    chronicle: [
      'Quarantined infected cities completely',
      'Spent the entire treasury to treat the sick',
      'Delegated the plague crisis to the Scholars in exchange for concessions',
    ],
  },
  treasury_dilemma: {
    chapter: 'Chapter Five and a Half â€” The Weight of Gold',
    title: 'The Treasury Fades',
    text: () => {
      let extra = 'The economic crisis was no surprise â€” but its true magnitude is staggering.';
      if (G.tags.has('treasury_empty')) extra = `<span class="dramatic">The plague drained the last reserves.</span> Jasper adds: <span class="whisper">"The situation is worse than I anticipated, Your Majesty."</span>`;
      else if (G.tags.has('healed_all')) extra = `The people know your sacrifice and call you the just ruler â€” <span class="good-word">but a just ruler who is bankrupt does not reign long.</span>`;
      else if (G.tags.has('bought_grain')) extra = `Buying grain from the North depleted reserves that have yet to be replenished. Jasper makes no effort to hide his concern.`;
      return `
        <span class="char-name">Jasper</span>, the kingdom's greatest merchant, requests an urgent audience.
        He sits before you and places a thick ledger on the table â€” numbers upon numbers.
        <br><br>
        <span class="whisper">"Your Majesty, the treasury will last three months. After that, we cannot pay the army's wages."</span>
        <br><br>
        ${extra}
      `;
    },
    memory: () => G.tags.has('treasury_empty') ? 'ğŸ’¸ Treasury nearly empty after treating the plague' :
                  G.tags.has('church_debt') ? 'ğŸ“œ The Scholars lent before â€” will they do it again?' :
                  'âš–ï¸ Jasper knows every secret of the treasury',
    choices_text: [
      'Offer Jasper trade monopolies in exchange for an emergency loan',
      'Impose an extraordinary tax on top nobles and merchants',
      'Sell some royal lands â€” sacrifice begins from the palace',
    ],
    chronicle: [
      'Struck a deal with Jasper in exchange for a loan and monopolies',
      'Imposed an extraordinary tax on the wealthy to save the treasury',
      'Sold royal lands to save the treasury',
    ],
  },
  betrayal: {
    chapter: 'Chapter Six â€” The Knife in the Back',
    title: "Marwan's Betrayal",
    text: () => {
      const ngKnows = G.tags.has('ng_knows_murder')
        ? `<div class="ng-scene-tag">âœ¦ NG+ â€” You know more than they think</div>
           <span class="good-word">Nasr and Leyla gave you the advantage.</span>
           This letter does not surprise you. Marwan does not know you know â€”
           <span class="dramatic">and that is the most powerful weapon in your hands now.</span><br><br>` : '';
      let extra = 'The palace holds its breath. Everyone watches how you act.';
      if (G.tags.has('yusuf_deal')) extra = `<span class="dramatic">Jasper smiles in the corner</span> â€” your deal bound him to you, but it bound you to him as well. Is he entangled with Marwan?`;
      else if (G.tags.has('king_sacrifice')) extra = `<span class="good-word">The people know your sacrifice of the royal lands.</span> That credit may shield you from backlash.`;
      else if (G.tags.has('diplomacy_rebel')) extra = `<span class="char-name">Prince Ivan</span>, your ally, confirms: <span class="good-word">"I saw Marwan meeting with Thandar's spies with my own eyes."</span>`;
      else if (G.tags.has('taxed_nobles')) extra = `<span class="dramatic">The furious nobles secretly support Marwan</span> â€” they see him as an ally against you.`;
      return `${ngKnows}
        On a cold night, an anonymous letter appears beneath your pillow.
        It contains detailed evidence: <span class="char-name">Marwan</span>, your vizier since day one â€”
        was the one who advised your father to take the loans that crushed the treasury,
        and was the one leaking intelligence to Thandar before the invasion.
        <br><br>
        <span class="whisper">A voice in your head: "Act rashly, and you'll turn half the court against you."</span>
        <br><br>
        ${extra}
      `;
    },
    memory: () => G.tags.has('diplomacy_rebel') ? 'ğŸ¤ Prince Ivan is an eyewitness against Marwan' :
                  G.tags.has('taxed_nobles') ? 'âš ï¸ The nobles back Marwan â€” act with care' :
                  'ğŸ—¡ï¸ Marwan was the closest person to you',
    choices_text: [
      'A public trial â€” the evidence before all',
      'Exile him quietly without scandal â€” the kingdom cannot bear a public shame',
      'Grant him a chance to confess in exchange for mercy',
    ],
    chronicle: [
      'Tried Marwan publicly before the people and factions',
      'Exiled Marwan silently, away from the spotlight',
      'Granted Marwan a chance to confess and showed mercy',
    ],
  },
  pretender: {
    chapter: 'Chapter Seven â€” Blood of Kings',
    title: 'The Claimant to the Throne',
    text: () => {
      let extra = 'The truth is buriedâ€¦ and you must decide.';
      if (G.tags.has('solomon_secret')) extra = `<span class="good-word">Marwan confessed the truth:</span> this young man is real â€” your father told him years before his death. <span class="dramatic">Your illegitimate brother is alive.</span>`;
      else if (G.tags.has('public_trial')) extra = `After the Marwan scandal, <span class="dramatic">the people are ready to believe any claim</span> that shakes the throne.`;
      else if (G.tags.has('crushed_rebel')) extra = `Your military strength stands behind you â€” but <span class="whisper">swords cannot silence doubt.</span>`;
      return `
        From the distant Eastern lands comes a young man claiming to be <span class="dramatic">your father's son from a secret marriage</span>.
        He carries documents that appear genuine, and an old royal signet seen by very few.
        <br><br>
        <span class="char-name">Leyla</span> sits before you, her eyes full of concern:
        <span class="whisper">"Your Majesty, if he is real, half the kingdom will follow him. And if he is false â€” who sent him?"</span>
        <br><br>
        ${extra}
      `;
    },
    memory: () => G.tags.has('solomon_secret') ? 'ğŸ’€ Marwan revealed: the claimant is your true brother' :
                  G.tags.has('public_trial') ? "âš–ï¸ Marwan's trial sowed doubt in every heart" :
                  'ğŸ‘‘ Who sent this young man? And why now?',
    choices_text: [
      'A blood test before the Scholars and nobles â€” truth stands above all',
      'Arrest him immediately â€” those who question the ruler deserve the dungeon',
      'Acknowledge him as a brother and grant him an honorary title â€” keep your enemies close',
    ],
    chronicle: [
      'Blood test revealed: the claimant is a true brother',
      'Blood test exposed the false claimant before all',
      'Imprisoned the claimant without public trial',
      'Acknowledged the claimant as brother and granted him a title',
    ],
  },
  political_marriage: {
    chapter: 'Chapter Eight â€” The Mark of Alliance',
    title: 'The Alliance Bargain',
    text: () => `
      Ambassadors from three regions compete to forge an alliance through marriage.
      <span class="char-name">Leyla</span> lays the proposals before you:
      <br><br>
      The General's daughter from Thandar â€” an alliance that stops the wars.
      A noble princess from the East â€” silences their opposition and fills the treasury.
      And the granddaughter of the Head Scholar â€” granting you unmatched religious legitimacy.
      <br><br>
      <span class="whisper">"Every choice, Your Majesty, closes one door and opens three."</span>
    `,
    memory: () => G.tags.has('surrendered_land') ? 'ğŸ³ï¸ Thandar has not forgotten you ceded your lands' :
                  G.tags.has('brother_revealed') ? "ğŸ‘‘ Your brother's presence complicates any alliance" : null,
    choices_text: [
      "The General's daughter â€” peace with Thandar above all else",
      "The noble princess â€” wealth and internal stability are the foundation of rule",
      "The Head Scholar's granddaughter â€” wisdom and counsel cannot be bought with gold",
    ],
    chronicle: [
      'Married the daughter of the Northern General',
      'Married the noble princess from the East',
      'Married the granddaughter of the Head Scholar',
    ],
  },
  legacy: {
    chapter: "The Final Chapter â€” Arihan's Legacy",
    title: 'The Last Decision',
    text: () => {
      const base = `
        Ten years have passed since you first sat on Arihan's throne.
        The kingdom has changed. You have changed. And now one decision will define how you are remembered.
        <br><br>
        <span class="char-name">Leyla</span> stands beside you one last time:
        <span class="whisper">"Your Majesty, ${gT('every ruler leaves something. What do you wish to leave','every ruler leaves something. What do you wish to leave')} for Arihan?"</span>
        <br><br>
      `;
      if (G.tags.has('brother_revealed') || G.tags.has('adopted_brother'))
        return base + `<span class="char-name">Your brother</span> stands in the corner, watching. His eyes reveal nothing â€” love? Resentment? Or ambition?`;
      if (G.tags.has('king_sacrifice'))
        return base + `<span class="good-word">The people still retell the story of the ruler who sold their land</span> to feed them. Leyla pats your shoulder: <span class="whisper">"What you gave will not be forgotten."</span>`;
      if (G.tags.has('healed_all'))
        return base + `The people whose wounds you healed still cheer your name in the markets. <span class="char-name">Karaz the physician</span> stands behind Leyla with grateful eyes.`;
      if (G.tags.has('led_battle'))
        return base + `The soldiers who fought beside you became fathers and mothers â€” they tell their children of the ruler who descended from the throne and carried a sword.`;
      if (G.tags.has('yusuf_deal'))
        return base + `<span class="char-name">Jasper</span> sits in the background. Leyla's gaze at him is cold: <span class="whisper">"Some deals stay with you longer than you'd like, Your Majesty."</span>`;
      return base + `Arihan waits. History readies its pen.`;
    },
    memory: () => {
      if (G.tags.has('adopted_brother') || G.tags.has('brother_revealed')) return 'ğŸ‘‘ Your brother still watches from within the palace';
      if (G.tags.has('forgave_solomon')) return 'ğŸ•¯ï¸ Your mercy toward Marwan taught people the meaning of justice';
      return 'ğŸ“œ Ten years of decisions lead to this moment';
    },
    choices_text: [
      "The Charter of Rights â€” the first law protecting the people from noble tyranny",
      "The Grand University â€” knowledge and medicine for all of Arihan's children",
      "The Empire â€” Arihan expands and Thandar will pay the price",
    ],
    chronicle: [
      'Issued the Charter of Rights to protect the people',
      'Founded the Grand University for all of Arihan',
      'Declared Arihan an empire and began expansion',
    ],
  },
};

// â”€â”€ RANDOM EVENTS EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RANDOM_EVENTS_EN = {
  spy_caught: { title:'A Spy in the Palace', text:'Your guards catch a man photographing palace maps at night. Under interrogation, he reveals he works for northern nobles seeking to destabilize your throne.', choices:['Execute him immediately â€” a message to others','Turn him into a double agent'] },
  harvest_miracle: { title:'Season of Abundance', text:"Against all expectations, this year's harvest is plentiful. The farmers say it is a blessing from God upon your righteous reign.", choices:['Distribute the surplus to the poor in full','Store it in the treasury for emergencies'] },
  leyla_arrives: { title:'The Mysterious Advisor', text:'A woman named <strong>Leyla</strong> requests an audience. She studied in Eastern academies and speaks seven languages. Her eyes read rooms before people.', choices:['Accept her as a personal advisor','Refuse â€” the palace is not for strangers'] },
  merchants_petition: { title:"The Merchants' Delegation", text:'Twenty merchants demand the abolition of road taxes. They claim it impoverishes the economy. The nobles object â€” this tax is part of their income.', choices:['Abolish it â€” trade enriches all','Halve it â€” a middle ground'] },
  army_promotion: { title:'The Battle Hero', text:'A young officer from a poor family saved an entire battalion. Tariq proposes promoting him to Commander of the Royal Guard. The nobles refuse â€” the family is not noble.', choices:['Promote him â€” merit above lineage','Award him a medal â€” traditions matter'] },
  secret_library: { title:"Your Father's Secret Library", text:"Behind a wall in an old storeroom, you find your father's hidden library. It contains secret documents â€” some revealing hidden deals, others holding maps to buried treasure.", choices:['Announce the documents â€” transparency first','Use the maps in secret'] },
  wandering_healer: { title:'The Strange Physician', text:'A wandering healer claims cures for diseases without remedy. The Scholars accuse him of charlatanism. The people believe him and gather around him.', choices:['Invite him to the palace and officially sponsor him','Expel him â€” no place for superstition'] },
  poet_scandal: { title:'A Poem That Shakes the Court', text:'A young poet published a satirical poem mocking the nobles and glorifying the people. The nobles demand his tongue be cut. The people recite the poem in every alley.', choices:['Protect the poet â€” freedom of expression is sacred','Imprison him â€” stability above all','Pardon him and make him the court poet'] },
  earthquake: { title:'The Eastern Earthquake', text:'An earthquake strikes the eastern region. A thousand homes collapse, and thousands of displaced people march toward the capital. The treasury groans â€” but conscience speaks.', choices:['Declare a state of emergency and send all resources','Send limited aid and maintain priorities'] },
  foreign_ambassador: { title:'An Ambassador from the Far West', text:"An ambassador from a distant kingdom offers a trade alliance â€” new routes and unknown markets. But the Scholars suspect his motives.", choices:['Sign the treaty â€” trade enriches all','Refuse until you study it more deeply'] },
  royal_treasury_thief: { title:'The Thief in the Treasury', text:"An old guard is caught stealing from the royal treasury. Investigation reveals he was sending money to his impoverished family. The law is clear â€” but the heart speaks.", choices:['Dismiss and punish him â€” no exceptions to the law','Pardon him and provide for his family from the treasury'] },
};

// â”€â”€ REACTIONS EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const REACTIONS_EN = {
  people: {
    up: ['The people cheer your name in the alleys!','Hearts lean toward you, O ruler','The people\'s blessing anchors the throne','Joy spreads across the city'],
    down: ['Murmurs of discontent fill the streets...','Anger rises in the roads','The people\'s trust erodes bit by bit','Complaint precedes rebellion...'],
  },
  army: {
    up: ['The soldiers raise their swords in loyalty!','The army is more united today','Troop morale has never been higher!','The barracks ring with the ruler\'s name!'],
    down: ['Whispers of discontent run through the soldiers...','The army slowly loses its spirit','Grumbling spreads through the ranks','Loyalty begins to fracture...'],
  },
  nobles: {
    up: ['The nobles express their approval','The influential stand in your corner','Wealth flows into your treasury'],
    down: ['The nobles confer behind closed doors...','Money dries up and its owners pull away','A quiet fury simmers in the noble halls...'],
  },
  church: {
    up: ['The Scholars endorse and support your decision','Your legitimacy grows stronger','Elder Zaid praises your wisdom'],
    down: ['The Scholars express clear reservations...','Your legitimacy is now in question','The Scholars hesitate in their support...'],
  },
};

// â”€â”€ YEAR DISPLAY EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const YEAR_NAMES_EN = ['','First Year','Second Year','Third Year','Fourth Year','Fifth Year','Sixth Year','Seventh Year','Eighth Year','Ninth Year','Tenth Year','Eleventh Year','Twelfth Year','Thirteenth Year','Fourteenth Year','Fifteenth Year'];

// â”€â”€ CHRONICLE MAP EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CHRONICLE_EN = {
  'ÙØ±Ø¶ Ø¶Ø±ÙŠØ¨Ø© Ø·Ø§Ø±Ø¦Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡': 'Imposed emergency taxes on the nobles',
  'Ø·Ù„Ø¨ ØªØ¶Ø­ÙŠØ© Ù…Ù† Ø§Ù„Ø¬ÙŠØ´ Ø¨ÙˆØ¹Ø¯ Ø¨Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ©': 'Asked the army to sacrifice bonuses for a future promise',
  'Ø§Ø³ØªØ¹Ø§Ø± Ù…Ù† Ø®Ø²ÙŠÙ†Ø© Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù…ØªÙŠØ§Ø²Ø§Øª': "Borrowed from the Scholars' treasury in exchange for privileges",
  'ÙØªØ­ Ø§Ù„Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù„Ù„Ø´Ø¹Ø¨': 'Opened the royal grain stores for the people',
  'Ø£Ù…Ø± Ø§Ù„Ø¬ÙŠØ´ Ø¨Ø­ÙØ± Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙŠ': 'Ordered the army to dig irrigation canals',
  'Ø´Ø±Ø§Ø¡ Ø§Ù„Ø­Ø¨ÙˆØ¨ Ù…Ù† Ø§Ù„Ø´Ù…Ø§Ù„ Ø¨Ø§Ù„Ø®Ø²ÙŠÙ†Ø©': 'Bought grain from the North with the treasury',
  'Ø£Ø®Ù…Ø¯ ØªÙ…Ø±Ø¯ Ø§Ù„Ø£Ù…ÙŠØ± Ø¥ÙŠÙØ§Ù† Ø¨Ø§Ù„Ù‚ÙˆØ©': "Crushed Prince Ivan's rebellion by force",
  'ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø§Ù„Ø£Ù…ÙŠØ± ÙˆÙ…Ù†Ø­Ù‡ Ù…Ù†ØµØ¨Ø§Ù‹': 'Negotiated with the Prince and granted him a position',
  'Ø§ØªÙ‡Ù… Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ù„Ù†Ø§Ù‹ ÙˆØ§Ù†ØªØ¸Ø± Ø§Ù„Ø¯Ø¹Ù…': 'Publicly accused the Prince and awaited faction support',
  'ØµØ§Ø¯Ù‚ Ø¹Ù„Ù‰ Ø®Ø·Ø© Ø§Ù„Ø­Ø±Ø¨ ÙÙŠ Ù…Ø¬Ù„Ø³ Ø§Ù„ÙˆØ²Ø±Ø§Ø¡': 'Endorsed the war plan in the war council',
  'Ø£Ø±Ø³Ù„ Ù…Ø¨Ø¹ÙˆØ«Ø§Ù‹ Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ§Ù‹ Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù†ÙˆØ§ÙŠØ§ Ø§Ù„Ø«Ù†Ø¯Ø§Ø±': "Sent a diplomatic envoy to probe Thandar's intentions",
  'Ø§Ø´ØªØ±Ù‰ ÙˆÙ‚ØªØ§Ù‹ Ø¨Ø§Ù„Ø°Ù‡Ø¨ Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¬ÙŠØ´': 'Bought time with gold to prepare the army',
  'Ù‚Ø§Ø¯ Ø§Ù„Ø¬ÙŠØ´ Ø´Ø®ØµÙŠØ§Ù‹ ÙÙŠ Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø«Ù†Ø¯Ø§Ø±': 'Led the army personally in the Battle of Thandar',
  'ØªÙ†Ø§Ø²Ù„ Ø¹Ù† Ø£Ø±Ø§Ø¶Ù Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø±Ø¨': 'Ceded territories to stop the war',
  'Ø­Ø±Ù‚ Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙƒÙ…ØµÙŠØ¯Ø© Ù„Ù„ØºØ²Ø§Ø©': 'Burned the border as a trap for the invaders',
  'Ø¹Ø²Ù„ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØµØ§Ø¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„': 'Quarantined infected cities completely',
  'ØµØ±Ù Ø§Ù„Ø®Ø²ÙŠÙ†Ø© ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù…Ø±Ø¶Ù‰': 'Spent the entire treasury to treat the sick',
  'Ø£ÙˆÙƒÙ„ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ¨Ø§Ø¡ Ù…Ù‚Ø§Ø¨Ù„ Ù…Ù†Ø­': 'Delegated the plague crisis to the Scholars',
  'Ø¹Ù‚Ø¯ ØµÙÙ‚Ø© Ù…Ø¹ Ø¬Ø§Ø¨Ø± Ø§Ù„Ø«Ø±ÙŠ Ù…Ù‚Ø§Ø¨Ù„ Ù‚Ø±Ø¶ ÙˆØ§Ù…ØªÙŠØ§Ø²Ø§Øª': 'Struck a deal with Jasper in exchange for a loan and monopolies',
  'ÙØ±Ø¶ Ø¶Ø±ÙŠØ¨Ø© Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø«Ø±ÙŠØ§Ø¡ Ù„Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø®Ø²ÙŠÙ†Ø©': 'Imposed an extraordinary tax on the wealthy to save the treasury',
  'Ø¨Ø§Ø¹ Ø£Ø±Ø§Ø¶ÙŠ Ù…Ù„ÙƒÙŠØ© Ù„Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø®Ø²ÙŠÙ†Ø©': 'Sold royal lands to save the treasury',
  'Ø­Ø§ÙƒÙ… Ù…Ø±ÙˆØ§Ù† Ø¹Ù„Ù†Ø§Ù‹ Ø£Ù…Ø§Ù… Ø§Ù„Ø´Ø¹Ø¨ ÙˆØ§Ù„ÙØµØ§Ø¦Ù„': 'Tried Marwan publicly before the people and factions',
  'Ø£Ø¨Ø¹Ø¯ Ù…Ø±ÙˆØ§Ù† ÙÙŠ ØµÙ…Øª Ø¨Ø¹ÙŠØ¯Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø£Ø¶ÙˆØ§Ø¡': 'Exiled Marwan silently, away from the spotlight',
  'Ù…Ù†Ø­ Ù…Ø±ÙˆØ§Ù† ÙØ±ØµØ© Ø§Ù„Ø§Ø¹ØªØ±Ø§Ù ÙˆØ§Ù„Ø±Ø­Ù…Ø©': 'Granted Marwan a chance to confess and showed mercy',
  'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ù… ÙƒØ´Ù: Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø£Ø® Ø­Ù‚ÙŠÙ‚ÙŠ': 'Blood test revealed: the claimant is a true brother',
  'ÙØ¶Ø­ Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø§Ù„ÙƒØ§Ø°Ø¨ Ø£Ù…Ø§Ù… Ø§Ù„Ø¬Ù…ÙŠØ¹': 'Blood test exposed the false claimant before all',
  'Ø³Ø¬Ù† Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø¯ÙˆÙ† Ù…Ø­Ø§ÙƒÙ…Ø© Ø¹Ù„Ù†ÙŠØ©': 'Imprisoned the claimant without public trial',
  'Ø§Ø¹ØªØ±Ù Ø¨Ø§Ù„Ù…Ø¯Ù‘Ø¹ÙŠ Ø£Ø®Ø§Ù‹ ÙˆÙ…Ù†Ø­Ù‡ Ù„Ù‚Ø¨Ø§Ù‹ Ø´Ø±ÙÙŠØ§Ù‹': 'Acknowledged the claimant as brother with an honorary title',
  'ØªØ²ÙˆÙ‘Ø¬ Ø§Ø¨Ù†Ø© Ø§Ù„Ø¬Ù†Ø±Ø§Ù„ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ': 'Married the daughter of the Northern General',
  'ØªØ²ÙˆÙ‘Ø¬ Ø£Ù…ÙŠØ±Ø© Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡ Ù…Ù† Ø§Ù„Ø´Ø±Ù‚': 'Married the noble princess from the East',
  'ØªØ²ÙˆÙ‘Ø¬ Ø§Ø¨Ù†Ø© ÙƒØ¨ÙŠØ± Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡': 'Married the granddaughter of the Head Scholar',
  'Ø£ØµØ¯Ø± Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨': 'Issued the Charter of Rights to protect the people',
  'Ø£Ø³Ù‘Ø³ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ Ù„Ø£Ø¨Ù†Ø§Ø¡ Ø£Ø±ÙŠÙ‡Ø§Ù†': 'Founded the Grand University for all of Arihan',
  'Ø£Ø¹Ù„Ù† Ø£Ø±ÙŠÙ‡Ø§Ù† Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© ÙˆØ¨Ø¯Ø£ Ø§Ù„ØªÙˆØ³Ø¹': 'Declared Arihan an empire and began expansion',
  '[NG+] Ø¹Ø±Ù Ø­Ù‚ÙŠÙ‚Ø© Ù„ÙŠÙ„Ù‰ ÙˆÙØªØ­ Ù…Ø¹Ù‡Ø§ ØªØ­Ø§Ù„ÙØ§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹': '[NG+] Learned Leyla\'s truth and forged a deep alliance',
  '[NG+] Ø·Ù„Ø¨ Ù…Ù† Ù„ÙŠÙ„Ù‰ ÙˆØ«ÙŠÙ‚Ø© Ø±Ø³Ù…ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØµØ¯ÙŠÙ‚': '[NG+] Requested official documentation from Leyla',
  '[NG+] Ø±ÙØ¶ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ÙŠÙ„Ù‰ ÙˆØ£ØºÙ„Ù‚ Ø§Ù„Ø¨Ø§Ø¨': '[NG+] Refused to hear Leyla and closed the door',
  '[NG+] ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¬Ø§Ø³ÙˆØ³ Ø¨Ø­Ù†ÙƒØ©': '[NG+] Handled the spy with cunning',
  '[NG+] Ø£Ø­Ø§Ù„ Ø§Ù„Ø¬Ø§Ø³ÙˆØ³ Ù„Ù„Ù…Ø­Ø§ÙƒÙ…Ø© Ø§Ù„Ø¹Ù„Ù†ÙŠØ©': '[NG+] Sent the spy to public trial',
};

// â”€â”€ ENDINGS EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ENDINGS_EN = {
  legend: {
    title: 'The Legendary Ruler', rank: 'First Rank: Greatest Rulers of Arihan',
    story: () => {
      const charter = G.tags.has('charter_issued') ? ' Issued the Charter of Rights that protected the people for centuries.' : '';
      const uni = G.tags.has('university_built') ? ' Built the Grand University that lit minds and produced physicians and scholars.' : '';
      const battle = G.tags.has('led_battle') ? gT(' Descended from the throne and fought shoulder to shoulder with the soldiers in the Battle of Thandar.','') : '';
      const sac = G.tags.has('king_sacrifice') ? ' And when the treasury ran dry, sold the royal lands to feed the people.' : '';
      const leyla = G.tags.has('leyla_trusted') ? ' And Leyla was the mirror that never lied.' : '';
      return `<strong>${G.name}</strong> ruled with wisdom rarely matched in Arihan's history.${battle}${sac}${charter}${uni}${leyla} The people loved them, the army trusted them, the nobles respected them, and the Scholars yielded to their vision. When they drew their last breath, the rich and the poor, the frontline soldier and the village elder all wept together. Their name was etched in gold above the capital's gate and is read to this day.`;
    },
  },
  sacrifice_legend: {
    title: 'The Ruler Who Gave Everything', rank: 'Symbol of Sacrifice in Arihan',
    story: () => {
      const uni = G.tags.has('university_built') ? ' Then built the university on what remained of the treasury.' : '';
      return `<strong>${G.name}</strong> was not the wealthiest nor the mightiest, but was the most giving. Sold the royal lands to feed the hungry and opened the treasury entirely to heal the sick.${uni} When they died poor by a king's standards, the people carried their coffin with untiring hands â€” for they were the heaviest ruler on the heart of history and the lightest on the shoulders of the people.`;
    },
  },
  people_king: {
    title: 'Beloved of the People', rank: 'The Humane Ruler',
    story: () => {
      const healed = G.tags.has('healed_all') ? ' Spent the treasury on the sick without hesitation.' : '';
      const stores = G.tags.has('opened_stores') ? ' And opened the grain stores when the poor went hungry.' : '';
      const poet = G.tags.has('poet_protected') ? ' And protected the poet who said what rulers fear.' : '';
      return `<strong>${G.name}</strong> was not the strongest or wealthiest of rulers, but was the most merciful.${healed}${stores}${poet} Chose the people over power, and justice over prestige. When they died, the poor carried the coffin before the nobles â€” and children who never knew them placed flowers on the grave because their mothers told them the story.`;
    },
  },
  warrior_king: {
    title: 'The Warrior Ruler', rank: 'Vanquisher of Thandar',
    story: () => {
      const emp = G.tags.has('empire_declared') ? ' Then declared the Empire and extended the banner beyond the mountains.' : '';
      const dip = G.tags.has('sent_envoy') ? ' But knew when to send the envoy before the sword.' : '';
      return `<strong>${G.name}</strong> marched at the head of the army and the people cheered.${emp}${dip} History preserves their victories â€” and forgets what was destroyed behind them. The soldiers who fought with them tell their grandchildren: "I saw the ruler drinking from the same river as us."`;
    },
  },
  diplomat_king: {
    title: 'The Ruler Who Never Drew a Sword', rank: 'Master of Word and Understanding',
    story: () => {
      const bro = G.tags.has('adopted_brother') ? ' And the claimant who once could have been the greatest enemy became the most loyal advisor.' : '';
      return `<strong>${G.name}</strong>'s advisors always said: "War is faster." And the reply was always: "War builds no city." Negotiated with rebels, wrote to enemies, sent envoys before soldiers.${bro} Arihan under this reign was never made to widow its women â€” and that alone is enough to be written into memory.`;
    },
  },
  church_puppet: {
    title: 'A Ruler in the Shadow of the Scholars', rank: 'A History Written by Others',
    story: () => {
      const debt = G.tags.has('church_debt') ? ' From the very first day, when they borrowed from the Scholars\' treasury, they had their path drawn for them.' : '';
      return `<strong>${G.name}</strong> ruled, but Elder Zaid was the one who truly made the decisions.${debt} The Scholars won, and the ruler became their polished facade. When they died, their successor also came from the Scholars. History remembers the Elder's name more than the ruler's.`;
    },
  },
  noble_puppet: {
    title: "The Nobles' Ruler", rank: 'The Empty Golden Throne',
    story: () => {
      const j = G.tags.has('yusuf_deal') ? ' Jasper was the most frequent face in the palace.' : '';
      return `<strong>${G.name}</strong> ruled from a gold-plated throne, but the gold was not theirs.${j} The nobles gave them the title and kept the power. The people outside call for a ruler who sees them. History records the reign as: "The wealthy ruled, and the poor paid the price."`;
    },
  },
  brother_king: {
    title: 'Two Rulers, One Soul', rank: 'The One Who Ended the Hatred of Blood',
    story: () => {
      const r = G.tags.has('solomon_secret') ? " Learned the truth from Marwan's confession â€” and still opened their arms." : '';
      return `<strong>${G.name}</strong> decided that mercy is stronger than fear.${r} The brother who could have been the most dangerous enemy became the closest ally. Arihan knew for the first time a ruler who consulted their brother before their council. The people said: "This is a ruler who does not fear the truth."`;
    },
  },
  leyla_ending: {
    title: () => gT('In the Shadow of the Wise', 'Two Sages, One Throne'),
    rank: () => 'The Ruler Who Knew When to Listen',
    story: () => {
      const ng = G.tags.has('ng_leyla_secret') ? ' And Leyla carried a deeper secret: she is the daughter of Nasr, the witness to everything.' : '';
      return gT(
        `<strong>Leyla</strong> knew the end of every story before it began.${ng} And <strong>${G.name}</strong> knew when to be silent and when to speak. Together they governed Arihan with a calm it had never known. The great decisions were made in quiet rooms, far from the noise. History wrote both their names together â€” the ruler and the sage â€” in a single chapter.`,
        `<strong>Leyla</strong> knew the end of every story before it began.${ng} And <strong>${G.name}</strong> knew when to be silent and when to speak. Two sages, one throne, and Arihan had never seen the like. History wrote both their names together â€” in a chapter that cannot be closed.`
      );
    },
  },
  empire: {
    title: () => 'Founder of the Empire', rank: 'The Greatest Conqueror',
    story: () => {
      const ch = G.tags.has('charter_issued') ? ' But in their final days, issued the Charter â€” perhaps as atonement for the bloodshed.' : '';
      return `<strong>${G.name}</strong> was not content with Arihan. The banner rose in lands their father never dreamed of. Thandar retreated. Borders expanded. Villages were built on the rubble of what was torn down.${ch} History remembers them as a great conqueror â€” and other poets remember them in other words.`;
    },
  },
  collapse_betrayed: {
    title: 'A Kingdom Without Memory', rank: 'Fell in the Age of Scandals',
    story: () => `The Marwan trial was the spark that <strong>${G.name}</strong> lit with their own hands. The scandal dispersed what little trust remained. The nobles allied, the people tired, and the army sought a new leader. The throne fell on a rainy night, and the imprisoned poet wrote: "The ruler themselves lit the fire that consumed them."`,
  },
  collapse: {
    title: 'The Fall of Arihan', rank: 'Last of the Royal Line',
    story: () => {
      const n = G.tags.has('scorched_earth') ? ' The scorched lands never recovered.' : G.tags.has('army_debt') ? ' The army whose promise was broken was the last to surrender the fortress.' : '';
      return `The name <strong>${G.name}</strong> is written only alongside one word: catastrophe.${n} The people rose, the army fractured, and the kingdom cracked like old clay. Arihanâ€¦ was no longer the Arihan that was inherited.`;
    },
  },
  forgotten: {
    title: () => 'The Forgotten Ruler',
    rank: () => 'An Ordinary Ruler in Extraordinary Times',
    story: () => {
      const c = G.choices.length;
      return `<strong>${G.name}</strong> ruled for years. ${c >= 8 ? 'Made many decisions â€” but none are remembered.' : 'Ruled in a silence closer to hesitation.'} Neither brilliant nor ruinous. Wavering decisions, modest successes and acceptable failures. History passed over them as wind passes over sand â€” moving without changing.`;
    },
  },
};

// â”€â”€ UI STRINGS EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const UI_EN = {
  splash_sub: 'Kingdom of Decision & Destiny',
  splash_hint: 'The kingdom awaits youâ€¦',
  pers_label: 'âœ¦ Your Ruling Nature âœ¦',
  pers_sage: 'The Sage', pers_sage_bonus: '+Scholars start',
  pers_warrior: 'The Warrior', pers_warrior_bonus: '+Army start',
  pers_diplomat: 'The Diplomat', pers_diplomat_bonus: '+People start',
  gender_label: 'âœ¦ Who Are You? âœ¦',
  gender_male: 'King', gender_female: 'Queen',
  name_label_m: 'âœ¦ What is your name, O King? âœ¦',
  name_label_f: 'âœ¦ What is your name, O Queen? âœ¦',
  name_placeholder_m: 'Enter your nameâ€¦', name_placeholder_f: 'Enter your nameâ€¦',
  start_btn_m: 'âš”ï¸ Claim the Throne âš”ï¸', start_btn_f: 'âš”ï¸ Claim the Throne âš”ï¸',
  f_people: 'People', f_army: 'Army', f_nobles: 'Nobles', f_church: 'Scholars',
  f_people_desc: 'Your true power', f_army_desc: 'Guardians of the throne',
  f_nobles_desc: 'Owners of wealth', f_church_desc: 'Counsel & wisdom',
  map_btn: 'ğŸ—ºï¸ Map', map_title: 'ğŸ—ºï¸ Map of the Kingdom of Arihan', map_close: 'âœ• Close Map',
  choices_header_m: 'â€” Choose your path, O King â€”',
  choices_header_f: 'â€” Choose your path, O Queen â€”',
  event_tag: 'â€” Urgent Event â€”',
  save_text: 'ğŸ’¾ Auto-saved',
  ach_title: 'New Achievement',
  score_label: 'Governance Score',
  chronicle_title: "ğŸ“œ The Ruler's Decision Chronicle",
  standings_title: 'âš–ï¸ Faction Balance at End of Reign',
  replay_btn: 'ğŸ”„ Start a New Path',
  share_btn: 'ğŸ“¤ Share Your Ending',
  years_label: 'Years of Reign',
  pers_sum_title: 'âœ¦ Your Ruling Nature âœ¦',
  ng_badge: 'âœ¦ Hard Governance Mode â€” New Game+ âœ¦',
  ng_scene_tag: 'âœ¦ Exclusive Scene â€” New Game+',
  ng_btn_text: 'âœ¦ New Game+ â€” Hard Mode',
  king_title_m: 'King', king_title_f: 'Queen',
  chapter_prefix: 'Chapter ',
  newspaper_name: 'THE ARIHAN HERALD',
};

const UI_AR = {
  splash_sub: 'Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…ØµÙŠØ±',
  splash_hint: 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© ØªÙ†ØªØ¸Ø±Ùƒ...',
  pers_label: 'âœ¦ Ø·Ø¨ÙŠØ¹Ø© Ø­ÙƒÙ…Ùƒ âœ¦',
  pers_sage: 'Ø§Ù„Ø­ÙƒÙŠÙ…', pers_sage_bonus: '+Ø­ÙƒÙ…Ø§Ø¡ Ø¨Ø¯Ø§ÙŠØ©',
  pers_warrior: 'Ø§Ù„Ù…Ø­Ø§Ø±Ø¨', pers_warrior_bonus: '+Ø¬ÙŠØ´ Ø¨Ø¯Ø§ÙŠØ©',
  pers_diplomat: 'Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠ', pers_diplomat_bonus: '+Ø´Ø¹Ø¨ Ø¨Ø¯Ø§ÙŠØ©',
  gender_label: 'âœ¦ Ù…Ù† ØªÙƒÙˆÙ†ØŸ âœ¦',
  gender_male: 'Ù…Ù„Ùƒ', gender_female: 'Ù…Ù„ÙƒØ©',
  name_label_m: 'âœ¦ Ù…Ø§ Ø§Ø³Ù…Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØŸ âœ¦',
  name_label_f: 'âœ¦ Ù…Ø§ Ø§Ø³Ù…ÙƒÙ Ø£ÙŠØªÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØ©ØŸ âœ¦',
  name_placeholder_m: 'Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ...', name_placeholder_f: 'Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…ÙƒÙ...',
  start_btn_m: 'âš”ï¸ ØªØ³Ù„Ù‘Ù… Ø§Ù„Ø¹Ø±Ø´ âš”ï¸', start_btn_f: 'âš”ï¸ ØªØ³Ù„Ù‘Ù…ÙŠ Ø§Ù„Ø¹Ø±Ø´ âš”ï¸',
  f_people: 'Ø§Ù„Ø´Ø¹Ø¨', f_army: 'Ø§Ù„Ø¬ÙŠØ´', f_nobles: 'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡', f_church: 'Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡',
  f_people_desc: 'Ù‚ÙˆØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©', f_army_desc: 'Ø­Ø±Ø§Ø³ Ø§Ù„Ø¹Ø±Ø´',
  f_nobles_desc: 'Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø«Ø±ÙˆØ©', f_church_desc: 'Ù…Ø´ÙˆØ±Ø© ÙˆØ±Ø£ÙŠ',
  map_btn: 'ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©', map_title: 'ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ù…Ù…Ù„ÙƒØ© Ø£Ø±ÙŠÙ‡Ø§Ù†', map_close: 'âœ• Ø£ØºÙ„Ù‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø©',
  choices_header_m: 'â€” Ø§Ø®ØªØ± Ù…Ø³Ø§Ø±Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„Ùƒ â€”',
  choices_header_f: 'â€” Ø§Ø®ØªØ§Ø±ÙŠ Ù…Ø³Ø§Ø±Ùƒ Ø£ÙŠØªÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØ© â€”',
  event_tag: 'â€” Ø­Ø¯Ø« Ø·Ø§Ø±Ø¦ â€”',
  save_text: 'ğŸ’¾ ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹',
  ach_title: 'Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯',
  score_label: 'Ù†Ù‚Ø§Ø· Ø§Ù„Ø­ÙƒÙ…',
  chronicle_title: 'ğŸ“œ Ø³Ø¬Ù„ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„Ùƒ',
  standings_title: 'âš–ï¸ Ù…ÙŠØ²Ø§Ù† Ø§Ù„ÙØµØ§Ø¦Ù„ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­ÙƒÙ…',
  replay_btn: 'ğŸ”„ Ø§Ø¨Ø¯Ø£ Ù…Ø³Ø§Ø±Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹',
  share_btn: 'ğŸ“¤ Ø´Ø§Ø±Ùƒ Ù†Ù‡Ø§ÙŠØªÙƒ',
  years_label: 'Ø³Ù†ÙˆØ§Øª Ù…Ù† Ø§Ù„Ø­ÙƒÙ…',
  pers_sum_title: 'âœ¦ Ø·Ø¨ÙŠØ¹Ø© Ø­ÙƒÙ…Ùƒ âœ¦',
  ng_badge: 'âœ¦ ÙˆØ¶Ø¹ Ø§Ù„Ø­ÙƒÙ… Ø§Ù„ØµØ¹Ø¨ â€” New Game+ âœ¦',
  ng_scene_tag: 'âœ¦ Ù…Ø´Ù‡Ø¯ Ø­ØµØ±ÙŠ â€” New Game+',
  ng_btn_text: 'âœ¦ New Game+ â€” Ø§Ù„Ø­ÙƒÙ… Ø§Ù„ØµØ¹Ø¨',
  king_title_m: 'Ø§Ù„Ù…Ù„Ùƒ', king_title_f: 'Ø§Ù„Ù…Ù„ÙƒØ©',
  chapter_prefix: 'Ø§Ù„ÙØµÙ„ ',
  newspaper_name: 'Ø¬Ø±ÙŠØ¯Ø© Ø£Ø±ÙŠÙ‡Ø§Ù† Ø§Ù„Ø±Ø³Ù…ÙŠØ©',
};

function ui(key) {
  const map = currentLang === 'en' ? UI_EN : UI_AR;
  return map[key] || (UI_AR[key] || key);
}

// â”€â”€ ACHIEVEMENT NAMES EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ACHIEVEMENTS_EN = {
  bold_start: () => 'Bold Beginning',
  king_of_warriors: () => gT('Warrior King','Warrior Queen'),
  heart_of_gold: () => 'Heart of Gold',
  merciful_king: () => gT('The Merciful Ruler','The Merciful Ruler'),
  sacrifice_king: () => gT('The Ruler Who Gave All','The Ruler Who Gave All'),
  master_diplomat: () => gT('Master of Diplomacy','Mistress of Diplomacy'),
  truth_seeker: () => 'Seeker of Truth',
  iron_will: () => 'Iron Will',
};

// â”€â”€ PERSONALITIES EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PERSONALITIES_EN = {
  sage:     { name:'The Sage',     desc:'You prefer wisdom and knowledge over power. The Scholars trust you from the start.' },
  warrior:  { name:'The Warrior',  desc:'Born to fight. The army sees one of their own in you.' },
  diplomat: { name:'The Diplomat', desc:'Words are your weapon. The people see a fair ruler, not just a king.' },
};

// â”€â”€ SCORE RANK EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getScoreRankEN(score) {
  if (score >= 90) return 'Legendary ğŸŒŸ';
  if (score >= 75) return 'Excellent â­';
  if (score >= 58) return 'Good ğŸ…';
  if (score >= 42) return 'Average ğŸ“œ';
  return 'Weak ğŸ’€';
}

// â”€â”€ PATCH REACTION DISPLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _applyOrig_bi = window.apply;
window.apply = function(delta) {
  const reactions = [];
  const pool = currentLang === 'en' ? REACTIONS_EN : REACTIONS;
  ['people','army','nobles','church'].forEach(f => {
    if (delta[f] !== undefined && delta[f] !== 0) {
      const msgs = pool[f]?.[delta[f] > 0 ? 'up' : 'down'];
      if (msgs) reactions.push(msgs[Math.floor(Math.random() * msgs.length)]);
    }
  });
  _applyOrig_bi(delta);
  if (reactions.length > 0) pendingReaction = reactions[0];
};

// â”€â”€ PATCH TRANSITION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _transOrig_bi = window.transition || transition;
const _trans_patched = function(emoji, text, callback) {
  const displayText = currentLang === 'en' ? (typeof text === 'function' ? text() : (TRANS_EN[text] || text)) : (typeof text === 'function' ? text() : text);
  _transOrig_bi(emoji, displayText, callback);
};
window.transition = _trans_patched;

// â”€â”€ PATCH SHOWSCENE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _showSceneOrig_bi = window.showScene;
window.showScene = function(sc) {
  if (currentLang === 'en') {
    // Inject EN scene data
    const scId = Object.keys(SCENES).find(k => SCENES[k] === sc);
    const enSc = scId ? SCENES_EN[scId] : null;
    if (enSc) {
      const patchedSc = Object.assign({}, sc, {
        chapter: enSc.chapter,
        title: enSc.title,
        text: enSc.text,
        memory: enSc.memory,
        choices: sc.choices.map((c, i) => {
          const enText = enSc.choices_text ? enSc.choices_text[i] : null;
          return Object.assign({}, c, {
            text: enText || c.text,
            sub: c.sub.map(s => Object.assign({}, s, { label: translateSub(s.label) })),
          });
        }),
      });
      _showSceneOrig_bi(patchedSc);
      // Localize character names in body
      const body = document.getElementById('sceneBody');
      if (body) body.innerHTML = localizeNames(body.innerHTML);
      // Fix chapter indicator
      const chInd = document.getElementById('chapterIndicator');
      if (chInd) chInd.textContent = 'Chapter ' + (G.turn || 1);
      // Fix year display
      const yrEl = document.getElementById('yearDisplay');
      if (yrEl) {
        const yr = G.currentYear || G.turn;
        yrEl.textContent = (YEAR_NAMES_EN[yr] || `Year ${yr}`) + ' of Reign';
      }
      // Fix choices header
      const chHeader = document.getElementById('choicesHeader');
      if (chHeader) chHeader.textContent = ui(G.gender === 'female' ? 'choices_header_f' : 'choices_header_m');
      return;
    }
    // Fallback: just localize names
    _showSceneOrig_bi(sc);
    const body = document.getElementById('sceneBody');
    if (body) body.innerHTML = localizeNames(body.innerHTML);
  } else {
    _showSceneOrig_bi(sc);
  }
};

// â”€â”€ PATCH RANDOM EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _triggerEvOrig_bi = window.triggerRandomEvent || triggerRandomEvent;
window.triggerRandomEvent = function(callback) {
  if (currentLang === 'ar') { _triggerEvOrig_bi(callback); return; }
  const unseen = RANDOM_EVENTS.filter(e => !G.seenEvents.has(e.id));
  if (unseen.length === 0) { callback(); return; }
  const totalWeight = unseen.reduce((s,e) => s+e.weight, 0);
  let rand = Math.random() * totalWeight;
  let chosen = unseen[0];
  for (const e of unseen) { rand -= e.weight; if (rand <= 0) { chosen = e; break; } }
  G.seenEvents.add(chosen.id);
  const en = RANDOM_EVENTS_EN[chosen.id];
  const modal = document.createElement('div');
  modal.className = 'event-modal';
  modal.innerHTML = `
    <div class="event-inner">
      <span class="event-emoji">${chosen.emoji}</span>
      <div class="event-tag">â€” Urgent Event â€”</div>
      <div class="event-title">${en ? en.title : chosen.title}</div>
      <div class="event-text">${en ? en.text : chosen.text}</div>
      <div class="event-choices" id="evChoices"></div>
    </div>
  `;
  document.body.appendChild(modal);
  const choicesEl = modal.querySelector('#evChoices');
  chosen.choices.forEach((c, idx) => {
    const btn = document.createElement('button');
    btn.className = 'event-choice-btn';
    const enText = en?.choices?.[idx] || c.text;
    btn.innerHTML = `<span style="font-size:22px">${c.emoji}</span><span>${enText}</span>`;
    btn.onclick = () => {
      apply(c.apply);
      if (c.tag) G.tags.add(c.tag);
      modal.style.opacity = '0';
      modal.style.transition = 'opacity 0.35s';
      setTimeout(() => { modal.remove(); callback(); }, 380);
    };
    choicesEl.appendChild(btn);
  });
};

// â”€â”€ PATCH SHOWENDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _showEndingOrig_bi = window.showEnding;
window.showEnding = function(e) {
  if (currentLang === 'en') {
    const enE = ENDINGS_EN[e.id];
    if (enE) {
      const patchedE = Object.assign({}, e, {
        title: typeof enE.title === 'function' ? enE.title() : (enE.title || e.title),
        rank:  typeof enE.rank  === 'function' ? enE.rank()  : (enE.rank  || e.rank),
        story: enE.story,
      });
      _showEndingOrig_bi(patchedE);
    } else {
      _showEndingOrig_bi(e);
    }
    // EN-specific ending UI patches
    setTimeout(() => {
      const scoreLabel = document.querySelector('.score-label');
      if (scoreLabel) scoreLabel.textContent = ui('score_label');
      const chronTitle = document.querySelector('.chronicle-title');
      if (chronTitle) chronTitle.textContent = ui('chronicle_title');
      const standTitle = document.querySelector('.standings-title');
      if (standTitle) standTitle.textContent = ui('standings_title');
      // Chronicle in EN
      const ch = document.getElementById('chronicle');
      if (ch) {
        ch.innerHTML = '';
        G.choices.forEach((c, i) => {
          const entry = document.createElement('div');
          entry.className = 'chronicle-entry';
          entry.style.animationDelay = (i * 0.08) + 's';
          const enText = CHRONICLE_EN[c.text] || c.text;
          entry.innerHTML = `<span class="chronicle-icon">${c.icon}</span><span>Chapter ${i+1}: ${enText}</span>`;
          ch.appendChild(entry);
        });
      }
      // Score rank
      const srEl = document.getElementById('scoreRankText');
      if (srEl) srEl.textContent = getScoreRankEN(parseInt(document.getElementById('scoreValue').textContent));
      // Faction names
      const fNames = {people:'People',army:'Army',nobles:'Nobles',church:'Scholars'};
      document.querySelectorAll('.standing-name').forEach((el, i) => {
        el.textContent = Object.values(fNames)[i] || el.textContent;
      });
      // Personality summary
      const pers = PERSONALITIES_EN[G.personality] || PERSONALITIES[G.personality];
      const pEl = document.getElementById('personalitySummary');
      if (pEl) pEl.querySelector('.pers-sum-title').textContent = ui('pers_sum_title');
      if (pEl && pers.name) pEl.querySelector('.pers-sum-name').textContent = pers.name;
      if (pEl && pers.desc) pEl.querySelector('.pers-sum-desc').textContent = pers.desc;
      // Replay buttons
      const replayBtns = document.querySelectorAll('.replay-section .btn-gold');
      replayBtns.forEach(btn => { if (btn.id !== 'ngBtn') btn.textContent = ui('replay_btn'); });
      document.querySelectorAll('.replay-section .btn-outline').forEach(btn => btn.textContent = ui('share_btn'));
      // Years label
      const yLabel = document.querySelector('.ending-years-label');
      if (yLabel) yLabel.textContent = ui('years_label');
      // NG+ button text
      const ngBtn = document.getElementById('ngBtn');
      if (ngBtn) ngBtn.innerHTML = ui('ng_btn_text');
    }, 100);
    return;
  }
  _showEndingOrig_bi(e);
};

// â”€â”€ PATCH ACHIEVEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _checkAchOrig_bi = window.checkAchievement || checkAchievement;
window.checkAchievement = function(id, icon, name) {
  if (G.achievements.includes(id)) return;
  G.achievements.push(id);
  const def = ACHIEVEMENT_DEFS[id];
  let displayName;
  if (currentLang === 'en' && ACHIEVEMENTS_EN[id]) {
    displayName = ACHIEVEMENTS_EN[id]();
  } else {
    displayName = def ? (typeof def.name === 'function' ? def.name() : def.name) : name;
  }
  showAchievement(def ? def.icon : icon, displayName);
  const achTitleEl = document.querySelector('.ach-title');
  if (achTitleEl) achTitleEl.textContent = ui('ach_title');
};

// â”€â”€ PATCH YEAR DISPLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _updateYearOrig_bi = window.updateYearDisplay || updateYearDisplay;
window.updateYearDisplay = function(sceneId) {
  _updateYearOrig_bi(sceneId);
  if (currentLang === 'en') {
    const yr = CHAPTER_YEARS[sceneId] || G.turn;
    const el = document.getElementById('yearDisplay');
    if (el) el.textContent = (YEAR_NAMES_EN[yr] || `Year ${yr}`) + ' of Reign';
  }
};

// â”€â”€ APPLY LANG UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// (old applyLangUI/setLang replaced by new versions below)

// â”€â”€ NEWSPAPER EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NEWSPAPERS_EN = {
  debt: {
    headline: 'A New Ruler on the Throne â€” And the First Decision Stirs Controversy',
    sub: 'Palace sources: A bold move to resolve the father\'s debts redraws the map of power',
  },
  drought: {
    headline: 'Arihan Faces the Drought â€” The Ruler\'s Decision Divides Opinion',
    sub: 'Between gratitude and discontent: reactions to the decision on the food crisis',
  },
  rebellion: {
    headline: 'The Eastern Rebellionâ€¦ The Ruler Chooses Their Response',
    sub: 'Analysts ask: will the ruler\'s decision strengthen the centre or deepen the rift?',
  },
  invasion: {
    headline: 'The Northern Invasion Reveals the Mettle of Rulers',
    sub: 'Arihan emerged from the trial of war â€” but the price is still being counted',
  },
  plague: {
    headline: 'The Plague Retreatsâ€¦ But the Question of Who Paid the Price Lingers',
    sub: 'Death tolls fall, yet the economic and social wounds remain open',
  },
  betrayal: {
    headline: 'The Marwan Affair â€” The Palace Will Never Be the Same',
    sub: 'How did the ruler handle the betrayal? A question that will define the nature of this reign forever',
  },
  pretender: {
    headline: 'The Claimant Mystery Is Settled â€” But the Questions Have Not Ended',
    sub: 'The ruler\'s decision in the claimant case painted a clear picture: this ruler governs byâ€¦',
  },
  political_marriage: {
    headline: 'The Palace Wedding â€” An Alliance That Redraws the Political Landscape',
    sub: 'The four factions analyse the consequences: who gains most from this marriage?',
  },
};

// â”€â”€ PATCH NEWSPAPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _origNewspaper = window.showNewspaper;
window.showNewspaper = function(sceneId, callback) {
  if (currentLang === 'ar') { _origNewspaper(sceneId, callback); return; }

  const data = NEWSPAPERS_EN[sceneId];
  if (!data) { _origNewspaper(sceneId, callback); return; }

  const yr = CHAPTER_YEARS[sceneId] || G.currentYear || G.turn;
  const yearLabel = YEAR_NAMES_EN[yr]
    ? YEAR_NAMES_EN[yr] + ' of ' + (G.gender === 'female' ? 'Queen ' : 'King ') + G.name + '\'s Reign'
    : 'Year ' + yr;

  const overlay = document.createElement('div');
  overlay.className = 'newspaper-overlay';
  overlay.style.direction = 'ltr';
  overlay.style.fontFamily = 'Georgia, serif';
  overlay.innerHTML = `
    <div class="newspaper-inner">
      <div class="newspaper-masthead">
        <div class="newspaper-name" style="font-family:'Georgia',serif;letter-spacing:4px">THE ARIHAN HERALD</div>
        <div class="newspaper-date">${yearLabel}</div>
      </div>
      <div class="newspaper-body">
        <div class="newspaper-headline" style="font-family:'Georgia',serif">${data.headline}</div>
        <div class="newspaper-sub">${data.sub}</div>
        <div class="newspaper-byline">The Independent Press of Arihan â€” Since the Kingdom's Founding</div>
      </div>
      <button class="newspaper-btn" id="npClose" style="font-family:'Georgia',serif;letter-spacing:2px">Continue Reading â†’</button>
    </div>
  `;
  document.body.appendChild(overlay);
  overlay.querySelector('#npClose').onclick = () => {
    overlay.style.opacity = '0';
    overlay.style.transition = 'opacity 0.3s';
    setTimeout(() => { overlay.remove(); callback(); }, 300);
  };
};

// â”€â”€ NG+ SCENES EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NG_PLUS_SCENES_EN = {
  ng_spy: {
    chapter: 'âœ¦ New Game+ â€” What You Did Not Know the First Time',
    title: "Your Dead Father's Secret",
    memory: () => 'ğŸ•¯ï¸ NG+ â€” Nasr carries your father\'s secrets',
    text: () => `
      On the first night you sleep as ${gT('a King','a Queen')}, an old man enters â€” one you have never seen before.
      He introduces himself: <span class="char-name">Nasr</span> â€” your father's personal keeper of secrets for thirty years.
      <br><br>
      <span class="whisper">"Your Majesty, your late father entrusted me with one thing: if he died before he could tell you â€” I am the one who tells you."</span>
      <br><br>
      He then places three things before you: <span class="dramatic">a letter sealed with Marwan's seal</span>, a map to a secret chamber in the palace, and one sentence: <span class="whisper">"Your father did not die of natural illness."</span>
      <br><br>
      Nasr waits. His eyes do not lie â€” but they conceal much as well.
    `,
    choices_text: [
      'Open the letter and enter the secret chamber â€” the full truth or nothing',
      'Expel Nasr â€” one who brings news of the dead in the night cannot be trusted',
      'Listen to everything but act not yet â€” time is a weapon',
    ],
    sub: [
      [{ label:'+Scholars +8', type:'up' }, { label:'âˆ’Army âˆ’5 (suspicion spreads)', type:'down' }, { label:"Reveals Marwan's secret early", type:'neutral' }],
      [{ label:'+Army +8 (resolve)', type:'up' }, { label:'You remain in the dark', type:'neutral' }],
      [{ label:'+Scholars +5', type:'up' }, { label:'+People +3', type:'up' }, { label:'A card held in reserve', type:'neutral' }],
    ],
  },
  ng_leyla: {
    chapter: 'âœ¦ New Game+ â€” The Other Face',
    title: 'Leyla â€” Who Is She Really?',
    memory: () => G.tags.has('ng_knows_murder') ? 'ğŸŒ™ NG+ â€” Leyla is Nasr\'s daughter' : 'ğŸŒ™ NG+ â€” Leyla knows your father\'s secret',
    text: () => {
      const knowsMurder = G.tags.has('ng_knows_murder');
      const base = `
        Leyla requests a private audience â€” no guards, no witnesses.
        She sits before you and places on the table something you did not expect:
        <span class="dramatic">a ring bearing your father's family crestâ€¦ believed lost for twenty years.</span>
        <br><br>
        <span class="whisper">"Your Majesty, I am not merely an advisor. My mother was your father's closest handmaiden. And my fatherâ€¦"</span>
        She pauses. Her eyes search your face for something.
        <span class="whisper">"My father is Nasr."</span>
        <br><br>
      `;
      if (knowsMurder) {
        return base + `<span class="good-word">The picture completes itself</span> â€” Leyla knows her father told you. She came to finish what he began.`;
      }
      return base + `She looks at you with calm eyes: <span class="whisper">"I know what you do not know about your father's death. The question is: do you wish to know?"</span>`;
    },
    choices_text: [
      'Hear her fully â€” this meeting was no coincidence',
      "Request an official document â€” words alone are not enough in a palace",
      'Rise and leave â€” the palace has enough secrets',
    ],
    sub: [
      [{ label:'+Scholars +10', type:'up' }, { label:'+People +5', type:'up' }, { label:"Opens Leyla's full storyline", type:'neutral' }],
      [{ label:'+Nobles +5', type:'up' }, { label:'Leyla respects your resolve', type:'neutral' }],
      [{ label:'+Army +8 (resolve)', type:'up' }, { label:'Leyla disappears from the story', type:'down' }],
    ],
  },
};

// â”€â”€ PATCH SHOWSCENE for NG+ EN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _showSceneOrig_ng = window.showScene;
window.showScene = function(sc) {
  if (currentLang === 'en') {
    const ngKey = Object.keys(NG_PLUS_SCENES).find(k => NG_PLUS_SCENES[k] === sc);
    if (ngKey && NG_PLUS_SCENES_EN[ngKey]) {
      const enNg = NG_PLUS_SCENES_EN[ngKey];
      const patchedSc = Object.assign({}, sc, {
        chapter: enNg.chapter,
        title: enNg.title,
        text: enNg.text,
        memory: enNg.memory,
        choices: sc.choices.map((c, i) => Object.assign({}, c, {
          text: enNg.choices_text[i] || c.text,
          sub: enNg.sub[i] || c.sub,
        })),
      });
      // Use the earlier showScene which handles EN localization
      _showSceneOrig_ng(patchedSc);
      setTimeout(() => {
        const body = document.getElementById('sceneBody');
        if (body) body.innerHTML = localizeNames(body.innerHTML);
      }, 50);
      return;
    }
  }
  _showSceneOrig_ng(sc);
};

// â”€â”€ CHRONICLE: add missing entries â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Object.assign(CHRONICLE_EN, {
  '[NG+] Ø§ÙƒØªØ´Ù Ø³Ø± Ù…Ù‚ØªÙ„ Ø£Ø¨ÙŠÙ‡ Ù…Ù† Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ…': '[NG+] Uncovered the secret of his father\'s death from Nasr',
  '[NG+] Ø·Ø±Ø¯ Ù†ØµØ± Ø§Ù„ÙƒØ§ØªÙ… ÙˆØ±ÙØ¶ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©': '[NG+] Expelled Nasr and refused to learn the truth',
  '[NG+] Ø§Ø³ØªÙ…Ø¹ Ù„Ù†ØµØ± ÙˆØ§Ù†ØªØ¸Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨':  '[NG+] Listened to Nasr and waited for the right moment',
  '[NG+] Ø¹Ø±Ù Ø­Ù‚ÙŠÙ‚Ø© Ù„ÙŠÙ„Ù‰ ÙˆÙØªØ­ Ù…Ø¹Ù‡Ø§ ØªØ­Ø§Ù„ÙØ§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹': '[NG+] Learned Leyla\'s truth and forged a deep alliance with her',
  '[NG+] Ø·Ù„Ø¨ Ù…Ù† Ù„ÙŠÙ„Ù‰ ÙˆØ«ÙŠÙ‚Ø© Ø±Ø³Ù…ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØµØ¯ÙŠÙ‚':   '[NG+] Requested official documentation from Leyla before trusting her',
  '[NG+] Ø±ÙØ¶ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ÙŠÙ„Ù‰ ÙˆØ£ØºÙ„Ù‚ Ø§Ù„Ø¨Ø§Ø¨':         '[NG+] Refused to hear Leyla and closed the door',
  '[NG+] ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¬Ø§Ø³ÙˆØ³ Ø¨Ø­Ù†ÙƒØ©':                 '[NG+] Handled the spy with cunning',
  '[NG+] Ø£Ø­Ø§Ù„ Ø§Ù„Ø¬Ø§Ø³ÙˆØ³ Ù„Ù„Ù…Ø­Ø§ÙƒÙ…Ø© Ø§Ù„Ø¹Ù„Ù†ÙŠØ©':          '[NG+] Sent the spy to public trial',
});

// â”€â”€ FULL applyLangUI OVERRIDE (replaces earlier version) â”€â”€â”€â”€â”€
function applyLangUI() {
  const isFemale = (G && G.gender === 'female') || selectedGender === 'female';
  const isEN = currentLang === 'en';

  // Direction & font
  document.documentElement.setAttribute('dir', isEN ? 'ltr' : 'rtl');
  document.documentElement.setAttribute('lang', currentLang);
  document.body.style.fontFamily = isEN ? "'Georgia', serif" : '';

  // â”€â”€ Splash â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const splashTitle = document.querySelector('.splash-title');
  if (splashTitle) splashTitle.textContent = 'Ø£Ø±ÙŠÙ‡Ø§Ù†';
  const splashSub = document.querySelector('.splash-sub');
  if (splashSub) splashSub.textContent = isEN ? 'Kingdom of Decision & Destiny' : 'Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…ØµÙŠØ±';
  const splashHint = document.querySelector('.splash-hint');
  if (splashHint) splashHint.textContent = isEN ? 'The kingdom awaits youâ€¦' : 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© ØªÙ†ØªØ¸Ø±Ùƒ...';

  // â”€â”€ Intro lore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const introLore = document.querySelector('.intro-lore');
  if (introLore) introLore.innerHTML = isEN
    ? `The kingdom of <em>Arihan</em> bleeds from within.
       The late king left behind heavy debts,
       scattered factions, and a throne shaken by fear.
       <br><br>
       You are the sole heir â€” and the pen is in your hand.
       Every decision will be told in the chronicles of history
       or buried forever.`
    : `Ù…Ù…Ù„ÙƒØ© <em>Ø£Ø±ÙŠÙ‡Ø§Ù†</em> ØªÙ†Ø²Ù Ù…Ù† Ø§Ù„Ø¯Ø§Ø®Ù„.
       Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø±Ø§Ø­Ù„ ØªØ±Ùƒ ÙˆØ±Ø§Ø¡Ù‡ Ø¯ÙŠÙˆÙ†Ø§Ù‹ Ø«Ù‚ÙŠÙ„Ø©ØŒ
       ÙØµØ§Ø¦Ù„ Ù…ØªÙ†Ø§Ø«Ø±Ø©ØŒ ÙˆØ¹Ø±Ø´Ø§Ù‹ ÙŠÙ‡Ø²Ù‘Ù‡ Ø§Ù„Ø®ÙˆÙ.
       <br><br>
       Ø£Ù†Øª Ø§Ù„ÙˆØ±ÙŠØ« Ø§Ù„ÙˆØ­ÙŠØ¯ â€” ÙˆØ§Ù„Ù‚Ù„Ù… Ø¨ÙŠØ¯Ùƒ.
       ÙƒÙ„ Ù‚Ø±Ø§Ø± Ø³ÙŠÙØ­ÙƒÙ‰ ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®
       Ø£Ùˆ ÙŠÙØ·Ù…Ø³ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¨Ø¯.`;

  // â”€â”€ Personality section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const persLabel = document.querySelector('.personality-section .section-label');
  if (persLabel) persLabel.textContent = isEN ? 'âœ¦ Your Ruling Nature âœ¦' : 'âœ¦ Ø·Ø¨ÙŠØ¹Ø© Ø­ÙƒÙ…Ùƒ âœ¦';
  const persData = [
    { ar: 'Ø§Ù„Ø­ÙƒÙŠÙ…',       en: 'The Sage',      bonusAr: '+Ø­ÙƒÙ…Ø§Ø¡ Ø¨Ø¯Ø§ÙŠØ©', bonusEn: '+Scholars start' },
    { ar: 'Ø§Ù„Ù…Ø­Ø§Ø±Ø¨',      en: 'The Warrior',   bonusAr: '+Ø¬ÙŠØ´ Ø¨Ø¯Ø§ÙŠØ©',   bonusEn: '+Army start' },
    { ar: 'Ø§Ù„Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠ',   en: 'The Diplomat',  bonusAr: '+Ø´Ø¹Ø¨ Ø¨Ø¯Ø§ÙŠØ©',   bonusEn: '+People start' },
  ];
  document.querySelectorAll('.pers-card').forEach((card, i) => {
    const d = persData[i];
    if (!d) return;
    const nameEl = card.querySelector('.pers-name');
    const bonusEl = card.querySelector('.pers-bonus');
    if (nameEl) nameEl.textContent = isEN ? d.en : d.ar;
    if (bonusEl) bonusEl.textContent = isEN ? d.bonusEn : d.bonusAr;
  });

  // â”€â”€ Faction preview cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const factionData = [
    { nameAr:'Ø§Ù„Ø´Ø¹Ø¨',   nameEn:'People',   descAr:'Ù‚ÙˆØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©',   descEn:'Your true power' },
    { nameAr:'Ø§Ù„Ø¬ÙŠØ´',   nameEn:'Army',     descAr:'Ø­Ø±Ø§Ø³ Ø§Ù„Ø¹Ø±Ø´',      descEn:'Guardians of the throne' },
    { nameAr:'Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡', nameEn:'Nobles',   descAr:'Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø«Ø±ÙˆØ©',    descEn:'Owners of wealth' },
    { nameAr:'Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡', nameEn:'Scholars', descAr:'Ù…Ø´ÙˆØ±Ø© ÙˆØ±Ø£ÙŠ',      descEn:'Counsel & wisdom' },
  ];
  document.querySelectorAll('.factions-preview .faction-card').forEach((card, i) => {
    const d = factionData[i];
    if (!d) return;
    const nameEl = card.querySelector('.faction-card-name');
    const descEl = card.querySelector('.faction-card-desc');
    if (nameEl) nameEl.textContent = isEN ? d.nameEn : d.nameAr;
    if (descEl) descEl.textContent = isEN ? d.descEn : d.descAr;
  });

  // â”€â”€ Faction stat bar labels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const statLabels = [
    { ar:'ğŸ˜ï¸ Ø§Ù„Ø´Ø¹Ø¨', en:'ğŸ˜ï¸ People' },
    { ar:'ğŸ—¡ï¸ Ø§Ù„Ø¬ÙŠØ´', en:'ğŸ—¡ï¸ Army' },
    { ar:'ğŸ’ Ø§Ù„Ù†Ø¨Ù„Ø§Ø¡', en:'ğŸ’ Nobles' },
    { ar:'ğŸ“œ Ø§Ù„Ø­ÙƒÙ…Ø§Ø¡', en:'ğŸ“œ Scholars' },
  ];
  document.querySelectorAll('.faction-stat-name').forEach((el, i) => {
    if (statLabels[i]) el.textContent = isEN ? statLabels[i].en : statLabels[i].ar;
  });

  // â”€â”€ Gender section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const genderLabel = document.querySelector('.gender-section .section-label');
  if (genderLabel) genderLabel.textContent = isEN ? 'âœ¦ Who Are You? âœ¦' : 'âœ¦ Ù…Ù† ØªÙƒÙˆÙ†ØŸ âœ¦';
  const genderCards = document.querySelectorAll('.gender-card');
  if (genderCards.length >= 2) {
    const gn0 = genderCards[0].querySelector('.gender-name');
    const gn1 = genderCards[1].querySelector('.gender-name');
    if (gn0) gn0.textContent = isEN ? 'King' : 'Ù…Ù„Ùƒ';
    if (gn1) gn1.textContent = isEN ? 'Queen' : 'Ù…Ù„ÙƒØ©';
  }

  // â”€â”€ Name label & placeholder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const nameLabel = document.getElementById('nameLabelText');
  if (nameLabel) nameLabel.textContent = isEN
    ? (isFemale ? 'âœ¦ What is your name, O Queen? âœ¦' : 'âœ¦ What is your name, O King? âœ¦')
    : (isFemale ? 'âœ¦ Ù…Ø§ Ø§Ø³Ù…ÙƒÙ Ø£ÙŠØªÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØ©ØŸ âœ¦'       : 'âœ¦ Ù…Ø§ Ø§Ø³Ù…Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØŸ âœ¦');
  const kingInput = document.getElementById('kingInput');
  if (kingInput) kingInput.placeholder = isEN ? 'Enter your nameâ€¦' : (isFemale ? 'Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…ÙƒÙ...' : 'Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ...');

  // â”€â”€ Start button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const startBtn = document.getElementById('startBtn');
  if (startBtn) startBtn.textContent = isEN ? 'âš”ï¸ Claim the Throne âš”ï¸' : (isFemale ? 'âš”ï¸ ØªØ³Ù„Ù‘Ù…ÙŠ Ø§Ù„Ø¹Ø±Ø´ âš”ï¸' : 'âš”ï¸ ØªØ³Ù„Ù‘Ù… Ø§Ù„Ø¹Ø±Ø´ âš”ï¸');

  // â”€â”€ Map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const mapTitle = document.querySelector('.map-title');
  if (mapTitle) mapTitle.textContent = isEN ? 'ğŸ—ºï¸ Map of the Kingdom of Arihan' : 'ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ù…Ù…Ù„ÙƒØ© Ø£Ø±ÙŠÙ‡Ø§Ù†';
  const mapClose = document.querySelector('.map-close');
  if (mapClose) mapClose.textContent = isEN ? 'âœ• Close Map' : 'âœ• Ø£ØºÙ„Ù‚ Ø§Ù„Ø®Ø±ÙŠØ·Ø©';
  const mapBtn = document.querySelector('.map-btn');
  if (mapBtn) mapBtn.textContent = isEN ? 'ğŸ—ºï¸ Map' : 'ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©';

  // Map SVG labels
  const mapSVGTexts = document.querySelectorAll('.map-svg text');
  if (mapSVGTexts.length) {
    const mapLabels = {
      'Ø§Ù„Ø«Ù†Ø¯Ø§Ø± Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©': 'Northern Thandar',
      'Ø§Ù„Ø¹Ø§ØµÙ…Ø©':          'Capital',
      'Ø§Ù„Ø´Ø±Ù‚':            'East',
      'Ø§Ù„Ø¬Ø¨Ø§Ù„':           'Mountains',
      'Ø§Ù„ØµØ­Ø±Ø§Ø¡ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©': 'Southern Desert',
      'Ù†Ù‡Ø± Ø£Ø±ÙŠÙ‡Ø§Ù†':       'Arihan River',
      'Ø´': 'N', 'Ø¬': 'S', 'Øº': 'W',
    };
    mapSVGTexts.forEach(el => {
      const orig = el.textContent.trim();
      if (isEN && mapLabels[orig]) el.textContent = mapLabels[orig];
      else if (!isEN && mapLabels[orig]) {
        // revert handled by re-loading; skip for now
      }
    });
  }

  // Compass E (Ø´Ø±Ù‚ at index 3 = 'Ø´' duplicate â€” skip double-Ø´)
  const compassTexts = document.querySelectorAll('.map-svg g text');
  if (compassTexts.length >= 4 && isEN) {
    const dirs = ['N','S','W','E'];
    compassTexts.forEach((el, i) => { if (dirs[i]) el.textContent = dirs[i]; });
  } else if (!isEN) {
    const dirs = ['Ø´','Ø¬','Øº','Ø´'];
    compassTexts.forEach((el, i) => { if (dirs[i]) el.textContent = dirs[i]; });
  }

  // â”€â”€ In-game bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const yearDisplay = document.getElementById('yearDisplay');
  if (yearDisplay && G && G.currentYear) {
    const yr = G.currentYear;
    yearDisplay.textContent = isEN
      ? (YEAR_NAMES_EN[yr] || 'Year ' + yr) + ' of Reign'
      : (YEAR_NAMES[yr] || 'Ø§Ù„Ø³Ù†Ø© ' + yr) + ' Ù…Ù† Ø§Ù„Ø­ÙƒÙ…';
  }
  const chapterIndicator = document.getElementById('chapterIndicator');
  if (chapterIndicator && G && G.turn) {
    chapterIndicator.textContent = isEN ? 'Chapter ' + G.turn : 'Ø§Ù„ÙØµÙ„ ' + arabNum(G.turn);
  }
  const choicesHeader = document.getElementById('choicesHeader');
  if (choicesHeader) choicesHeader.textContent = isEN
    ? (isFemale ? 'â€” Choose your path, O Queen â€”' : 'â€” Choose your path, O King â€”')
    : (isFemale ? 'â€” Ø§Ø®ØªØ§Ø±ÙŠ Ù…Ø³Ø§Ø±Ùƒ Ø£ÙŠØªÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØ© â€”' : 'â€” Ø§Ø®ØªØ± Ù…Ø³Ø§Ø±Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„Ùƒ â€”');

  // â”€â”€ King title bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const kingTitleBar = document.getElementById('kingTitleBar');
  if (kingTitleBar && G && G.name) {
    const pers = PERSONALITIES[G.personality];
    const persName = isEN ? (PERSONALITIES_EN[G.personality]?.name || pers.name) : pers.name;
    const titleWord = isEN ? (isFemale ? 'Queen' : 'King') : (isFemale ? 'Ø§Ù„Ù…Ù„ÙƒØ©' : 'Ø§Ù„Ù…Ù„Ùƒ');
    kingTitleBar.innerHTML = `${titleWord} ${G.name} <span class="personality-badge">${pers.icon} ${persName}</span>`;
  }

  // â”€â”€ Persistent UI elements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const saveInd = document.getElementById('saveIndicator');
  if (saveInd) saveInd.textContent = isEN ? 'ğŸ’¾ Auto-saved' : 'ğŸ’¾ ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹';
  const achTitle = document.querySelector('.ach-title');
  if (achTitle) achTitle.textContent = isEN ? 'New Achievement' : 'Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯';

  // â”€â”€ NG+ badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ngBadge = document.getElementById('ngBadge');
  if (ngBadge) ngBadge.textContent = isEN
    ? 'âœ¦ Hard Governance Mode â€” New Game+ âœ¦'
    : 'âœ¦ ÙˆØ¶Ø¹ Ø§Ù„Ø­ÙƒÙ… Ø§Ù„ØµØ¹Ø¨ â€” New Game+ âœ¦';

  // â”€â”€ Lang toggle button states â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const btnAr = document.getElementById('btnAr');
  const btnEn = document.getElementById('btnEn');
  if (btnAr) { btnAr.style.color = isEN ? '#a08860' : '#d4a843'; btnAr.style.background = isEN ? 'transparent' : 'rgba(212,168,67,0.15)'; }
  if (btnEn) { btnEn.style.color = isEN ? '#d4a843' : '#a08860'; btnEn.style.background = isEN ? 'rgba(212,168,67,0.15)' : 'transparent'; }
}

// â”€â”€ CHOOSE LANG (from the opening screen) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function chooseLang(lang) {
  currentLang = lang;
  try { localStorage.setItem('arihan_lang', lang); } catch(e){}
  const screen = document.getElementById('langSelect');
  if (screen) {
    screen.classList.add('hidden');
    setTimeout(() => screen.remove(), 800);
  }
  // Apply immediately
  setLang(lang);
}

// â”€â”€ SET LANGUAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setLang(lang) {
  currentLang = lang;
  try { localStorage.setItem('arihan_lang', lang); } catch(e){}
  applyLangUI();
}

// â”€â”€ PATCH SELECTGENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.selectGender = function(el) {
  document.querySelectorAll('.gender-card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  selectedGender = el.dataset.gender;
  const isFemale = selectedGender === 'female';
  const isEN = currentLang === 'en';
  const nameLabel = document.getElementById('nameLabelText');
  if (nameLabel) nameLabel.textContent = isEN
    ? (isFemale ? 'âœ¦ What is your name, O Queen? âœ¦' : 'âœ¦ What is your name, O King? âœ¦')
    : (isFemale ? 'âœ¦ Ù…Ø§ Ø§Ø³Ù…ÙƒÙ Ø£ÙŠØªÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØ©ØŸ âœ¦'       : 'âœ¦ Ù…Ø§ Ø§Ø³Ù…Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØŸ âœ¦');
  const kingInput = document.getElementById('kingInput');
  if (kingInput) kingInput.placeholder = isEN ? 'Enter your nameâ€¦' : (isFemale ? 'Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…ÙƒÙ...' : 'Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ...');
  const startBtn = document.getElementById('startBtn');
  if (startBtn) startBtn.textContent = isEN ? 'âš”ï¸ Claim the Throne âš”ï¸' : (isFemale ? 'âš”ï¸ ØªØ³Ù„Ù‘Ù…ÙŠ Ø§Ù„Ø¹Ø±Ø´ âš”ï¸' : 'âš”ï¸ ØªØ³Ù„Ù‘Ù… Ø§Ù„Ø¹Ø±Ø´ âš”ï¸');
  const choicesHeader = document.getElementById('choicesHeader');
  if (choicesHeader) choicesHeader.textContent = isEN
    ? (isFemale ? 'â€” Choose your path, O Queen â€”' : 'â€” Choose your path, O King â€”')
    : (isFemale ? 'â€” Ø§Ø®ØªØ§Ø±ÙŠ Ù…Ø³Ø§Ø±Ùƒ Ø£ÙŠØªÙ‡Ø§ Ø§Ù„Ù…Ù„ÙƒØ© â€”' : 'â€” Ø§Ø®ØªØ± Ù…Ø³Ø§Ø±Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ù„Ùƒ â€”');
};

// â”€â”€ PATCH RESTART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _origRestart_bi = window.restartGame;
window.restartGame = function() {
  _origRestart_bi();
  setTimeout(() => applyLangUI(), 100);
};

// â”€â”€ PATCH STARTGAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _origStart_bi = window.startGame;
window.startGame = function() {
  _origStart_bi();
  setTimeout(() => applyLangUI(), 150);
};

// â”€â”€ PATCH SHARE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _origShare_bi = window.shareResult || shareResult;
window.shareResult = function() {
  if (currentLang === 'ar') { _origShare_bi(); return; }
  const score = document.getElementById('scoreValue').textContent;
  const pers = PERSONALITIES_EN[G.personality] || PERSONALITIES[G.personality];
  const ending = document.getElementById('endingTitle').textContent;
  const isFemale = G.gender === 'female';
  const text = `ğŸ‘‘ I played Arihan!\n\n${isFemale ? 'Queen' : 'King'}: ${G.name} (${PERSONALITIES[G.personality].icon} ${pers.name})\nEnding: "${ending}"\nGovernance Score: ${score}\n\nPeople: ${G.people} | Army: ${G.army} | Nobles: ${G.nobles} | Scholars: ${G.church}\n\nArihan â€” Kingdom of Decision & Destiny`;
  if (navigator.share) {
    navigator.share({ title: 'Arihan', text });
  } else {
    navigator.clipboard?.writeText(text).then(() => showBanner('ğŸ“‹', 'Result copied!'));
  }
};

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// If lang was previously saved, skip the selection screen
(function initLang() {
  let saved = null;
  try { saved = localStorage.getItem('arihan_lang'); } catch(e){}
  if (saved) {
    // Skip lang select screen
    const screen = document.getElementById('langSelect');
    if (screen) { screen.style.display = 'none'; screen.remove(); }
    currentLang = saved;
    setTimeout(() => setLang(saved), 200);
  } else {
    // Show lang select â€” it's already in the DOM
    // applyLangUI will be called when user picks
    setTimeout(() => {
      // Default: show both equally until chosen
    }, 100);
  }
}());


</script>
</body>
</html>
